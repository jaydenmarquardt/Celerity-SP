/*! For license information please see chunk.231_none_c1893f76baaa40238f73.js.LICENSE.txt */
"use strict";(self["webpackJsonp_8496636c-2300-4915-abef-20de64c98d8b_1.19.0_"]=self["webpackJsonp_8496636c-2300-4915-abef-20de64c98d8b_1.19.0_"]||[]).push([[231],{6231:(e,t,n)=>{n.r(t),n.d(t,{NestedAppAuthController:()=>S});var a=n(2190),i=n(2520),r=n(6124),o=n(586),s=n(3356),c=n(4358),d=n(543),l=n(3905),u=n(773),f=n(711),p=n(5500),m=n(2586),_=n(6937),h=n(6925);class b{constructor(e,t,n,a){this.clientId=e,this.clientCapabilities=t,this.crypto=n,this.logger=a}toNaaTokenRequest(e){let t;t=void 0===e.extraQueryParameters?new Map:new Map(Object.entries(e.extraQueryParameters));const n=(new c.H).addClientCapabilitiesToClaims(e.claims,this.clientCapabilities);return{platformBrokerId:e.account?.homeAccountId,clientId:this.clientId,authority:e.authority,scope:e.scopes.join(" "),correlationId:void 0!==e.correlationId?e.correlationId:this.crypto.createNewGuid(),claims:d.x.isEmptyObj(n)?void 0:n,state:e.state,authenticationScheme:e.authenticationScheme||l.sO.BEARER,extraParameters:t}}fromNaaTokenResponse(e,t,n){if(!t.token.id_token||!t.token.access_token)throw(0,u.CP)(f.jM);const a=new Date(1e3*(n+(t.token.expires_in||0))),i=p.X_(t.token.id_token,this.crypto.base64Decode),r=this.fromNaaAccountInfo(t.account,i),o=t.token.scope||e.scope;return{authority:t.token.authority||r.environment,uniqueId:r.localAccountId,tenantId:r.tenantId,scopes:o.split(" "),account:r,idToken:t.token.id_token,idTokenClaims:i,accessToken:t.token.access_token,fromCache:!0,expiresOn:a,tokenType:e.authenticationScheme||l.sO.BEARER,correlationId:e.correlationId,extExpiresOn:a,state:e.state}}fromNaaAccountInfo(e,t){const n=t||e.idTokenClaims,a=e.localAccountId||n?.oid||n?.sub||"",i=e.tenantId||n?.tid||"",r=e.homeAccountId||`${a}.${i}`,o=e.username||n?.preferred_username||"",s=e.name||n?.name;return{homeAccountId:r,environment:e.environment,tenantId:i,username:o,localAccountId:a,name:s,idToken:e.idToken,idTokenClaims:n}}fromBridgeError(e){if(!function(e){return void 0!==e.status}(e))return new h.u4("unknown_error","An unknown error occurred");switch(e.status){case"USER_CANCEL":return new u.ir(f.$R);case"NO_NETWORK":return new u.ir(f.Rq);case"ACCOUNT_UNAVAILABLE":return new u.ir(f.nX);case"DISABLED":return new u.ir(f.Hs);case"NESTED_APP_AUTH_UNAVAILABLE":return new u.ir(e.code||f.Hs,e.description);case"TRANSIENT_ERROR":case"PERSISTENT_ERROR":return new m.n(e.code,e.description);case"USER_INTERACTION_REQUIRED":return new _.Jo(e.code,e.description);default:return new h.u4(e.code,e.description)}}}class g extends h.u4{constructor(e,t){super(e,t),Object.setPrototypeOf(this,g.prototype),this.name="NestedAppAuthError"}static createUnsupportedError(){return new g("unsupported_method","The PKCE code challenge and verifier could not be generated.")}}var v=n(9079),y=n(3938);class S{constructor(e){this.operatingContext=e;const t=this.operatingContext.getBridgeProxy();if(void 0===t)throw new Error("unexpected: bridgeProxy is undefined");this.bridgeProxy=t,this.config=e.getConfig(),this.logger=this.operatingContext.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=e.isBrowserEnvironment()?new s.Q(this.logger,this.performanceClient):a.d,this.eventHandler=new v.b(this.logger,this.browserCrypto),this.nestedAppAuthAdapter=new b(this.config.auth.clientId,this.config.auth.clientCapabilities,this.browserCrypto,this.logger)}getBrowserStorage(){throw g.createUnsupportedError()}getEventHandler(){return this.eventHandler}static async createController(e){const t=new S(e);return Promise.resolve(t)}initialize(){return Promise.resolve()}async acquireTokenInteractive(e){this.eventHandler.emitEvent(y.t.ACQUIRE_TOKEN_START,o.g_.Popup,e);const t=this.performanceClient.startMeasurement(i.Ok.AcquireTokenPopup,e.correlationId);t?.add({nestedAppAuthRequest:!0});try{const n=this.nestedAppAuthAdapter.toNaaTokenRequest(e),a=r.I.nowSeconds(),i=await this.bridgeProxy.getTokenInteractive(n),s=this.nestedAppAuthAdapter.fromNaaTokenResponse(n,i,a);return this.operatingContext.setActiveAccount(s.account),this.eventHandler.emitEvent(y.t.ACQUIRE_TOKEN_SUCCESS,o.g_.Popup,s),t.add({accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length}),t.end({success:!0,requestId:s.requestId}),s}catch(e){const n=this.nestedAppAuthAdapter.fromBridgeError(e);throw this.eventHandler.emitEvent(y.t.ACQUIRE_TOKEN_FAILURE,o.g_.Popup,null,e),t.end({errorCode:n.errorCode,subErrorCode:n.subError,success:!1}),n}}async acquireTokenSilentInternal(e){this.eventHandler.emitEvent(y.t.ACQUIRE_TOKEN_START,o.g_.Silent,e);const t=this.performanceClient.startMeasurement(i.Ok.SsoSilent,e.correlationId);t?.increment({visibilityChangeCount:0}),t?.add({nestedAppAuthRequest:!0});try{const n=this.nestedAppAuthAdapter.toNaaTokenRequest(e),a=r.I.nowSeconds(),i=await this.bridgeProxy.getTokenSilent(n),s=this.nestedAppAuthAdapter.fromNaaTokenResponse(n,i,a);return this.operatingContext.setActiveAccount(s.account),this.eventHandler.emitEvent(y.t.ACQUIRE_TOKEN_SUCCESS,o.g_.Silent,s),t?.add({accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length}),t?.end({success:!0,requestId:s.requestId}),s}catch(e){const n=this.nestedAppAuthAdapter.fromBridgeError(e);throw this.eventHandler.emitEvent(y.t.ACQUIRE_TOKEN_FAILURE,o.g_.Silent,null,e),t?.end({errorCode:n.errorCode,subErrorCode:n.subError,success:!1}),n}}async acquireTokenPopup(e){return this.acquireTokenInteractive(e)}acquireTokenRedirect(e){throw g.createUnsupportedError()}async acquireTokenSilent(e){return this.acquireTokenSilentInternal(e)}acquireTokenByCode(e){throw g.createUnsupportedError()}acquireTokenNative(e,t,n){throw g.createUnsupportedError()}acquireTokenByRefreshToken(e,t){throw g.createUnsupportedError()}addEventCallback(e){return this.eventHandler.addEventCallback(e)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){throw g.createUnsupportedError()}removePerformanceCallback(e){throw g.createUnsupportedError()}enableAccountStorageEvents(){throw g.createUnsupportedError()}disableAccountStorageEvents(){throw g.createUnsupportedError()}getAccount(e){throw g.createUnsupportedError()}getAccountByHomeId(e){const t=this.operatingContext.getActiveAccount();return void 0!==t&&t.homeAccountId===e?this.nestedAppAuthAdapter.fromNaaAccountInfo(t):null}getAccountByLocalId(e){const t=this.operatingContext.getActiveAccount();return void 0!==t&&t.localAccountId===e?this.nestedAppAuthAdapter.fromNaaAccountInfo(t):null}getAccountByUsername(e){const t=this.operatingContext.getActiveAccount();return void 0!==t&&t.username===e?this.nestedAppAuthAdapter.fromNaaAccountInfo(t):null}getAllAccounts(){const e=this.operatingContext.getActiveAccount();return void 0!==e?[this.nestedAppAuthAdapter.fromNaaAccountInfo(e)]:[]}handleRedirectPromise(e){throw g.createUnsupportedError()}loginPopup(e){if(void 0!==e)return this.acquireTokenInteractive(e);throw g.createUnsupportedError()}loginRedirect(e){throw g.createUnsupportedError()}logout(e){throw g.createUnsupportedError()}logoutRedirect(e){throw g.createUnsupportedError()}logoutPopup(e){throw g.createUnsupportedError()}ssoSilent(e){return this.acquireTokenSilentInternal(e)}getTokenCache(){throw g.createUnsupportedError()}getLogger(){return this.logger}setLogger(e){this.logger=e}setActiveAccount(e){this.logger.warning("nestedAppAuth does not support setActiveAccount")}getActiveAccount(){const e=this.operatingContext.getActiveAccount();return void 0!==e?this.nestedAppAuthAdapter.fromNaaAccountInfo(e):null}initializeWrapperLibrary(e,t){}setNavigationClient(e){this.logger.warning("setNavigationClient is not supported in nested app auth")}getConfiguration(){return this.config}isBrowserEnv(){return this.operatingContext.isBrowserEnvironment()}getBrowserCrypto(){return this.browserCrypto}getPerformanceClient(){throw g.createUnsupportedError()}getRedirectResponse(){throw g.createUnsupportedError()}preflightBrowserEnvironmentCheck(e,t){throw g.createUnsupportedError()}async clearCache(e){throw g.createUnsupportedError()}async hydrateCache(e,t){throw g.createUnsupportedError()}}}
}]);