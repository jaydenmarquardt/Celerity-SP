/*! For license information please see chunk.734_none_d5235e3bfced0205cf83.js.LICENSE.txt */
"use strict";(self["webpackJsonp_8496636c-2300-4915-abef-20de64c98d8b_1.19.0_"]=self["webpackJsonp_8496636c-2300-4915-abef-20de64c98d8b_1.19.0_"]||[]).push([[734],{7512:(e,t,n)=>{n.d(t,{L:()=>Wr});var a=n(8222),i=n(5529),r=n(5243),o=n(1540),s=n(586);class c{static loggerCallback(e,t){switch(e){case i.i.Error:return void console.error(t);case i.i.Info:return void console.info(t);case i.i.Verbose:return void console.debug(t);case i.i.Warning:return void console.warn(t);default:return void console.log(t)}}constructor(e){let t;this.browserEnvironment="undefined"!=typeof window,this.config=(0,r.Z7)(e,this.browserEnvironment);try{t=window[s.Tx.SessionStorage]}catch(e){}const n=t?.getItem(s.tg),a=t?.getItem(s.jK)?.toLowerCase(),d="true"===a||"false"!==a&&void 0,l={...this.config.system.loggerOptions},u=n&&Object.keys(i.i).includes(n)?i.i[n]:void 0;u&&(l.loggerCallback=c.loggerCallback,l.logLevel=u),void 0!==d&&(l.piiLoggingEnabled=d),this.logger=new i.Y(l,o.u,o.i),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}class d extends c{getModuleName(){return d.MODULE_NAME}getId(){return d.ID}async initialize(){return this.available="undefined"!=typeof window,this.available}}d.MODULE_NAME="",d.ID="StandardOperatingContext";var l=n(605);class u{static async createPublicClientApplication(e){const t=await async function(e){const t=new d(e);return await t.initialize(),(await Promise.resolve().then(n.bind(n,605))).StandardController.createController(t)}(e);return new u(e,t)}constructor(e,t){if(t)this.controller=t;else{const t=new d(e);this.controller=new l.StandardController(t)}}async initialize(){return this.controller.initialize()}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e){return this.controller.addEventCallback(e)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}var f=n(2520),p=n(3700),m=n(3905);function _(){let e;try{e=window[s.Tx.SessionStorage];const t=e?.getItem(s.RG);if(1===Number(t))return n.e(206).then(n.bind(n,3206))}catch(e){}}function h(){return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.now}function b(e){if(e&&h())return Math.round(window.performance.now()-e)}class g extends class{constructor(e,t,n,a,i,r,o){this.authority=t,this.libraryName=a,this.libraryVersion=i,this.applicationTelemetry=r,this.clientId=e,this.logger=n,this.callbacks=new Map,this.eventsByCorrelationId=new Map,this.queueMeasurements=new Map,this.preQueueTimeByCorrelationId=new Map,this.intFields=o||new Set;for(const e of f.I0)this.intFields.add(e)}startPerformanceMeasurement(e,t){return{}}getPreQueueTime(e,t){const n=this.preQueueTimeByCorrelationId.get(t);if(n){if(n.name===e)return n.time;this.logger.trace(`PerformanceClient.getPreQueueTime: no pre-queue time found for ${e}, unable to add queue measurement`)}else this.logger.trace(`PerformanceClient.getPreQueueTime: no pre-queue times found for correlationId: ${t}, unable to add queue measurement`)}calculateQueuedTime(e,t){return e<1?(this.logger.trace(`PerformanceClient: preQueueTime should be a positive integer and not ${e}`),0):t<1?(this.logger.trace(`PerformanceClient: currentTime should be a positive integer and not ${t}`),0):t<e?(this.logger.trace("PerformanceClient: currentTime is less than preQueueTime, check how time is being retrieved"),0):t-e}addQueueMeasurement(e,t,n,a){if(!t)return void this.logger.trace(`PerformanceClient.addQueueMeasurement: correlationId not provided for ${e}, cannot add queue measurement`);if(0===n)this.logger.trace(`PerformanceClient.addQueueMeasurement: queue time provided for ${e} is ${n}`);else if(!n)return void this.logger.trace(`PerformanceClient.addQueueMeasurement: no queue time provided for ${e}`);const i={eventName:e,queueTime:a?0:n,manuallyCompleted:a},r=this.queueMeasurements.get(t);if(r)r.push(i),this.queueMeasurements.set(t,r);else{this.logger.trace(`PerformanceClient.addQueueMeasurement: adding correlationId ${t} to queue measurements`);const e=[i];this.queueMeasurements.set(t,e)}this.preQueueTimeByCorrelationId.delete(t)}startMeasurement(e,t){const n=t||this.generateId();t||this.logger.info(`PerformanceClient: No correlation id provided for ${e}, generating`,n),this.logger.trace(`PerformanceClient: Performance measurement started for ${e}`,n);const a={eventId:this.generateId(),status:f.$L.InProgress,authority:this.authority,libraryName:this.libraryName,libraryVersion:this.libraryVersion,clientId:this.clientId,name:e,startTimeMs:Date.now(),correlationId:n,appName:this.applicationTelemetry?.appName,appVersion:this.applicationTelemetry?.appVersion};return this.cacheEventByCorrelationId(a),{end:e=>this.endMeasurement({...a,...e}),discard:()=>this.discardMeasurements(a.correlationId),add:e=>this.addFields(e,a.correlationId),increment:e=>this.incrementFields(e,a.correlationId),event:a,measurement:new p.g}}endMeasurement(e){const t=this.eventsByCorrelationId.get(e.correlationId);if(!t)return this.logger.trace(`PerformanceClient: Measurement not found for ${e.eventId}`,e.correlationId),null;const n=e.eventId===t.eventId;let a={totalQueueTime:0,totalQueueCount:0,manuallyCompletedCount:0};n?(a=this.getQueueInfo(e.correlationId),this.discardCache(t.correlationId)):t.incompleteSubMeasurements?.delete(e.eventId);const i=e.durationMs||this.getDurationMs(e.startTimeMs);if(this.logger.trace(`PerformanceClient: Performance measurement ended for ${e.name}: ${i} ms`,e.correlationId),!n)return t[e.name+"DurationMs"]=Math.floor(i),{...t};let r={...t,...e},o=0;return r.incompleteSubMeasurements?.forEach(t=>{this.logger.trace(`PerformanceClient: Incomplete submeasurement ${t.name} found for ${e.name}`,r.correlationId),o++}),r.incompleteSubMeasurements=void 0,r={...r,durationMs:Math.round(i),queuedTimeMs:a.totalQueueTime,queuedCount:a.totalQueueCount,queuedManuallyCompletedCount:a.manuallyCompletedCount,status:f.$L.Completed,incompleteSubsCount:o},this.truncateIntegralFields(r),this.emitEvents([r],e.correlationId),r}addFields(e,t){this.logger.trace("PerformanceClient: Updating static fields");const n=this.eventsByCorrelationId.get(t);n?this.eventsByCorrelationId.set(t,{...n,...e}):this.logger.trace("PerformanceClient: Event not found for",t)}incrementFields(e,t){this.logger.trace("PerformanceClient: Updating counters");const n=this.eventsByCorrelationId.get(t);if(n)for(const t in e){if(n.hasOwnProperty(t)){if(isNaN(Number(n[t])))return}else n[t]=0;n[t]+=e[t]}else this.logger.trace("PerformanceClient: Event not found for",t)}cacheEventByCorrelationId(e){const t=this.eventsByCorrelationId.get(e.correlationId);t?(this.logger.trace(`PerformanceClient: Performance measurement for ${e.name} added/updated`,e.correlationId),t.incompleteSubMeasurements=t.incompleteSubMeasurements||new Map,t.incompleteSubMeasurements.set(e.eventId,{name:e.name,startTimeMs:e.startTimeMs})):(this.logger.trace(`PerformanceClient: Performance measurement for ${e.name} started`,e.correlationId),this.eventsByCorrelationId.set(e.correlationId,{...e}))}getQueueInfo(e){const t=this.queueMeasurements.get(e);t||this.logger.trace(`PerformanceClient: no queue measurements found for for correlationId: ${e}`);let n=0,a=0,i=0;return t?.forEach(e=>{n+=e.queueTime,a++,i+=e.manuallyCompleted?1:0}),{totalQueueTime:n,totalQueueCount:a,manuallyCompletedCount:i}}discardMeasurements(e){this.logger.trace("PerformanceClient: Performance measurements discarded",e),this.eventsByCorrelationId.delete(e)}discardCache(e){this.discardMeasurements(e),this.logger.trace("PerformanceClient: QueueMeasurements discarded",e),this.queueMeasurements.delete(e),this.logger.trace("PerformanceClient: Pre-queue times discarded",e),this.preQueueTimeByCorrelationId.delete(e)}addPerformanceCallback(e){const t=this.generateId();return this.callbacks.set(t,e),this.logger.verbose(`PerformanceClient: Performance callback registered with id: ${t}`),t}removePerformanceCallback(e){const t=this.callbacks.delete(e);return t?this.logger.verbose(`PerformanceClient: Performance callback ${e} removed.`):this.logger.verbose(`PerformanceClient: Performance callback ${e} not removed.`),t}emitEvents(e,t){this.logger.verbose("PerformanceClient: Emitting performance events",t),this.callbacks.forEach((n,a)=>{this.logger.trace(`PerformanceClient: Emitting event to callback ${a}`,t),n.apply(null,[e])})}truncateIntegralFields(e){this.intFields.forEach(t=>{t in e&&"number"==typeof e[t]&&(e[t]=Math.floor(e[t]))})}getDurationMs(e){const t=Date.now()-e;return t<0?t:0}}{constructor(e,t){super(e.auth.clientId,e.auth.authority||`${m.oT.DEFAULT_AUTHORITY}`,new i.Y(e.system?.loggerOptions||{},o.u,o.i),o.u,o.i,e.telemetry?.application||{appName:"",appVersion:""},t)}generateId(){return window.crypto.randomUUID()}getPageVisibility(){return document.visibilityState?.toString()||null}deleteIncompleteSubMeasurements(e){_()?.then(t=>{const n=this.eventsByCorrelationId.get(e.event.correlationId),a=n&&n.eventId===e.event.eventId,i=[];a&&n?.incompleteSubMeasurements&&n.incompleteSubMeasurements.forEach(e=>{i.push({...e})}),t.BrowserPerformanceMeasurement.flushMeasurements(e.event.correlationId,i)})}startMeasurement(e,t){const n=this.getPageVisibility(),a=super.startMeasurement(e,t),i=h()?window.performance.now():void 0,r=_()?.then(t=>new t.BrowserPerformanceMeasurement(e,a.event.correlationId));return r?.then(e=>e.startMeasurement()),{...a,end:e=>{const t=a.end({...e,startPageVisibility:n,endPageVisibility:this.getPageVisibility(),durationMs:b(i)});return r?.then(e=>e.endMeasurement()),this.deleteIncompleteSubMeasurements(a),t},discard:()=>{a.discard(),r?.then(e=>e.flushMeasurement()),this.deleteIncompleteSubMeasurements(a)}}}setPreQueueTime(e,t){if(!h())return void this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to set telemetry queue time for ${e}`);if(!t)return void this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to set telemetry queue time`);const n=this.preQueueTimeByCorrelationId.get(t);n&&(this.logger.trace(`BrowserPerformanceClient: Incomplete pre-queue ${n.name} found`,t),this.addQueueMeasurement(n.name,t,void 0,!0)),this.preQueueTimeByCorrelationId.set(t,{name:e,time:window.performance.now()})}addQueueMeasurement(e,t,n,a){if(!h())return void this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to add queue measurement for ${e}`);if(!t)return void this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to add queue measurement`);const i=super.getPreQueueTime(e,t);if(!i)return;const r=window.performance.now(),o=n||super.calculateQueuedTime(i,r);return super.addQueueMeasurement(e,t,o,a)}}var v="function",y="object",S="undefined",D=Object,I=D.prototype,x=D.assign,C=D.create,O=D.defineProperty,w=I.hasOwnProperty,E=null;function A(e){void 0===e&&(e=!0);var t=!1===e?null:E;return t||(typeof globalThis!==S&&(t=globalThis),t||typeof self===S||(t=self),t||typeof window===S||(t=window),t||typeof n.g===S||(t=n.g),E=t),t}function L(e){throw new TypeError(e)}function k(e){if(C)return C(e);if(null==e)return{};var t=typeof e;function n(){}return t!==y&&t!==v&&L("Object prototype may only be an Object:"+e),n.prototype=e,new n}(A()||{}).Symbol,(A()||{}).Reflect;var M,P=function(e,t){return P=D.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},P(e,t)};function T(e,t){function n(){this.constructor=e}typeof t!==v&&null!==t&&L("Class extends value "+String(t)+" is not a constructor or null"),P(e,t),e.prototype=null===t?k(t):(n.prototype=t.prototype,new n)}function U(e,t){for(var n=0,a=t.length,i=e.length;n<a;n++,i++)e[i]=t[n];return e}var F,H="undefined",R="prototype",N="function",B="_dynClass",j="_unknown_",V=Object,z=V.getPrototypeOf,G=V.getOwnPropertyNames,K=(typeof globalThis!==H&&(F=globalThis),F||typeof self===H||(F=self),F||typeof window===H||(F=window),F||typeof n.g===H||(F=n.g),F||{}),W=K.__dynProto$Gbl||(K.__dynProto$Gbl={o:(M={},M.setInstFuncs=!0,M.useBaseInst=!0,M),n:1e3});function q(e,t){return e&&V.prototype.hasOwnProperty.call(e,t)}function Q(e){return e&&(e===V.prototype||e===Array.prototype)}function Y(e){return Q(e)||e===Function.prototype}function J(e){var t;if(e){if(z)return z(e);var n=e.__proto__||e.prototype||(e.constructor?e.constructor.prototype:null);t=e._dyn__proto__||n,q(e,"_dyn__proto__")||(delete e._dynInstProto,t=e._dyn__proto__=e._dynInstProto||e._dyn__proto__,e._dynInstProto=n)}return t}function X(e,t){var n=[];if(G)n=G(e);else for(var a in e)"string"==typeof a&&q(e,a)&&n.push(a);if(n&&n.length>0)for(var i=0;i<n.length;i++)t(n[i])}function Z(e,t,n){return"constructor"!==t&&typeof e[t]===N&&(n||q(e,t))}function $(e){throw new TypeError("DynamicProto: "+e)}function ee(e,t){for(var n=e.length-1;n>=0;n--)if(e[n]===t)return!0;return!1}function te(e,t,n,a){var i=null;if(e&&q(n,B)){var r=e._dynInstFuncs||{};if((i=(r[n._dynClass]||{})[t])||$("Missing ["+t+"] "+N),!i._dynInstChk&&!1!==r._dynInstChk){for(var o=!q(e,t),s=J(e),c=[];o&&s&&!Y(s)&&!ee(c,s);){var d=s[t];if(d){o=d===a;break}c.push(s),s=J(s)}try{o&&(e[t]=i),i._dynInstChk=1}catch(e){r._dynInstChk=!1}}}return i}function ne(e,t,n){var a=t[e];return a===n&&(a=J(t)[e]),typeof a!==N&&$("["+e+"] is not a "+N),a}function ae(e,t){return q(e,R)?e.name||t||j:((e||{}).constructor||{}).name||t||j}function ie(e,t,n,a){q(e,R)||$("theClass is an invalid class definition.");var i=e.prototype;(function(e,t){if(z){for(var n=[],a=J(t);a&&!Y(a)&&!ee(n,a);){if(a===e)return!0;n.push(a),a=J(a)}return!1}return!0})(i,t)||$("["+ae(e)+"] not in hierarchy of ["+ae(t)+"]");var r=null;q(i,B)?r=i._dynClass:(r="_dynCls$"+ae(e,"_")+"$"+W.n,W.n++,i._dynClass=r);var o=ie._dfOpts,s=!!o.useBaseInst;s&&a&&void 0!==a.useBaseInst&&(s=!!a.useBaseInst);var c=function(e){var t={};return X(e,function(n){!t[n]&&Z(e,n,!1)&&(t[n]=e[n])}),t}(t),d=function(e,t,n,a){function i(e,t,n){var i=t[n];if(i._isDynProxy&&a){var r=e._dynInstFuncs||{};!1!==r._dynInstChk&&(i=(r[t._dynClass]||{})[n]||i)}return function(){return i.apply(e,arguments)}}var r={};X(n,function(e){r[e]=i(t,n,e)});for(var o=J(e),s=[];o&&!Y(o)&&!ee(s,o);)X(o,function(e){!r[e]&&Z(o,e,!z)&&(r[e]=i(t,o,e))}),s.push(o),o=J(o);return r}(i,t,c,s);n(t,d);var l=!!z&&!!o.setInstFuncs;l&&a&&(l=!!a.setInstFuncs),function(e,t,n,a,i){if(!Q(e)){var r=n._dynInstFuncs=n._dynInstFuncs||{},o=r[t]=r[t]||{};!1!==r._dynInstChk&&(r._dynInstChk=!!i),X(n,function(t){Z(n,t,!1)&&n[t]!==a[t]&&(o[t]=n[t],delete n[t],(!q(e,t)||e[t]&&!e[t]._isDynProxy)&&(e[t]=function(e,t){var n=function(){return(te(this,t,e,n)||ne(t,e,n)).apply(this,arguments)};return n._isDynProxy=1,n}(e,t)))})}}(i,r,t,c,!1!==l)}ie._dfOpts=W.o;var re="",oe="extensionConfig",se=O,ce=D.freeze,de=(D.seal,D.keys),le=String.prototype,ue=le.trim,fe=le.endsWith,pe=le.startsWith,me=Date.prototype.toISOString,_e=Array.isArray,he=I.toString,be=w.toString,ge=be.call(D),ve=/-([a-z])/g,ye=/([^\w\d_$])/g,Se=/^(\d+[\w\d_$])/,De=Object.getPrototypeOf;function Ie(e){return void 0===e||typeof e===S}function xe(e){return null===e||Ie(e)}function Ce(e){return!xe(e)}function Oe(e){return!(!e||typeof e!==y)}function we(e){return!(!e||typeof e!==v)}function Ee(e){var t=e;return t&&Pe(t)&&(t=(t=(t=t.replace(ve,function(e,t){return t.toUpperCase()})).replace(ye,"_")).replace(Se,function(e,t){return"_"+t})),t}function Ae(e,t){if(e)for(var n in e)w.call(e,n)&&t.call(e,n,e[n])}function Le(e,t){var n=!1;return e&&t&&!(n=e===t)&&(n=pe?e.startsWith(t):function(e,t){var n=!1,a=t?t.length:0;if(e&&a&&e.length>=a&&!(n=e===t)){for(var i=0;i<a;i++)if(e[i]!==t[i])return!1;n=!0}return n}(e,t)),n}function ke(e,t){return!(!e||!t)&&-1!==e.indexOf(t)}var Me=_e||function(e){return!(!e||"[object Array]"!==he.call(e))};function Pe(e){return"string"==typeof e}function Te(e){return"number"==typeof e}function Ue(e){return"boolean"==typeof e}function Fe(e){var t=!1;if(e&&"object"==typeof e){var n=De?De(e):function(e){if(e){if(De)return De(e);var t=e.__proto__||e.prototype||e.constructor;if(t)return t}return null}(e);n?(n.constructor&&w.call(n,"constructor")&&(n=n.constructor),t=typeof n===v&&be.call(n)===ge):t=!0}return t}function He(e){if(e)return me?e.toISOString():function(e){if(e&&e.getUTCFullYear){var t=function(e){var t=String(e);return 1===t.length&&(t="0"+t),t};return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(e)}function Re(e,t,n){var a=e.length;try{for(var i=0;i<a&&(!(i in e)||-1!==t.call(n||e,e[i],i,e));i++);}catch(e){}}function Ne(e,t,n){if(e){if(e.indexOf)return e.indexOf(t,n);var a=e.length,i=n||0;try{for(var r=Math.max(i>=0?i:a-Math.abs(i),0);r<a;r++)if(r in e&&e[r]===t)return r}catch(e){}}return-1}function Be(e){return e&&(e=ue&&e.trim?e.trim():e.replace?e.replace(/^\s+|(?=\s)\s+$/g,re):e),e}var je=!{toString:null}.propertyIsEnumerable("toString"),Ve=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];function ze(e){var t=typeof e;if(t===v||t===y&&null!==e||L("objKeys called on non-object"),!je&&de)return de(e);var n=[];for(var a in e)e&&w.call(e,a)&&n.push(a);if(je)for(var i=Ve.length,r=0;r<i;r++)e&&w.call(e,Ve[r])&&n.push(Ve[r]);return n}function Ge(e,t,n,a){if(se)try{var i={enumerable:!0,configurable:!0};return n&&(i.get=n),a&&(i.set=a),se(e,t,i),!0}catch(e){}return!1}function Ke(e){return ce&&Ae(e,function(e,t){(Me(t)||Oe(t))&&ce(t)}),We(e)}var We=ce||function(e){return e};function qe(){var e=Date;return e.now?e.now():(new e).getTime()}function Qe(e){return(t=e)&&"[object Error]"===he.call(t)?e.name:re;var t}function Ye(e,t,n,a,i){var r=n;return e&&((r=e[t])===n||i&&!i(r)||a&&!a(n)||(r=n,e[t]=r)),r}function Je(e,t,n){var a;return e?!(a=e[t])&&xe(a)&&(a=Ie(n)?{}:n,e[t]=a):a=Ie(n)?{}:n,a}function Xe(e,t){return xe(e)?t:e}function Ze(e){return!!e}function $e(e){throw new Error(e)}function et(e,t,n,a,i){e&&t&&n&&(!1!==i||Ie(e[t]))&&(e[t]=function(e,t){var n=null,a=null;return we(e)?n=e:a=e,function(){var e=arguments;if(n&&(a=n()),a)return a[t].apply(a,e)}}(n,a))}function tt(e){return e&&x&&(e=D(x({},e))),e}function nt(e,t,n,a,i,r){var o=arguments,s=o[0]||{},c=o.length,d=!1,l=1;for(c>0&&Ue(s)&&(d=s,s=o[l]||{},l++),Oe(s)||(s={});l<c;l++){var u=o[l],f=Me(u),p=Oe(u);for(var m in u){var _=f&&m in u||p&&w.call(u,m);if(_){var h=u[m],b=void 0;if(d&&h&&((b=Me(h))||Fe(h))){var g=s[m];b?Me(g)||(g=[]):Fe(g)||(g={}),h=nt(d,g,h)}void 0!==h&&(s[m]=h)}}}return s}var at=function(){function e(t,n,a){var i,r=this,o=!1;r.start=qe(),r.name=t,r.isAsync=a,r.isChildEvt=function(){return!1},we(n)&&(o=Ge(r,"payload",function(){return!i&&we(n)&&(i=n(),n=null),i})),r.getCtx=function(t){return t?t===e.ParentContextKey||t===e.ChildrenContextKey?r[t]:(r.ctx||{})[t]:null},r.setCtx=function(t,n){t&&(t===e.ParentContextKey?(r[t]||(r.isChildEvt=function(){return!0}),r[t]=n):t===e.ChildrenContextKey?r[t]=n:(r.ctx=r.ctx||{})[t]=n)},r.complete=function(){var t=0,a=r.getCtx(e.ChildrenContextKey);if(Me(a))for(var i=0;i<a.length;i++){var s=a[i];s&&(t+=s.time)}r.time=qe()-r.start,r.exTime=r.time-t,r.complete=function(){},!o&&we(n)&&(r.payload=n())}}return e.ParentContextKey="parent",e.ChildrenContextKey="childEvts",e}(),it=function(){function e(t){this.ctx={},ie(e,this,function(e){e.create=function(e,t,n){return new at(e,t,n)},e.fire=function(e){e&&(e.complete(),t&&we(t.perfEvent)&&t.perfEvent(e))},e.setCtx=function(t,n){t&&((e.ctx=e.ctx||{})[t]=n)},e.getCtx=function(t){return(e.ctx||{})[t]}})}return e.__ieDyn=1,e}(),rt="CoreUtils.doPerf";function ot(e,t,n,a,i){if(e){var r=e;if(r.getPerfMgr&&(r=r.getPerfMgr()),r){var o=void 0,s=r.getCtx(rt);try{if(o=r.create(t(),a,i)){if(s&&o.setCtx&&(o.setCtx(at.ParentContextKey,s),s.getCtx&&s.setCtx)){var c=s.getCtx(at.ChildrenContextKey);c||(c=[],s.setCtx(at.ChildrenContextKey,c)),c.push(o)}return r.setCtx(rt,o),n(o)}}catch(e){o&&o.setCtx&&o.setCtx("exception",e)}finally{o&&r.fire(o),r.setCtx(rt,s)}}}return n()}var st="window",ct="JSON",dt="XMLHttpRequest",lt=null,ut=null,ft=null,pt=null;function mt(e,t){var n=!1;if(e){try{if(!(n=t in e)){var a=e.prototype;a&&(n=t in a)}}catch(e){}if(!n)try{n=!Ie((new e)[t])}catch(e){}}return n}function _t(e){var t=A();return t&&t[e]?t[e]:e===st&&ht()?window:null}function ht(){return Boolean(typeof window===y&&window)}function bt(){return ht()?window:_t(st)}function gt(){return Boolean(typeof document===y&&document)}function vt(){return gt()?document:_t("document")}function yt(){return Boolean(typeof navigator===y&&navigator)}function St(){return yt()?navigator:_t("navigator")}function Dt(e){return typeof location===y&&location?location:_t("location")}function It(){return Boolean(typeof JSON===y&&JSON||null!==_t(ct))}function xt(){return It()?JSON||_t(ct):null}function Ct(){var e=St();return!(!e||!e.product)&&"ReactNative"===e.product}function Ot(){var e=St();if(e&&(e.userAgent!==ut||null===lt)){var t=((ut=e.userAgent)||re).toLowerCase();lt=ke(t,"msie")||ke(t,"trident/")}return lt}function wt(e){var t=Object.prototype.toString.call(e),n=re;return"[object Error]"===t?n="{ stack: '"+e.stack+"', message: '"+e.message+"', name: '"+e.name+"'":It()&&(n=xt().stringify(e)),t+n}function Et(){return null===pt&&(pt=yt()&&Boolean(St().sendBeacon)),pt}function At(e){var t=!1;try{t=!!_t("fetch");var n=_t("Request");t&&e&&n&&(t=mt(n,"keepalive"))}catch(e){}return t}function Lt(){var e=!1;try{e=!!_t(dt)}catch(e){}return e}var kt,Mt=["eventsSent","eventsDiscarded","eventsSendRequest","perfEvent"],Pt=null;function Tt(e,t){return function(){var n=arguments,a=Ut(t);if(a){var i=a.listener;i&&i[e]&&i[e].apply(i,n)}}}function Ut(e){var t,n=Pt;return n||!0===e.disableDbgExt||(n=Pt||((t=_t("Microsoft"))&&(Pt=t.ApplicationInsights),Pt)),n?n.ChromeDbgExt:null}function Ft(e){if(!kt){kt={};for(var t=0;t<Mt.length;t++)kt[Mt[t]]=Tt(Mt[t],e)}return kt}function Ht(e){return e?'"'+e.replace(/\"/g,re)+'"':re}function Rt(e,t){var n=typeof console!==S?console:_t("console");if(n){var a="log";n[e]&&(a=e),we(n[a])&&n[a](t)}}var Nt=function(){function e(e,t,n,a){void 0===n&&(n=!1);var i=this;i.messageId=e,i.message=(n?"AI: ":"AI (Internal): ")+e;var r=re;It()&&(r=xt().stringify(a));var o=(t?" message:"+Ht(t):re)+(a?" props:"+Ht(r):re);i.message+=o}return e.dataType="MessageData",e}();function Bt(e,t){return(e||{}).logger||new jt(t)}var jt=function(){function e(t){this.identifier="DiagnosticLogger",this.queue=[];var n,a,i,r,o=0,s={};ie(e,this,function(e){function c(t,n){if(!(o>=i)){var r=!0,c="AITR_"+n.messageId;if(s[c]?r=!1:s[c]=!0,r&&(t<=a&&(e.queue.push(n),o++,d(1===t?"error":"warn",n)),o===i)){var l="Internal events throttle limit per PageView reached for this app.",u=new Nt(23,l,!1);e.queue.push(u),1===t?e.errorToConsole(l):e.warnToConsole(l)}}}function d(e,n){var a=Ut(t||{});a&&a.diagLog&&a.diagLog(e,n)}!function(e){n=Xe(e.loggingLevelConsole,0),a=Xe(e.loggingLevelTelemetry,1),i=Xe(e.maxMessageLimit,25),r=Xe(e.enableDebug,Xe(e.enableDebugExceptions,!1))}(t||{}),e.consoleLoggingLevel=function(){return n},e.telemetryLoggingLevel=function(){return a},e.maxInternalMessageLimit=function(){return i},e.enableDebugExceptions=function(){return r},e.throwInternal=function(t,a,i,o,l){void 0===l&&(l=!1);var u=new Nt(a,i,l,o);if(r)throw wt(u);var f=1===t?"errorToConsole":"warnToConsole";if(Ie(u.message))d("throw"+(1===t?"Critical":"Warning"),u);else{if(l){var p=+u.messageId;!s[p]&&n>=t&&(e[f](u.message),s[p]=!0)}else n>=t&&e[f](u.message);c(t,u)}},e.warnToConsole=function(e){Rt("warn",e),d("warning",e)},e.errorToConsole=function(e){Rt("error",e),d("error",e)},e.resetInternalMessageCount=function(){o=0,s={}},e.logInternalMessage=c})}return e.__ieDyn=1,e}();function Vt(e){return e||new jt}function zt(e,t,n,a,i,r){void 0===r&&(r=!1),Vt(e).throwInternal(t,n,a,i,r)}function Gt(e,t){Vt(e).warnToConsole(t)}var Kt=4294967296,Wt=4294967295,qt=!1,Qt=123456789,Yt=987654321;function Jt(e){var t=0,n=_t("crypto")||_t("msCrypto");return n&&n.getRandomValues&&(t=n.getRandomValues(new Uint32Array(1))[0]&Wt),0===t&&Ot()&&(qt||function(){try{var e=2147483647&qe();(t=(Math.random()*Kt^e)+e)<0&&(t>>>=0),Qt=123456789+t&Wt,Yt=987654321-t&Wt,qt=!0}catch(e){}var t}(),t=function(e){var t=((Yt=36969*(65535&Yt)+(Yt>>16)&Wt)<<16)+(65535&(Qt=18e3*(65535&Qt)+(Qt>>16)&Wt))>>>0&Wt|0;return t>>>=0}()&Wt),0===t&&(t=Math.floor(Kt*Math.random()|0)),e||(t>>>=0),t}function Xt(e){void 0===e&&(e=22);for(var t=Jt()>>>0,n=0,a=re;a.length<e;)n++,a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&t),t>>>=6,5===n&&(t=(Jt()<<2&4294967295|3&t)>>>0,n=0);return a}var Zt=O,$t="."+Xt(6),en=0;function tn(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType}function nn(e,t){return void 0===t&&(t=!1),Ee(e+en+++(t?".2.8.16":re)+$t)}function an(e){var t={id:nn("_aiData-"+(e||re)+".2.8.16"),accept:function(e){return tn(e)},get:function(e,n,a,i){var r=e[t.id];return r?r[Ee(n)]:(i&&((r=function(e,t){var n=t[e.id];if(!n){n={};try{tn(t)&&(function(e,t,n){if(Zt)try{return Zt(e,t,{value:n,enumerable:!1,configurable:!0}),!0}catch(e){}return!1}(t,e.id,n)||(t[e.id]=n))}catch(e){}}return n}(t,e))[Ee(n)]=a),a)},kill:function(e,t){if(e&&e[t])try{delete e[t]}catch(e){}}};return t}function rn(e,t,n){return!(!e||e.length!==t||e===n||!e.match(/^[\da-f]*$/i))}function on(e){return rn(e,32,"00000000000000000000000000000000")}function sn(e){return rn(e,16,"0000000000000000")}var cn=an("plugin");function dn(e){return cn.get(e,"state",{},!0)}function ln(e,t){for(var n,a=[],i=null,r=e.getNext();r;){var o=r.getPlugin();o&&(i&&we(i.setNextPlugin)&&we(o.processTelemetry)&&i.setNextPlugin(o),(we(o.isInitialized)?o.isInitialized():(n=dn(o)).isInitialized)||a.push(o),i=o,r=r.getNext())}Re(a,function(a){var i=e.core();a.initialize(e.getCfg(),i,t,e.getNext()),n=dn(a),a.core||n.core||(n.core=i),n.isInitialized=!0,delete n.teardown})}function un(e){return e.sort(function(e,t){var n=0;if(t){var a=we(t.processTelemetry);we(e.processTelemetry)?n=a?e.priority-t.priority:1:a&&(n=-1)}else n=e?1:-1;return n})}var fn=0;function pn(e,t,n,a){var i=null,r=[];null!==a&&(i=a?function(e,t,n){for(;e;){if(e.getPlugin()===n)return e;e=e.getNext()}return bn([n],t.config||{},t)}(e,n,a):e);var o={_next:function(){var e=i;if(i=e?e.getNext():null,!e){var t=r;t&&t.length>0&&(Re(t,function(e){try{e.func.call(e.self,e.args)}catch(e){zt(n.logger,2,73,"Unexpected Exception during onComplete - "+wt(e))}}),r=[])}return e},ctx:{core:function(){return n},diagLog:function(){return Bt(n,t)},getCfg:function(){return t},getExtCfg:s,getConfig:function(e,n,a){void 0===a&&(a=!1);var i,r=s(e,null);return r&&!xe(r[n])?i=r[n]:t&&!xe(t[n])&&(i=t[n]),xe(i)?a:i},hasNext:function(){return!!i},getNext:function(){return i},setNext:function(e){i=e},iterate:function(e){for(var t;t=o._next();){var n=t.getPlugin();n&&e(n)}},onComplete:function(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];e&&r.push({func:e,self:Ie(t)?o.ctx:t,args:n})}}};function s(e,n,a){var i;if(void 0===n&&(n={}),void 0===a&&(a=0),t){var r=t.extensionConfig;r&&e&&(i=r[e])}if(i){if(Oe(n)&&0!==a){var o=nt(!0,n,i);t&&2===a&&Ae(n,function(e){if(xe(o[e])){var n=t[e];xe(n)||(o[e]=n)}}),i=o}}else i=n;return i}return o}function mn(e,t,n,a){var i=pn(e,t,n,a),r=i.ctx;return r.processNext=function(e){var t=i._next();return t&&t.processTelemetry(e,r),!t},r.createNew=function(e,a){return void 0===e&&(e=null),Me(e)&&(e=bn(e,t,n,a)),mn(e||r.getNext(),t,n,a)},r}function _n(e,t,n){var a=t.config||{},i=pn(e,a,t,n),r=i.ctx;return r.processNext=function(e){var t=i._next();return t&&t.unload(r,e),!t},r.createNew=function(e,n){return void 0===e&&(e=null),Me(e)&&(e=bn(e,a,t,n)),_n(e||r.getNext(),t,n)},r}function hn(e,t,n){var a=t.config||{},i=pn(e,a,t,n).ctx;return i.processNext=function(e){return i.iterate(function(t){we(t.update)&&t.update(i,e)})},i.createNew=function(e,n){return void 0===e&&(e=null),Me(e)&&(e=bn(e,a,t,n)),hn(e||i.getNext(),t,n)},i}function bn(e,t,n,a){var i=null,r=!a;if(Me(e)&&e.length>0){var o=null;Re(e,function(e){if(r||a!==e||(r=!0),r&&e&&we(e.processTelemetry)){var s=function(e,t,n){var a,i=null,r=we(e.processTelemetry),o=we(e.setNextPlugin),s={getPlugin:function(){return e},getNext:function(){return i},processTelemetry:function(a,d){c(d=d||function(){var a;return e&&we(e._getTelCtx)&&(a=e._getTelCtx()),a||(a=mn(s,t,n)),a}(),function(t){if(!e||!r)return!1;var n=dn(e);return!n.teardown&&!n.disabled&&(o&&e.setNextPlugin(i),e.processTelemetry(a,t),!0)},"processTelemetry",function(){return{item:a}},!a.sync)||d.processNext(a)},unload:function(t,n){c(t,function(){var a=!1;if(e){var i=dn(e),r=e.core||i.core;!e||r&&r!==t.core()||i.teardown||(i.core=null,i.teardown=!0,i.isInitialized=!1,e.teardown&&!0===e.teardown(t,n)&&(a=!0))}return a},"unload",function(){},n.isAsync)||t.processNext(n)},update:function(t,n){c(t,function(){var a=!1;if(e){var i=dn(e),r=e.core||i.core;!e||r&&r!==t.core()||i.teardown||e.update&&!0===e.update(t,n)&&(a=!0)}return a},"update",function(){},!1)||t.processNext(n)},_id:a=e?e.identifier+"-"+e.priority+"-"+fn++:"Unknown-0-"+fn++,_setNext:function(e){i=e}};function c(t,n,r,o,s){var c=!1,d=e?e.identifier:"TelemetryPluginChain",l=t._hasRun;return l||(l=t._hasRun={}),t.setNext(i),e&&ot(t.core(),function(){return d+":"+r},function(){l[a]=!0;try{var e=i?i._id:re;e&&(l[e]=!1),c=n(t)}catch(e){var o=!i||l[i._id];o&&(c=!0),i&&o||zt(t.diagLog(),1,73,"Plugin ["+d+"] failed during "+r+" - "+wt(e)+", run flags: "+wt(l))}},o,s),c}return We(s)}(e,t,n);i||(i=s),o&&o._setNext(s),o=s}})}return a&&!i?bn([a],t,n):i}function gn(e,t,n){t&&Me(t)&&t.length>0&&(Re(t=t.sort(function(e,t){return e.priority-t.priority}),function(e){e.priority<500&&$e("Channel has invalid priority - "+e.identifier)}),e.push({queue:We(t),chain:bn(t,n.config,n)}))}var vn="toGMTString",yn="toUTCString",Sn=null,Dn=null,In=null,xn=vt(),Cn={},On={};function wn(e){return!e||e.isEnabled()}function En(e,t){return!!(t&&e&&Me(e.ignoreCookies))&&-1!==e.ignoreCookies.indexOf(t)}function An(e,t){var n;if(e)n=e.getCookieMgr();else if(t){var a=t.cookieCfg;n=a._ckMgr?a._ckMgr:Ln(t)}return n||(n=function(e,t){var n=Ln._ckMgr||On._ckMgr;return n||(n=Ln._ckMgr=Ln(e,t),On._ckMgr=n),n}(t,(e||{}).logger)),n}function Ln(e,t){var n,a=function(e){var t=e.cookieCfg=e.cookieCfg||{};if(Ye(t,"domain",e.cookieDomain,Ce,xe),Ye(t,"path",e.cookiePath||"/",null,xe),xe(t.enabled)){var n=void 0;Ie(e.isCookieUseDisabled)||(n=!e.isCookieUseDisabled),Ie(e.disableCookiesUsage)||(n=!e.disableCookiesUsage),t.enabled=n}return t}(e||On),i=a.path||"/",r=a.domain,o=!1!==a.enabled,s=((n={isEnabled:function(){var e=o&&kn(t),n=On._ckMgr;return e&&n&&s!==n&&(e=wn(n)),e}}).setEnabled=function(e){o=!1!==e},n.set=function(e,t,n,o,c){var d,l=!1;if(wn(s)&&!function(e,t){return!!(t&&e&&Me(e.blockedCookies)&&-1!==e.blockedCookies.indexOf(t))||En(e,t)}(a,e)){var u={},f=Be(t||re),p=f.indexOf(";");if(-1!==p&&(f=Be(t.substring(0,p)),u=Mn(t.substring(p+1))),Ye(u,"domain",o||r,Ze,Ie),!xe(n)){var m=Ot();if(Ie(u.expires)){var _=qe()+1e3*n;if(_>0){var h=new Date;h.setTime(_),Ye(u,"expires",Pn(h,m?vn:yn)||Pn(h,m?vn:yn)||re,Ze)}}m||Ye(u,"max-age",re+n,null,Ie)}var b=Dt();b&&"https:"===b.protocol&&(Ye(u,"secure",null,null,Ie),null===Dn&&(d=(St()||{}).userAgent,Dn=!(Pe(d)&&(ke(d,"CPU iPhone OS 12")||ke(d,"iPad; CPU OS 12")||ke(d,"Macintosh; Intel Mac OS X 10_14")&&ke(d,"Version/")&&ke(d,"Safari")||ke(d,"Macintosh; Intel Mac OS X 10_14")&&function(e,t){var n=!1;return e&&!(n=e===t)&&(n=fe?e.endsWith(t):function(e,t){var n=!1,a=t.length,i=e?e.length:0;if(a&&i&&i>=a&&!(n=e===t)){for(var r=i-1,o=a-1;o>=0;o--){if(e[r]!=t[o])return!1;r--}n=!0}return n}(e,t)),n}(d,"AppleWebKit/605.1.15 (KHTML, like Gecko)")||ke(d,"Chrome/5")||ke(d,"Chrome/6")||ke(d,"UnrealEngine")&&!ke(d,"Chrome")||ke(d,"UCBrowser/12")||ke(d,"UCBrowser/11")))),Dn&&Ye(u,"SameSite","None",null,Ie)),Ye(u,"path",c||i,null,Ie),(a.setCookie||Fn)(e,Tn(f,u)),l=!0}return l},n.get=function(e){var t=re;return wn(s)&&!En(a,e)&&(t=(a.getCookie||Un)(e)),t},n.del=function(e,t){var n=!1;return wn(s)&&(n=s.purge(e,t)),n},n.purge=function(e,n){var i,r=!1;if(kn(t)){var o=((i={}).path=n||"/",i.expires="Thu, 01 Jan 1970 00:00:01 GMT",i);Ot()||(o["max-age"]="0"),(a.delCookie||Fn)(e,Tn(re,o)),r=!0}return r},n);return s._ckMgr=s,s}function kn(e){if(null===Sn){Sn=!1;try{Sn=void 0!==(xn||{}).cookie}catch(t){zt(e,2,68,"Cannot access document.cookie - "+Qe(t),{exception:wt(t)})}}return Sn}function Mn(e){var t={};return e&&e.length&&Re(Be(e).split(";"),function(e){if(e=Be(e||re)){var n=e.indexOf("=");-1===n?t[e]=null:t[Be(e.substring(0,n))]=Be(e.substring(n+1))}}),t}function Pn(e,t){return we(e[t])?e[t]():null}function Tn(e,t){var n=e||re;return Ae(t,function(e,t){n+="; "+e+(xe(t)?re:"="+t)}),n}function Un(e){var t=re;if(xn){var n=xn.cookie||re;In!==n&&(Cn=Mn(n),In=n),t=Be(Cn[e]||re)}return t}function Fn(e,t){xn&&(xn.cookie=e+"="+t)}function Hn(){var e=[];return{add:function(t){t&&e.push(t)},run:function(t,n){Re(e,function(e){try{e(t,n)}catch(e){zt(t.diagLog(),2,73,"Unexpected error calling unload handler - "+wt(e))}}),e=[]}}}var Rn=function(){function e(){var t,n,a,i,r,o=this;function s(e){void 0===e&&(e=null);var t=e;if(!t){var i=n||mn(null,{},o.core);t=a&&a.getPlugin?i.createNew(null,a.getPlugin):i.createNew(null,a)}return t}function c(e,t,i){e&&Ye(e,oe,[],null,xe),!i&&t&&(i=t.getProcessTelContext().getNext());var r=a;a&&a.getPlugin&&(r=a.getPlugin()),o.core=t,n=mn(i,e,t,r)}function d(){t=!1,o.core=null,n=null,a=null,r=[],i=Hn()}d(),ie(e,o,function(e){e.initialize=function(e,n,a,i){c(e,n,i),t=!0},e.teardown=function(t,n){var o,s=e.core;if(s&&(!t||s===t.core())){var c,l=!1,u=t||_n(null,s,a&&a.getPlugin?a.getPlugin():a),f=n||((o={reason:0}).isAsync=!1,o);return e._doTeardown&&!0===e._doTeardown(u,f,p)?c=!0:p(),c}function p(){if(!l){l=!0,i.run(u,n);var e=r;r=[],Re(e,function(e){e.rm()}),!0===c&&u.processNext(f),d()}}},e.update=function(t,n){var i=e.core;if(i&&(!t||i===t.core())){var r,o=!1,s=t||hn(null,i,a&&a.getPlugin?a.getPlugin():a),d=n||{reason:0};return e._doUpdate&&!0===e._doUpdate(s,d,l)?r=!0:l(),r}function l(){o||(o=!0,c(s.getCfg(),s.core(),s.getNext()))}},e._addHook=function(e){e&&(Me(e)?r=r.concat(e):r.push(e))},et(e,"_addUnloadCb",function(){return i},"add")}),o.diagLog=function(e){return s(e).diagLog()},o.isInitialized=function(){return t},o.setInitialized=function(e){t=e},o.setNextPlugin=function(e){a=e},o.processNext=function(e,t){t?t.processNext(e):a&&we(a.processTelemetry)&&a.processTelemetry(e,null)},o._getTelCtx=s}return e.__ieDyn=1,e}(),Nn=function(e){function t(){var n,a,i=e.call(this)||this;function r(){n=0,a=[]}return i.identifier="TelemetryInitializerPlugin",i.priority=199,r(),ie(t,i,function(e,t){e.addTelemetryInitializer=function(e){var t={id:n++,fn:e};return a.push(t),{remove:function(){Re(a,function(e,n){if(e.id===t.id)return a.splice(n,1),-1})}}},e.processTelemetry=function(t,n){for(var i=!1,r=a.length,o=0;o<r;++o){var s=a[o];if(s)try{if(!1===s.fn.apply(null,[t])){i=!0;break}}catch(e){zt(n.diagLog(),1,64,"One of telemetry initializers failed, telemetry item will not be sent: "+Qe(e),{exception:wt(e)},!0)}}i||e.processNext(t,n)},e._doTeardown=function(){r()}}),i}return T(t,e),t.__ieDyn=1,t}(Rn),Bn="Plugins must provide initialize method",jn="SDK is still unloading...",Vn={loggingLevelConsole:1};function zn(e,t){return new it(t)}function Gn(e,t){var n=!1;return Re(t,function(t){if(t===e)return n=!0,-1}),n}var Kn=function(){function e(){var t,n,a,i,r,o,s,c,d,l,u,f,p,m,_,h,b,g,v,y,S=0,D=!1;ie(e,this,function(e){function I(n){if(!S&&!D&&(n||e.logger&&e.logger.queue.length>0)){var a=Xe(t.diagnosticLogInterval);a&&a>0||(a=1e4),S=setInterval(function(){clearInterval(S),S=0,L()},a)}return S}function x(){n=!1,t=nt(!0,{},Vn),e.config=t,e.logger=new jt(t),e._extensions=[],_=new Nn,a=[],i=null,r=null,o=null,s=null,c=null,l=null,d=[],u=null,f=null,p=null,m=!1,h=null,b=nn("AIBaseCore",!0),g=Hn(),y=null}function C(){var n=mn(E(),t,e);return n.onComplete(I),n}function O(n){var a=function(e,t,n){var a,i=[],r={};return Re(n,function(t){(xe(t)||xe(t.initialize))&&$e(Bn);var n=t.priority,a=t.identifier;t&&n&&(xe(r[n])?r[n]=a:Gt(e,"Two extensions have same priority #"+n+" - "+r[n]+", "+a)),(!n||n<500)&&i.push(t)}),(a={all:n}).core=i,a}(e.logger,0,d);l=a.core,c=null;var i=a.all;if(p=We(function(e,t,n){var a=[];if(e&&Re(e,function(e){return gn(a,e,n)}),t){var i=[];Re(t,function(e){e.priority>500&&i.push(e)}),gn(a,i,n)}return a}(f,i,e)),u){var r=Ne(i,u);-1!==r&&i.splice(r,1),-1!==(r=Ne(l,u))&&l.splice(r,1),u._setQueue(p)}else u=function(e,t){function n(){return mn(null,t.config,t,null)}function a(e,t,n,a){var i=e?e.length+1:1;function r(){0==--i&&(a&&a(),a=null)}i>0&&Re(e,function(e){if(e&&e.queue.length>0){var a=e.chain,o=t.createNew(a);o.onComplete(r),n(o)}else i--}),r()}var i=!1,r={identifier:"ChannelControllerPlugin",priority:500,initialize:function(t,n,a,r){i=!0,Re(e,function(e){e&&e.queue.length>0&&ln(mn(e.chain,t,n),a)})},isInitialized:function(){return i},processTelemetry:function(t,i){a(e,i||n(),function(e){e.processNext(t)},function(){i.processNext(t)})},update:function(t,n){var i=n||{reason:0};return a(e,t,function(e){e.processNext(i)},function(){t.processNext(i)}),!0},pause:function(){a(e,n(),function(e){e.iterate(function(e){e.pause&&e.pause()})},null)},resume:function(){a(e,n(),function(e){e.iterate(function(e){e.resume&&e.resume()})},null)},teardown:function(t,n){var r=n||{reason:0,isAsync:!1};return a(e,t,function(e){e.processNext(r)},function(){t.processNext(r),i=!1}),!0},getChannel:function(t){var n=null;return e&&e.length>0&&Re(e,function(e){if(e&&e.queue.length>0&&(Re(e.queue,function(e){if(e.identifier===t)return n=e,-1}),n))return-1}),n},flush:function(t,i,r,o){var s=1,c=!1,d=null;function l(){s--,c&&0===s&&(d&&(clearTimeout(d),d=null),i&&i(c),i=null)}return o=o||5e3,a(e,n(),function(e){e.iterate(function(e){if(e.flush){s++;var n=!1;e.flush(t,function(){n=!0,l()},r)||n||(t&&null==d?d=setTimeout(function(){d=null,l()},o):l())}})},function(){c=!0,l()}),!0},_setQueue:function(t){e=t}};return r}(p,e);i.push(u),l.push(u),e._extensions=un(i),u.initialize(t,e,i),ln(C(),i),e._extensions=We(un(l||[])).slice(),n&&function(t){var n=hn(E(),e);n.onComplete(I),e._updateHook&&!0===e._updateHook(n,t)||n.processNext(t)}(n)}function w(t){var n,a=null,i=null;return Re(e._extensions,function(e){if(e.identifier===t&&e!==u&&e!==_)return i=e,-1}),!i&&u&&(i=u.getChannel(t)),i&&((n={plugin:i}).setEnabled=function(e){dn(i).disabled=!e},n.isEnabled=function(){var e=dn(i);return!e.teardown&&!e.disabled},n.remove=function(e,t){var n;void 0===e&&(e=!0);var a=[i],r=((n={reason:1}).isAsync=e,n);A(a,r,function(e){e&&O({reason:32,removed:a}),t&&t(e)})},a=n),a}function E(){if(!c){var n=(l||[]).slice();-1===Ne(n,_)&&n.push(_),c=bn(un(n),t,e)}return c}function A(n,a,i){if(n&&n.length>0){var r=_n(bn(n,t,e),e);r.onComplete(function(){var e=!1,t=[];Re(d,function(a,i){Gn(a,n)?e=!0:t.push(a)}),d=t;var a=[];f&&(Re(f,function(t,i){var r=[];Re(t,function(t){Gn(t,n)?e=!0:r.push(t)}),a.push(r)}),f=a),i&&i(e),I()}),r.processNext(a)}else i(!1)}function L(){if(e.logger&&e.logger.queue){var n=e.logger.queue.slice(0);e.logger.queue.length=0,Re(n,function(n){var a,i=((a={}).name=h||"InternalMessageId: "+n.messageId,a.iKey=Xe(t.instrumentationKey),a.time=He(new Date),a.baseType=Nt.dataType,a.baseData={message:n.message},a);e.track(i)})}}function M(e,t,n,a){return u?u.flush(e,t,n||6,a):(t&&t(!1),!0)}function P(t){var n=e.logger;n?(zt(n,2,73,t),I()):$e(t)}var T,F,H;x(),e.isInitialized=function(){return n},e.initialize=function(a,r,s,c){var l,u;m&&$e(jn),e.isInitialized()&&$e("Core should not be initialized more than once"),t=a||{},e.config=t,xe(a.instrumentationKey)&&$e("Please provide instrumentation key"),i=c,e._notificationManager=c,!0===(u=Xe(t.disableDbgExt))&&v&&(i.removeNotificationListener(v),v=null),i&&!v&&!0!==u&&(v=Ft(t),i.addNotificationListener(v)),!(l=Xe(t.enablePerfMgr))&&o&&(o=null),l&&Je(t,"createPerfMgr",zn),Je(t,oe,{}).NotificationManager=i,s&&(e.logger=s);var _=Je(t,"extensions",[]);(d=[]).push.apply(d,U(U([],r),_)),f=Je(t,"channels",[]),O(null),p&&0!==p.length||$e("No channels available"),n=!0,e.releaseQueue()},e.getTransmissionControls=function(){var e=[];return p&&Re(p,function(t){e.push(t.queue)}),We(e)},e.track=function(n){n.iKey=n.iKey||t.instrumentationKey,n.time=n.time||He(new Date),n.ver=n.ver||"4.0",!m&&e.isInitialized()?C().processNext(n):a.push(n)},e.getProcessTelContext=C,e.getNotifyMgr=function(){return i||(i=function(){var e;return k(((e={}).addNotificationListener=function(e){},e.removeNotificationListener=function(e){},e.eventsSent=function(e){},e.eventsDiscarded=function(e,t){},e.eventsSendRequest=function(e,t){},e))}(),e._notificationManager=i),i},e.addNotificationListener=function(e){i&&i.addNotificationListener(e)},e.removeNotificationListener=function(e){i&&i.removeNotificationListener(e)},e.getCookieMgr=function(){return s||(s=Ln(t,e.logger)),s},e.setCookieMgr=function(e){s=e},e.getPerfMgr=function(){if(!r&&!o&&Xe(t.enablePerfMgr)){var n=Xe(t.createPerfMgr);we(n)&&(o=n(e,e.getNotifyMgr()))}return r||o||null},e.setPerfMgr=function(e){r=e},e.eventCnt=function(){return a.length},e.releaseQueue=function(){if(n&&a.length>0){var e=a;a=[],Re(e,function(e){C().processNext(e)})}},e.pollInternalLogs=function(e){return h=e||null,D=!1,S&&(clearInterval(S),S=null),I(!0)},e.stopPollingInternalLogs=function(){D=!0,S&&(clearInterval(S),S=0,L())},F=function(){return _},H=["addTelemetryInitializer"],(T=e)&&F&&Oe(T)&&Me(H)&&Re(H,function(e){Pe(e)&&et(T,e,F,e,undefined)}),e.unload=function(t,a,i){var r;void 0===t&&(t=!0),n||$e("SDK is not initialized"),m&&$e(jn);var o=((r={reason:50}).isAsync=t,r.flushComplete=!1,r),s=_n(E(),e);function c(t){o.flushComplete=t,m=!0,g.run(s,o),e.stopPollingInternalLogs(),s.processNext(o)}s.onComplete(function(){x(),a&&a(o)},e),L(),M(t,c,6,i)||c(!1)},e.getPlugin=w,e.addPlugin=function(e,t,n,a){if(!e)return a&&a(!1),void P(Bn);var i=w(e.identifier);if(i&&!t)return a&&a(!1),void P("Plugin ["+e.identifier+"] is already loaded!");var r={reason:16};function o(t){d.push(e),r.added=[e],O(r),a&&a(!0)}if(i){var s=[i.plugin];A(s,{reason:2,isAsync:!!n},function(e){e?(r.removed=s,r.reason|=32,o()):a&&a(!1)})}else o()},e.evtNamespace=function(){return b},e.flush=M,e.getTraceCtx=function(e){var t;return y||(t={},y={getName:function(){return t.name},setName:function(e){t.name=e},getTraceId:function(){return t.traceId},setTraceId:function(e){on(e)&&(t.traceId=e)},getSpanId:function(){return t.spanId},setSpanId:function(e){sn(e)&&(t.spanId=e)},getTraceFlags:function(){return t.traceFlags},setTraceFlags:function(e){t.traceFlags=e}}),y},e.setTraceCtx=function(e){y=e||null},et(e,"addUnloadCb",function(){return g},"add")})}return e.__ieDyn=1,e}();function Wn(e,t,n,a){Re(e,function(e){if(e&&e[t])if(n)setTimeout(function(){return a(e)},0);else try{a(e)}catch(e){}})}var qn,Qn=function(){function e(t){this.listeners=[];var n=!!(t||{}).perfEvtsSendAll;ie(e,this,function(e){e.addNotificationListener=function(t){e.listeners.push(t)},e.removeNotificationListener=function(t){for(var n=Ne(e.listeners,t);n>-1;)e.listeners.splice(n,1),n=Ne(e.listeners,t)},e.eventsSent=function(t){Wn(e.listeners,"eventsSent",!0,function(e){e.eventsSent(t)})},e.eventsDiscarded=function(t,n){Wn(e.listeners,"eventsDiscarded",!0,function(e){e.eventsDiscarded(t,n)})},e.eventsSendRequest=function(t,n){Wn(e.listeners,"eventsSendRequest",n,function(e){e.eventsSendRequest(t,n)})},e.perfEvent=function(t){t&&(!n&&t.isChildEvt()||Wn(e.listeners,"perfEvent",!1,function(e){t.isAsync?setTimeout(function(){return e.perfEvent(t)},0):e.perfEvent(t)}))}})}return e.__ieDyn=1,e}(),Yn=function(e){function t(){var n=e.call(this)||this;return ie(t,n,function(e,t){function n(t){var n=e.getNotifyMgr();n&&n.eventsDiscarded([t],2)}e.initialize=function(e,n,a,i){t.initialize(e,n,a||new jt(e),i||new Qn(e))},e.track=function(a){ot(e.getPerfMgr(),function(){return"AppInsightsCore:track"},function(){null===a&&(n(a),$e("Invalid telemetry item")),function(e){xe(e.name)&&(n(e),$e("telemetry name required"))}(a),t.track(a)},function(){return{item:a}},!a.sync)}}),n}return T(t,e),t.__ieDyn=1,t}(Kn),Jn="",Xn="events",Zn="visibilitychange",$n="pagehide",ea="pageshow",ta="unload",na="beforeunload",aa=nn("aiEvtPageHide"),ia=nn("aiEvtPageShow"),ra=/\.[\.]+/g,oa=/[\.]+$/,sa=1,ca=an("events"),da=/^([^.]*)(?:\.(.+)|)/;function la(e){return e&&e.replace?e.replace(/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,re):e}function ua(e,t){var n;if(t){var a=re;Me(t)?(a=re,Re(t,function(e){(e=la(e))&&("."!==e[0]&&(e="."+e),a+=e)})):a=la(t),a&&("."!==a[0]&&(a="."+a),e=(e||re)+a)}var i=da.exec(e||re)||[];return(n={}).type=i[1],n.ns=(i[2]||re).replace(ra,".").replace(oa,re).split(".").sort().join("."),n}function fa(e,t,n){void 0===n&&(n=!0);var a=ca.get(e,Xn,{},n),i=a[t];return i||(i=a[t]=[]),i}function pa(e,t,n,a){e&&t&&t.type&&(e.removeEventListener?e.removeEventListener(t.type,n,a):e.detachEvent&&e.detachEvent("on"+t.type,n))}function ma(e,t,n,a){for(var i=t.length;i--;){var r=t[i];r&&(n.ns&&n.ns!==r.evtName.ns||a&&!a(r)||(pa(e,r.evtName,r.handler,r.capture),t.splice(i,1)))}}function _a(e,t){return t?ua("xx",Me(t)?[e].concat(t):[e,t]).ns.split("."):e}function ha(e,t,n,a,i){var r;void 0===i&&(i=!1);var o=!1;if(e)try{var s=ua(t,a);if(o=function(e,t,n,a){var i=!1;return e&&t&&t.type&&n&&(e.addEventListener?(e.addEventListener(t.type,n,a),i=!0):e.attachEvent&&(e.attachEvent("on"+t.type,n),i=!0)),i}(e,s,n,i),o&&ca.accept(e)){var c=((r={guid:sa++,evtName:s}).handler=n,r.capture=i,r);fa(e,s.type).push(c)}}catch(e){}return o}function ba(e,t,n,a,i){if(void 0===i&&(i=!1),e)try{var r=ua(t,a),o=!1;!function(e,t,n){if(t.type)ma(e,fa(e,t.type),t,n);else{var a=ca.get(e,Xn,{});Ae(a,function(a,i){ma(e,i,t,n)}),0===ze(a).length&&ca.kill(e,Xn)}}(e,r,function(e){return!((!r.ns||n)&&e.handler!==n||(o=!0,0))}),o||pa(e,r,n,i)}catch(e){}}function ga(e,t,n,a){var i=!1;return t&&e&&e.length>0&&Re(e,function(e){e&&(n&&-1!==Ne(n,e)||(i=function(e,t,n){var a=!1,i=bt();i&&(a=ha(i,e,t,n),a=ha(i.body,e,t,n)||a);var r=vt();return r&&(a=ha(r,e,t,n)||a),a}(e,t,a)||i))}),i}function va(e,t,n){e&&Me(e)&&Re(e,function(e){e&&function(e,t,n){var a=bt();a&&(ba(a,e,t,n),ba(a.body,e,t,n));var i=vt();i&&ba(i,e,t,n)}(e,t,n)})}function ya(e,t,n){var a=_a(aa,n),i=ga([$n],e,t,a);return t&&-1!==Ne(t,Zn)||(i=ga([Zn],function(t){var n=vt();e&&n&&"hidden"===n.visibilityState&&e(t)},t,a)||i),!i&&t&&(i=ya(e,null,n)),i}function Sa(e,t,n){var a=_a(ia,n),i=ga([ea],e,t,a);return!(i=ga([Zn],function(t){var n=vt();e&&n&&"visible"===n.visibilityState&&e(t)},t,a)||i)&&t&&(i=Sa(e,null,n)),i}function Da(){var e=Ia();return e.substring(0,8)+"-"+e.substring(8,12)+"-"+e.substring(12,16)+"-"+e.substring(16,20)+"-"+e.substring(20)}function Ia(){for(var e,t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=re,a=0;a<4;a++)n+=t[15&(e=Jt())]+t[e>>4&15]+t[e>>8&15]+t[e>>12&15]+t[e>>16&15]+t[e>>20&15]+t[e>>24&15]+t[e>>28&15];var i=t[8+(3&Jt())|0];return n.substr(0,8)+n.substr(9,4)+"4"+n.substr(13,3)+i+n.substr(16,3)+n.substr(19,12)}var xa="1DS-Web-JS-3.2.15",Ca="withCredentials",Oa=((qn={})[0]=0,qn[2]=6,qn[1]=1,qn[3]=7,qn[4098]=6,qn[4097]=1,qn[4099]=7,qn);function wa(e){return!(e===Jn||xe(e))}function Ea(e,t,n){var a=-1;if(!Ie(e))if(t>0&&(32===t?a=8192:t<=13&&(a=t<<5)),function(e){return e>=0&&e<=9}(n))-1===a&&(a=0),a|=n;else{var i=Oa[Ta(e)]||-1;-1!==a&&-1!==i?a|=i:6===i&&(a=i)}return a}function Aa(e,t,n){var a;return void 0===n&&(n=!0),e&&(a=e.get(t),n&&a&&decodeURIComponent&&(a=decodeURIComponent(a))),a||Jn}function La(e){void 0===e&&(e="D");var t=Da();return"B"===e?t="{"+t+"}":"P"===e?t="("+t+")":"N"===e&&(t=t.replace(/-/g,Jn)),t}function ka(e,t,n,a,i){var r={},o=!1,s=0,c=arguments.length,d=Object.prototype,l=arguments;for("[object Boolean]"===d.toString.call(l[0])&&(o=l[0],s++);s<c;s++)Ae(e=l[s],function(e,t){o&&t&&Oe(t)?Me(t)?(r[e]=r[e]||[],Re(t,function(t,n){t&&Oe(t)?r[e][n]=ka(!0,r[e][n],t):r[e][n]=t})):r[e]=ka(!0,r[e],t):r[e]=t});return r}Boolean(vt()),Boolean(bt());var Ma=function(){var e=_t("performance");return e&&e.now?e.now():qe()};function Pa(e,t){var n=e;n.timings=n.timings||{},n.timings.processTelemetryStart=n.timings.processTelemetryStart||{},n.timings.processTelemetryStart[t]=Ma()}function Ta(e){var t=0;if(null!=e){var n=typeof e;"string"===n?t=1:"number"===n?t=2:"boolean"===n?t=3:n===y&&(t=4,Me(e)?(t=4096,e.length>0&&(t|=Ta(e[0]))):w.call(e,"value")&&(t=8192|Ta(e.value)))}return t}var Ua=function(e){function t(){var n=e.call(this)||this;return n.pluginVersionStringArr=[],ie(t,n,function(e,t){e.logger&&e.logger.queue||(e.logger=new jt({loggingLevelConsole:1})),e.initialize=function(n,a,i,r){ot(e,function(){return"AppInsightsCore.initialize"},function(){var o=e.pluginVersionStringArr;if(n){n.endpointUrl||(n.endpointUrl="https://browser.events.data.microsoft.com/OneCollector/1.0/");var s=n.propertyStorageOverride;!s||s.getProperty&&s.setProperty||$e("Invalid property storage override passed."),n.channels&&Re(n.channels,function(e){e&&Re(e,function(e){if(e.identifier&&e.version){var t=e.identifier+"="+e.version;o.push(t)}})})}e.getWParam=function(){return"undefined"!=typeof document||n.enableWParam?0:-1},a&&Re(a,function(e){if(e&&e.identifier&&e.version){var t=e.identifier+"="+e.version;o.push(t)}}),e.pluginVersionString=o.join(";"),e.pluginVersionStringArr=o;try{t.initialize(n,a,i,r),e.pollInternalLogs("InternalLog")}catch(t){var c=e.logger,d=wt(t);-1!==d.indexOf("channels")&&(d+="\n - Channels must be provided through config.channels only!"),zt(c,1,514,"SDK Initialization Failed - no telemetry will be sent: "+d)}},function(){return{config:n,extensions:a,logger:i,notificationManager:r}})},e.track=function(n){ot(e,function(){return"AppInsightsCore.track"},function(){var a,i=n;if(i){i.timings=i.timings||{},i.timings.trackStart=Ma(),(a=i.latency)&&Te(a)&&a>=1&&a<=4||(i.latency=1);var r=i.ext=i.ext||{};r.sdk=r.sdk||{},r.sdk.ver=xa;var o=i.baseData=i.baseData||{};o.properties=o.properties||{};var s=o.properties;s.version=s.version||e.pluginVersionString||Jn}t.track(i)},function(){return{item:n}},!n.sync)}}),n}return T(t,e),t.__ieDyn=1,t}(Yn);const Fa=Ua;function Ha(e){var t={};return Ae(e,function(e,n){t[e]=n[1],t[n[0]]=n[1]}),Ke(t)}var Ra,Na="locale",Ba="ver",ja="name",Va=Ha({UserExt:[0,"user"],DeviceExt:[1,"device"],TraceExt:[2,"trace"],WebExt:[3,"web"],AppExt:[4,"app"],OSExt:[5,"os"],SdkExt:[6,"sdk"],IntWebExt:[7,"intweb"],UtcExt:[8,"utc"],LocExt:[9,"loc"],CloudExt:[10,"cloud"],DtExt:[11,"dt"]}),za=Ha({id:[0,"id"],ver:[1,Ba],appName:[2,ja],locale:[3,Na],expId:[4,"expId"],env:[5,"env"]}),Ga=Ha({domain:[0,"domain"],browser:[1,"browser"],browserVer:[2,"browserVer"],screenRes:[3,"screenRes"],userConsent:[4,"userConsent"],consentDetails:[5,"consentDetails"]}),Ka=Ha({locale:[0,Na],localId:[1,"localId"],id:[2,"id"]}),Wa=Ha({osName:[0,ja],ver:[1,Ba]}),qa=Ha({ver:[0,Ba],seq:[1,"seq"],installId:[2,"installId"],epoch:[3,"epoch"]}),Qa=Ha({msfpc:[0,"msfpc"],anid:[1,"anid"],serviceName:[2,"serviceName"]}),Ya=Ha({popSample:[0,"popSample"],eventFlags:[1,"eventFlags"]}),Ja=Ha({tz:[0,"tz"]}),Xa=Ha({sessionId:[0,"sesId"]}),Za=Ha({localId:[0,"localId"],deviceClass:[1,"deviceClass"],make:[2,"make"],model:[3,"model"]}),$a=Ha({role:[0,"role"],roleInstance:[1,"roleInstance"],roleVer:[2,"roleVer"]}),ei=Ha({traceId:[0,"traceID"],traceName:[1,ja],parentId:[2,"parentID"]}),ti=Ha({traceId:[0,"traceId"],spanId:[1,"spanId"],traceFlags:[2,"traceFlags"]});function ni(){return void 0===Ra&&(Ra=!!ii(0)),Ra}function ai(){return ni()?ii(0):null}function ii(e){var t,n,a=null;try{var i=A();if(!i)return null;n=new Date,(a=0===e?i.localStorage:i.sessionStorage)&&we(a.setItem)&&(a.setItem(n,n),t=a.getItem(n)!==n,a.removeItem(n),t&&(a=null))}catch(e){a=null}return a}function ri(){return this.getId()}function oi(e){this.setId(e)}var si=function(){function e(){ie(e,this,function(e){e.setId=function(t){e.customId=t},e.getId=function(){return Pe(e.customId)?e.customId:e.automaticId}})}return e._staticInit=void Ge(e.prototype,"id",ri,oi),e}(),ci="ai_session",di=function(){function e(t,n){var a,i,r=Bt(t),o=An(t);ie(e,this,function(t){var s,c={sessionRenewalMs:(s=n).sessionRenewalMs&&function(){return s.sessionRenewalMs},sessionExpirationMs:s.sessionExpirationMs&&function(){return s.sessionExpirationMs},cookieDomain:s.cookieDomain&&function(){return s.cookieDomain},namePrefix:s.namePrefix&&function(){return s.namePrefix},sessionAsGuid:function(){return s.sessionAsGuid},idLength:function(){return s.idLength?s.idLength:22}};function d(e){var n=t.automaticSession,a=e.split("|");a.length>0&&n.setId(a[0]);try{if(a.length>1){var i=+a[1];n.acquisitionDate=+new Date(i),n.acquisitionDate=n.acquisitionDate>0?n.acquisitionDate:0}if(a.length>2){var o=+a[2];n.renewalDate=+new Date(o),n.renewalDate=n.renewalDate>0?n.renewalDate:0}}catch(e){zt(r,1,510,"Error parsing ai_session cookie, session will be reset: "+e)}0===n.renewalDate&&zt(r,2,517,"AI session renewal date is 0, session will be reset.")}function l(){var e=t.automaticSession,n=(new Date).getTime(),a=t.config.sessionAsGuid();!Ie(a)&&a?Ue(a)?e.setId(La()):e.setId(La(a)):e.setId(Xt(c&&c.idLength?c.idLength():22)),e.acquisitionDate=n,e.renewalDate=n,u(e.getId(),e.acquisitionDate,e.renewalDate),ni()||zt(r,2,505,"Browser does not support local storage. Session durations will be inaccurate.")}function u(e,n,r){var s=n+t.config.sessionExpirationMs(),c=r+t.config.sessionRenewalMs(),d=new Date,l=[e,n,r];s<c?d.setTime(s):d.setTime(c);var u=t.config.cookieDomain?t.config.cookieDomain():null;o.set(i(),l.join("|")+";expires="+d.toUTCString(),null,u),a=(new Date).getTime()}we(n.sessionExpirationMs)||(c.sessionExpirationMs=function(){return e.acquisitionSpan}),we(n.sessionRenewalMs)||(c.sessionRenewalMs=function(){return e.renewalSpan}),t.config=c,i=function(){return t.config.namePrefix&&t.config.namePrefix()?ci+t.config.namePrefix():ci},t.automaticSession=new si,t.update=function(){t.automaticSession.getId()||function(){var e=o.get(i());if(e&&we(e.split))d(e);else{var n=function(e,t){var n=ai();if(null!==n)try{return n.getItem(t)}catch(t){Ra=!1,zt(e,1,503,"Browser failed read of local storage. "+t)}return null}(r,i());n&&d(n)}t.automaticSession.getId()||l()}();var n=t.automaticSession,s=t.config,c=(new Date).getTime(),f=c-n.acquisitionDate>s.sessionExpirationMs(),p=c-n.renewalDate>s.sessionRenewalMs();f||p?l():(!a||c-a>e.cookieUpdateInterval)&&(n.renewalDate=c,u(n.getId(),n.acquisitionDate,n.renewalDate))},t.backup=function(){var e,n,a,o=t.automaticSession;e=o.getId(),n=o.acquisitionDate,a=o.renewalDate,function(e,t,n){var a=ai();if(null!==a)try{a.setItem(t,n)}catch(t){Ra=!1,zt(e,1,504,"Browser failed write to local storage. "+t)}}(r,i(),[e,n,a].join("|"))}})}return e.acquisitionSpan=864e5,e.renewalSpan=18e5,e.cookieUpdateInterval=6e4,e}(),li=["AX","EX","SF","CS","CF","CT","CU","DC","DF","H5","HL","WS","WP"];function ui(e,t){void 0===t&&(t=li);var n=null;if(e)for(var a=e.split(","),i=0;i<a.length;i++)fi(a[i],t)&&(n?n+=","+a[i]:n=a[i]);return n}function fi(e,t){if(void 0===t&&(t=li),!e||e.length<4)return!1;for(var n=!1,a=e.substring(0,3).toString().toUpperCase(),i=0;i<t.length;i++)if(t[i]+":"===a&&e.length<=256){n=!0;break}return n}function pi(){return this.getExpId()}var mi=function(){function e(t,n){var a=null,i=li.slice(0),r=An(n),o=t;ie(e,this,function(e){if(gt()){var n=vt().documentElement;n&&(e.locale=n.lang)}function s(e){e!==a&&(a=ui(e,i))}e.env=t.env?t.env:function(e){var t,n={},a=vt();if(a){t=a&&a.querySelectorAll("meta");for(var i=0;i<t.length;i++){var r=t[i];r.name&&0===r.name.toLowerCase().indexOf(e)&&(n[r.name.replace(e,"")]=r.content)}}return n}("awa-").env,e.getExpId=function(){return o.expId?(s(o.expId),a):(s(Aa(r,"Treatments")),a)}})}return e.validateAppExpId=ui,e._staticInit=void Ge(e.prototype,"expId",pi),e}(),_i=function(){},hi=function(){};function bi(){return this.getMsfpc()}function gi(){return this.getAnid()}var vi=function(){function e(t,n){var a=An(n);ie(e,this,function(e){t.serviceName&&(e.serviceName=t.serviceName),e.getMsfpc=function(){return Aa(a,"MSFPC")},e.getAnid=function(){return Aa(a,"ANON").slice(0,34)}})}var t;return e._staticInit=(Ge(t=e.prototype,"msfpc",bi),void Ge(t,"anid",gi)),e}(),yi=function(){var e=(new Date).getTimezoneOffset(),t=e%60,n=(e-t)/60,a="+";n>0&&(a="-"),n=Math.abs(n),t=Math.abs(t),this.tz=a+(n<10?"0"+n:n.toString())+":"+(t<10?"0"+t:t.toString())},Si={WIN:/(windows|win32)/i,WINRT:/ arm;/i,WINPHONE:/windows\sphone\s\d+\.\d+/i,OSX:/(macintosh|mac os x)/i,IOS:/(ipad|iphone|ipod)(?=.*like mac os x)/i,LINUX:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,ANDROID:/android/i,CROS:/CrOS/i},Di={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},Ii="Unknown",xi=[{r:Si.WINPHONE,os:"Windows Phone"},{r:Si.WINRT,os:"Windows RT"},{r:Si.WIN,os:"Windows"},{r:Si.IOS,os:"iOS"},{r:Si.ANDROID,os:"Android"},{r:Si.LINUX,os:"Linux"},{r:Si.CROS,os:"Chrome OS"},{s:"x11",os:"Unix"},{s:"blackberry",os:"BlackBerry"},{s:"symbian",os:"Symbian"},{s:"nokia",os:"Nokia"},{r:Si.OSX,os:"Mac OS X"}];function Ci(e,t){var n=e.match(new RegExp(t+" ([\\d,.]+)"));return n?Di[n[1]]?Di[n[1]]:n[1]:Ii}function Oi(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null}var wi=function(e){if(e.populateOperatingSystemInfo){var t=this,n=St()||{},a=e.userAgent||n.userAgent||"",i=e.userAgentData||n.userAgentData||{};if(a){var r=function(e){for(var t=0;t<xi.length;t++){var n=xi[t];if(n.r&&e.match(n.r))return n.os;if(n.s&&-1!==e.indexOf(n.s))return n.os}return Ii}(a.toLowerCase());t.name=r,t.ver=function(e,t){return"Windows"===t?Ci(e,"Windows NT"):"Android"===t?Ci(e,t):"Mac OS X"===t?function(e){var t=e.match(new RegExp("Mac OS X ([\\d,_,.]+)"));if(t){var n=t[1].replace(/_/g,".");if(n){var a=Oi(n);return a?n.split(a)[0]:n}}return Ii}(e):"iOS"===t?function(e){var t=e.match(new RegExp("OS ([\\d,_,.]+)"));if(t){var n=t[1].replace(/_/g,".");if(n){var a=Oi(n);return a?n.split(a)[0]:n}}return Ii}(e):Ii}(a,r)}t.name&&t.name!==Ii||!Pe(i.platform)||(t.name=i.platform)}},Ei="MicrosoftApplicationsTelemetryDeviceId",Ai=function(){function e(t,n){var a=0;ie(e,this,function(e){var i=t.propertyStorageOverride;e.seq=a,e.epoch=Jt(!1).toString();var r=An(n,t);if(r.isEnabled()||i){var o=function(e,t,n){return t?t.getProperty(n)||"":Aa(e,n)}(r,i,Ei);o||(o=Da()),function(e,t,n,a){t?t.setProperty(n,a):e.set(n,a,31536e3)}(r,i,Ei,o),e.installId=o}else r.purge(Ei);e.getSequenceId=function(){return++a}})}return e.__ieDyn=1,e}(),Li=function(e,t,n,a){var i=this;if(i.traceId=t||Ia(),e.enableDistributedTracing&&!n&&(n=Ia().substring(0,16)),i.parentId=n,e.enableApplicationInsightsTrace){i.name=a;var r=Dt();r&&r.pathname&&(i.name=r.pathname)}};function ki(){return this.getLocalId()}function Mi(e){this.setLocalId(e)}var Pi=function(){function e(t,n,a){var i,r=n,o=An(a,t);ie(e,this,function(n){if(o&&o.isEnabled()&&(f(),r.enableApplicationInsightsUser)){var a=Aa(o,e.userCookieName);if(a){var s=a.split(e.cookieSeparator);s.length>0&&(n.id=s[0])}if(!n.id){n.id=Xt(t&&!Ie(t.idLength)?t.idLength:22);var c=He(new Date);n.accountAcquisitionDate=c;var d=[n.id,c],l=r.cookieDomain?r.cookieDomain:void 0;o.set(e.userCookieName,d.join(e.cookieSeparator),31536e3,l)}}if("undefined"!=typeof navigator){var u=navigator;n.locale=u.userLanguage||u.language}function f(){if(!r.hashIdentifiers&&!r.dropIdentifiers){var e=Aa(o,"MUID");e&&(i="t:"+e)}return i}n.getLocalId=function(){return i||f()},n.setLocalId=function(e){i=e}})}return e.cookieSeparator="|",e.userCookieName="ai_user",e._staticInit=void Ge(e.prototype,"localId",ki,Mi),e}(),Ti=function(e){var t=this;t.popSample=100,t.eventFlags=0,e.hashIdentifiers&&(t.eventFlags=1048576|t.eventFlags),e.dropIdentifiers&&(t.eventFlags=2097152|t.eventFlags),e.scrubIpOnly&&(t.eventFlags=4194304|t.eventFlags)},Ui=["Required","Analytics","SocialMedia","Advertising"],Fi="Unknown",Hi="Edg/",Ri=[{ua:"OPR/",b:"Opera"},{ua:"PhantomJS",b:"PhantomJS"},{ua:"Edge",b:"Edge"},{ua:Hi,b:"Edge"},{ua:"Electron",b:"Electron"},{ua:"Chrome",b:"Chrome"},{ua:"Trident",b:"MSIE"},{ua:"MSIE ",b:"MSIE"},{ua:"Firefox",b:"Firefox"},{ua:"Safari",b:"Safari"},{ua:"SkypeShell",b:"SkypeShell"}],Ni=[{br:"Microsoft Edge",b:"Edge"},{br:"Google Chrome",b:"Chrome"},{br:"Opera",b:"Opera"}];function Bi(e,t){return t.indexOf(e)>-1}function ji(e,t){for(var n=0;n<t.length;n++)if(e==t[n].brand)return t[n].version;return null}function Vi(){return this.getUserConsent()}var zi=function(){function e(t,n){var a=An(n),i=t||{};ie(e,this,function(e){var t=Dt();if(t){var n=t.hostname;n&&(e.domain="file:"===t.protocol?"local":n)}if(i.populateBrowserInfo){var r=i.userAgent,o=(i.userAgentData||{}).brands,s=St();s&&(r=r||s.userAgent||"",o=o||(s.userAgentData||{}).brands),function(t,n){if(Me(n))try{for(var a=0;a<Ni.length;a++){var i=ji(Ni[a].br,n);if(i)return e.browser=Ni[a].b,void(e.browserVer=i)}}catch(e){}if(t){var r=function(e){if(e)for(var t=0;t<Ri.length;t++)if(Bi(Ri[t].ua,e))return Ri[t].b;return Fi}(t);e.browser=r,e.browserVer=function(e,t){return"MSIE"===t?function(e){var t=e.match(new RegExp("MSIE ([\\d,.]+)"));if(t)return t[1];var n=e.match(new RegExp("rv:([\\d,.]+)"));return n?n[1]:void 0}(e):function(e,t){"Safari"===e?e="Version":"Edge"===e&&Bi(Hi,t)&&(e="Edg");var n=t.match(new RegExp(e+"/([\\d,.]+)"));return n||"Opera"===e&&(n=t.match(new RegExp("OPR/([\\d,.]+)")))?n[1]:Fi}(t,e)}(t,r)}}(r,o);var c=function(){var e={h:0,w:0},t=bt();return t&&t.screen&&(e.h=screen.height,e.w=screen.width),e}();e.screenRes=c.w+"X"+c.h}Ie(i.gpcDataSharingOptIn)?e.gpcDataSharingOptIn=null:e.gpcDataSharingOptIn=i.gpcDataSharingOptIn,e.getUserConsent=function(){return i.userConsented||!!Aa(a,i.userConsentCookieName||"MSCC")},e.getUserConsentDetails=function(){var t=null;try{var n=i.callback;if(n&&n.userConsentDetails){var a=n.userConsentDetails();if(a){t=i.disableConsentDetailsSanitize?a:{};for(var r=0;r<Ui.length;r++){var o=Ui[r];t[o]=a[o]||!1}}}var s=e.gpcDataSharingOptIn;return null!==s&&((t=t||{}).GPC_DataSharingOptIn=!!s),t?JSON.stringify(t):null}catch(e){}},Ge(e,"userConsent",e.getUserConsent)})}return e._staticInit=void Ge(e.prototype,"userConsent",Vi),e}();function Gi(e,t,n,a,i){var r=t.ext[Va[e]];if(r)try{Ae(a,function(e,t){if(Pe(t)||Te(t)||Ue(t)){var a=r[n[e]];!i&&(a||Pe(a)||Te(a)||Ue(a))&&(t=a),r[n[e]]=t}})}catch(e){}return r}var Ki=function(){function e(t,n,a){ie(e,this,function(e){e.app=new mi(n,a),e.cloud=new _i,e.user=new Pi(t,n,a),e.os=new wi(n),e.web=new zi(n,a);var i=new Ai(t,a),r=new vi(n,a),o=new Ti(n);e.loc=new yi,e.device=new hi;var s=new di(a,n);e.session=new si;var c,d,l,u=(c=new Li(n),d=m(),l=c||{},{getName:function(){return l.name},setName:function(e){d&&d.setName(e),l.name=e},getTraceId:function(){return l.traceId},setTraceId:function(e){d&&d.setTraceId(e),on(e)&&(l.traceId=e)},getSpanId:function(){return l.parentId},setSpanId:function(e){d&&d.setSpanId(e),sn(e)&&(l.parentId=e)},getTraceFlags:function(){return l.traceFlags},setTraceFlags:function(e){d&&d.setTraceFlags(e),l.traceFlags=e}}),f=!(n||{}).eventContainExtFields;function p(){var t=e.session;if(t&&Pe(t.customId))return t.customId;s.update();var n=s.automaticSession;if(n){var a=n.getId();a&&Pe(a)&&(t.automaticId=a)}return t.automaticId}function m(){var e=u;return a&&a.getTraceCtx&&(e=a.getTraceCtx(!1)||u),e}e.getTraceCtx=function(){return u},e.getSessionId=p,e.applyApplicationContext=function(t){var n,a=e.app;Gi(4,t,za,((n={})[0]=a.id,n[1]=a.ver,n[2]=a.name,n[3]=a.locale,n[4]=a.getExpId(),n[5]=a.env,n),f)},e.applyUserContext=function(t){var n,a=e.user;Gi(0,t,Ka,((n={})[1]=a.getLocalId(),n[0]=a.locale,n[2]=a.id,n),f)},e.applyWebContext=function(t){var n,a=e.web;Gi(3,t,Ga,((n={})[0]=a.domain,n[1]=a.browser,n[2]=a.browserVer,n[3]=a.screenRes,n[5]=a.getUserConsentDetails(),n[4]=a.getUserConsent(),n),f)},e.applyOsContext=function(t){var n,a=e.os;Gi(5,t,Wa,((n={})[0]=a.name,n[1]=a.ver,n),f)},e.applySdkContext=function(e){var t;Gi(6,e,qa,((t={})[2]=i.installId,t[1]=i.getSequenceId(),t[3]=i.epoch,t),f)},e.applyIntWebContext=function(e){var t;Gi(7,e,Qa,((t={})[0]=r.getMsfpc(),t[1]=r.getAnid(),t[2]=r.serviceName,t),f)},e.applyUtcContext=function(e){var t,n=((t={})[0]=o.popSample,t);o.eventFlags>0&&(n[1]=o.eventFlags),Gi(8,e,Ya,n,f)},e.applyLocContext=function(t){var n;Gi(9,t,Ja,((n={})[0]=e.loc.tz,n),f)},e.applySessionContext=function(e){var t;Gi(4,e,Xa,((t={})[0]=p(),t),f)},e.applyDeviceContext=function(t){var n,a=e.device;Gi(1,t,Za,((n={})[0]=a.localId,n[2]=a.make,n[3]=a.model,n[1]=a.deviceClass,n),f)},e.applyCloudContext=function(t){var n,a=e.cloud;Gi(10,t,$a,((n={})[0]=a.role,n[1]=a.roleInstance,n[2]=a.roleVer,n),f)},e.applyAITraceContext=function(e){var t;if(n.enableApplicationInsightsTrace){var a=m();a&&Gi(2,e,ei,((t={})[0]=a.getTraceId(),t[1]=a.getName(),t[2]=a.getSpanId(),t),!1)}},e.applyDistributedTraceContext=function(e){var t,n=m();if(n){var a=((t={})[0]=n.getTraceId(),t[1]=n.getSpanId(),t),i=n.getTraceFlags();xe(i)||(a[2]=i),Gi(11,e,ti,a,!1)}}})}return e.__ieDyn=1,e}(),Wi=[Va[4],Va[0],Va[3],Va[5],Va[6],Va[7],Va[8],Va[9],Va[1],Va[2],Va[11],Va[10]];const qi=function(e){function t(){var n,a,i,r=e.call(this)||this;return r.identifier="SystemPropertiesCollector",r.priority=3,r.version="3.2.15",ie(t,r,function(e,t){function r(){n=null,a={}}r(),e.initialize=function(a,r,o){t.initialize(a,r,o),i=e._getTelCtx().getExtCfg(e.identifier),n=new Ki(a,i,r),r&&r.setTraceCtx&&r.setTraceCtx(n.getTraceCtx())},e.processTelemetry=function(t,r){Pa(t,e.identifier),r=e._getTelCtx(r);var o,s,c=t.ext=t.ext?t.ext:{};t.data=t.data?t.data:{},Re(Wi,function(e){c[e]=c[e]||{}}),n&&(n.applyUtcContext(t),n.applyApplicationContext(t),n.applyUserContext(t),n.applyWebContext(t),n.applyOsContext(t),n.applySdkContext(t),n.applyIntWebContext(t),n.applyLocContext(t),n.applySessionContext(t),n.applyDeviceContext(t),i.enableApplicationInsightsTrace&&n.applyAITraceContext(t),i.enableDistributedTracing&&n.applyDistributedTraceContext(t),n.applyCloudContext(t)),Re(ze(c),function(e){0===ze(c[e]).length&&delete c[e]}),o=a,s=t.data,o&&Ae(o,function(e,t){s[e]||(s[e]=t)}),e.processNext(t,r)},e.getPropertiesContext=function(){return n},e.setProperty=function(e,t){a[e]=t},e._doTeardown=function(e,t){var a=(e||{}).core();if(a&&a.getTraceCtx&&n){var i=a.getTraceCtx(!1);i&&i===n.getTraceCtx()&&a.setTraceCtx(null)}r()}}),r}return T(t,e),t.__ieDyn=1,t}(Rn);var Qi,Yi=(Qi={},Ae({Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5},function(e,t){Qi[e]=t,Qi[t]=e}),Ke(Qi)),Ji="REAL_TIME",Xi="",Zi="POST",$i="drop",er="requeue",tr="application/x-json-stream",nr="content-type",ar="client-version",ir="client-id",rr="time-delta-to-apply-millis",or="upload-time",sr="apikey",cr="AuthMsaDeviceTicket",dr="AuthXToken";function lr(e){var t=(e.ext||{}).intweb;return t&&wa(t.msfpc)?t.msfpc:null}function ur(e){for(var t=null,n=0;null===t&&n<e.length;n++)t=lr(e[n]);return t}var fr=function(){function e(t,n){var a=n?[].concat(n):[],i=this,r=ur(a);i.iKey=function(){return t},i.Msfpc=function(){return r||Xi},i.count=function(){return a.length},i.events=function(){return a},i.addEvent=function(e){return!!e&&(a.push(e),r||(r=lr(e)),!0)},i.split=function(n,i){var o;if(n<a.length){var s=a.length-n;xe(i)||(s=i<s?i:s),o=a.splice(n,s),r=ur(a)}return new e(t,o)}}return e.create=function(t,n){return new e(t,n)},e}();const pr=function(){function e(){var t=!0,n=!0,a=!0,i="use-collector-delta",r=!1;ie(e,this,function(e){e.allowRequestSending=function(){return t},e.firstRequestSent=function(){a&&(a=!1,r||(t=!1))},e.shouldAddClockSkewHeaders=function(){return n},e.getClockSkewHeaderValue=function(){return i},e.setClockSkew=function(e){r||(e?(i=e,n=!0,r=!0):n=!1,t=!0)}})}return e.__ieDyn=1,e}();var mr=function(){function e(){var t={};ie(e,this,function(e){e.setKillSwitchTenants=function(e,n){if(e&&n)try{var a=function(e){var t=[];return e&&Re(e,function(e){t.push(Be(e))}),t}(e.split(","));if("this-request-only"===n)return a;for(var i=1e3*parseInt(n,10),r=0;r<a.length;++r)t[a[r]]=qe()+i}catch(e){return[]}return[]},e.isTenantKilled=function(e){var n=t,a=Be(e);return void 0!==n[a]&&n[a]>qe()||(delete n[a],!1)}})}return e.__ieDyn=1,e}();const _r=mr;function hr(e){var t,n=Math.floor(1200*Math.random())+2400;return t=Math.pow(2,e)*n,Math.min(t,6e5)}var br,gr=2e6,vr=Math.min(gr,65e3),yr=/\./,Sr=function(){function e(t,n,a,i){var r="baseData",o=!!i,s=n,c={};ie(e,this,function(e){function n(e,t,i,r,d,l,u){Ae(e,function(e,f){var p=null;if(f||wa(f)){var m=i,_=e,h=d,b=t;if(o&&!r&&yr.test(e)){var g=e.split("."),v=g.length;if(v>1){h&&(h=h.slice());for(var y=0;y<v-1;y++){var S=g[y];b=b[S]=b[S]||{},m+="."+S,h&&h.push(S)}_=g[v-1]}}var D=r&&function(e,t){var n=c[e];return void 0===n&&(e.length>=7&&(n=Le(e,"ext.metadata")||Le(e,"ext.web")),c[e]=n),n}(m);if(p=!D&&s&&s.handleField(m,_)?s.value(m,_,f,a):function(e,t,n){if(!t&&!wa(t)||"string"!=typeof e)return null;var a,i=typeof t;if("string"===i||"number"===i||"boolean"===i||Me(t))t={value:t};else if("object"!==i||w.call(t,"value")){if(xe(t.value)||t.value===Jn||!Pe(t.value)&&!Te(t.value)&&!Ue(t.value)&&!Me(t.value))return null}else t={value:n?JSON.stringify(t):t};if(Me(t.value)&&!(t.value.length>0))return null;if(!xe(t.kind)){if(Me(t.value)||!(0===(a=t.kind)||a>0&&a<=13||32===a))return null;t.value=t.value.toString()}return t}(_,f,a)){var I=p.value;if(b[_]=I,l&&l(h,_,p),u&&"object"==typeof I&&!Me(I)){var x=h;x&&(x=x.slice()).push(_),n(f,I,m+"."+_,r,x,l,u)}}}})}e.createPayload=function(e,t,n,a,i,r){return{apiKeys:[],payloadBlob:Xi,overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:e,isTeardown:t,isSync:n,isBeacon:a,sendType:r,sendReason:i}},e.appendPayload=function(n,a,i){var r=n&&a&&!n.overflow;return r&&ot(t,function(){return"Serializer:appendPayload"},function(){for(var t=a.events(),r=n.payloadBlob,o=n.numEvents,s=!1,c=[],d=[],l=n.isBeacon,u=l?65e3:3984588,f=l?vr:gr,p=0,m=0;p<t.length;){var _=t[p];if(_){if(o>=i){n.overflow=a.split(p);break}var h=e.getEventBlob(_);if(h&&h.length<=f){var b=h.length;if(r.length+b>u){n.overflow=a.split(p);break}r&&(r+="\n"),r+=h,++m>20&&(r.substr(0,1),m=0),s=!0,o++}else h?c.push(_):d.push(_),t.splice(p,1),p--}p++}if(c&&c.length>0&&n.sizeExceed.push(fr.create(a.iKey(),c)),d&&d.length>0&&n.failedEvts.push(fr.create(a.iKey(),d)),s){n.batches.push(a),n.payloadBlob=r,n.numEvents=o;var g=a.iKey();-1===Ne(n.apiKeys,g)&&n.apiKeys.push(g)}},function(){return{payload:n,theBatch:{iKey:a.iKey(),evts:a.events()},max:i}}),r},e.getEventBlob=function(e){try{return ot(t,function(){return"Serializer.getEventBlob"},function(){var t={};t.name=e.name,t.time=e.time,t.ver=e.ver,t.iKey="o:"+function(e){if(e){var t=e.indexOf("-");if(t>-1)return e.substring(0,t)}return Jn}(e.iKey);var a={},i=e.ext;i&&(t.ext=a,Ae(i,function(e,t){n(t,a[e]={},"ext."+e,!0,null,null,!0)}));var o=t.data={};o.baseType=e.baseType;var s=o.baseData={};return n(e.baseData,s,r,!1,[r],function(e,t,n){Dr(a,e,t,n)},!0),n(e.data,o,"data",!1,[],function(e,t,n){Dr(a,e,t,n)},!0),JSON.stringify(t)},function(){return{item:e}})}catch(e){return null}}})}return e.__ieDyn=1,e}();function Dr(e,t,n,a){if(a&&e){var i=Ea(a.value,a.kind,a.propertyType);if(i>-1){var r=e.metadata;r||(r=e.metadata={f:{}});var o=r.f;if(o||(o=r.f={}),t)for(var s=0;s<t.length;s++){var c=t[s];o[c]||(o[c]={f:{}});var d=o[c].f;d||(d=o[c].f={}),o=d}o=o[n]={},Me(a.value)?o.a={t:i}:o.t=i}}}var Ir="&NoResponseBody=true",xr=((br={})[1]=er,br[100]=er,br[200]="sent",br[8004]=$i,br[8003]=$i,br),Cr={},Or={};function wr(e,t,n){Cr[e]=t,!1!==n&&(Or[t]=e)}function Er(e){try{return e.responseText}catch(e){}return Xi}function Ar(e,t){var n,a,i=!1;if(e&&t){var r=ze(e);if(r&&r.length>0)for(var o=t.toLowerCase(),s=0;s<r.length;s++){var c=r[s];if(c&&(a=c,(n=t)&&w.call(n,a))&&c.toLowerCase()===o){i=!0;break}}}return i}function Lr(e,t,n,a){t&&n&&n.length>0&&(a&&Cr[t]?(e.hdrs[Cr[t]]=n,e.useHdrs=!0):e.url+="&"+t+"="+n)}function kr(e,t){return t&&(Te(t)?e=[t].concat(e):Me(t)&&(e=t.concat(e))),e}wr(cr,cr,!1),wr(ar,ar),wr(ir,"Client-Id"),wr(sr,sr),wr(rr,rr),wr(or,or),wr(dr,dr);var Mr=function(){function e(t,n,a,i,r){this._responseHandlers=[];var o,s,c,d,l,u,f,p,m,_,h="?cors=true&"+nr.toLowerCase()+"="+tr,b=new _r,g=!1,v=new pr,y=!1,D=0,I=!0,x=[],C={},O=[],w=null,E=!1,A=!1,L=!1;ie(e,this,function(e){var k=!0;function M(e,t){for(var n=0,a=null,i=0;null==a&&i<e.length;)1===(n=e[i])?(null===ft&&(ft=typeof XDomainRequest!==S)&&Lt()&&(ft=ft&&!mt(_t(dt),"withCredentials")),ft?a=P:Lt()&&(a=U)):2===n&&At(t)&&(!t||t&&!p)?a=T:y&&3===n&&Et()&&(a=H),i++;return a?{_transport:n,_isSync:t,sendPOST:a}:null}function P(e,t,n){var a=new XDomainRequest;a.open(Zi,e.urlString),e.timeout&&(a.timeout=e.timeout),a.onload=function(){var e=Er(a);F(t,200,{},e),Q(e)},a.onerror=function(){F(t,400,{})},a.ontimeout=function(){F(t,500,{})},a.onprogress=function(){},n?a.send(e.data):r.set(function(){a.send(e.data)},0)}function T(e,t,n){var a,i=e.urlString,o=!1,s=!1,c=((a={body:e.data,method:Zi}).Microsoft_ApplicationInsights_BypassAjaxInstrumentation=!0,a);n&&(c.keepalive=!0,2===e._sendReason&&(o=!0,_&&(i+=Ir))),k&&(c.credentials="include"),e.headers&&ze(e.headers).length>0&&(c.headers=e.headers),fetch(i,c).then(function(e){var n={},a=Xi,i=e.headers;i&&i.forEach(function(e,t){n[t]=e}),e.body&&e.text().then(function(e){a=e}),s||(s=!0,F(t,e.status,n,a),Q(a))}).catch(function(e){s||(s=!0,F(t,0,{}))}),o&&!s&&(s=!0,F(t,200,{})),!s&&e.timeout>0&&r.set(function(){s||(s=!0,F(t,500,{}))},e.timeout)}function U(e,t,n){var a=e.urlString;function i(e,t,n){if(!e[n]&&t&&t.getResponseHeader){var a=t.getResponseHeader(n);a&&(e[n]=Be(a))}return e}function r(e,n){F(t,e.status,function(e){var t,n,a={};return e.getAllResponseHeaders?(t=e.getAllResponseHeaders(),n={},Pe(t)&&Re(Be(t).split(/[\r\n]+/),function(e){if(e){var t=e.indexOf(": ");if(-1!==t){var a=Be(e.substring(0,t)).toLowerCase(),i=Be(e.substring(t+1));n[a]=i}else n[Be(e)]=1}}),a=n):(a=i(a,e,"time-delta-millis"),a=i(a,e,"kill-duration"),a=i(a,e,"kill-duration-seconds")),a}(e),n)}n&&e.disableXhrSync&&(n=!1);var o=function(e,t,n,a,i,r){function o(e,t,n){try{e[t]=n}catch(e){}}void 0===a&&(a=!1),void 0===i&&(i=!1);var s=new XMLHttpRequest;return a&&o(s,"Microsoft_ApplicationInsights_BypassAjaxInstrumentation",a),n&&o(s,Ca,n),s.open("POST",t,!i),n&&o(s,Ca,n),!i&&r&&o(s,"timeout",r),s}(0,a,k,!0,n,e.timeout);Ae(e.headers,function(e,t){o.setRequestHeader(e,t)}),o.onload=function(){var e=Er(o);r(o,e),Q(e)},o.onerror=function(){r(o)},o.ontimeout=function(){r(o)},o.send(e.data)}function F(e,t,n,a){try{e(t,n,a)}catch(e){zt(s,2,518,wt(e))}}function H(e,t,n){var a=200,i=e._thePayload,r=e.urlString+(_?Ir:Xi);try{var o=St();if(!o.sendBeacon(r,e.data))if(i){var c=[];Re(i.batches,function(e){if(c&&e&&e.count()>0){for(var t=e.events(),n=0;n<t.length;n++)if(!o.sendBeacon(r,w.getEventBlob(t[n]))){c.push(e.split(n));break}}else c.push(e.split(0))}),Y(c,8003,i.sendType,!0)}else a=0}catch(e){Gt(s,"Failed to send telemetry using sendBeacon API. Ex:"+wt(e)),a=0}finally{F(t,a,{},Xi)}}function R(e){return 2===e||3===e}function N(e){return A&&R(e)&&(e=2),e}function B(){return!g&&D<n}function j(){var e=O;return O=[],e}function V(e,t,n){var a=!1;return e&&e.length>0&&!g&&c[t]&&w&&(a=0!==t||B()&&(n>0||v.allowRequestSending())),a}function z(e){var t={};return e&&Re(e,function(e,n){t[n]={iKey:e.iKey(),evts:e.events()}}),t}function G(e,n,a,i,r){if(e&&0!==e.length)if(g)Y(e,1,i);else{i=N(i);try{var o=e,l=0!==i;ot(d,function(){return"HttpManager:_sendBatches"},function(o){o&&(e=e.slice(0));for(var s=[],d=null,u=Ma(),f=c[i]||(l?c[1]:c[0]),p=f&&f._transport,_=m&&(A||R(i)||3===p||f._isSync&&2===p);V(e,i,n);){var h=e.shift();h&&h.count()>0&&(b.isTenantKilled(h.iKey())?s.push(h):(d=d||w.createPayload(n,a,l,_,r,i),w.appendPayload(d,h,t)?null!==d.overflow&&(e=[d.overflow].concat(e),d.overflow=null,W(d,u,Ma(),r),u=Ma(),d=null):(W(d,u,Ma(),r),u=Ma(),e=[h].concat(e),d=null)))}d&&W(d,u,Ma(),r),e.length>0&&(O=e.concat(O)),Y(s,8004,i)},function(){return{batches:z(o),retryCount:n,isTeardown:a,isSynchronous:l,sendReason:r,useSendBeacon:R(i),sendType:i}},!l)}catch(e){zt(s,2,48,"Unexpected Exception sending batch: "+wt(e))}}}function K(e,t,n){e[t]=e[t]||{},e[t][o.identifier]=n}function W(t,n,i,r){if(t&&t.payloadBlob&&t.payloadBlob.length>0){var l=!!e.sendHook,m=c[t.sendType];!R(t.sendType)&&t.isBeacon&&2===t.sendReason&&(m=c[2]||c[3]||m);var _=L;(t.isBeacon||3===m._transport)&&(_=!1);var g=function(e,t){var n={url:h,hdrs:{},useHdrs:!1};t?(n.hdrs=ka(n.hdrs,C),n.useHdrs=ze(n.hdrs).length>0):Ae(C,function(e,t){Or[e]?Lr(n,Or[e],t,!1):(n.hdrs[e]=t,n.useHdrs=!0)}),Lr(n,ir,"NO_AUTH",t),Lr(n,ar,xa,t);var a=Xi;Re(e.apiKeys,function(e){a.length>0&&(a+=","),a+=e}),Lr(n,sr,a,t),Lr(n,or,qe().toString(),t);var i=function(e){for(var t=0;t<e.batches.length;t++){var n=e.batches[t].Msfpc();if(n)return encodeURIComponent(n)}return Xi}(e);if(wa(i)&&(n.url+="&ext.intweb.msfpc="+i),v.shouldAddClockSkewHeaders()&&Lr(n,rr,v.getClockSkewHeaderValue(),t),d.getWParam){var r=d.getWParam();r>=0&&(n.url+="&w="+r)}for(var o=0;o<x.length;o++)n.url+="&"+x[o].name+"="+x[o].value;return n}(t,_);_=_||g.useHdrs;var y=Ma();ot(d,function(){return"HttpManager:_doPayloadSend"},function(){for(var c=0;c<t.batches.length;c++)for(var h=t.batches[c].events(),x=0;x<h.length;x++){var C=h[x];if(E){var O=C.timings=C.timings||{};K(O,"sendEventStart",y),K(O,"serializationStart",n),K(O,"serializationCompleted",i)}C.sendAttempt>0?C.sendAttempt++:C.sendAttempt=1}Y(t.batches,1e3+(r||0),t.sendType,!0);var w={data:t.payloadBlob,urlString:g.url,headers:g.hdrs,_thePayload:t,_sendReason:r,timeout:u,disableXhrSync:f,disableFetchKeepAlive:p};_&&(Ar(w.headers,"cache-control")||(w.headers["cache-control"]="no-cache, no-store"),Ar(w.headers,nr)||(w.headers["content-type"]=tr));var L=null;m&&(L=function(n){v.firstRequestSent();var i=function(n,i){!function(t,n,i,r){var s,c=9e3,d=null,l=!1,u=!1;try{var f=!0;if(typeof t!==S){if(n){v.setClockSkew(n["time-delta-millis"]);var p=n["kill-duration"]||n["kill-duration-seconds"];Re(b.setKillSwitchTenants(n["kill-tokens"],p),function(e){Re(i.batches,function(t){if(t.iKey()===e){d=d||[];var n=t.split(0);i.numEvents-=n.count(),d.push(n)}})})}if(200==t||204==t)return void(c=200);((s=t)>=300&&s<500&&408!=s&&429!=s||501==s||505==s||i.numEvents<=0)&&(f=!1),c=9e3+t%1e3}if(f){c=100;var m=i.retryCnt;0===i.sendType&&(m<a?(l=!0,q(function(){0===i.sendType&&D--,G(i.batches,m+1,i.isTeardown,A?2:i.sendType,5)},A,hr(m))):(u=!0,A&&(c=8001)))}}finally{l||(v.setClockSkew(),function(t,n,a,i){try{i&&o._backOffTransmission(),200===n&&(i||t.isSync||o._clearBackOff(),function(e){if(E){var t=Ma();Re(e,function(e){e&&e.count()>0&&function(e,t){E&&Re(e,function(e){K(e.timings=e.timings||{},"sendEventCompleted",t)})}(e.events(),t)})}}(t.batches)),Y(t.batches,n,t.sendType,!0)}finally{0===t.sendType&&(D--,5!==a&&e.sendQueuedRequests(t.sendType,a))}}(i,c,r,u)),Y(d,8004,i.sendType)}}(n,i,t,r)},c=t.isTeardown||t.isSync;try{m.sendPOST(n,i,c),e.sendListener&&e.sendListener(w,n,c,t.isBeacon)}catch(e){Gt(s,"Unexpected exception sending payload. Ex:"+wt(e)),F(i,0,{})}}),ot(d,function(){return"HttpManager:_doPayloadSend.sender"},function(){if(L)if(0===t.sendType&&D++,l&&!t.isBeacon&&3!==m._transport){var n={data:w.data,urlString:w.urlString,headers:ka({},w.headers),timeout:w.timeout,disableXhrSync:w.disableXhrSync,disableFetchKeepAlive:w.disableFetchKeepAlive},a=!1;ot(d,function(){return"HttpManager:_doPayloadSend.sendHook"},function(){try{e.sendHook(n,function(e){a=!0,I||e._thePayload||(e._thePayload=e._thePayload||w._thePayload,e._sendReason=e._sendReason||w._sendReason),L(e)},t.isSync||t.isTeardown)}catch(e){a||L(w)}})}else L(w)})},function(){return{thePayload:t,serializationStart:n,serializationCompleted:i,sendReason:r}},t.isSync)}t.sizeExceed&&t.sizeExceed.length>0&&Y(t.sizeExceed,8003,t.sendType),t.failedEvts&&t.failedEvts.length>0&&Y(t.failedEvts,8002,t.sendType)}function q(e,t,n){t?e():r.set(e,n)}function Q(t){var n=e._responseHandlers;try{for(var a=0;a<n.length;a++)try{n[a](t)}catch(e){zt(s,1,519,"Response handler failed: "+e)}if(t){var i=JSON.parse(t);wa(i.webResult)&&wa(i.webResult.msfpc)&&l.set("MSFPC",i.webResult.msfpc,31536e3)}}catch(e){}}function Y(e,t,n,a){if(e&&e.length>0&&i){var r=i[(c=t,l=xr[c],wa(l)||(l="oth",c>=9e3&&c<=9999?l="rspFail":c>=8e3&&c<=8999?l=$i:c>=1e3&&c<=1999&&(l="send")),l)];if(r){var o=0!==n;ot(d,function(){return"HttpManager:_sendBatchesNotification"},function(){q(function(){try{r.call(i,e,t,o,n)}catch(e){zt(s,1,74,"send request notification failed: "+e)}},a||o,0)},function(){return{batches:z(e),reason:t,isSync:o,sendSync:a,sendType:n}},!o)}}var c,l}e.initialize=function(e,t,n,a,i){var r;i||(i={}),h=e+h,L=!!Ie(i.avoidOptions)||!i.avoidOptions,d=t,l=t.getCookieMgr(),E=!d.config.disableEventTimings;var b=!!d.config.enableCompoundKey;s=(o=n).diagLog();var g=i.valueSanitizer,v=i.stringifyObjects;Ie(i.enableCompoundKey)||(b=!!i.enableCompoundKey),u=i.xhrTimeout,f=!!i.disableXhrSync,p=!!i.disableFetchKeepAlive,_=!1!==i.addNoResponse,y=!Ct(),w=new Sr(d,g,v,b),xe(i.useSendBeacon)||(y=!!i.useSendBeacon);var S=a,D=i.alwaysUseXhrOverride?a:null,x=i.alwaysUseXhrOverride?a:null,C=[3,2];if(!a){I=!1;var O=Dt();O&&O.protocol&&"file:"===O.protocol.toLowerCase()&&(k=!1);var A=[];Ct()?(A=[2,1],C=[2,1,3]):A=[1,2,3],(a=M(A=kr(A,i.transports),!1))||Gt(s,"No available transport to send events"),S=M(A,!0)}D||(D=M(C=kr(C,i.unloadTransports),!0)),m=!I&&(y&&Et()||!p&&At(!0)),(r={})[0]=a,r[1]=S||M([1,2,3],!0),r[2]=D||S||M([1],!0),r[3]=x||M([2,3],!0)||S||M([1],!0),c=r},e._getDbgPlgTargets=function(){return[c[0],b,w,c]},e.addQueryStringParameter=function(e,t){for(var n=0;n<x.length;n++)if(x[n].name===e)return void(x[n].value=t);x.push({name:e,value:t})},e.addHeader=function(e,t){C[e]=t},e.canSendRequest=function(){return B()&&v.allowRequestSending()},e.sendQueuedRequests=function(e,t){Ie(e)&&(e=0),A&&(e=N(e),t=2),V(O,e,0)&&G(j(),0,!1,e,t||0)},e.isCompletelyIdle=function(){return!g&&0===D&&0===O.length},e.setUnloading=function(e){A=e},e.addBatch=function(e){if(e&&e.count()>0){if(b.isTenantKilled(e.iKey()))return!1;O.push(e)}return!0},e.teardown=function(){O.length>0&&G(j(),0,!0,2,2)},e.pause=function(){g=!0},e.resume=function(){g=!1,e.sendQueuedRequests(0,4)},e.sendSynchronousBatch=function(e,t,n){e&&e.count()>0&&(xe(t)&&(t=1),A&&(t=N(t),n=2),G([e],0,!1,t,n||0))}})}return e.__ieDyn=1,e}();function Pr(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];return setTimeout(e,t,n)}function Tr(e){clearTimeout(e)}function Ur(e,t){return{set:e||Pr,clear:t||Tr}}var Fr="eventsDiscarded",Hr=function(e){function t(){var n,a=e.call(this)||this;a.identifier="PostChannel",a.priority=1011,a.version="3.2.15";var i,r,o,s,c,d,l,u=!1,f=[],p=null,m=!1,_=0,h=500,b=0,g=1e4,v={},y=Ji,S=null,D=null,I=0,x=0,C={},O=-1,w=!0,E=!1,A=6,L=2;return ie(t,a,function(e,t){function a(e){"beforeunload"!==(e||bt().event).type&&(E=!0,r.setUnloading(E)),N(2,2)}function k(e){E=!1,r.setUnloading(E)}function M(e,t){if(e.sendAttempt||(e.sendAttempt=0),e.latency||(e.latency=1),e.ext&&e.ext.trace&&delete e.ext.trace,e.ext&&e.ext.user&&e.ext.user.id&&delete e.ext.user.id,w&&(e.ext=tt(e.ext),e.baseData&&(e.baseData=tt(e.baseData)),e.data&&(e.data=tt(e.data))),e.sync)if(I||m)e.latency=3,e.sync=!1;else if(r)return w&&(e=tt(e)),void r.sendSynchronousBatch(fr.create(e.iKey,[e]),!0===e.sync?1:e.sync,3);var n=e.latency,a=b,i=g;4===n&&(a=_,i=h);var o=!1;if(a<i)o=!V(e,t);else{var s=1,c=20;4===n&&(s=4,c=1),o=!0,function(e,t,n,a){for(;n<=t;){var i=B(e,t,!0);if(i&&i.count()>0){var r=i.split(0,a),o=r.count();if(o>0)return 4===n?_-=o:b-=o,X(Fr,[r],Yi.QueueFull),!0}n++}return z(),!1}(e.iKey,e.latency,s,c)&&(o=!V(e,t))}o&&J(Fr,[e],Yi.QueueFull)}function P(e,t,n){var a=G(e,t,n);return r.sendQueuedRequests(t,n),a}function T(){return b>0}function U(){if(O>=0&&G(O,0,c)&&r.sendQueuedRequests(0,c),_>0&&!D&&!m){var e=v[y][2];e>=0&&(D=H(function(){D=null,P(4,0,1),U()},e))}var t=v[y][1];!S&&!p&&t>=0&&!m&&(T()?S=H(function(){S=null,P(0===x?3:1,0,1),x++,x%=2,U()},t):x=0)}function F(){n=null,u=!1,f=[],p=null,m=!1,_=0,h=500,b=0,g=1e4,v={},y=Ji,S=null,D=null,I=0,x=0,i=null,C={},o=void 0,s=0,O=-1,c=null,w=!0,E=!1,A=6,L=2,d=null,l=Ur(),r=new Mr(500,2,1,{requeue:Q,send:Z,sent:$,drop:ee,rspFail:te,oth:ne},l),q(),C[4]={batches:[],iKeyMap:{}},C[3]={batches:[],iKeyMap:{}},C[2]={batches:[],iKeyMap:{}},C[1]={batches:[],iKeyMap:{}},ae()}function H(e,t){0===t&&I&&(t=1);var n=1e3;return I&&(n=hr(I-1)),l.set(e,t*n)}function R(){return null!==S&&(l.clear(S),S=null,x=0,!0)}function N(e,t){R(),p&&(l.clear(p),p=null),m||P(1,e,t)}function B(e,t,n){var a=C[t];a||(a=C[t=1]);var i=a.iKeyMap[e];return!i&&n&&(i=fr.create(e),a.batches.push(i),a.iKeyMap[e]=i),i}function j(t,n){r.canSendRequest()&&!I&&(o>0&&b>o&&(n=!0),n&&null==p&&e.flush(t,null,20))}function V(e,t){w&&(e=tt(e));var n=e.latency,a=B(e.iKey,n,!0);return!!a.addEvent(e)&&(4!==n?(b++,t&&0===e.sendAttempt&&j(!e.sync,s>0&&a.count()>=s)):_++,!0)}function z(){for(var e=0,t=0,n=function(n){var a=C[n];a&&a.batches&&Re(a.batches,function(a){4===n?e+=a.count():t+=a.count()})},a=1;a<=4;a++)n(a);b=t,_=e}function G(t,n,a){var i=!1,o=0===n;return!o||r.canSendRequest()?ot(e.core,function(){return"PostChannel._queueBatches"},function(){for(var e=[],n=4;n>=t;){var a=C[n];a&&a.batches&&a.batches.length>0&&(Re(a.batches,function(t){r.addBatch(t)?i=i||t&&t.count()>0:e=e.concat(t.events()),4===n?_-=t.count():b-=t.count()}),a.batches=[],a.iKeyMap={}),n--}e.length>0&&J(Fr,e,Yi.KillSwitch),i&&O>=t&&(O=-1,c=0)},function(){return{latency:t,sendType:n,sendReason:a}},!o):(O=O>=0?Math.min(O,t):t,c=Math.max(c,a)),i}function K(e,t){P(1,0,t),z(),W(function(){e&&e(),f.length>0?p=H(function(){p=null,K(f.shift(),t)},0):(p=null,U())})}function W(e){r.isCompletelyIdle()?e():p=H(function(){p=null,W(e)},.25)}function q(){(v={}).REAL_TIME=[2,1,0],v.NEAR_REAL_TIME=[6,3,0],v.BEST_EFFORT=[18,9,0]}function Q(t,n){var a=[],i=A;E&&(i=L),Re(t,function(t){t&&t.count()>0&&Re(t.events(),function(t){t&&(t.sync&&(t.latency=4,t.sync=!1),t.sendAttempt<i?(Pa(t,e.identifier),M(t,!1)):a.push(t))})}),a.length>0&&J(Fr,a,Yi.NonRetryableStatus),E&&N(2,2)}function Y(t,n){var a=e._notificationManager||{},i=a[t];if(i)try{i.apply(a,n)}catch(n){zt(e.diagLog(),1,74,t+" notification failed: "+n)}}function J(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];t&&t.length>0&&Y(e,[t].concat(n))}function X(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];t&&t.length>0&&Re(t,function(t){t&&t.count()>0&&Y(e,[t.events()].concat(n))})}function Z(e,t,n){e&&e.length>0&&Y("eventsSendRequest",[t>=1e3&&t<=1999?t-1e3:0,!0!==n])}function $(e,t){X("eventsSent",e,t),U()}function ee(e,t){X(Fr,e,t>=8e3&&t<=8999?t-8e3:Yi.Unknown)}function te(e){X(Fr,e,Yi.NonRetryableStatus),U()}function ne(e,t){X(Fr,e,Yi.Unknown),U()}function ae(){s=n&&n.disableAutoBatchFlushLimit?0:Math.max(1500,g/6)}F(),e._getDbgPlgTargets=function(){return[r]},e.initialize=function(s,c,u){ot(c,function(){return"PostChannel:initialize"},function(){var f,p,m,_,b=c;t.initialize(s,c,u);try{c.addUnloadCb,d=_a(nn(e.identifier),c.evtNamespace&&c.evtNamespace());var v=e._getTelCtx();s.extensionConfig[e.identifier]=s.extensionConfig[e.identifier]||{},n=v.getExtCfg(e.identifier),l=Ur(n.setTimeoutOverride,n.clearTimeoutOverride),w=!n.disableOptimizeObj&&!!_t("chrome"),function(e){var t=e.getWParam;e.getWParam=function(){var e=0;return n.ignoreMc1Ms0CookieProcessing&&(e|=2),e|t()}}(b),n.eventsLimitInMem>0&&(g=n.eventsLimitInMem),n.immediateEventLimit>0&&(h=n.immediateEventLimit),n.autoFlushEventsLimit>0&&(o=n.autoFlushEventsLimit),Te(n.maxEventRetryAttempts)&&(A=n.maxEventRetryAttempts),Te(n.maxUnloadEventRetryAttempts)&&(L=n.maxUnloadEventRetryAttempts),ae(),n.httpXHROverride&&n.httpXHROverride.sendPOST&&(i=n.httpXHROverride),wa(s.anonCookieName)&&r.addQueryStringParameter("anoncknm",s.anonCookieName),r.sendHook=n.payloadPreprocessor,r.sendListener=n.payloadListener;var y=n.overrideEndpointUrl?n.overrideEndpointUrl:s.endpointUrl;e._notificationManager=c.getNotifyMgr(),r.initialize(y,e.core,e,i,n);var S=s.disablePageUnloadEvents||[];f=[na,ta,$n],m=S,_=d,(p=a)&&f&&Me(f)&&!ga(f,p,m,_)&&m&&m.length>0&&ga(f,p,null,_),ya(a,S,d),Sa(k,s.disablePageShowEvents,d)}catch(t){throw e.setInitialized(!1),t}},function(){return{coreConfig:s,core:c,extensions:u}})},e.processTelemetry=function(t,a){Pa(t,e.identifier);var i=(a=e._getTelCtx(a)).getExtCfg(e.identifier),r=!!n.disableTelemetry;i&&(r=r||!!i.disableTelemetry);var o=t;r||u||(n.overrideInstrumentationKey&&(o.iKey=n.overrideInstrumentationKey),i&&i.overrideInstrumentationKey&&(o.iKey=i.overrideInstrumentationKey),M(o,!0),E?N(2,2):U()),e.processNext(o,a)},e._doTeardown=function(e,t){var n;N(2,2),u=!0,r.teardown(),va([na,ta,$n],null,d),n=_a(aa,d),va([$n],null,n),va([Zn],null,n),function(e,t){var n=_a(ia,t);va([ea],null,n),va([Zn],null,n)}(0,d),F()},e.setEventQueueLimits=function(e,t){g=e>0?e:1e4,o=t>0?t:0,ae();var n=b>e;if(!n&&s>0)for(var a=1;!n&&a<=3;a++){var i=C[a];i&&i.batches&&Re(i.batches,function(e){e&&e.count()>=s&&(n=!0)})}j(!0,n)},e.pause=function(){R(),m=!0,r.pause()},e.resume=function(){m=!1,r.resume(),U()},e.addResponseHandler=function(e){r._responseHandlers.push(e)},e._loadTransmitProfiles=function(e){R(),q(),y=Ji,U(),Ae(e,function(e,t){var n=t.length;if(n>=2){var a=n>2?t[2]:0;if(t.splice(0,n-2),t[1]<0&&(t[0]=-1),t[1]>0&&t[0]>0){var i=t[0]/t[1];t[0]=Math.ceil(i)*t[1]}a>=0&&t[1]>=0&&a>t[1]&&(a=t[1]),t.push(a),v[e]=t}})},e.flush=function(e,t,n){if(void 0===e&&(e=!0),!m)if(n=n||1,e)null==p?(R(),G(1,0,n),p=H(function(){p=null,K(t,n)},0)):f.push(t);else{var a=R();P(1,1,n),null!=t&&t(),a&&U()}},e.setMsaAuthTicket=function(e){r.addHeader(cr,e)},e.hasEvents=T,e._setTransmitProfile=function(e){y!==e&&void 0!==v[e]&&(R(),y=e,U())},e._backOffTransmission=function(){I<4&&(I++,R(),U())},e._clearBackOff=function(){I&&(I=0,R(),U())},Ge(e,"_setTimeoutOverride",function(){return l.set},function(e){l=Ur(e,l.clear)}),Ge(e,"_clearTimeoutOverride",function(){return l.clear},function(e){l=Ur(l.set,e)})}),a}return T(t,e),t.__ieDyn=1,t}(Rn);const Rr=Hr;var Nr=function(e){function t(){var n,a,i=e.call(this)||this;return ie(t,i,function(e,t){e.initialize=function(e,r){var o=i;ot(i,function(){return"ApplicationInsights:initialize"},function(){n=new Rr;var i=[a=new qi];r&&(i=i.concat(r)),e||$e("You must provide a config object!");var s=e.channels;if(s&&s.length>0){for(var c=!1,d=0;d<s[0].length;d++)if(s[0][d].identifier===n.identifier){c=!0;break}c||s[0].push(n)}else e.channels=[[n]];var l=e.extensionConfig=e.extensionConfig||[];l[n.identifier]=l[n.identifier]||e&&e.channelConfiguration||{},l[a.identifier]=l[a.identifier]||e&&e.propertyConfiguration||{};try{t.initialize(e,i)}catch(e){zt(o.logger,1,514,"Failed to initialize SDK."+wt(e))}},function(){return{config:e,extensions:r}})},e.getPropertyManager=function(){return a},e.getPostChannel=function(){return n}}),i}return T(t,e),t.__ieDyn=1,t}(Fa);const Br=Nr,jr={...f.Ok,PairwiseBrokerApplicationInitializeBrokering:"pairwiseBrokerApplicationInitializeBrokering",BrokerClientApplicationHandleBrokerHandshake:"brokerClientApplicationHandleBrokerHandshake",BrokerClientApplicationBrokeredSSOSilentRequest:"brokerClientApplicationBrokeredSSOSilentRequest",BrokerClientApplicationBrokeredSilentRequest:"brokerClientApplicationBrokeredSilentRequest",EmbeddedClientApplicationSendSSOSilentRequest:"embeddedClientApplicationSendSSOSilentRequest",EmbeddedClientApplicationSendPopupRequest:"embeddedClientApplicationSendPopupRequest",EmbeddedClientApplicationSendRedirectRequest:"embeddedClientApplicationSendRedirectRequest",EmbeddedClientApplicationHandleRedirectRequest:"embeddedClientApplicationHandleRedirectRequest",EmbeddedClientApplicationSendSilentRefreshRequest:"embeddedClientApplicationSendSilentRefreshRequest"},Vr=new Set(["brokerInteractionTimeoutMs","brokerMessageTimeoutMs","brokerHandshakeTimeoutMs","brokerIframeTimeoutMs"]),zr=new Set([jr.AcquireTokenSilent,jr.SsoSilent,jr.AcquireTokenByCode,jr.InitializeClientApplication,jr.AcquireTokenPopup]);class Gr{constructor(e,t){this.logger=e,this.eventsToEmit=new Set(t?.eventsToEmit?.filter(e=>zr.has(e))||[jr.AcquireTokenSilent,jr.SsoSilent,jr.AcquireTokenByCode,jr.InitializeClientApplication]),this.logger.verbose(`PerformanceTelemetryReporter: Events to be tracked include : ${[...this.eventsToEmit].join(",")}`),this.logger.verbose(`PerformanceTelemetryReporter: Events passed in the PerformanceTelemetryConfiguration are: ${t?.eventsToEmit}`),this.appInsights=new Br,this.appInsights.initialize({instrumentationKey:"d634483c08244c1ca09af2b2d952c92e-ab2bba03-2ba3-49d8-a82c-ef6da750d8ab-7725",extensions:[]},[]),this.logger.verbose("PerformanceTelemetryReporter: Initialized")}sendCustomEvent(e){const t={...e,appName:void 0},n={name:e.name,data:t};this.logger.verbose(`PerformanceTelemetryReporter: Sending ${n.name} for tracking`),this.appInsights.track(n)}getPerformanceTelemetryCallback(){return this.logger.trace("PerformanceTelemetryReporter: Attaching callback to send custom metrics."),this.logger.verbose(" PerformanceTelemetryReporter: Returning callback as telemetry emitted."),e=>{e.forEach(e=>{this.eventsToEmit.has(e.name)?(this.logger.verbose(`PerformanceTelemetryReporter: Emitting telemetry for ${e.name}`,e.correlationId),this.sendCustomEvent(e)):this.logger.verbose(`PerformanceTelemetryReporter: Skipping telemetry for ${e.name}`,e.correlationId)})}}}const Kr=[a.z.AzurePublic,a.z.AzurePpe];class Wr extends u{constructor(e,t){var n;!t?.disabled&&(n=t?.samplingPercentage,0!==n&&Math.random()<=(n||.1))&&function(e){return!e.auth.authority||Kr.some(t=>0===e.auth.authority?.indexOf(t.toString()))}(e)?super({...e,telemetry:{...e.telemetry,client:e.telemetry?.client||new g(e,Vr)}}):super(e);const a=new Gr(this.getLogger(),t);this.addPerformanceCallback(a.getPerformanceTelemetryCallback())}}}
,4282:(e,t,n)=>{n.d(t,{L:()=>Tt});var a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},a(e,t)};function i(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var r,o,s=function(){return s=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)};function c(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}c((a=a.apply(e,t||[])).next())})}function d(e,t){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],a=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,i,r=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=r.next()).done;)o.push(a.value)}catch(e){i={error:e}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return o}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}!function(e){e.AcquireTokenByCode="acquireTokenByCode",e.AcquireTokenByRefreshToken="acquireTokenByRefreshToken",e.AcquireTokenSilent="acquireTokenSilent",e.AcquireTokenSilentAsync="acquireTokenSilentAsync",e.AcquireTokenPopup="acquireTokenPopup",e.CryptoOptsGetPublicKeyThumbprint="cryptoOptsGetPublicKeyThumbprint",e.CryptoOptsSignJwt="cryptoOptsSignJwt",e.SilentCacheClientAcquireToken="silentCacheClientAcquireToken",e.SilentIframeClientAcquireToken="silentIframeClientAcquireToken",e.SilentRefreshClientAcquireToken="silentRefreshClientAcquireToken",e.SsoSilent="ssoSilent",e.StandardInteractionClientGetDiscoveredAuthority="standardInteractionClientGetDiscoveredAuthority",e.FetchAccountIdWithNativeBroker="fetchAccountIdWithNativeBroker",e.NativeInteractionClientAcquireToken="nativeInteractionClientAcquireToken",e.BaseClientCreateTokenRequestHeaders="baseClientCreateTokenRequestHeaders",e.BrokerHandhshake="brokerHandshake",e.AcquireTokenByRefreshTokenInBroker="acquireTokenByRefreshTokenInBroker",e.AcquireTokenByBroker="acquireTokenByBroker",e.RefreshTokenClientExecuteTokenRequest="refreshTokenClientExecuteTokenRequest",e.RefreshTokenClientAcquireToken="refreshTokenClientAcquireToken",e.RefreshTokenClientAcquireTokenWithCachedRefreshToken="refreshTokenClientAcquireTokenWithCachedRefreshToken"}(r||(r={})),function(e){e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Completed=2]="Completed"}(o||(o={}));var f,p,m,_,h,b,g,v,y=n(9405),S="msal.js.browser",D="53ee284d-920a-4b59-9d30-a60315b26836";!function(e){e.HandshakeRequest="Handshake",e.HandshakeResponse="HandshakeResponse",e.GetToken="GetToken",e.Response="Response"}(f||(f={})),function(e){e.LocalStorage="localStorage",e.SessionStorage="sessionStorage",e.MemoryStorage="memoryStorage"}(p||(p={})),function(e){e.GET="GET",e.POST="POST"}(m||(m={})),function(e){e.AUTHORITY="authority",e.ACQUIRE_TOKEN_ACCOUNT="acquireToken.account",e.SESSION_STATE="session.state",e.REQUEST_STATE="request.state",e.NONCE_IDTOKEN="nonce.id_token",e.ORIGIN_URI="request.origin",e.RENEW_STATUS="token.renew.status",e.URL_HASH="urlHash",e.REQUEST_PARAMS="request.params",e.SCOPES="scopes",e.INTERACTION_STATUS_KEY="interaction.status",e.CCS_CREDENTIAL="ccs.credential",e.CORRELATION_ID="request.correlationId",e.NATIVE_REQUEST="request.native"}(_||(_={})),function(e){e.WRAPPER_SKU="wrapper.sku",e.WRAPPER_VER="wrapper.version"}(h||(h={})),function(e){e[e.acquireTokenRedirect=861]="acquireTokenRedirect",e[e.acquireTokenPopup=862]="acquireTokenPopup",e[e.ssoSilent=863]="ssoSilent",e[e.acquireTokenSilent_authCode=864]="acquireTokenSilent_authCode",e[e.handleRedirectPromise=865]="handleRedirectPromise",e[e.acquireTokenByCode=866]="acquireTokenByCode",e[e.acquireTokenSilent_silentFlow=61]="acquireTokenSilent_silentFlow",e[e.logout=961]="logout",e[e.logoutPopup=962]="logoutPopup"}(b||(b={})),function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(g||(g={})),function(e){e.Startup="startup",e.Login="login",e.Logout="logout",e.AcquireToken="acquireToken",e.SsoSilent="ssoSilent",e.HandleRedirect="handleRedirect",e.None="none"}(v||(v={}));var I,x={scopes:y.r_},C="jwk";!function(e){e.React="@azure/msal-react",e.Angular="@azure/msal-angular"}(I||(I={}));var O,w="msal.db",E=n(3891),A=n(5278),L=function(e){function t(n,a){var i=e.call(this,n,a)||this;return i.name="JoseHeaderError",Object.setPrototypeOf(i,t.prototype),i}return(0,E.XT)(t,e),t.createMissingKidError=function(){return new t("missing_kid_error","The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.")},t.createMissingAlgError=function(){return new t("missing_alg_error","The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided.")},t}(A.l),k=function(){function e(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}return e.getShrHeaderString=function(t){if(!t.kid)throw L.createMissingKidError();if(!t.alg)throw L.createMissingAlgError();var n=new e({typ:t.typ||y.L.Jwt,kid:t.kid,alg:t.alg});return JSON.stringify(n)},e}(),M=function(){function e(){}return e.decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t},e}(),P=function(){function e(e){this.cryptoObj=e}return e.prototype.generateGuid=function(){try{var e=new Uint8Array(16);return this.cryptoObj.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,M.decimalToHex(e[0])+M.decimalToHex(e[1])+M.decimalToHex(e[2])+M.decimalToHex(e[3])+"-"+M.decimalToHex(e[4])+M.decimalToHex(e[5])+"-"+M.decimalToHex(e[6])+M.decimalToHex(e[7])+"-"+M.decimalToHex(e[8])+M.decimalToHex(e[9])+"-"+M.decimalToHex(e[10])+M.decimalToHex(e[11])+M.decimalToHex(e[12])+M.decimalToHex(e[13])+M.decimalToHex(e[14])+M.decimalToHex(e[15])}catch(e){for(var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",n="0123456789abcdef",a=0,i=y.oT.EMPTY_STRING,r=0;r<36;r++)"-"!==t[r]&&"4"!==t[r]&&(a=16*Math.random()|0),"x"===t[r]?i+=n[a]:"y"===t[r]?(a&=3,i+=n[a|=8]):i+=t[r];return i}},e.prototype.isGuid=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e}(),T=function(){function e(){}return e.stringToUtf8Arr=function(e){for(var t,n=0,a=e.length,i=0;i<a;i++)n+=(t=e.charCodeAt(i))<128?1:t<2048?2:t<65536?3:t<2097152?4:t<67108864?5:6;for(var r=new Uint8Array(n),o=0,s=0;o<n;s++)(t=e.charCodeAt(s))<128?r[o++]=t:t<2048?(r[o++]=192+(t>>>6),r[o++]=128+(63&t)):t<65536?(r[o++]=224+(t>>>12),r[o++]=128+(t>>>6&63),r[o++]=128+(63&t)):t<2097152?(r[o++]=240+(t>>>18),r[o++]=128+(t>>>12&63),r[o++]=128+(t>>>6&63),r[o++]=128+(63&t)):t<67108864?(r[o++]=248+(t>>>24),r[o++]=128+(t>>>18&63),r[o++]=128+(t>>>12&63),r[o++]=128+(t>>>6&63),r[o++]=128+(63&t)):(r[o++]=252+(t>>>30),r[o++]=128+(t>>>24&63),r[o++]=128+(t>>>18&63),r[o++]=128+(t>>>12&63),r[o++]=128+(t>>>6&63),r[o++]=128+(63&t));return r},e.stringToArrayBuffer=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),a=0;a<e.length;a++)n[a]=e.charCodeAt(a);return t},e.utf8ArrToString=function(e){for(var t=y.oT.EMPTY_STRING,n=void 0,a=e.length,i=0;i<a;i++)n=e[i],t+=String.fromCharCode(n>251&&n<254&&i+5<a?1073741824*(n-252)+(e[++i]-128<<24)+(e[++i]-128<<18)+(e[++i]-128<<12)+(e[++i]-128<<6)+e[++i]-128:n>247&&n<252&&i+4<a?(n-248<<24)+(e[++i]-128<<18)+(e[++i]-128<<12)+(e[++i]-128<<6)+e[++i]-128:n>239&&n<248&&i+3<a?(n-240<<18)+(e[++i]-128<<12)+(e[++i]-128<<6)+e[++i]-128:n>223&&n<240&&i+2<a?(n-224<<12)+(e[++i]-128<<6)+e[++i]-128:n>191&&n<224&&i+1<a?(n-192<<6)+e[++i]-128:n);return t},e}(),U=function(){function e(){}return e.prototype.urlEncode=function(e){return encodeURIComponent(this.encode(e).replace(/=/g,y.oT.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_"))},e.prototype.urlEncodeArr=function(e){return this.base64EncArr(e).replace(/=/g,y.oT.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_")},e.prototype.encode=function(e){var t=T.stringToUtf8Arr(e);return this.base64EncArr(t)},e.prototype.base64EncArr=function(e){for(var t=(3-e.length%3)%3,n=y.oT.EMPTY_STRING,a=void 0,i=e.length,r=0,o=0;o<i;o++)a=o%3,r|=e[o]<<(16>>>a&24),2!==a&&e.length-o!=1||(n+=String.fromCharCode(this.uint6ToB64(r>>>18&63),this.uint6ToB64(r>>>12&63),this.uint6ToB64(r>>>6&63),this.uint6ToB64(63&r)),r=0);return 0===t?n:n.substring(0,n.length-t)+(1===t?"=":"==")},e.prototype.uint6ToB64=function(e){return e<26?e+65:e<52?e+71:e<62?e-4:62===e?43:63===e?47:65},e}(),F=function(){function e(){}return e.prototype.decode=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("Invalid base64 string")}var n=this.base64DecToArr(t);return T.utf8ArrToString(n)},e.prototype.base64DecToArr=function(e,t){for(var n=e.replace(/[^A-Za-z0-9\+\/]/g,y.oT.EMPTY_STRING),a=n.length,i=t?Math.ceil((3*a+1>>>2)/t)*t:3*a+1>>>2,r=new Uint8Array(i),o=void 0,s=void 0,c=0,d=0,l=0;l<a;l++)if(s=3&l,c|=this.b64ToUint6(n.charCodeAt(l))<<18-6*s,3===s||a-l==1){for(o=0;o<3&&d<i;o++,d++)r[d]=c>>>(16>>>o&24)&255;c=0}return r},e.prototype.b64ToUint6=function(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:43===e?62:47===e?63:0},e}(),H=n(2169),R="user_cancelled",N="crypto_key_not_found",B="database_unavailable",j=function(e){function t(n,a){var i=e.call(this,n,a)||this;return Object.setPrototypeOf(i,t.prototype),i.name="BrowserAuthError",i}return i(t,e),t.createPkceNotGeneratedError=function(e){return new t("pkce_not_created","The PKCE code challenge and verifier could not be generated. Detail:"+e)},t.createCryptoNotAvailableError=function(e){return new t("crypto_nonexistent","The crypto object or function is not available. Detail:"+e)},t.createHttpMethodNotImplementedError=function(e){return new t("http_method_not_implemented","The HTTP method given has not been implemented in this library. Given Method: "+e)},t.createEmptyNavigationUriError=function(){return new t("empty_navigate_uri","Navigation URI is empty. Please check stack trace for more info.")},t.createEmptyHashError=function(e){return new t("hash_empty_error","Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. For more visit: aka.ms/msaljs/browser-errors. Given Url: "+e)},t.createHashDoesNotContainStateError=function(){return new t("no_state_in_hash","Hash does not contain state. Please verify that the request originated from msal.")},t.createHashDoesNotContainKnownPropertiesError=function(){return new t("hash_does_not_contain_known_properties","Hash does not contain known properites. Please verify that your redirectUri is not changing the hash. For more visit: aka.ms/msaljs/browser-errors.")},t.createUnableToParseStateError=function(){return new t("unable_to_parse_state","Unable to parse state. Please verify that the request originated from msal.")},t.createStateInteractionTypeMismatchError=function(){return new t("state_interaction_type_mismatch","Hash contains state but the interaction type does not match the caller.")},t.createInteractionInProgressError=function(){return new t("interaction_in_progress","Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.  For more visit: aka.ms/msaljs/browser-errors.")},t.createPopupWindowError=function(e){var n="Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.";return new t("popup_window_error",n=H.x.isEmpty(e)?n:n+" Details: "+e)},t.createEmptyWindowCreatedError=function(){return new t("empty_window_error","window.open returned null or undefined window object.")},t.createUserCancelledError=function(){return new t(R,"User cancelled the flow.")},t.createMonitorPopupTimeoutError=function(){return new t("monitor_window_timeout","Token acquisition in popup failed due to timeout. For more visit: aka.ms/msaljs/browser-errors.")},t.createMonitorIframeTimeoutError=function(){return new t("monitor_window_timeout","Token acquisition in iframe failed due to timeout. For more visit: aka.ms/msaljs/browser-errors.")},t.createRedirectInIframeError=function(e){return new t("redirect_in_iframe","Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs. (window.parent !== window) => "+e)},t.createBlockReloadInHiddenIframeError=function(){return new t("block_iframe_reload","Request was blocked inside an iframe because MSAL detected an authentication response. For more visit: aka.ms/msaljs/browser-errors")},t.createBlockAcquireTokenInPopupsError=function(){return new t("block_nested_popups","Request was blocked inside a popup because MSAL detected it was running in a popup.")},t.createIframeClosedPrematurelyError=function(){return new t("iframe_closed_prematurely","The iframe being monitored was closed prematurely.")},t.createSilentLogoutUnsupportedError=function(){return new t("silent_logout_unsupported","Silent logout not supported. Please call logoutRedirect or logoutPopup instead.")},t.createNoAccountError=function(){return new t("no_account_error","No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.")},t.createSilentPromptValueError=function(e){return new t("silent_prompt_value_error","The value given for the prompt value is not valid for silent requests - must be set to 'none'. Given value: "+e)},t.createUnableToParseTokenRequestCacheError=function(){return new t("unable_to_parse_token_request_cache_error","The cached token request could not be parsed.")},t.createNoTokenRequestCacheError=function(){return new t("no_token_request_cache_error","No token request found in cache.")},t.createAuthRequestNotSetError=function(){return new t("auth_request_not_set_error","Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler")},t.createNoCachedAuthorityError=function(){return new t("no_cached_authority_error","No cached authority found.")},t.createInvalidCacheTypeError=function(){return new t("invalid_cache_type","Invalid cache type")},t.createNonBrowserEnvironmentError=function(){return new t("non_browser_environment","Login and token requests are not supported in non-browser environments.")},t.createDatabaseNotOpenError=function(){return new t("database_not_open","Database is not open!")},t.createNoNetworkConnectivityError=function(){return new t("no_network_connectivity","No network connectivity. Check your internet connection.")},t.createPostRequestFailedError=function(e,n){return new t("post_request_failed","Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA' | Network client threw: "+e+" | Attempted to reach: "+n.split("?")[0])},t.createGetRequestFailedError=function(e,n){return new t("get_request_failed","Network request failed. Please check the network trace to determine root cause. | Network client threw: "+e+" | Attempted to reach: "+n.split("?")[0])},t.createFailedToParseNetworkResponseError=function(e){return new t("failed_to_parse_response","Failed to parse network response. Check network trace. | Attempted to reach: "+e.split("?")[0])},t.createUnableToLoadTokenError=function(e){return new t("unable_to_load_token","Error loading token to cache. | "+e)},t.createSigningKeyNotFoundInStorageError=function(e){return new t(N,"Cryptographic Key or Keypair not found in browser storage. | No match found for KeyId: "+e)},t.createAuthCodeRequiredError=function(){return new t("auth_code_required","An authorization code must be provided (as the `code` property on the request) to this flow.")},t.createAuthCodeOrNativeAccountIdRequiredError=function(){return new t("auth_code_or_nativeAccountId_required","An authorization code or nativeAccountId must be provided to this flow.")},t.createDatabaseUnavailableError=function(){return new t(B,"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.")},t.createUnableToAcquireTokenFromNativePlatformError=function(){return new t("unable_to_acquire_token_from_native_platform","Unable to acquire token from native platform. For a list of possible reasons visit aka.ms/msaljs/browser-errors.")},t.createNativeHandshakeTimeoutError=function(){return new t("native_handshake_timeout","Timed out while attempting to establish connection to browser extension")},t.createNativeExtensionNotInstalledError=function(){return new t("native_extension_not_installed","Native extension is not installed. If you think this is a mistake call the initialize function.")},t.createNativeConnectionNotEstablishedError=function(){return new t("native_connection_not_established","Connection to native platform has not been established. Please install a compatible browser extension and run initialize(). For more please visit aka.ms/msaljs/browser-errors.")},t.createNativeBrokerCalledBeforeInitialize=function(){return new t("native_broker_called_before_initialize","You must call and await the initialize function before attempting to call any other MSAL API when native brokering is enabled. For more please visit aka.ms/msaljs/browser-errors.")},t.createNativePromptParameterNotSupportedError=function(){return new t("native_prompt_not_supported","The provided prompt is not supported by the native platform. This request should be routed to the web based flow.")},t}(A.l),V=function(){function e(e){this.base64Encode=new U,this.cryptoObj=e}return e.prototype.generateCodes=function(){return c(this,void 0,void 0,function(){var e,t;return d(this,function(n){switch(n.label){case 0:return e=this.generateCodeVerifier(),[4,this.generateCodeChallengeFromVerifier(e)];case 1:return t=n.sent(),[2,{verifier:e,challenge:t}]}})})},e.prototype.generateCodeVerifier=function(){try{var e=new Uint8Array(32);return this.cryptoObj.getRandomValues(e),this.base64Encode.urlEncodeArr(e)}catch(e){throw j.createPkceNotGeneratedError(e)}},e.prototype.generateCodeChallengeFromVerifier=function(e){return c(this,void 0,void 0,function(){var t,n;return d(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.cryptoObj.sha256Digest(e)];case 1:return t=a.sent(),[2,this.base64Encode.urlEncodeArr(new Uint8Array(t))];case 2:throw n=a.sent(),j.createPkceNotGeneratedError(n);case 3:return[2]}})})},e}(),z="SHA-256",G=new Uint8Array([1,0,1]),K=function(){function e(e){if(this.logger=e,!this.hasCryptoAPI())throw j.createCryptoNotAvailableError("Browser crypto or msCrypto object not available.");this._keygenAlgorithmOptions={name:"RSASSA-PKCS1-v1_5",hash:z,modulusLength:2048,publicExponent:G}}return e.prototype.sha256Digest=function(e){return c(this,void 0,void 0,function(){var t;return d(this,function(n){return t=T.stringToUtf8Arr(e),[2,this.hasIECrypto()?this.getMSCryptoDigest(z,t):this.getSubtleCryptoDigest(z,t)]})})},e.prototype.getRandomValues=function(e){var t=window.msCrypto||window.crypto;if(!t.getRandomValues)throw j.createCryptoNotAvailableError("getRandomValues does not exist.");t.getRandomValues(e)},e.prototype.generateKeyPair=function(e,t){return c(this,void 0,void 0,function(){return d(this,function(n){return[2,this.hasIECrypto()?this.msCryptoGenerateKey(e,t):window.crypto.subtle.generateKey(this._keygenAlgorithmOptions,e,t)]})})},e.prototype.exportJwk=function(e){return c(this,void 0,void 0,function(){return d(this,function(t){return[2,this.hasIECrypto()?this.msCryptoExportJwk(e):window.crypto.subtle.exportKey(C,e)]})})},e.prototype.importJwk=function(t,n,a){return c(this,void 0,void 0,function(){var i,r;return d(this,function(o){return i=e.getJwkString(t),r=T.stringToArrayBuffer(i),[2,this.hasIECrypto()?this.msCryptoImportKey(r,n,a):window.crypto.subtle.importKey(C,t,this._keygenAlgorithmOptions,n,a)]})})},e.prototype.sign=function(e,t){return c(this,void 0,void 0,function(){return d(this,function(n){return[2,this.hasIECrypto()?this.msCryptoSign(e,t):window.crypto.subtle.sign(this._keygenAlgorithmOptions,e,t)]})})},e.prototype.hasCryptoAPI=function(){return this.hasIECrypto()||this.hasBrowserCrypto()},e.prototype.hasIECrypto=function(){return"msCrypto"in window},e.prototype.hasBrowserCrypto=function(){return"crypto"in window},e.prototype.getSubtleCryptoDigest=function(e,t){return c(this,void 0,void 0,function(){return d(this,function(n){return[2,window.crypto.subtle.digest(e,t)]})})},e.prototype.getMSCryptoDigest=function(e,t){return c(this,void 0,void 0,function(){return d(this,function(n){return[2,new Promise(function(n,a){var i=window.msCrypto.subtle.digest(e,t.buffer);i.addEventListener("complete",function(e){n(e.target.result)}),i.addEventListener("error",function(e){a(e)})})]})})},e.prototype.msCryptoGenerateKey=function(e,t){return c(this,void 0,void 0,function(){var n=this;return d(this,function(a){return[2,new Promise(function(a,i){var r=window.msCrypto.subtle.generateKey(n._keygenAlgorithmOptions,e,t);r.addEventListener("complete",function(e){a(e.target.result)}),r.addEventListener("error",function(e){i(e)})})]})})},e.prototype.msCryptoExportJwk=function(e){return c(this,void 0,void 0,function(){return d(this,function(t){return[2,new Promise(function(t,n){var a=window.msCrypto.subtle.exportKey(C,e);a.addEventListener("complete",function(e){var a=e.target.result,i=T.utf8ArrToString(new Uint8Array(a)).replace(/\r/g,y.oT.EMPTY_STRING).replace(/\n/g,y.oT.EMPTY_STRING).replace(/\t/g,y.oT.EMPTY_STRING).split(" ").join(y.oT.EMPTY_STRING).replace("\0",y.oT.EMPTY_STRING);try{t(JSON.parse(i))}catch(e){n(e)}}),a.addEventListener("error",function(e){n(e)})})]})})},e.prototype.msCryptoImportKey=function(e,t,n){return c(this,void 0,void 0,function(){var a=this;return d(this,function(i){return[2,new Promise(function(i,r){var o=window.msCrypto.subtle.importKey(C,e,a._keygenAlgorithmOptions,t,n);o.addEventListener("complete",function(e){i(e.target.result)}),o.addEventListener("error",function(e){r(e)})})]})})},e.prototype.msCryptoSign=function(e,t){return c(this,void 0,void 0,function(){var n=this;return d(this,function(a){return[2,new Promise(function(a,i){var r=window.msCrypto.subtle.sign(n._keygenAlgorithmOptions,e,t);r.addEventListener("complete",function(e){a(e.target.result)}),r.addEventListener("error",function(e){i(e)})})]})})},e.getJwkString=function(e){return JSON.stringify(e,Object.keys(e).sort())},e}(),W=function(){function e(){this.dbName=w,this.version=1,this.tableName="msal.db.keys",this.dbOpen=!1}return e.prototype.open=function(){return c(this,void 0,void 0,function(){var e=this;return d(this,function(t){return[2,new Promise(function(t,n){var a=window.indexedDB.open(e.dbName,e.version);a.addEventListener("upgradeneeded",function(t){t.target.result.createObjectStore(e.tableName)}),a.addEventListener("success",function(n){var a=n;e.db=a.target.result,e.dbOpen=!0,t()}),a.addEventListener("error",function(){return n(j.createDatabaseUnavailableError())})})]})})},e.prototype.closeConnection=function(){var e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)},e.prototype.validateDbIsOpen=function(){return c(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return this.dbOpen?[3,2]:[4,this.open()];case 1:return[2,e.sent()];case 2:return[2]}})})},e.prototype.getItem=function(e){return c(this,void 0,void 0,function(){var t=this;return d(this,function(n){switch(n.label){case 0:return[4,this.validateDbIsOpen()];case 1:return n.sent(),[2,new Promise(function(n,a){if(!t.db)return a(j.createDatabaseNotOpenError());var i=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).get(e);i.addEventListener("success",function(e){var a=e;t.closeConnection(),n(a.target.result)}),i.addEventListener("error",function(e){t.closeConnection(),a(e)})})]}})})},e.prototype.setItem=function(e,t){return c(this,void 0,void 0,function(){var n=this;return d(this,function(a){switch(a.label){case 0:return[4,this.validateDbIsOpen()];case 1:return a.sent(),[2,new Promise(function(a,i){if(!n.db)return i(j.createDatabaseNotOpenError());var r=n.db.transaction([n.tableName],"readwrite").objectStore(n.tableName).put(t,e);r.addEventListener("success",function(){n.closeConnection(),a()}),r.addEventListener("error",function(e){n.closeConnection(),i(e)})})]}})})},e.prototype.removeItem=function(e){return c(this,void 0,void 0,function(){var t=this;return d(this,function(n){switch(n.label){case 0:return[4,this.validateDbIsOpen()];case 1:return n.sent(),[2,new Promise(function(n,a){if(!t.db)return a(j.createDatabaseNotOpenError());var i=t.db.transaction([t.tableName],"readwrite").objectStore(t.tableName).delete(e);i.addEventListener("success",function(){t.closeConnection(),n()}),i.addEventListener("error",function(e){t.closeConnection(),a(e)})})]}})})},e.prototype.getKeys=function(){return c(this,void 0,void 0,function(){var e=this;return d(this,function(t){switch(t.label){case 0:return[4,this.validateDbIsOpen()];case 1:return t.sent(),[2,new Promise(function(t,n){if(!e.db)return n(j.createDatabaseNotOpenError());var a=e.db.transaction([e.tableName],"readonly").objectStore(e.tableName).getAllKeys();a.addEventListener("success",function(n){var a=n;e.closeConnection(),t(a.target.result)}),a.addEventListener("error",function(t){e.closeConnection(),n(t)})})]}})})},e.prototype.containsKey=function(e){return c(this,void 0,void 0,function(){var t=this;return d(this,function(n){switch(n.label){case 0:return[4,this.validateDbIsOpen()];case 1:return n.sent(),[2,new Promise(function(n,a){if(!t.db)return a(j.createDatabaseNotOpenError());var i=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).count(e);i.addEventListener("success",function(e){var a=e;t.closeConnection(),n(1===a.target.result)}),i.addEventListener("error",function(e){t.closeConnection(),a(e)})})]}})})},e.prototype.deleteDatabase=function(){return c(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return this.db&&this.dbOpen&&this.closeConnection(),[4,window.indexedDB.databases()];case 1:return e.sent().find(function(e){return e.name===w})?[2,new Promise(function(e,t){var n=window.indexedDB.deleteDatabase(w);n.addEventListener("success",function(){return e(!0)}),n.addEventListener("error",function(){return t(!1)})})]:[2,!0]}})})},e}(),q=function(){function e(){this.cache=new Map}return e.prototype.getItem=function(e){return this.cache.get(e)||null},e.prototype.setItem=function(e,t){this.cache.set(e,t)},e.prototype.removeItem=function(e){this.cache.delete(e)},e.prototype.getKeys=function(){var e=[];return this.cache.forEach(function(t,n){e.push(n)}),e},e.prototype.containsKey=function(e){return this.cache.has(e)},e.prototype.clear=function(){this.cache.clear()},e}(),Q=function(){function e(e,t){this.inMemoryCache=new q,this.indexedDBCache=new W,this.logger=e,this.storeName=t}return e.prototype.handleDatabaseAccessError=function(e){if(!(e instanceof j&&e.errorCode===B))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")},e.prototype.getItem=function(e){return c(this,void 0,void 0,function(){var t,n;return d(this,function(a){switch(a.label){case 0:if(t=this.inMemoryCache.getItem(e))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),[4,this.indexedDBCache.getItem(e)];case 2:return[2,a.sent()];case 3:return n=a.sent(),this.handleDatabaseAccessError(n),[3,4];case 4:return[2,t]}})})},e.prototype.setItem=function(e,t){return c(this,void 0,void 0,function(){var n;return d(this,function(a){switch(a.label){case 0:this.inMemoryCache.setItem(e,t),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.indexedDBCache.setItem(e,t)];case 2:return a.sent(),[3,4];case 3:return n=a.sent(),this.handleDatabaseAccessError(n),[3,4];case 4:return[2]}})})},e.prototype.removeItem=function(e){return c(this,void 0,void 0,function(){var t;return d(this,function(n){switch(n.label){case 0:this.inMemoryCache.removeItem(e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.indexedDBCache.removeItem(e)];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),this.handleDatabaseAccessError(t),[3,4];case 4:return[2]}})})},e.prototype.getKeys=function(){return c(this,void 0,void 0,function(){var e,t;return d(this,function(n){switch(n.label){case 0:if(0!==(e=this.inMemoryCache.getKeys()).length)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),this.logger.verbose("In-memory cache is empty, now querying persistent storage."),[4,this.indexedDBCache.getKeys()];case 2:return[2,n.sent()];case 3:return t=n.sent(),this.handleDatabaseAccessError(t),[3,4];case 4:return[2,e]}})})},e.prototype.containsKey=function(e){return c(this,void 0,void 0,function(){var t,n;return d(this,function(a){switch(a.label){case 0:if(t=this.inMemoryCache.containsKey(e))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),[4,this.indexedDBCache.containsKey(e)];case 2:return[2,a.sent()];case 3:return n=a.sent(),this.handleDatabaseAccessError(n),[3,4];case 4:return[2,t]}})})},e.prototype.clear=function(){return c(this,void 0,void 0,function(){var e,t;return d(this,function(n){switch(n.label){case 0:this.logger.verbose("Deleting in-memory keystore "+this.storeName),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore "+this.storeName+" deleted"),this.logger.verbose("Deleting persistent keystore "+this.storeName),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.indexedDBCache.deleteDatabase()];case 2:return(e=n.sent())&&this.logger.verbose("Persistent keystore "+this.storeName+" deleted"),[2,e];case 3:return t=n.sent(),this.handleDatabaseAccessError(t),[2,!1];case 4:return[2]}})})},e}();!function(e){e.asymmetricKeys="asymmetricKeys",e.symmetricKeys="symmetricKeys"}(O||(O={}));var Y,J=function(){function e(e,t){this.logger=e,this.browserCrypto=new K(this.logger),this.b64Encode=new U,this.b64Decode=new F,this.guidGenerator=new P(this.browserCrypto),this.pkceGenerator=new V(this.browserCrypto),this.cache={asymmetricKeys:new Q(this.logger,O.asymmetricKeys),symmetricKeys:new Q(this.logger,O.symmetricKeys)},this.performanceClient=t}return e.prototype.createNewGuid=function(){return this.guidGenerator.generateGuid()},e.prototype.base64Encode=function(e){return this.b64Encode.encode(e)},e.prototype.base64Decode=function(e){return this.b64Decode.decode(e)},e.prototype.generatePkceCodes=function(){return c(this,void 0,void 0,function(){return d(this,function(e){return[2,this.pkceGenerator.generateCodes()]})})},e.prototype.getPublicKeyThumbprint=function(t){var n;return c(this,void 0,void 0,function(){var a,i,o,s,c,l,u,f;return d(this,function(d){switch(d.label){case 0:return a=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement(r.CryptoOptsGetPublicKeyThumbprint,t.correlationId),[4,this.browserCrypto.generateKeyPair(e.EXTRACTABLE,e.POP_KEY_USAGES)];case 1:return i=d.sent(),[4,this.browserCrypto.exportJwk(i.publicKey)];case 2:return o=d.sent(),s={e:o.e,kty:o.kty,n:o.n},c=K.getJwkString(s),[4,this.hashString(c)];case 3:return l=d.sent(),[4,this.browserCrypto.exportJwk(i.privateKey)];case 4:return u=d.sent(),[4,this.browserCrypto.importJwk(u,!1,["sign"])];case 5:return f=d.sent(),[4,this.cache.asymmetricKeys.setItem(l,{privateKey:f,publicKey:i.publicKey,requestMethod:t.resourceRequestMethod,requestUri:t.resourceRequestUri})];case 6:return d.sent(),a&&a.endMeasurement({success:!0}),[2,l]}})})},e.prototype.removeTokenBindingKey=function(e){return c(this,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return[4,this.cache.asymmetricKeys.removeItem(e)];case 1:return t.sent(),[4,this.cache.asymmetricKeys.containsKey(e)];case 2:return[2,!t.sent()]}})})},e.prototype.clearKeystore=function(){return c(this,void 0,void 0,function(){var e;return d(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),this.logger.verbose("Deleting in-memory and persistent asymmetric key stores"),[4,this.cache.asymmetricKeys.clear()];case 1:return t.sent(),this.logger.verbose("Successfully deleted asymmetric key stores"),this.logger.verbose("Deleting in-memory and persistent symmetric key stores"),[4,this.cache.symmetricKeys.clear()];case 2:return t.sent(),this.logger.verbose("Successfully deleted symmetric key stores"),[2,!0];case 3:return(e=t.sent())instanceof Error?this.logger.error("Clearing keystore failed with error: "+e.message):this.logger.error("Clearing keystore failed with unknown error"),[2,!1];case 4:return[2]}})})},e.prototype.signJwt=function(e,t,n){var a;return c(this,void 0,void 0,function(){var i,o,s,c,l,u,f,p,m,_,h,b,g;return d(this,function(d){switch(d.label){case 0:return i=null===(a=this.performanceClient)||void 0===a?void 0:a.startMeasurement(r.CryptoOptsSignJwt,n),[4,this.cache.asymmetricKeys.getItem(t)];case 1:if(!(o=d.sent()))throw j.createSigningKeyNotFoundInStorageError(t);return[4,this.browserCrypto.exportJwk(o.publicKey)];case 2:return s=d.sent(),c=K.getJwkString(s),l=this.b64Encode.urlEncode(JSON.stringify({kid:t})),u=k.getShrHeaderString({kid:l,alg:s.alg}),f=this.b64Encode.urlEncode(u),e.cnf={jwk:JSON.parse(c)},p=this.b64Encode.urlEncode(JSON.stringify(e)),m=f+"."+p,_=T.stringToArrayBuffer(m),[4,this.browserCrypto.sign(o.privateKey,_)];case 3:return h=d.sent(),b=this.b64Encode.urlEncodeArr(new Uint8Array(h)),g=m+"."+b,i&&i.endMeasurement({success:!0}),[2,g]}})})},e.prototype.hashString=function(e){return c(this,void 0,void 0,function(){var t,n;return d(this,function(a){switch(a.label){case 0:return[4,this.browserCrypto.sha256Digest(e)];case 1:return t=a.sent(),n=new Uint8Array(t),[2,this.b64Encode.urlEncodeArr(n)]}})})},e.POP_KEY_USAGES=["sign","verify"],e.EXTRACTABLE=!0,e}(),X=n(8064),Z=function(){function e(e,t,n,a,i,r){this.authority=t,this.libraryName=a,this.libraryVersion=i,this.applicationTelemetry=r,this.clientId=e,this.logger=n,this.callbacks=new Map,this.eventsByCorrelationId=new Map,this.measurementsById=new Map}return e.prototype.startMeasurement=function(e,t){var n,a,i=this,r=t||this.generateId();t||this.logger.info("PerformanceClient: No correlation id provided for "+e+", generating",r),this.logger.trace("PerformanceClient: Performance measurement started for "+e,r);var s=this.startPerformanceMeasuremeant(e,r);s.startMeasurement();var c={eventId:this.generateId(),status:o.InProgress,authority:this.authority,libraryName:this.libraryName,libraryVersion:this.libraryVersion,appName:null===(n=this.applicationTelemetry)||void 0===n?void 0:n.appName,appVersion:null===(a=this.applicationTelemetry)||void 0===a?void 0:a.appVersion,clientId:this.clientId,name:e,startTimeMs:Date.now(),correlationId:r};return this.cacheEventByCorrelationId(c),this.cacheMeasurement(c,s),{endMeasurement:function(e){var t=i.endMeasurement((0,E._i)((0,E._i)({},c),e));return t&&i.cacheEventByCorrelationId(t),t},flushMeasurement:function(){return i.flushMeasurements(c.name,c.correlationId)},discardMeasurement:function(){return i.discardMeasurements(c.correlationId)},measurement:s,event:c}},e.prototype.endMeasurement=function(e){var t=this.measurementsById.get(e.eventId);if(t){this.measurementsById.delete(e.eventId),t.endMeasurement();var n=t.flushMeasurement();if(null!==n)return this.logger.trace("PerformanceClient: Performance measurement ended for "+e.name+": "+n+" ms",e.correlationId),(0,E._i)((0,E._i)({durationMs:Math.round(n)},e),{status:o.Completed});this.logger.trace("PerformanceClient: Performance measurement not taken",e.correlationId)}else this.logger.trace("PerformanceClient: Measurement not found for "+e.eventId,e.correlationId);return null},e.prototype.cacheEventByCorrelationId=function(e){var t=this.eventsByCorrelationId.get(e.correlationId);t?(this.logger.trace("PerformanceClient: Performance measurement for "+e.name+" added/updated",e.correlationId),t.set(e.eventId,e)):(this.logger.trace("PerformanceClient: Performance measurement for "+e.name+" started",e.correlationId),this.eventsByCorrelationId.set(e.correlationId,(new Map).set(e.eventId,e)))},e.prototype.cacheMeasurement=function(e,t){this.measurementsById.set(e.eventId,t)},e.prototype.flushMeasurements=function(e,t){var n=this;this.logger.trace("PerformanceClient: Performance measurements flushed for "+e,t);var a=this.eventsByCorrelationId.get(t);if(a){this.discardMeasurements(t);var i=[];a.forEach(function(a){if(a.name!==e&&a.status!==o.Completed){n.logger.trace("PerformanceClient: Incomplete submeasurement "+a.name+" found for "+e,t);var r=n.endMeasurement(a);r&&i.push(r)}i.push(a)});var r=i.sort(function(e,t){return e.startTimeMs-t.startTimeMs}),s=r.filter(function(t){return t.name===e&&t.status===o.Completed});if(s.length>0){s.length>1&&this.logger.verbose("PerformanceClient: Multiple distinct top-level performance events found, using the first",t);var c=s[0];this.logger.verbose("PerformanceClient: Measurement found for "+e,t);var d=r.reduce(function(a,i){if(i.name!==e){n.logger.trace("PerformanceClient: Complete submeasurement found for "+i.name,t);var r=i.name+"DurationMs";a[r]?n.logger.verbose("PerformanceClient: Submeasurement for "+e+" already exists for "+i.name+", ignoring",t):a[r]=i.durationMs,i.accessTokenSize&&(a.accessTokenSize=i.accessTokenSize),i.idTokenSize&&(a.idTokenSize=i.idTokenSize),i.refreshTokenSize&&(a.refreshTokenSize=i.refreshTokenSize)}return a},c);this.emitEvents([d],d.correlationId)}else this.logger.verbose("PerformanceClient: No completed top-level measurements found for "+e,t)}else this.logger.verbose("PerformanceClient: No measurements found",t)},e.prototype.discardMeasurements=function(e){this.logger.trace("PerformanceClient: Performance measurements discarded",e),this.eventsByCorrelationId.delete(e)},e.prototype.addPerformanceCallback=function(e){var t=this.generateId();return this.callbacks.set(t,e),this.logger.verbose("PerformanceClient: Performance callback registered with id: "+t),t},e.prototype.removePerformanceCallback=function(e){var t=this.callbacks.delete(e);return t?this.logger.verbose("PerformanceClient: Performance callback "+e+" removed."):this.logger.verbose("PerformanceClient: Performance callback "+e+" not removed."),t},e.prototype.emitEvents=function(e,t){var n=this;this.logger.verbose("PerformanceClient: Emitting performance events",t),this.callbacks.forEach(function(a,i){n.logger.trace("PerformanceClient: Emitting event to callback "+i,t),a.apply(null,[e])})},e}(),$=function(){function e(){}return e.prototype.startMeasurement=function(){},e.prototype.endMeasurement=function(){},e.prototype.flushMeasurement=function(){return null},e}(),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,E.XT)(t,e),t.prototype.generateId=function(){return"callback-id"},t.prototype.startPerformanceMeasuremeant=function(){return new $},t}(Z),te={createNewGuid:function(){throw A.l.createUnexpectedError("Crypto interface - createNewGuid() has not been implemented")},base64Decode:function(){throw A.l.createUnexpectedError("Crypto interface - base64Decode() has not been implemented")},base64Encode:function(){throw A.l.createUnexpectedError("Crypto interface - base64Encode() has not been implemented")},generatePkceCodes:function(){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(e){throw A.l.createUnexpectedError("Crypto interface - generatePkceCodes() has not been implemented")})})},getPublicKeyThumbprint:function(){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(e){throw A.l.createUnexpectedError("Crypto interface - getPublicKeyThumbprint() has not been implemented")})})},removeTokenBindingKey:function(){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(e){throw A.l.createUnexpectedError("Crypto interface - removeTokenBindingKey() has not been implemented")})})},clearKeystore:function(){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(e){throw A.l.createUnexpectedError("Crypto interface - clearKeystore() has not been implemented")})})},signJwt:function(){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(e){throw A.l.createUnexpectedError("Crypto interface - signJwt() has not been implemented")})})},hashString:function(){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(e){throw A.l.createUnexpectedError("Crypto interface - hashString() has not been implemented")})})}},ne=n(3863),ae=function(e){function t(n,a,i){var r=e.call(this,n,a,i)||this;return r.name="ServerError",Object.setPrototypeOf(r,t.prototype),r}return(0,E.XT)(t,e),t}(A.l),ie=n(8124);function re(e,t){if(H.x.isEmpty(e))throw ie.e.createClientInfoEmptyError();try{var n=t.base64Decode(e);return JSON.parse(n)}catch(e){throw ie.e.createClientInfoDecodingError(e.message)}}function oe(e){if(H.x.isEmpty(e))throw ie.e.createClientInfoDecodingError("Home account ID was empty.");var t=e.split(y.wv.CLIENT_INFO_SEPARATOR,2);return{uid:t[0],utid:t.length<2?y.oT.EMPTY_STRING:t[1]}}!function(e){e[e.Default=0]="Default",e[e.Adfs=1]="Adfs",e[e.Dsts=2]="Dsts"}(Y||(Y={}));var se,ce=function(){function e(){}return e.prototype.generateAccountId=function(){return[this.homeAccountId,this.environment].join(y.wv.CACHE_KEY_SEPARATOR).toLowerCase()},e.prototype.generateAccountKey=function(){return e.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})},e.prototype.generateType=function(){switch(this.authorityType){case y.cR.ADFS_ACCOUNT_TYPE:return y.HL.ADFS;case y.cR.MSAV1_ACCOUNT_TYPE:return y.HL.MSA;case y.cR.MSSTS_ACCOUNT_TYPE:return y.HL.MSSTS;case y.cR.GENERIC_ACCOUNT_TYPE:return y.HL.GENERIC;default:throw ie.e.createUnexpectedAccountTypeError()}},e.prototype.getAccountInfo=function(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,idTokenClaims:this.idTokenClaims,nativeAccountId:this.nativeAccountId}},e.generateAccountCacheKey=function(e){return[e.homeAccountId,e.environment||y.oT.EMPTY_STRING,e.tenantId||y.oT.EMPTY_STRING].join(y.wv.CACHE_KEY_SEPARATOR).toLowerCase()},e.createAccount=function(t,n,a,i,r,o,s,c){var d,l,u,f,p,m,_=new e;_.authorityType=y.cR.MSSTS_ACCOUNT_TYPE,_.clientInfo=t,_.homeAccountId=n,_.nativeAccountId=c;var h=s||i&&i.getPreferredCache();if(!h)throw ie.e.createInvalidCacheEnvironmentError();if(_.environment=h,_.realm=(null===(d=null==a?void 0:a.claims)||void 0===d?void 0:d.tid)||y.oT.EMPTY_STRING,a){_.idTokenClaims=a.claims,_.localAccountId=(null===(l=null==a?void 0:a.claims)||void 0===l?void 0:l.oid)||(null===(u=null==a?void 0:a.claims)||void 0===u?void 0:u.sub)||y.oT.EMPTY_STRING;var b=null===(f=null==a?void 0:a.claims)||void 0===f?void 0:f.preferred_username,g=(null===(p=null==a?void 0:a.claims)||void 0===p?void 0:p.emails)?a.claims.emails[0]:null;_.username=b||g||y.oT.EMPTY_STRING,_.name=null===(m=null==a?void 0:a.claims)||void 0===m?void 0:m.name}return _.cloudGraphHostName=r,_.msGraphHost=o,_},e.createGenericAccount=function(t,n,a,i,r,o){var s,c,d,l,u=new e;u.authorityType=a&&a.authorityType===Y.Adfs?y.cR.ADFS_ACCOUNT_TYPE:y.cR.GENERIC_ACCOUNT_TYPE,u.homeAccountId=t,u.realm=y.oT.EMPTY_STRING;var f=o||a&&a.getPreferredCache();if(!f)throw ie.e.createInvalidCacheEnvironmentError();return n&&(u.localAccountId=(null===(s=null==n?void 0:n.claims)||void 0===s?void 0:s.oid)||(null===(c=null==n?void 0:n.claims)||void 0===c?void 0:c.sub)||y.oT.EMPTY_STRING,u.username=(null===(d=null==n?void 0:n.claims)||void 0===d?void 0:d.upn)||y.oT.EMPTY_STRING,u.name=(null===(l=null==n?void 0:n.claims)||void 0===l?void 0:l.name)||y.oT.EMPTY_STRING,u.idTokenClaims=null==n?void 0:n.claims),u.environment=f,u.cloudGraphHostName=i,u.msGraphHost=r,u},e.generateHomeAccountId=function(e,t,n,a,i){var r,o=(null===(r=null==i?void 0:i.claims)||void 0===r?void 0:r.sub)?i.claims.sub:y.oT.EMPTY_STRING;if(t===Y.Adfs||t===Y.Dsts)return o;if(e)try{var s=re(e,a);if(!H.x.isEmpty(s.uid)&&!H.x.isEmpty(s.utid))return""+s.uid+y.wv.CLIENT_INFO_SEPARATOR+s.utid}catch(e){}return n.verbose("No client info in response"),o},e.isAccountEntity=function(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")},e.accountInfoIsEqual=function(e,t,n){if(!e||!t)return!1;var a=!0;if(n){var i=e.idTokenClaims||{},r=t.idTokenClaims||{};a=i.iat===r.iat&&i.nonce===r.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&a},e}(),de=function(){function e(){}return e.prototype.generateAccountId=function(){return e.generateAccountIdForCacheKey(this.homeAccountId,this.environment)},e.prototype.generateCredentialId=function(){return e.generateCredentialIdForCacheKey(this.credentialType,this.clientId,this.realm,this.familyId)},e.prototype.generateTarget=function(){return e.generateTargetForCacheKey(this.target)},e.prototype.generateCredentialKey=function(){return e.generateCredentialCacheKey(this.homeAccountId,this.environment,this.credentialType,this.clientId,this.realm,this.target,this.familyId,this.tokenType,this.requestedClaimsHash)},e.prototype.generateType=function(){switch(this.credentialType){case y.a3.ID_TOKEN:return y.HL.ID_TOKEN;case y.a3.ACCESS_TOKEN:case y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME:return y.HL.ACCESS_TOKEN;case y.a3.REFRESH_TOKEN:return y.HL.REFRESH_TOKEN;default:throw ie.e.createUnexpectedCredentialTypeError()}},e.getCredentialType=function(e){return-1!==e.indexOf(y.a3.ACCESS_TOKEN.toLowerCase())?-1!==e.indexOf(y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())?y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME:y.a3.ACCESS_TOKEN:-1!==e.indexOf(y.a3.ID_TOKEN.toLowerCase())?y.a3.ID_TOKEN:-1!==e.indexOf(y.a3.REFRESH_TOKEN.toLowerCase())?y.a3.REFRESH_TOKEN:y.oT.NOT_DEFINED},e.generateCredentialCacheKey=function(e,t,n,a,i,r,o,s,c){return[this.generateAccountIdForCacheKey(e,t),this.generateCredentialIdForCacheKey(n,a,i,o),this.generateTargetForCacheKey(r),this.generateClaimsHashForCacheKey(c),this.generateSchemeForCacheKey(s)].join(y.wv.CACHE_KEY_SEPARATOR).toLowerCase()},e.generateAccountIdForCacheKey=function(e,t){return[e,t].join(y.wv.CACHE_KEY_SEPARATOR).toLowerCase()},e.generateCredentialIdForCacheKey=function(e,t,n,a){return[e,e===y.a3.REFRESH_TOKEN&&a||t,n||y.oT.EMPTY_STRING].join(y.wv.CACHE_KEY_SEPARATOR).toLowerCase()},e.generateTargetForCacheKey=function(e){return(e||y.oT.EMPTY_STRING).toLowerCase()},e.generateClaimsHashForCacheKey=function(e){return(e||y.oT.EMPTY_STRING).toLowerCase()},e.generateSchemeForCacheKey=function(e){return e&&e.toLowerCase()!==y.sO.BEARER.toLowerCase()?e.toLowerCase():y.oT.EMPTY_STRING},e}(),le=function(e){function t(n,a){var i=e.call(this,n,a)||this;return i.name="ClientConfigurationError",Object.setPrototypeOf(i,t.prototype),i}return(0,E.XT)(t,e),t.createRedirectUriEmptyError=function(){return new t("redirect_uri_empty","A redirect URI is required for all calls, and none has been set.")},t.createPostLogoutRedirectUriEmptyError=function(){return new t("post_logout_uri_empty","A post logout redirect has not been set.")},t.createClaimsRequestParsingError=function(e){return new t("claims_request_parsing_error","Could not parse the given claims request object. Given value: "+e)},t.createInsecureAuthorityUriError=function(e){return new t("authority_uri_insecure","Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options Given URI: "+e)},t.createUrlParseError=function(e){return new t("url_parse_error","URL could not be parsed into appropriate segments. Given Error: "+e)},t.createUrlEmptyError=function(){return new t("empty_url_error","URL was empty or null.")},t.createEmptyScopesArrayError=function(){return new t("empty_input_scopes_error","Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.")},t.createClientIdSingleScopeError=function(e){return new t("clientid_input_scopes_error","Client ID can only be provided as a single scope. Given Scopes: "+e)},t.createInvalidPromptError=function(e){return new t("invalid_prompt_value","Supported prompt values are 'login', 'select_account', 'consent', 'create', 'none' and 'no_session'.  Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest Given value: "+e)},t.createInvalidClaimsRequestError=function(){return new t("invalid_claims","Given claims parameter must be a stringified JSON object.")},t.createEmptyLogoutRequestError=function(){return new t("logout_request_empty","The logout request was null or undefined.")},t.createEmptyTokenRequestError=function(){return new t("token_request_empty","Token request was empty and not found in cache.")},t.createInvalidCodeChallengeMethodError=function(){return new t("invalid_code_challenge_method",'code_challenge_method passed is invalid. Valid values are "plain" and "S256".')},t.createInvalidCodeChallengeParamsError=function(){return new t("pkce_params_missing","Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request")},t.createInvalidCloudDiscoveryMetadataError=function(){return new t("invalid_cloud_discovery_metadata","Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields")},t.createInvalidAuthorityMetadataError=function(){return new t("invalid_authority_metadata","Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.")},t.createUntrustedAuthorityError=function(){return new t("untrusted_authority","The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.")},t.createInvalidAzureCloudInstanceError=function(){return new t("invalid_azure_cloud_instance","Invalid AzureCloudInstance provided. Please refer MSAL JS docs: aks.ms/msaljs/azure_cloud_instance for valid values")},t.createMissingSshJwkError=function(){return new t("missing_ssh_jwk","Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.")},t.createMissingSshKidError=function(){return new t("missing_ssh_kid","Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.")},t.createMissingNonceAuthenticationHeadersError=function(){return new t("missing_nonce_authentication_header","Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.")},t.createInvalidAuthenticationHeaderError=function(e,n){return new t("invalid_authentication_header","Invalid authentication header provided. Invalid header: "+e+". Details: "+n)},t}(ie.e),ue=function(){function e(e){var t=this,n=e?H.x.trimArrayEntries((0,E._r)(e)):[],a=n?H.x.removeEmptyStringsFromArray(n):[];this.validateInputScopes(a),this.scopes=new Set,a.forEach(function(e){return t.scopes.add(e)})}return e.fromString=function(t){return new e((t||y.oT.EMPTY_STRING).split(" "))},e.prototype.validateInputScopes=function(e){if(!e||e.length<1)throw le.createEmptyScopesArrayError()},e.prototype.containsScope=function(t){var n=new e(this.printScopesLowerCase().split(" "));return!H.x.isEmpty(t)&&n.scopes.has(t.toLowerCase())},e.prototype.containsScopeSet=function(e){var t=this;return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(function(e){return t.containsScope(e)})},e.prototype.containsOnlyOIDCScopes=function(){var e=this,t=0;return y.$f.forEach(function(n){e.containsScope(n)&&(t+=1)}),this.scopes.size===t},e.prototype.appendScope=function(e){H.x.isEmpty(e)||this.scopes.add(e.trim())},e.prototype.appendScopes=function(e){var t=this;try{e.forEach(function(e){return t.appendScope(e)})}catch(e){throw ie.e.createAppendScopeSetError(e)}},e.prototype.removeScope=function(e){if(H.x.isEmpty(e))throw ie.e.createRemoveEmptyScopeFromSetError(e);this.scopes.delete(e.trim())},e.prototype.removeOIDCScopes=function(){var e=this;y.$f.forEach(function(t){e.scopes.delete(t)})},e.prototype.unionScopeSets=function(e){if(!e)throw ie.e.createEmptyInputScopeSetError();var t=new Set;return e.scopes.forEach(function(e){return t.add(e.toLowerCase())}),this.scopes.forEach(function(e){return t.add(e.toLowerCase())}),t},e.prototype.intersectingScopeSets=function(e){if(!e)throw ie.e.createEmptyInputScopeSetError();e.containsOnlyOIDCScopes()||e.removeOIDCScopes();var t=this.unionScopeSets(e),n=e.getScopeCount(),a=this.getScopeCount();return t.size<a+n},e.prototype.getScopeCount=function(){return this.scopes.size},e.prototype.asArray=function(){var e=[];return this.scopes.forEach(function(t){return e.push(t)}),e},e.prototype.printScopes=function(){return this.scopes?this.asArray().join(" "):y.oT.EMPTY_STRING},e.prototype.printScopesLowerCase=function(){return this.printScopes().toLowerCase()},e}(),fe=function(){function e(t,n){if(H.x.isEmpty(t))throw ie.e.createTokenNullOrEmptyError(t);this.rawToken=t,this.claims=e.extractTokenClaims(t,n)}return e.extractTokenClaims=function(e,t){var n=H.x.decodeAuthToken(e);try{var a=n.JWSPayload,i=t.base64Decode(a);return JSON.parse(i)}catch(e){throw ie.e.createTokenParsingError(e)}},e.checkMaxAge=function(e,t){if(0===t||Date.now()-3e5>e+t)throw ie.e.createMaxAgeTranspiredError()},e}(),pe=function(){function e(e,t){this.clientId=e,this.cryptoImpl=t}return e.prototype.getAllAccounts=function(){var t=this,n=this.getAccountsFilteredBy(),a=Object.keys(n).map(function(e){return n[e]});return a.length<1?[]:a.map(function(n){var a=e.toObject(new ce,n).getAccountInfo(),i=t.readIdTokenFromCache(t.clientId,a);return i&&!a.idTokenClaims&&(a.idToken=i.secret,a.idTokenClaims=new fe(i.secret,t.cryptoImpl).claims),a})},e.prototype.saveCacheRecord=function(e){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(t){switch(t.label){case 0:if(!e)throw ie.e.createNullOrUndefinedCacheRecord();return e.account&&this.setAccount(e.account),e.idToken&&this.setIdTokenCredential(e.idToken),e.accessToken?[4,this.saveAccessToken(e.accessToken)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e.refreshToken&&this.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&this.setAppMetadata(e.appMetadata),[2]}})})},e.prototype.saveAccessToken=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t,n,a,i,r=this;return(0,E.Uh)(this,function(o){switch(o.label){case 0:return t=this.getCredentialsFilteredBy({clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash}),n=ue.fromString(e.target),(a=Object.keys(t.accessTokens).map(function(e){return t.accessTokens[e]}))?(i=[],a.forEach(function(e){ue.fromString(e.target).intersectingScopeSets(n)&&i.push(r.removeCredential(e))}),[4,Promise.all(i)]):[3,2];case 1:o.sent(),o.label=2;case 2:return this.setAccessTokenCredential(e),[2]}})})},e.prototype.getAccountsFilteredBy=function(e){return this.getAccountsFilteredByInternal(e?e.homeAccountId:y.oT.EMPTY_STRING,e?e.environment:y.oT.EMPTY_STRING,e?e.realm:y.oT.EMPTY_STRING,e?e.nativeAccountId:y.oT.EMPTY_STRING)},e.prototype.getAccountsFilteredByInternal=function(e,t,n,a){var i=this,r=this.getKeys(),o={};return r.forEach(function(r){var s=i.getAccount(r);s&&(e&&!i.matchHomeAccountId(s,e)||t&&!i.matchEnvironment(s,t)||n&&!i.matchRealm(s,n)||a&&!i.matchNativeAccountId(s,a)||(o[r]=s))}),o},e.prototype.getCredentialsFilteredBy=function(e){return this.getCredentialsFilteredByInternal(e.homeAccountId,e.environment,e.credentialType,e.clientId,e.familyId,e.realm,e.target,e.userAssertionHash,e.tokenType,e.keyId,e.requestedClaimsHash)},e.prototype.getCredentialsFilteredByInternal=function(e,t,n,a,i,r,o,s,c,d,l){var u=this,f=this.getKeys(),p={idTokens:{},accessTokens:{},refreshTokens:{}};return f.forEach(function(f){var m=de.getCredentialType(f);if(m!==y.oT.NOT_DEFINED){var _=u.getSpecificCredential(f,m);if(_&&(!s||u.matchUserAssertionHash(_,s))&&("string"!=typeof e||u.matchHomeAccountId(_,e))&&(!t||u.matchEnvironment(_,t))&&(!r||u.matchRealm(_,r))&&(!n||u.matchCredentialType(_,n))&&(!a||u.matchClientId(_,a))&&(!i||u.matchFamilyId(_,i))&&(!o||u.matchTarget(_,o))&&(!l&&!_.requestedClaimsHash||_.requestedClaimsHash===l)){if(n===y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(c&&!u.matchTokenType(_,c))return;if(c===y.sO.SSH&&d&&!u.matchKeyId(_,d))return}var h=u.updateCredentialCacheKey(f,_);switch(m){case y.a3.ID_TOKEN:p.idTokens[h]=_;break;case y.a3.ACCESS_TOKEN:case y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME:p.accessTokens[h]=_;break;case y.a3.REFRESH_TOKEN:p.refreshTokens[h]=_}}}}),p},e.prototype.getAppMetadataFilteredBy=function(e){return this.getAppMetadataFilteredByInternal(e.environment,e.clientId)},e.prototype.getAppMetadataFilteredByInternal=function(e,t){var n=this,a=this.getKeys(),i={};return a.forEach(function(a){if(n.isAppMetadata(a)){var r=n.getAppMetadata(a);r&&(e&&!n.matchEnvironment(r,e)||t&&!n.matchClientId(r,t)||(i[a]=r))}}),i},e.prototype.getAuthorityMetadataByAlias=function(e){var t=this,n=this.getAuthorityMetadataKeys(),a=null;return n.forEach(function(n){if(t.isAuthorityMetadata(n)&&-1!==n.indexOf(t.clientId)){var i=t.getAuthorityMetadata(n);i&&-1!==i.aliases.indexOf(e)&&(a=i)}}),a},e.prototype.removeAllAccounts=function(){return(0,E.fG)(this,void 0,void 0,function(){var e,t,n=this;return(0,E.Uh)(this,function(a){switch(a.label){case 0:return e=this.getKeys(),t=[],e.forEach(function(e){n.getAccount(e)&&t.push(n.removeAccount(e))}),[4,Promise.all(t)];case 1:return a.sent(),[2,!0]}})})},e.prototype.removeAccount=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t;return(0,E.Uh)(this,function(n){switch(n.label){case 0:if(!(t=this.getAccount(e)))throw ie.e.createNoAccountFoundError();return[4,this.removeAccountContext(t)];case 1:return[2,n.sent()&&this.removeItem(e,y.Yj.ACCOUNT)]}})})},e.prototype.removeAccountContext=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t,n,a,i=this;return(0,E.Uh)(this,function(r){switch(r.label){case 0:return t=this.getKeys(),n=e.generateAccountId(),a=[],t.forEach(function(e){var t=de.getCredentialType(e);if(t!==y.oT.NOT_DEFINED){var r=i.getSpecificCredential(e,t);r&&n===r.generateAccountId()&&a.push(i.removeCredential(r))}}),[4,Promise.all(a)];case 1:return r.sent(),[2,!0]}})})},e.prototype.removeCredential=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t,n;return(0,E.Uh)(this,function(a){switch(a.label){case 0:if(t=e.generateCredentialKey(),e.credentialType.toLowerCase()!==y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())return[3,4];if(e.tokenType!==y.sO.POP)return[3,4];if(!(n=e.keyId))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.cryptoImpl.removeTokenBindingKey(n)];case 2:return a.sent(),[3,4];case 3:throw a.sent(),ie.e.createBindingKeyNotRemovedError();case 4:return[2,this.removeItem(t,y.Yj.CREDENTIAL)]}})})},e.prototype.removeAppMetadata=function(){var e=this;return this.getKeys().forEach(function(t){e.isAppMetadata(t)&&e.removeItem(t,y.Yj.APP_METADATA)}),!0},e.prototype.readCacheRecord=function(e,t,n,a){var i=this.readAccountFromCache(e),r=this.readIdTokenFromCache(t,e),o=this.readAccessTokenFromCache(t,e,n),s=this.readRefreshTokenFromCache(t,e,!1),c=this.readAppMetadataFromCache(a,t);return i&&r&&(i.idTokenClaims=new fe(r.secret,this.cryptoImpl).claims),{account:i,idToken:r,accessToken:o,refreshToken:s,appMetadata:c}},e.prototype.readAccountFromCache=function(e){var t=ce.generateAccountCacheKey(e);return this.getAccount(t)},e.prototype.readAccountFromCacheWithNativeAccountId=function(e){var t={nativeAccountId:e},n=this.getAccountsFilteredBy(t),a=Object.keys(n).map(function(e){return n[e]});if(a.length<1)return null;if(a.length>1)throw ie.e.createMultipleMatchingAccountsInCacheError();return n[0]},e.prototype.readIdTokenFromCache=function(e,t){var n={homeAccountId:t.homeAccountId,environment:t.environment,credentialType:y.a3.ID_TOKEN,clientId:e,realm:t.tenantId},a=this.getCredentialsFilteredBy(n),i=Object.keys(a.idTokens).map(function(e){return a.idTokens[e]}),r=i.length;if(r<1)return null;if(r>1)throw ie.e.createMultipleMatchingTokensInCacheError();return i[0]},e.prototype.readAccessTokenFromCache=function(e,t,n){var a=new ue(n.scopes||[]),i=n.authenticationScheme||y.sO.BEARER,r=i&&i.toLowerCase()!==y.sO.BEARER.toLowerCase()?y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME:y.a3.ACCESS_TOKEN,o={homeAccountId:t.homeAccountId,environment:t.environment,credentialType:r,clientId:e,realm:t.tenantId,target:a.printScopesLowerCase(),tokenType:i,keyId:n.sshKid,requestedClaimsHash:n.requestedClaimsHash},s=this.getCredentialsFilteredBy(o),c=Object.keys(s.accessTokens).map(function(e){return s.accessTokens[e]}),d=c.length;if(d<1)return null;if(d>1)throw ie.e.createMultipleMatchingTokensInCacheError();return c[0]},e.prototype.readRefreshTokenFromCache=function(e,t,n){var a=n?y.nh:void 0,i={homeAccountId:t.homeAccountId,environment:t.environment,credentialType:y.a3.REFRESH_TOKEN,clientId:e,familyId:a},r=this.getCredentialsFilteredBy(i),o=Object.keys(r.refreshTokens).map(function(e){return r.refreshTokens[e]});return o.length<1?null:o[0]},e.prototype.readAppMetadataFromCache=function(e,t){var n={environment:e,clientId:t},a=this.getAppMetadataFilteredBy(n),i=Object.keys(a).map(function(e){return a[e]}),r=i.length;if(r<1)return null;if(r>1)throw ie.e.createMultipleMatchingAppMetadataInCacheError();return i[0]},e.prototype.isAppMetadataFOCI=function(e,t){var n=this.readAppMetadataFromCache(e,t);return!(!n||n.familyId!==y.nh)},e.prototype.matchHomeAccountId=function(e,t){return!("string"!=typeof e.homeAccountId||t!==e.homeAccountId)},e.prototype.matchUserAssertionHash=function(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)},e.prototype.matchEnvironment=function(e,t){var n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)},e.prototype.matchCredentialType=function(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()},e.prototype.matchClientId=function(e,t){return!(!e.clientId||t!==e.clientId)},e.prototype.matchFamilyId=function(e,t){return!(!e.familyId||t!==e.familyId)},e.prototype.matchRealm=function(e,t){return!(!e.realm||t!==e.realm)},e.prototype.matchNativeAccountId=function(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)},e.prototype.matchTarget=function(e,t){if(e.credentialType!==y.a3.ACCESS_TOKEN&&e.credentialType!==y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)return!1;var n=ue.fromString(e.target),a=ue.fromString(t);return a.containsOnlyOIDCScopes()?a.removeScope(y.oT.OFFLINE_ACCESS_SCOPE):a.removeOIDCScopes(),n.containsScopeSet(a)},e.prototype.matchTokenType=function(e,t){return!(!e.tokenType||e.tokenType!==t)},e.prototype.matchKeyId=function(e,t){return!(!e.keyId||e.keyId!==t)},e.prototype.isAppMetadata=function(e){return-1!==e.indexOf(y.ag)},e.prototype.isAuthorityMetadata=function(e){return-1!==e.indexOf(y.VU.CACHE_KEY)},e.prototype.generateAuthorityMetadataCacheKey=function(e){return y.VU.CACHE_KEY+"-"+this.clientId+"-"+e},e.prototype.getSpecificCredential=function(e,t){switch(t){case y.a3.ID_TOKEN:return this.getIdTokenCredential(e);case y.a3.ACCESS_TOKEN:case y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME:return this.getAccessTokenCredential(e);case y.a3.REFRESH_TOKEN:return this.getRefreshTokenCredential(e);default:return null}},e.toObject=function(e,t){for(var n in t)e[n]=t[n];return e},e}(),me=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,E.XT)(t,e),t.prototype.setAccount=function(){throw A.l.createUnexpectedError("Storage interface - setAccount() has not been implemented for the cacheStorage interface.")},t.prototype.getAccount=function(){throw A.l.createUnexpectedError("Storage interface - getAccount() has not been implemented for the cacheStorage interface.")},t.prototype.setIdTokenCredential=function(){throw A.l.createUnexpectedError("Storage interface - setIdTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.getIdTokenCredential=function(){throw A.l.createUnexpectedError("Storage interface - getIdTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.setAccessTokenCredential=function(){throw A.l.createUnexpectedError("Storage interface - setAccessTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.getAccessTokenCredential=function(){throw A.l.createUnexpectedError("Storage interface - getAccessTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.setRefreshTokenCredential=function(){throw A.l.createUnexpectedError("Storage interface - setRefreshTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.getRefreshTokenCredential=function(){throw A.l.createUnexpectedError("Storage interface - getRefreshTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.setAppMetadata=function(){throw A.l.createUnexpectedError("Storage interface - setAppMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.getAppMetadata=function(){throw A.l.createUnexpectedError("Storage interface - getAppMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.setServerTelemetry=function(){throw A.l.createUnexpectedError("Storage interface - setServerTelemetry() has not been implemented for the cacheStorage interface.")},t.prototype.getServerTelemetry=function(){throw A.l.createUnexpectedError("Storage interface - getServerTelemetry() has not been implemented for the cacheStorage interface.")},t.prototype.setAuthorityMetadata=function(){throw A.l.createUnexpectedError("Storage interface - setAuthorityMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.getAuthorityMetadata=function(){throw A.l.createUnexpectedError("Storage interface - getAuthorityMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.getAuthorityMetadataKeys=function(){throw A.l.createUnexpectedError("Storage interface - getAuthorityMetadataKeys() has not been implemented for the cacheStorage interface.")},t.prototype.setThrottlingCache=function(){throw A.l.createUnexpectedError("Storage interface - setThrottlingCache() has not been implemented for the cacheStorage interface.")},t.prototype.getThrottlingCache=function(){throw A.l.createUnexpectedError("Storage interface - getThrottlingCache() has not been implemented for the cacheStorage interface.")},t.prototype.removeItem=function(){throw A.l.createUnexpectedError("Storage interface - removeItem() has not been implemented for the cacheStorage interface.")},t.prototype.containsKey=function(){throw A.l.createUnexpectedError("Storage interface - containsKey() has not been implemented for the cacheStorage interface.")},t.prototype.getKeys=function(){throw A.l.createUnexpectedError("Storage interface - getKeys() has not been implemented for the cacheStorage interface.")},t.prototype.clear=function(){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(e){throw A.l.createUnexpectedError("Storage interface - clear() has not been implemented for the cacheStorage interface.")})})},t.prototype.updateCredentialCacheKey=function(){throw A.l.createUnexpectedError("Storage interface - updateCredentialCacheKey() has not been implemented for the cacheStorage interface.")},t}(pe),_e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,E.XT)(t,e),t.createIdTokenEntity=function(e,n,a,i,r){var o=new t;return o.credentialType=y.a3.ID_TOKEN,o.homeAccountId=e,o.environment=n,o.clientId=i,o.secret=a,o.realm=r,o},t.isIdTokenEntity=function(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.credentialType===y.a3.ID_TOKEN},t}(de),he=function(){function e(){}return e.nowSeconds=function(){return Math.round((new Date).getTime()/1e3)},e.isTokenExpired=function(t,n){var a=Number(t)||0;return e.nowSeconds()+n>a},e.wasClockTurnedBack=function(t){return Number(t)>e.nowSeconds()},e.delay=function(e,t){return new Promise(function(n){return setTimeout(function(){return n(t)},e)})},e}(),be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,E.XT)(t,e),t.createAccessTokenEntity=function(e,n,a,i,r,o,s,c,d,l,u,f,p,m,_){var h,b,g=new t;g.homeAccountId=e,g.credentialType=y.a3.ACCESS_TOKEN,g.secret=a;var v=he.nowSeconds();if(g.cachedAt=v.toString(),g.expiresOn=s.toString(),g.extendedExpiresOn=c.toString(),l&&(g.refreshOn=l.toString()),g.environment=n,g.clientId=i,g.realm=r,g.target=o,g.userAssertionHash=f,g.tokenType=H.x.isEmpty(u)?y.sO.BEARER:u,m&&(g.requestedClaims=m,g.requestedClaimsHash=_),(null===(h=g.tokenType)||void 0===h?void 0:h.toLowerCase())!==y.sO.BEARER.toLowerCase())switch(g.credentialType=y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME,g.tokenType){case y.sO.POP:var S=fe.extractTokenClaims(a,d);if(!(null===(b=null==S?void 0:S.cnf)||void 0===b?void 0:b.kid))throw ie.e.createTokenClaimsRequiredError();g.keyId=S.cnf.kid;break;case y.sO.SSH:g.keyId=p}return g},t.isAccessTokenEntity=function(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.hasOwnProperty("target")&&(e.credentialType===y.a3.ACCESS_TOKEN||e.credentialType===y.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME)},t}(de),ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,E.XT)(t,e),t.createRefreshTokenEntity=function(e,n,a,i,r,o){var s=new t;return s.clientId=i,s.credentialType=y.a3.REFRESH_TOKEN,s.environment=n,s.homeAccountId=e,s.secret=a,s.userAssertionHash=o,r&&(s.familyId=r),s},t.isRefreshTokenEntity=function(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.credentialType===y.a3.REFRESH_TOKEN},t}(de),ve=function(){function e(){}return e.prototype.generateAppMetadataKey=function(){return e.generateAppMetadataCacheKey(this.environment,this.clientId)},e.generateAppMetadataCacheKey=function(e,t){return[y.ag,e,t].join(y.wv.CACHE_KEY_SEPARATOR).toLowerCase()},e.createAppMetadataEntity=function(t,n,a){var i=new e;return i.clientId=t,i.environment=n,a&&(i.familyId=a),i},e.isAppMetadataEntity=function(e,t){return!!t&&0===e.indexOf(y.ag)&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("environment")},e}(),ye=function(){function e(){this.failedRequests=[],this.errors=[],this.cacheHits=0}return e.isServerTelemetryEntity=function(e,t){var n=0===e.indexOf(y.PN.CACHE_KEY),a=!0;return t&&(a=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),n&&a},e}(),Se=function(){function e(){this.expiresAt=he.nowSeconds()+y.VU.REFRESH_TIME_SECONDS}return e.prototype.updateCloudDiscoveryMetadata=function(e,t){this.aliases=e.aliases,this.preferred_cache=e.preferred_cache,this.preferred_network=e.preferred_network,this.aliasesFromNetwork=t},e.prototype.updateEndpointMetadata=function(e,t){this.authorization_endpoint=e.authorization_endpoint,this.token_endpoint=e.token_endpoint,this.end_session_endpoint=e.end_session_endpoint,this.issuer=e.issuer,this.endpointsFromNetwork=t,this.jwks_uri=e.jwks_uri},e.prototype.updateCanonicalAuthority=function(e){this.canonical_authority=e},e.prototype.resetExpiresAt=function(){this.expiresAt=he.nowSeconds()+y.VU.REFRESH_TIME_SECONDS},e.prototype.isExpired=function(){return this.expiresAt<=he.nowSeconds()},e.isAuthorityMetadataEntity=function(e,t){return!!t&&0===e.indexOf(y.VU.CACHE_KEY)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")},e}(),De=function(){function e(){}return e.isThrottlingEntity=function(e,t){var n=!1;e&&(n=0===e.indexOf(y.tb.THROTTLING_PREFIX));var a=!0;return t&&(a=t.hasOwnProperty("throttleTime")),n&&a},e}(),Ie=function(){function e(){}return e.setRequestState=function(t,n,a){var i=e.generateLibraryState(t,a);return H.x.isEmpty(n)?i:""+i+y.oT.RESOURCE_DELIM+n},e.generateLibraryState=function(e,t){if(!e)throw ie.e.createNoCryptoObjectError("generateLibraryState");var n={id:e.createNewGuid()};t&&(n.meta=t);var a=JSON.stringify(n);return e.base64Encode(a)},e.parseRequestState=function(e,t){if(!e)throw ie.e.createNoCryptoObjectError("parseRequestState");if(H.x.isEmpty(t))throw ie.e.createInvalidStateError(t,"Null, undefined or empty state");try{var n=t.split(y.oT.RESOURCE_DELIM),a=n[0],i=n.length>1?n.slice(1).join(y.oT.RESOURCE_DELIM):y.oT.EMPTY_STRING,r=e.base64Decode(a),o=JSON.parse(r);return{userRequestState:H.x.isEmpty(i)?y.oT.EMPTY_STRING:i,libraryState:o}}catch(e){throw ie.e.createInvalidStateError(t,e)}},e}();!function(e){e.HOME_ACCOUNT_ID="home_account_id",e.UPN="UPN"}(se||(se={}));var xe,Ce,Oe=function(e){function t(n,a){var i=e.call(this,n,a)||this;return i.name="BrowserConfigurationAuthError",Object.setPrototypeOf(i,t.prototype),i}return i(t,e),t.createRedirectUriEmptyError=function(){return new t("redirect_uri_empty","A redirect URI is required for all calls, and none has been set.")},t.createPostLogoutRedirectUriEmptyError=function(){return new t("post_logout_uri_empty","A post logout redirect has not been set.")},t.createStorageNotSupportedError=function(e){return new t("storage_not_supported","Given storage configuration option was not supported. Given Location: "+e)},t.createRedirectCallbacksNotSetError=function(){return new t("no_redirect_callbacks","No redirect callbacks have been set. Please call setRedirectCallbacks() with the appropriate function arguments before continuing. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics.")},t.createStubPcaInstanceCalledError=function(){return new t("stubbed_public_client_application_called","Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors")},t.createInMemoryRedirectUnavailableError=function(){return new t("in_mem_redirect_unavailable","Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true.")},t}(A.l),we=function(){function e(e){this.validateWindowStorage(e),this.windowStorage=window[e]}return e.prototype.validateWindowStorage=function(e){if(e!==p.LocalStorage&&e!==p.SessionStorage)throw Oe.createStorageNotSupportedError(e);if(!window[e])throw Oe.createStorageNotSupportedError(e)},e.prototype.getItem=function(e){return this.windowStorage.getItem(e)},e.prototype.setItem=function(e,t){this.windowStorage.setItem(e,t)},e.prototype.removeItem=function(e){this.windowStorage.removeItem(e)},e.prototype.getKeys=function(){return Object.keys(this.windowStorage)},e.prototype.containsKey=function(e){return this.windowStorage.hasOwnProperty(e)},e}(),Ee=function(){function e(t){if(this._urlString=t,H.x.isEmpty(this._urlString))throw le.createUrlEmptyError();H.x.isEmpty(this.getHash())&&(this._urlString=e.canonicalizeUri(t))}return Object.defineProperty(e.prototype,"urlString",{get:function(){return this._urlString},enumerable:!1,configurable:!0}),e.canonicalizeUri=function(e){if(e){var t=e.toLowerCase();return H.x.endsWith(t,"?")?t=t.slice(0,-1):H.x.endsWith(t,"?/")&&(t=t.slice(0,-2)),H.x.endsWith(t,"/")||(t+="/"),t}return e},e.prototype.validateAsUri=function(){var e;try{e=this.getUrlComponents()}catch(e){throw le.createUrlParseError(e)}if(!e.HostNameAndPort||!e.PathSegments)throw le.createUrlParseError("Given url string: "+this.urlString);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw le.createInsecureAuthorityUriError(this.urlString)},e.appendQueryString=function(e,t){return H.x.isEmpty(t)?e:e.indexOf("?")<0?e+"?"+t:e+"&"+t},e.removeHashFromUrl=function(t){return e.canonicalizeUri(t.split("#")[0])},e.prototype.replaceTenantPath=function(t){var n=this.getUrlComponents(),a=n.PathSegments;return!t||0===a.length||a[0]!==y.Nb.COMMON&&a[0]!==y.Nb.ORGANIZATIONS||(a[0]=t),e.constructAuthorityUriFromObject(n)},e.prototype.getHash=function(){return e.parseHash(this.urlString)},e.prototype.getUrlComponents=function(){var e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw le.createUrlParseError("Given url string: "+this.urlString);var n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},a=n.AbsolutePath.split("/");return a=a.filter(function(e){return e&&e.length>0}),n.PathSegments=a,!H.x.isEmpty(n.QueryString)&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n},e.getDomainFromUrl=function(e){var t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw le.createUrlParseError("Given url string: "+e);return n[2]},e.getAbsoluteUrl=function(t,n){if(t[0]===y.oT.FORWARD_SLASH){var a=new e(n).getUrlComponents();return a.Protocol+"//"+a.HostNameAndPort+t}return t},e.parseHash=function(e){var t=e.indexOf("#"),n=e.indexOf("#/");return n>-1?e.substring(n+2):t>-1?e.substring(t+1):y.oT.EMPTY_STRING},e.parseQueryString=function(e){var t=e.indexOf("?"),n=e.indexOf("/?");return n>-1?e.substring(n+2):t>-1?e.substring(t+1):y.oT.EMPTY_STRING},e.constructAuthorityUriFromObject=function(t){return new e(t.Protocol+"//"+t.HostNameAndPort+"/"+t.PathSegments.join("/"))},e.getDeserializedHash=function(t){if(H.x.isEmpty(t))return{};var n=e.parseHash(t),a=H.x.queryStringToObject(H.x.isEmpty(n)?t:n);if(!a)throw ie.e.createHashNotDeserializedError(JSON.stringify(a));return a},e.getDeserializedQueryString=function(t){if(H.x.isEmpty(t))return{};var n=e.parseQueryString(t),a=H.x.queryStringToObject(H.x.isEmpty(n)?t:n);if(!a)throw ie.e.createHashNotDeserializedError(JSON.stringify(a));return a},e.hashContainsKnownProperties=function(t){if(H.x.isEmpty(t)||t.indexOf("=")<0)return!1;var n=e.getDeserializedHash(t);return!!(n.code||n.error_description||n.error||n.state)},e}(),Ae=function(){function e(){}return e.extractBrowserRequestState=function(e,t){if(H.x.isEmpty(t))return null;try{return Ie.parseRequestState(e,t).libraryState.meta}catch(e){throw ie.e.createInvalidStateError(t,e)}},e.parseServerResponseFromHash=function(e){if(!e)return{};var t=new Ee(e);return Ee.getDeserializedHash(t.getHash())},e}(),Le=function(e){function t(t,n,a,i){var r=e.call(this,t,a)||this;return r.COOKIE_LIFE_MULTIPLIER=864e5,r.cacheConfig=n,r.logger=i,r.internalStorage=new q,r.browserStorage=r.setupBrowserStorage(r.cacheConfig.cacheLocation),r.temporaryCacheStorage=r.setupTemporaryCacheStorage(r.cacheConfig.cacheLocation),r.migrateCacheEntries(),r}return i(t,e),t.prototype.setupBrowserStorage=function(e){switch(e){case p.LocalStorage:case p.SessionStorage:try{return new we(e)}catch(e){this.logger.verbose(e);break}}return this.cacheConfig.cacheLocation=p.MemoryStorage,new q},t.prototype.setupTemporaryCacheStorage=function(e){switch(e){case p.LocalStorage:case p.SessionStorage:try{return new we(p.SessionStorage)}catch(e){return this.logger.verbose(e),this.internalStorage}case p.MemoryStorage:default:return this.internalStorage}},t.prototype.migrateCacheEntries=function(){var e=this,t=y.oT.CACHE_PREFIX+"."+y.qi.ID_TOKEN,n=y.oT.CACHE_PREFIX+"."+y.qi.CLIENT_INFO,a=y.oT.CACHE_PREFIX+"."+y.qi.ERROR,i=y.oT.CACHE_PREFIX+"."+y.qi.ERROR_DESC,r=[this.browserStorage.getItem(t),this.browserStorage.getItem(n),this.browserStorage.getItem(a),this.browserStorage.getItem(i)];[y.qi.ID_TOKEN,y.qi.CLIENT_INFO,y.qi.ERROR,y.qi.ERROR_DESC].forEach(function(t,n){return e.migrateCacheEntry(t,r[n])})},t.prototype.migrateCacheEntry=function(e,t){t&&this.setTemporaryCache(e,t,!0)},t.prototype.validateAndParseJson=function(e){try{var t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}},t.prototype.getItem=function(e){return this.browserStorage.getItem(e)},t.prototype.setItem=function(e,t){this.browserStorage.setItem(e,t)},t.prototype.getAccount=function(e){var t=this.getItem(e);if(!t)return null;var n=this.validateAndParseJson(t);return n&&ce.isAccountEntity(n)?pe.toObject(new ce,n):null},t.prototype.setAccount=function(e){this.logger.trace("BrowserCacheManager.setAccount called");var t=e.generateAccountKey();this.setItem(t,JSON.stringify(e))},t.prototype.getIdTokenCredential=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&_e.isIdTokenEntity(n)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),pe.toObject(new _e,n)):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null)},t.prototype.setIdTokenCredential=function(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");var t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e))},t.prototype.getAccessTokenCredential=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&be.isAccessTokenEntity(n)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),pe.toObject(new be,n)):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null)},t.prototype.setAccessTokenCredential=function(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");var t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e))},t.prototype.getRefreshTokenCredential=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&ge.isRefreshTokenEntity(n)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),pe.toObject(new ge,n)):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null)},t.prototype.setRefreshTokenCredential=function(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");var t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e))},t.prototype.getAppMetadata=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&ve.isAppMetadataEntity(e,n)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),pe.toObject(new ve,n)):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)},t.prototype.setAppMetadata=function(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");var t=e.generateAppMetadataKey();this.setItem(t,JSON.stringify(e))},t.prototype.getServerTelemetry=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&ye.isServerTelemetryEntity(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),pe.toObject(new ye,n)):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)},t.prototype.setServerTelemetry=function(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))},t.prototype.getAuthorityMetadata=function(e){var t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&Se.isAuthorityMetadataEntity(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),pe.toObject(new Se,n)):null},t.prototype.getAuthorityMetadataKeys=function(){var e=this;return this.internalStorage.getKeys().filter(function(t){return e.isAuthorityMetadata(t)})},t.prototype.setWrapperMetadata=function(e,t){this.internalStorage.setItem(h.WRAPPER_SKU,e),this.internalStorage.setItem(h.WRAPPER_VER,t)},t.prototype.getWrapperMetadata=function(){return[this.internalStorage.getItem(h.WRAPPER_SKU)||y.oT.EMPTY_STRING,this.internalStorage.getItem(h.WRAPPER_VER)||y.oT.EMPTY_STRING]},t.prototype.setAuthorityMetadata=function(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))},t.prototype.getActiveAccount=function(){var e=this.generateCacheKey(y.qi.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(e);if(!t){this.logger.trace("No active account filters cache schema found, looking for legacy schema");var n=this.generateCacheKey(y.qi.ACTIVE_ACCOUNT),a=this.getItem(n);if(!a)return this.logger.trace("No active account found"),null;var i=this.getAccountInfoByFilter({localAccountId:a})[0]||null;return i?(this.logger.trace("Legacy active account cache schema found"),this.logger.trace("Adding active account filters cache schema"),this.setActiveAccount(i),i):null}var r=this.validateAndParseJson(t);return r?(this.logger.trace("Active account filters schema found"),this.getAccountInfoByFilter({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId})[0]||null):(this.logger.trace("No active account found"),null)},t.prototype.setActiveAccount=function(e){var t=this.generateCacheKey(y.qi.ACTIVE_ACCOUNT_FILTERS),n=this.generateCacheKey(y.qi.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");var a={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId};this.browserStorage.setItem(t,JSON.stringify(a)),this.browserStorage.setItem(n,e.localAccountId)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(n)},t.prototype.getAccountInfoByFilter=function(e){return this.getAllAccounts().filter(function(t){return!(e.username&&e.username.toLowerCase()!==t.username.toLowerCase()||e.homeAccountId&&e.homeAccountId!==t.homeAccountId||e.localAccountId&&e.localAccountId!==t.localAccountId||e.tenantId&&e.tenantId!==t.tenantId||e.environment&&e.environment!==t.environment)})},t.prototype.getAccountInfoByHints=function(e,t){var n=this.getAllAccounts().filter(function(n){if(t){var a=n.idTokenClaims&&n.idTokenClaims.sid;return t===a}return!!e&&e===n.username});if(1===n.length)return n[0];if(n.length>1)throw ie.e.createMultipleMatchingAccountsInCacheError();return null},t.prototype.getThrottlingCache=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&De.isThrottlingEntity(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),pe.toObject(new De,n)):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)},t.prototype.setThrottlingCache=function(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))},t.prototype.getTemporaryCache=function(e,t){var n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){var a=this.getItemCookie(n);if(a)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),a}var i=this.temporaryCacheStorage.getItem(n);if(!i){if(this.cacheConfig.cacheLocation===p.LocalStorage){var r=this.browserStorage.getItem(n);if(r)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),r}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i},t.prototype.setTemporaryCache=function(e,t,n){var a=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(a,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(a,t))},t.prototype.removeItem=function(e){return this.browserStorage.removeItem(e),this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(e)),!0},t.prototype.containsKey=function(e){return this.browserStorage.containsKey(e)||this.temporaryCacheStorage.containsKey(e)},t.prototype.getKeys=function(){return u(this.browserStorage.getKeys(),this.temporaryCacheStorage.getKeys())},t.prototype.clear=function(){return c(this,void 0,void 0,function(){var e=this;return d(this,function(t){switch(t.label){case 0:return[4,this.removeAllAccounts()];case 1:return t.sent(),this.removeAppMetadata(),this.getKeys().forEach(function(t){!e.browserStorage.containsKey(t)&&!e.temporaryCacheStorage.containsKey(t)||-1===t.indexOf(y.oT.CACHE_PREFIX)&&-1===t.indexOf(e.clientId)||e.removeItem(t)}),this.internalStorage.clear(),[2]}})})},t.prototype.setItemCookie=function(e,t,n){var a=encodeURIComponent(e)+"="+encodeURIComponent(t)+";path=/;SameSite=Lax;";n&&(a+="expires="+this.getCookieExpirationTime(n)+";"),this.cacheConfig.secureCookies&&(a+="Secure;"),document.cookie=a},t.prototype.getItemCookie=function(e){for(var t=encodeURIComponent(e)+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var i=n[a];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return decodeURIComponent(i.substring(t.length,i.length))}return y.oT.EMPTY_STRING},t.prototype.clearMsalCookies=function(){var e=this,t=y.oT.CACHE_PREFIX+"."+this.clientId;document.cookie.split(";").forEach(function(n){for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(t)){var a=n.split("=")[0];e.clearItemCookie(a)}})},t.prototype.clearItemCookie=function(e){this.setItemCookie(e,y.oT.EMPTY_STRING,-1)},t.prototype.getCookieExpirationTime=function(e){var t=new Date;return new Date(t.getTime()+e*this.COOKIE_LIFE_MULTIPLIER).toUTCString()},t.prototype.getCache=function(){return this.browserStorage},t.prototype.setCache=function(){},t.prototype.generateCacheKey=function(e){return this.validateAndParseJson(e)?JSON.stringify(e):H.x.startsWith(e,y.oT.CACHE_PREFIX)||H.x.startsWith(e,y.qi.ADAL_ID_TOKEN)?e:y.oT.CACHE_PREFIX+"."+this.clientId+"."+e},t.prototype.generateAuthorityKey=function(e){var t=Ie.parseRequestState(this.cryptoImpl,e).libraryState.id;return this.generateCacheKey(_.AUTHORITY+"."+t)},t.prototype.generateNonceKey=function(e){var t=Ie.parseRequestState(this.cryptoImpl,e).libraryState.id;return this.generateCacheKey(_.NONCE_IDTOKEN+"."+t)},t.prototype.generateStateKey=function(e){var t=Ie.parseRequestState(this.cryptoImpl,e).libraryState.id;return this.generateCacheKey(_.REQUEST_STATE+"."+t)},t.prototype.getCachedAuthority=function(e){var t=this.generateStateKey(e),n=this.getTemporaryCache(t);if(!n)return null;var a=this.generateAuthorityKey(n);return this.getTemporaryCache(a)},t.prototype.updateCacheEntries=function(e,t,n,a,i){this.logger.trace("BrowserCacheManager.updateCacheEntries called");var r=this.generateStateKey(e);this.setTemporaryCache(r,e,!1);var o=this.generateNonceKey(e);this.setTemporaryCache(o,t,!1);var s=this.generateAuthorityKey(e);if(this.setTemporaryCache(s,n,!1),i){var c={credential:i.homeAccountId,type:se.HOME_ACCOUNT_ID};this.setTemporaryCache(_.CCS_CREDENTIAL,JSON.stringify(c),!0)}else H.x.isEmpty(a)||(c={credential:a,type:se.UPN},this.setTemporaryCache(_.CCS_CREDENTIAL,JSON.stringify(c),!0))},t.prototype.resetRequestCache=function(e){var t=this;this.logger.trace("BrowserCacheManager.resetRequestCache called"),H.x.isEmpty(e)||this.getKeys().forEach(function(n){-1!==n.indexOf(e)&&t.removeItem(n)}),e&&(this.removeItem(this.generateStateKey(e)),this.removeItem(this.generateNonceKey(e)),this.removeItem(this.generateAuthorityKey(e))),this.removeItem(this.generateCacheKey(_.REQUEST_PARAMS)),this.removeItem(this.generateCacheKey(_.ORIGIN_URI)),this.removeItem(this.generateCacheKey(_.URL_HASH)),this.removeItem(this.generateCacheKey(_.CORRELATION_ID)),this.removeItem(this.generateCacheKey(_.CCS_CREDENTIAL)),this.removeItem(this.generateCacheKey(_.NATIVE_REQUEST)),this.setInteractionInProgress(!1)},t.prototype.cleanRequestByState=function(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){var t=this.generateStateKey(e),n=this.temporaryCacheStorage.getItem(t);this.logger.infoPii("BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: "+n),this.resetRequestCache(n||y.oT.EMPTY_STRING)}this.clearMsalCookies()},t.prototype.cleanRequestByInteractionType=function(e){var t=this;this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.getKeys().forEach(function(n){if(-1!==n.indexOf(_.REQUEST_STATE)){var a=t.temporaryCacheStorage.getItem(n);if(a){var i=Ae.extractBrowserRequestState(t.cryptoImpl,a);i&&i.interactionType===e&&(t.logger.infoPii("BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: "+a),t.resetRequestCache(a))}}}),this.clearMsalCookies(),this.setInteractionInProgress(!1)},t.prototype.cacheCodeRequest=function(e,t){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");var n=t.base64Encode(JSON.stringify(e));this.setTemporaryCache(_.REQUEST_PARAMS,n,!0)},t.prototype.getCachedRequest=function(e,t){this.logger.trace("BrowserCacheManager.getCachedRequest called");var n=this.getTemporaryCache(_.REQUEST_PARAMS,!0);if(!n)throw j.createNoTokenRequestCacheError();var a=this.validateAndParseJson(t.base64Decode(n));if(!a)throw j.createUnableToParseTokenRequestCacheError();if(this.removeItem(this.generateCacheKey(_.REQUEST_PARAMS)),H.x.isEmpty(a.authority)){var i=this.generateAuthorityKey(e),r=this.getTemporaryCache(i);if(!r)throw j.createNoCachedAuthorityError();a.authority=r}return a},t.prototype.getCachedNativeRequest=function(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");var e=this.getTemporaryCache(_.NATIVE_REQUEST,!0);return e?this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)},t.prototype.isInteractionInProgress=function(e){var t=this.getInteractionInProgress();return e?t===this.clientId:!!t},t.prototype.getInteractionInProgress=function(){var e=y.oT.CACHE_PREFIX+"."+_.INTERACTION_STATUS_KEY;return this.getTemporaryCache(e,!1)},t.prototype.setInteractionInProgress=function(e){var t=y.oT.CACHE_PREFIX+"."+_.INTERACTION_STATUS_KEY;if(e){if(this.getInteractionInProgress())throw j.createInteractionInProgressError();this.setTemporaryCache(t,this.clientId,!1)}else e||this.getInteractionInProgress()!==this.clientId||this.removeItem(t)},t.prototype.getLegacyLoginHint=function(){var e=this.getTemporaryCache(y.qi.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(y.qi.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));var t=this.getTemporaryCache(y.qi.ID_TOKEN,!0);t&&(this.removeItem(this.generateCacheKey(y.qi.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));var n=t||e;if(n){var a=new fe(n,this.cryptoImpl);if(a.claims&&a.claims.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),a.claims.preferred_username;if(a.claims&&a.claims.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),a.claims.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null},t.prototype.updateCredentialCacheKey=function(e,t){var n=t.generateCredentialKey();if(e!==n){var a=this.getItem(e);if(a)return this.removeItem(e),this.setItem(n,a),this.logger.verbose("Updated an outdated "+t.credentialType+" cache key"),n;this.logger.error("Attempted to update an outdated "+t.credentialType+" cache key but no item matching the outdated key was found in storage")}return e},t}(pe);!function(e){e.AAD="AAD",e.OIDC="OIDC"}(xe||(xe={})),function(e){e[e.None=0]="None",e.AzurePublic="https://login.microsoftonline.com",e.AzurePpe="https://login.windows-ppe.net",e.AzureChina="https://login.chinacloudapi.cn",e.AzureGermany="https://login.microsoftonline.de",e.AzureUsGovernment="https://login.microsoftonline.us"}(Ce||(Ce={}));var ke,Me="7.6.0",Pe={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1,proxyUrl:y.oT.EMPTY_STRING},Te={loggerCallback:function(){},piiLoggingEnabled:!1,logLevel:X.i.Info,correlationId:y.oT.EMPTY_STRING},Ue={sendGetRequestAsync:function(){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(e){throw A.l.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented")})})},sendPostRequestAsync:function(){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(e){throw A.l.createUnexpectedError("Network interface - sendPostRequestAsync() has not been implemented")})})}},Fe={sku:y.oT.SKU,version:Me,cpu:y.oT.EMPTY_STRING,os:y.oT.EMPTY_STRING},He={clientSecret:y.oT.EMPTY_STRING,clientAssertion:void 0},Re={azureCloudInstance:Ce.None,tenant:""+y.oT.DEFAULT_COMMON_TENANT},Ne={application:{appName:"",appVersion:""}},Be={sendGetRequestAsync:function(){return Promise.reject(A.l.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented for the Network interface."))},sendPostRequestAsync:function(){return Promise.reject(A.l.createUnexpectedError("Network interface - sendPostRequestAsync() has not been implemented for the Network interface."))}},je=function(){function e(){}return e.prototype.sendGetRequestAsync=function(e,t){return c(this,void 0,void 0,function(){var n,a,i;return d(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,fetch(e,{method:m.GET,headers:this.getFetchHeaders(t)})];case 1:return n=r.sent(),[3,3];case 2:throw a=r.sent(),window.navigator.onLine?j.createGetRequestFailedError(a,e):j.createNoNetworkConnectivityError();case 3:return r.trys.push([3,5,,6]),i={headers:this.getHeaderDict(n.headers)},[4,n.json()];case 4:return[2,(i.body=r.sent(),i.status=n.status,i)];case 5:throw r.sent(),j.createFailedToParseNetworkResponseError(e);case 6:return[2]}})})},e.prototype.sendPostRequestAsync=function(e,t){return c(this,void 0,void 0,function(){var n,a,i,r;return d(this,function(o){switch(o.label){case 0:n=t&&t.body||y.oT.EMPTY_STRING,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(e,{method:m.POST,headers:this.getFetchHeaders(t),body:n})];case 2:return a=o.sent(),[3,4];case 3:throw i=o.sent(),window.navigator.onLine?j.createPostRequestFailedError(i,e):j.createNoNetworkConnectivityError();case 4:return o.trys.push([4,6,,7]),r={headers:this.getHeaderDict(a.headers)},[4,a.json()];case 5:return[2,(r.body=o.sent(),r.status=a.status,r)];case 6:throw o.sent(),j.createFailedToParseNetworkResponseError(e);case 7:return[2]}})})},e.prototype.getFetchHeaders=function(e){var t=new Headers;if(!e||!e.headers)return t;var n=e.headers;return Object.keys(n).forEach(function(e){t.append(e,n[e])}),t},e.prototype.getHeaderDict=function(e){var t={};return e.forEach(function(e,n){t[n]=e}),t},e}(),Ve=function(){function e(){}return e.prototype.sendGetRequestAsync=function(e,t){return c(this,void 0,void 0,function(){return d(this,function(n){return[2,this.sendRequestAsync(e,m.GET,t)]})})},e.prototype.sendPostRequestAsync=function(e,t){return c(this,void 0,void 0,function(){return d(this,function(n){return[2,this.sendRequestAsync(e,m.POST,t)]})})},e.prototype.sendRequestAsync=function(e,t,n){var a=this;return new Promise(function(i,r){var o=new XMLHttpRequest;if(o.open(t,e,!0),a.setXhrHeaders(o,n),o.onload=function(){(o.status<200||o.status>=300)&&(t===m.POST?r(j.createPostRequestFailedError("Failed with status "+o.status,e)):r(j.createGetRequestFailedError("Failed with status "+o.status,e)));try{var n=JSON.parse(o.responseText),s={headers:a.getHeaderDict(o),body:n,status:o.status};i(s)}catch(t){r(j.createFailedToParseNetworkResponseError(e))}},o.onerror=function(){window.navigator.onLine?t===m.POST?r(j.createPostRequestFailedError("Failed with status "+o.status,e)):r(j.createGetRequestFailedError("Failed with status "+o.status,e)):r(j.createNoNetworkConnectivityError())},t===m.POST&&n&&n.body)o.send(n.body);else{if(t!==m.GET)throw j.createHttpMethodNotImplementedError(t);o.send()}})},e.prototype.setXhrHeaders=function(e,t){if(t&&t.headers){var n=t.headers;Object.keys(n).forEach(function(t){e.setRequestHeader(t,n[t])})}},e.prototype.getHeaderDict=function(e){var t=e.getAllResponseHeaders().trim().split(/[\r\n]+/),n={};return t.forEach(function(e){var t=e.split(": "),a=t.shift(),i=t.join(": ");a&&i&&(n[a]=i)}),n},e}(),ze=function(){function e(){}return e.clearHash=function(e){e.location.hash=y.oT.EMPTY_STRING,"function"==typeof e.history.replaceState&&e.history.replaceState(null,y.oT.EMPTY_STRING,""+e.location.origin+e.location.pathname+e.location.search)},e.replaceHash=function(e){var t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):y.oT.EMPTY_STRING},e.isInIframe=function(){return window.parent!==window},e.isInPopup=function(){return"undefined"!=typeof window&&!!window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf("msal.")},e.getCurrentUri=function(){return window.location.href.split("?")[0].split("#")[0]},e.getHomepage=function(){var e=new Ee(window.location.href).getUrlComponents();return e.Protocol+"//"+e.HostNameAndPort+"/"},e.getBrowserNetworkClient=function(){return window.fetch&&window.Headers?new je:new Ve},e.blockReloadInHiddenIframes=function(){if(Ee.hashContainsKnownProperties(window.location.hash)&&e.isInIframe())throw j.createBlockReloadInHiddenIframeError()},e.blockRedirectInIframe=function(t,n){var a=e.isInIframe();if(t===g.Redirect&&a&&!n)throw j.createRedirectInIframeError(a)},e.blockAcquireTokenInPopups=function(){if(e.isInPopup())throw j.createBlockAcquireTokenInPopupsError()},e.blockNonBrowserEnvironment=function(e){if(!e)throw j.createNonBrowserEnvironmentError()},e.blockNativeBrokerCalledBeforeInitialized=function(e,t){if(e&&!t)throw j.createNativeBrokerCalledBeforeInitialize()},e.detectIEOrEdge=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),a=e.indexOf("Edge/");return t>0||n>0||a>0},e}(),Ge=function(){function e(){}return e.prototype.navigateInternal=function(t,n){return e.defaultNavigateWindow(t,n)},e.prototype.navigateExternal=function(t,n){return e.defaultNavigateWindow(t,n)},e.defaultNavigateWindow=function(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(function(e){setTimeout(function(){e(!0)},t.timeout)})},e}(),Ke="@azure/msal-browser",We="2.28.1";!function(e){e.INITIALIZE_START="msal:initializeStart",e.INITIALIZE_END="msal:initializeEnd",e.ACCOUNT_ADDED="msal:accountAdded",e.ACCOUNT_REMOVED="msal:accountRemoved",e.LOGIN_START="msal:loginStart",e.LOGIN_SUCCESS="msal:loginSuccess",e.LOGIN_FAILURE="msal:loginFailure",e.ACQUIRE_TOKEN_START="msal:acquireTokenStart",e.ACQUIRE_TOKEN_SUCCESS="msal:acquireTokenSuccess",e.ACQUIRE_TOKEN_FAILURE="msal:acquireTokenFailure",e.ACQUIRE_TOKEN_NETWORK_START="msal:acquireTokenFromNetworkStart",e.SSO_SILENT_START="msal:ssoSilentStart",e.SSO_SILENT_SUCCESS="msal:ssoSilentSuccess",e.SSO_SILENT_FAILURE="msal:ssoSilentFailure",e.ACQUIRE_TOKEN_BY_CODE_START="msal:acquireTokenByCodeStart",e.ACQUIRE_TOKEN_BY_CODE_SUCCESS="msal:acquireTokenByCodeSuccess",e.ACQUIRE_TOKEN_BY_CODE_FAILURE="msal:acquireTokenByCodeFailure",e.HANDLE_REDIRECT_START="msal:handleRedirectStart",e.HANDLE_REDIRECT_END="msal:handleRedirectEnd",e.POPUP_OPENED="msal:popupOpened",e.LOGOUT_START="msal:logoutStart",e.LOGOUT_SUCCESS="msal:logoutSuccess",e.LOGOUT_FAILURE="msal:logoutFailure",e.LOGOUT_END="msal:logoutEnd"}(ke||(ke={}));var qe,Qe=function(){function e(e,t){this.eventCallbacks=new Map,this.logger=e,this.browserCrypto=t,this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}return e.prototype.addEventCallback=function(e){if("undefined"!=typeof window){var t=this.browserCrypto.createNewGuid();return this.eventCallbacks.set(t,e),this.logger.verbose("Event callback registered with id: "+t),t}return null},e.prototype.removeEventCallback=function(e){this.eventCallbacks.delete(e),this.logger.verbose("Event callback "+e+" removed.")},e.prototype.enableAccountStorageEvents=function(){"undefined"!=typeof window&&(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))},e.prototype.disableAccountStorageEvents=function(){"undefined"!=typeof window&&(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))},e.prototype.emitEvent=function(e,t,n,a){var i=this;if("undefined"!=typeof window){var r={eventType:e,interactionType:t||null,payload:n||null,error:a||null,timestamp:Date.now()};this.logger.info("Emitting event: "+e),this.eventCallbacks.forEach(function(t,n){i.logger.verbose("Emitting event to callback "+n+": "+e),t.apply(null,[r])})}},e.prototype.handleAccountCacheChange=function(e){try{var t=e.newValue||e.oldValue;if(!t)return;var n=JSON.parse(t);if("object"!=typeof n||!ce.isAccountEntity(n))return;var a=pe.toObject(new ce,n).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(ke.ACCOUNT_ADDED,void 0,a)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(ke.ACCOUNT_REMOVED,void 0,a))}catch(e){return}},e}(),Ye=function(){function e(){}return e.generateThrottlingStorageKey=function(e){return y.tb.THROTTLING_PREFIX+"."+JSON.stringify(e)},e.preProcess=function(t,n){var a,i=e.generateThrottlingStorageKey(n),r=t.getThrottlingCache(i);if(r){if(r.throttleTime<Date.now())return void t.removeItem(i,y.Yj.THROTTLING);throw new ae((null===(a=r.errorCodes)||void 0===a?void 0:a.join(" "))||y.oT.EMPTY_STRING,r.errorMessage,r.subError)}},e.postProcess=function(t,n,a){if(e.checkResponseStatus(a)||e.checkResponseForRetryAfter(a)){var i={throttleTime:e.calculateThrottleTime(parseInt(a.headers[y.GZ.RETRY_AFTER])),error:a.body.error,errorCodes:a.body.error_codes,errorMessage:a.body.error_description,subError:a.body.suberror};t.setThrottlingCache(e.generateThrottlingStorageKey(n),i)}},e.checkResponseStatus=function(e){return 429===e.status||e.status>=500&&e.status<600},e.checkResponseForRetryAfter=function(e){return!!e.headers&&e.headers.hasOwnProperty(y.GZ.RETRY_AFTER)&&(e.status<200||e.status>=300)},e.calculateThrottleTime=function(e){var t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(1e3*Math.min(n+(t||y.tb.DEFAULT_THROTTLE_TIME_SECONDS),n+y.tb.DEFAULT_MAX_THROTTLE_TIME_SECONDS))},e.removeThrottle=function(e,t,n,a){var i={clientId:t,authority:n.authority,scopes:n.scopes,homeAccountIdentifier:a,claims:n.claims,authenticationScheme:n.authenticationScheme,resourceRequestMethod:n.resourceRequestMethod,resourceRequestUri:n.resourceRequestUri,shrClaims:n.shrClaims,sshKid:n.sshKid},r=this.generateThrottlingStorageKey(i);return e.removeItem(r,y.Yj.THROTTLING)},e}(),Je=function(){function e(e,t){this.networkClient=e,this.cacheManager=t}return e.prototype.sendPostRequest=function(e,t,n){return(0,E.fG)(this,void 0,void 0,function(){var a,i;return(0,E.Uh)(this,function(r){switch(r.label){case 0:Ye.preProcess(this.cacheManager,e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.networkClient.sendPostRequestAsync(t,n)];case 2:return a=r.sent(),[3,4];case 3:throw(i=r.sent())instanceof A.l?i:ie.e.createNetworkError(t,i);case 4:return Ye.postProcess(this.cacheManager,e,a),[2,a]}})})},e}(),Xe=function(){function e(e,t){var n,a,i,r,o,s,c,d,l,u,f,p,m,_,h;this.config=(i=(n=e).authOptions,r=n.systemOptions,o=n.loggerOptions,s=n.storageInterface,c=n.networkInterface,d=n.cryptoInterface,l=n.clientCredentials,u=n.libraryInfo,f=n.telemetry,p=n.serverTelemetryManager,m=n.persistencePlugin,_=n.serializableCache,h=(0,E._i)((0,E._i)({},Te),o),{authOptions:(a=i,(0,E._i)({clientCapabilities:[],azureCloudOptions:Re,skipAuthorityMetadataCache:!1},a)),systemOptions:(0,E._i)((0,E._i)({},Pe),r),loggerOptions:h,storageInterface:s||new me(i.clientId,te),networkInterface:c||Ue,cryptoInterface:d||te,clientCredentials:l||He,libraryInfo:(0,E._i)((0,E._i)({},Fe),u),telemetry:(0,E._i)((0,E._i)({},Ne),f),serverTelemetryManager:p||null,persistencePlugin:m||null,serializableCache:_||null}),this.logger=new X.Y(this.config.loggerOptions,"@azure/msal-common",Me),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new Je(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}return e.prototype.createTokenRequestHeaders=function(e){var t={};if(t[y.GZ.CONTENT_TYPE]=y.oT.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case se.HOME_ACCOUNT_ID:try{var n=oe(e.credential);t[y.GZ.CCS_HEADER]="Oid:"+n.uid+"@"+n.utid}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case se.UPN:t[y.GZ.CCS_HEADER]="UPN: "+e.credential}return t},e.prototype.executePostToTokenEndpoint=function(e,t,n,a){return(0,E.fG)(this,void 0,void 0,function(){var i;return(0,E.Uh)(this,function(r){switch(r.label){case 0:return[4,this.networkManager.sendPostRequest(a,e,{body:t,headers:n,proxyUrl:this.config.systemOptions.proxyUrl})];case 1:return i=r.sent(),this.config.serverTelemetryManager&&i.status<500&&429!==i.status&&this.config.serverTelemetryManager.clearTelemetryCache(),[2,i]}})})},e.prototype.updateAuthority=function(e){if(!e.discoveryComplete())throw ie.e.createEndpointDiscoveryIncompleteError("Updated authority has not completed endpoint discovery.");this.authority=e},e}(),Ze=function(){function e(){}return e.validateRedirectUri=function(e){if(H.x.isEmpty(e))throw le.createRedirectUriEmptyError()},e.validatePrompt=function(e){var t=[];for(var n in y.NJ)t.push(y.NJ[n]);if(t.indexOf(e)<0)throw le.createInvalidPromptError(e)},e.validateClaims=function(e){try{JSON.parse(e)}catch(e){throw le.createInvalidClaimsRequestError()}},e.validateCodeChallengeParams=function(e,t){if(H.x.isEmpty(e)||H.x.isEmpty(t))throw le.createInvalidCodeChallengeParamsError();this.validateCodeChallengeMethod(t)},e.validateCodeChallengeMethod=function(e){if([y.qX.PLAIN,y.qX.S256].indexOf(e)<0)throw le.createInvalidCodeChallengeMethodError()},e.sanitizeEQParams=function(e,t){return e?(t.forEach(function(t,n){e[n]&&delete e[n]}),e):{}},e}(),$e=function(){function e(){this.parameters=new Map}return e.prototype.addResponseTypeCode=function(){this.parameters.set(y.ko.RESPONSE_TYPE,encodeURIComponent(y.oT.CODE_RESPONSE_TYPE))},e.prototype.addResponseTypeForTokenAndIdToken=function(){this.parameters.set(y.ko.RESPONSE_TYPE,encodeURIComponent(y.oT.TOKEN_RESPONSE_TYPE+" "+y.oT.ID_TOKEN_RESPONSE_TYPE))},e.prototype.addResponseMode=function(e){this.parameters.set(y.ko.RESPONSE_MODE,encodeURIComponent(e||y.Sw.QUERY))},e.prototype.addNativeBroker=function(){this.parameters.set(y.ko.NATIVE_BROKER,encodeURIComponent("1"))},e.prototype.addScopes=function(e,t){void 0===t&&(t=!0);var n=t?(0,E._r)(e||[],y.r_):e||[],a=new ue(n);this.parameters.set(y.ko.SCOPE,encodeURIComponent(a.printScopes()))},e.prototype.addClientId=function(e){this.parameters.set(y.ko.CLIENT_ID,encodeURIComponent(e))},e.prototype.addRedirectUri=function(e){Ze.validateRedirectUri(e),this.parameters.set(y.ko.REDIRECT_URI,encodeURIComponent(e))},e.prototype.addPostLogoutRedirectUri=function(e){Ze.validateRedirectUri(e),this.parameters.set(y.ko.POST_LOGOUT_URI,encodeURIComponent(e))},e.prototype.addIdTokenHint=function(e){this.parameters.set(y.ko.ID_TOKEN_HINT,encodeURIComponent(e))},e.prototype.addDomainHint=function(e){this.parameters.set(y.qO.DOMAIN_HINT,encodeURIComponent(e))},e.prototype.addLoginHint=function(e){this.parameters.set(y.qO.LOGIN_HINT,encodeURIComponent(e))},e.prototype.addCcsUpn=function(e){this.parameters.set(y.GZ.CCS_HEADER,encodeURIComponent("UPN:"+e))},e.prototype.addCcsOid=function(e){this.parameters.set(y.GZ.CCS_HEADER,encodeURIComponent("Oid:"+e.uid+"@"+e.utid))},e.prototype.addSid=function(e){this.parameters.set(y.qO.SID,encodeURIComponent(e))},e.prototype.addClaims=function(e,t){var n=this.addClientCapabilitiesToClaims(e,t);Ze.validateClaims(n),this.parameters.set(y.ko.CLAIMS,encodeURIComponent(n))},e.prototype.addCorrelationId=function(e){this.parameters.set(y.ko.CLIENT_REQUEST_ID,encodeURIComponent(e))},e.prototype.addLibraryInfo=function(e){this.parameters.set(y.ko.X_CLIENT_SKU,e.sku),this.parameters.set(y.ko.X_CLIENT_VER,e.version),e.os&&this.parameters.set(y.ko.X_CLIENT_OS,e.os),e.cpu&&this.parameters.set(y.ko.X_CLIENT_CPU,e.cpu)},e.prototype.addApplicationTelemetry=function(e){(null==e?void 0:e.appName)&&this.parameters.set(y.ko.X_APP_NAME,e.appName),(null==e?void 0:e.appVersion)&&this.parameters.set(y.ko.X_APP_VER,e.appVersion)},e.prototype.addPrompt=function(e){Ze.validatePrompt(e),this.parameters.set(""+y.ko.PROMPT,encodeURIComponent(e))},e.prototype.addState=function(e){H.x.isEmpty(e)||this.parameters.set(y.ko.STATE,encodeURIComponent(e))},e.prototype.addNonce=function(e){this.parameters.set(y.ko.NONCE,encodeURIComponent(e))},e.prototype.addCodeChallengeParams=function(e,t){if(Ze.validateCodeChallengeParams(e,t),!e||!t)throw le.createInvalidCodeChallengeParamsError();this.parameters.set(y.ko.CODE_CHALLENGE,encodeURIComponent(e)),this.parameters.set(y.ko.CODE_CHALLENGE_METHOD,encodeURIComponent(t))},e.prototype.addAuthorizationCode=function(e){this.parameters.set(y.ko.CODE,encodeURIComponent(e))},e.prototype.addDeviceCode=function(e){this.parameters.set(y.ko.DEVICE_CODE,encodeURIComponent(e))},e.prototype.addRefreshToken=function(e){this.parameters.set(y.ko.REFRESH_TOKEN,encodeURIComponent(e))},e.prototype.addCodeVerifier=function(e){this.parameters.set(y.ko.CODE_VERIFIER,encodeURIComponent(e))},e.prototype.addClientSecret=function(e){this.parameters.set(y.ko.CLIENT_SECRET,encodeURIComponent(e))},e.prototype.addClientAssertion=function(e){H.x.isEmpty(e)||this.parameters.set(y.ko.CLIENT_ASSERTION,encodeURIComponent(e))},e.prototype.addClientAssertionType=function(e){H.x.isEmpty(e)||this.parameters.set(y.ko.CLIENT_ASSERTION_TYPE,encodeURIComponent(e))},e.prototype.addOboAssertion=function(e){this.parameters.set(y.ko.OBO_ASSERTION,encodeURIComponent(e))},e.prototype.addRequestTokenUse=function(e){this.parameters.set(y.ko.REQUESTED_TOKEN_USE,encodeURIComponent(e))},e.prototype.addGrantType=function(e){this.parameters.set(y.ko.GRANT_TYPE,encodeURIComponent(e))},e.prototype.addClientInfo=function(){this.parameters.set(y.gR,"1")},e.prototype.addExtraQueryParameters=function(e){var t=this;Ze.sanitizeEQParams(e,this.parameters),Object.keys(e).forEach(function(n){t.parameters.set(n,e[n])})},e.prototype.addClientCapabilitiesToClaims=function(e,t){var n;if(e)try{n=JSON.parse(e)}catch(e){throw le.createInvalidClaimsRequestError()}else n={};return t&&t.length>0&&(n.hasOwnProperty(y.Os.ACCESS_TOKEN)||(n[y.Os.ACCESS_TOKEN]={}),n[y.Os.ACCESS_TOKEN][y.Os.XMS_CC]={values:t}),JSON.stringify(n)},e.prototype.addUsername=function(e){this.parameters.set(y.Me.username,encodeURIComponent(e))},e.prototype.addPassword=function(e){this.parameters.set(y.Me.password,encodeURIComponent(e))},e.prototype.addPopToken=function(e){H.x.isEmpty(e)||(this.parameters.set(y.ko.TOKEN_TYPE,y.sO.POP),this.parameters.set(y.ko.REQ_CNF,encodeURIComponent(e)))},e.prototype.addSshJwk=function(e){H.x.isEmpty(e)||(this.parameters.set(y.ko.TOKEN_TYPE,y.sO.SSH),this.parameters.set(y.ko.REQ_CNF,encodeURIComponent(e)))},e.prototype.addServerTelemetry=function(e){this.parameters.set(y.ko.X_CLIENT_CURR_TELEM,e.generateCurrentRequestHeaderValue()),this.parameters.set(y.ko.X_CLIENT_LAST_TELEM,e.generateLastRequestHeaderValue())},e.prototype.addThrottling=function(){this.parameters.set(y.ko.X_MS_LIB_CAPABILITY,y.tb.X_MS_LIB_CAPABILITY_VALUE)},e.prototype.addLogoutHint=function(e){this.parameters.set(y.ko.LOGOUT_HINT,encodeURIComponent(e))},e.prototype.createQueryString=function(){var e=new Array;return this.parameters.forEach(function(t,n){e.push(n+"="+t)}),e.join("&")},e}(),et=function(e,t,n,a,i){this.account=e||null,this.idToken=t||null,this.accessToken=n||null,this.refreshToken=a||null,this.appMetadata=i||null};!function(e){e.SW="sw",e.UHW="uhw"}(qe||(qe={}));var tt=function(){function e(e){this.cryptoUtils=e}return e.prototype.generateCnf=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t,n,a;return(0,E.Uh)(this,function(i){switch(i.label){case 0:return[4,this.generateKid(e)];case 1:return t=i.sent(),n=this.cryptoUtils.base64Encode(JSON.stringify(t)),a={kid:t.kid,reqCnfString:n},[4,this.cryptoUtils.hashString(n)];case 2:return[2,(a.reqCnfHash=i.sent(),a)]}})})},e.prototype.generateKid=function(e){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(t){switch(t.label){case 0:return[4,this.cryptoUtils.getPublicKeyThumbprint(e)];case 1:return[2,{kid:t.sent(),xms_ksl:qe.SW}]}})})},e.prototype.signPopToken=function(e,t,n){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(a){return[2,this.signPayload(e,t,n)]})})},e.prototype.signPayload=function(e,t,n,a){return(0,E.fG)(this,void 0,void 0,function(){var i,r,o,s,c,d;return(0,E.Uh)(this,function(l){switch(l.label){case 0:return i=n.resourceRequestMethod,r=n.resourceRequestUri,o=n.shrClaims,s=n.shrNonce,c=r?new Ee(r):void 0,d=null==c?void 0:c.getUrlComponents(),[4,this.cryptoUtils.signJwt((0,E._i)({at:e,ts:he.nowSeconds(),m:null==i?void 0:i.toUpperCase(),u:null==d?void 0:d.HostNameAndPort,nonce:s||this.cryptoUtils.createNewGuid(),p:null==d?void 0:d.AbsolutePath,q:(null==d?void 0:d.QueryString)?[[],d.QueryString]:void 0,client_claims:o||void 0},a),t,n.correlationId)];case 1:return[2,l.sent()]}})})},e}(),nt=function(){function e(e,t){this.cache=e,this.hasChanged=t}return Object.defineProperty(e.prototype,"cacheHasChanged",{get:function(){return this.hasChanged},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenCache",{get:function(){return this.cache},enumerable:!1,configurable:!0}),e}(),at=function(){function e(e,t,n,a,i,r){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=a,this.serializableCache=i,this.persistencePlugin=r}return e.prototype.validateServerAuthorizationCodeResponse=function(e,t,n){if(!e.state||!t)throw e.state?ie.e.createStateNotFoundError("Cached State"):ie.e.createStateNotFoundError("Server State");if(decodeURIComponent(e.state)!==decodeURIComponent(t))throw ie.e.createStateMismatchError();if(e.error||e.error_description||e.suberror){if(ne.Jo.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new ne.Jo(e.error||y.oT.EMPTY_STRING,e.error_description,e.suberror);throw new ae(e.error||y.oT.EMPTY_STRING,e.error_description,e.suberror)}e.client_info&&re(e.client_info,n)},e.prototype.validateTokenResponse=function(e){if(e.error||e.error_description||e.suberror){if(ne.Jo.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new ne.Jo(e.error,e.error_description,e.suberror);var t=e.error_codes+" - ["+e.timestamp+"]: "+e.error_description+" - Correlation ID: "+e.correlation_id+" - Trace ID: "+e.trace_id;throw new ae(e.error,t,e.suberror)}},e.prototype.handleServerTokenResponse=function(t,n,a,i,r,o,s,c,d){return(0,E.fG)(this,void 0,void 0,function(){var l,u,f,p,m,_;return(0,E.Uh)(this,function(h){switch(h.label){case 0:if(t.id_token){if(l=new fe(t.id_token||y.oT.EMPTY_STRING,this.cryptoObj),r&&!H.x.isEmpty(r.nonce)&&l.claims.nonce!==r.nonce)throw ie.e.createNonceMismatchError();if(i.maxAge||0===i.maxAge){if(!(u=l.claims.auth_time))throw ie.e.createAuthTimeNotFoundError();fe.checkMaxAge(u,i.maxAge)}}this.homeAccountIdentifier=ce.generateHomeAccountId(t.client_info||y.oT.EMPTY_STRING,n.authorityType,this.logger,this.cryptoObj,l),r&&r.state&&(f=Ie.parseRequestState(this.cryptoObj,r.state)),t.key_id=t.key_id||i.sshKid||void 0,p=this.generateCacheRecord(t,n,a,i,l,o,r),h.label=1;case 1:return h.trys.push([1,,5,8]),this.persistencePlugin&&this.serializableCache?(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),m=new nt(this.serializableCache,!0),[4,this.persistencePlugin.beforeCacheAccess(m)]):[3,3];case 2:h.sent(),h.label=3;case 3:return!s||c||!p.account||(_=p.account.generateAccountKey(),this.cacheStorage.getAccount(_))?[4,this.cacheStorage.saveCacheRecord(p)]:(this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),[2,e.generateAuthenticationResult(this.cryptoObj,n,p,!1,i,l,f,void 0,d)]);case 4:return h.sent(),[3,8];case 5:return this.persistencePlugin&&this.serializableCache&&m?(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),[4,this.persistencePlugin.afterCacheAccess(m)]):[3,7];case 6:h.sent(),h.label=7;case 7:return[7];case 8:return[2,e.generateAuthenticationResult(this.cryptoObj,n,p,!1,i,l,f,t.spa_code,d)]}})})},e.prototype.generateCacheRecord=function(e,t,n,a,i,r,o){var s,c,d=t.getPreferredCache();if(H.x.isEmpty(d))throw ie.e.createInvalidCacheEnvironmentError();!H.x.isEmpty(e.id_token)&&i&&(s=_e.createIdTokenEntity(this.homeAccountIdentifier,d,e.id_token||y.oT.EMPTY_STRING,this.clientId,i.claims.tid||y.oT.EMPTY_STRING),c=this.generateAccountEntity(e,i,t,o));var l=null;if(!H.x.isEmpty(e.access_token)){var u=e.scope?ue.fromString(e.scope):new ue(a.scopes||[]),f=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,p=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,m=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,_=n+f,h=_+p,b=m&&m>0?n+m:void 0;l=be.createAccessTokenEntity(this.homeAccountIdentifier,d,e.access_token||y.oT.EMPTY_STRING,this.clientId,i?i.claims.tid||y.oT.EMPTY_STRING:t.tenant,u.printScopes(),_,h,this.cryptoObj,b,e.token_type,r,e.key_id,a.claims,a.requestedClaimsHash)}var g=null;H.x.isEmpty(e.refresh_token)||(g=ge.createRefreshTokenEntity(this.homeAccountIdentifier,d,e.refresh_token||y.oT.EMPTY_STRING,this.clientId,e.foci,r));var v=null;return H.x.isEmpty(e.foci)||(v=ve.createAppMetadataEntity(this.clientId,d,e.foci)),new et(c,s,l,g,v)},e.prototype.generateAccountEntity=function(e,t,n,a){var i=n.authorityType,r=a?a.cloud_graph_host_name:y.oT.EMPTY_STRING,o=a?a.msgraph_host:y.oT.EMPTY_STRING;if(i===Y.Adfs)return this.logger.verbose("Authority type is ADFS, creating ADFS account"),ce.createGenericAccount(this.homeAccountIdentifier,t,n,r,o);if(H.x.isEmpty(e.client_info)&&"AAD"===n.protocolMode)throw ie.e.createClientInfoEmptyError();return e.client_info?ce.createAccount(e.client_info,this.homeAccountIdentifier,t,n,r,o):ce.createGenericAccount(this.homeAccountIdentifier,t,n,r,o)},e.generateAuthenticationResult=function(e,t,n,a,i,r,o,s,c){var d,l,u;return(0,E.fG)(this,void 0,void 0,function(){var f,p,m,_,h,b,g,v,S,D,I;return(0,E.Uh)(this,function(x){switch(x.label){case 0:if(f=y.oT.EMPTY_STRING,p=[],m=null,h=y.oT.EMPTY_STRING,!n.accessToken)return[3,4];if(n.accessToken.tokenType!==y.sO.POP)return[3,2];if(b=new tt(e),g=n.accessToken,v=g.secret,!(S=g.keyId))throw ie.e.createKeyIdMissingError();return[4,b.signPopToken(v,S,i)];case 1:return f=x.sent(),[3,3];case 2:f=n.accessToken.secret,x.label=3;case 3:p=ue.fromString(n.accessToken.target).asArray(),m=new Date(1e3*Number(n.accessToken.expiresOn)),_=new Date(1e3*Number(n.accessToken.extendedExpiresOn)),x.label=4;case 4:return n.appMetadata&&(h=n.appMetadata.familyId===y.nh?y.nh:y.oT.EMPTY_STRING),D=(null==r?void 0:r.claims.oid)||(null==r?void 0:r.claims.sub)||y.oT.EMPTY_STRING,I=(null==r?void 0:r.claims.tid)||y.oT.EMPTY_STRING,[2,{authority:t.canonicalAuthority,uniqueId:D,tenantId:I,scopes:p,account:n.account?n.account.getAccountInfo():null,idToken:r?r.rawToken:y.oT.EMPTY_STRING,idTokenClaims:r?r.claims:{},accessToken:f,fromCache:a,expiresOn:m,correlationId:i.correlationId,requestId:c||y.oT.EMPTY_STRING,extExpiresOn:_,familyId:h,tokenType:(null===(d=n.accessToken)||void 0===d?void 0:d.tokenType)||y.oT.EMPTY_STRING,state:o?o.userRequestState:y.oT.EMPTY_STRING,cloudGraphHostName:(null===(l=n.account)||void 0===l?void 0:l.cloudGraphHostName)||y.oT.EMPTY_STRING,msGraphHost:(null===(u=n.account)||void 0===u?void 0:u.msGraphHost)||y.oT.EMPTY_STRING,code:s,fromNativeBroker:!1}]}})})},e}(),it=function(e){function t(t){var n=e.call(this,t)||this;return n.includeRedirectUri=!0,n}return(0,E.XT)(t,e),t.prototype.getAuthCodeUrl=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t;return(0,E.Uh)(this,function(n){switch(n.label){case 0:return[4,this.createAuthCodeUrlQueryString(e)];case 1:return t=n.sent(),[2,Ee.appendQueryString(this.authority.authorizationEndpoint,t)]}})})},t.prototype.acquireToken=function(e,t){var n;return(0,E.fG)(this,void 0,void 0,function(){var a,i,r,o;return(0,E.Uh)(this,function(s){switch(s.label){case 0:if(this.logger.info("in acquireToken call"),!e||H.x.isEmpty(e.code))throw ie.e.createTokenRequestCannotBeMadeError();return a=he.nowSeconds(),[4,this.executeTokenRequest(this.authority,e)];case 1:return i=s.sent(),r=null===(n=i.headers)||void 0===n?void 0:n[y.GZ.X_MS_REQUEST_ID],(o=new at(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin)).validateTokenResponse(i.body),[4,o.handleServerTokenResponse(i.body,this.authority,a,e,t,void 0,void 0,void 0,r)];case 2:return[2,s.sent()]}})})},t.prototype.handleFragmentResponse=function(e,t){var n=new at(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null),a=new Ee(e),i=Ee.getDeserializedHash(a.getHash());if(n.validateServerAuthorizationCodeResponse(i,t,this.cryptoUtils),!i.code)throw ie.e.createNoAuthCodeInServerResponseError();return(0,E._i)((0,E._i)({},i),{code:i.code})},t.prototype.getLogoutUri=function(e){if(!e)throw le.createEmptyLogoutRequestError();var t=this.createLogoutUrlQueryString(e);return Ee.appendQueryString(this.authority.endSessionEndpoint,t)},t.prototype.executeTokenRequest=function(e,t){return(0,E.fG)(this,void 0,void 0,function(){var n,a,i,r,o,s,c;return(0,E.Uh)(this,function(d){switch(d.label){case 0:return n={clientId:this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid},[4,this.createTokenRequestBody(t)];case 1:if(a=d.sent(),i=this.createTokenQueryParameters(t),r=void 0,t.clientInfo)try{o=re(t.clientInfo,this.cryptoUtils),r={credential:""+o.uid+y.wv.CLIENT_INFO_SEPARATOR+o.utid,type:se.HOME_ACCOUNT_ID}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}return s=this.createTokenRequestHeaders(r||t.ccsCredential),c=H.x.isEmpty(i)?e.tokenEndpoint:e.tokenEndpoint+"?"+i,[2,this.executePostToTokenEndpoint(c,a,s,n)]}})})},t.prototype.createTokenQueryParameters=function(e){var t=new $e;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()},t.prototype.createTokenRequestBody=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t,n,a,i,r,o,s;return(0,E.Uh)(this,function(c){switch(c.label){case 0:return(t=new $e).addClientId(this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):Ze.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion&&(n=this.config.clientCredentials.clientAssertion,t.addClientAssertion(n.assertion),t.addClientAssertionType(n.assertionType)),t.addGrantType(y.hJ.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme!==y.sO.POP?[3,2]:[4,new tt(this.cryptoUtils).generateCnf(e)];case 1:return a=c.sent(),t.addPopToken(a.reqCnfString),[3,3];case 2:if(e.authenticationScheme===y.sO.SSH){if(!e.sshJwk)throw le.createMissingSshJwkError();t.addSshJwk(e.sshJwk)}c.label=3;case 3:if(i=e.correlationId||this.config.cryptoInterface.createNewGuid(),t.addCorrelationId(i),(!H.x.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),r=void 0,e.clientInfo)try{o=re(e.clientInfo,this.cryptoUtils),r={credential:""+o.uid+y.wv.CLIENT_INFO_SEPARATOR+o.utid,type:se.HOME_ACCOUNT_ID}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}else r=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&r)switch(r.type){case se.HOME_ACCOUNT_ID:try{o=oe(r.credential),t.addCcsOid(o)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case se.UPN:t.addCcsUpn(r.credential)}return e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[y.ko.RETURN_SPA_CODE]||t.addExtraQueryParameters(((s={})[y.ko.RETURN_SPA_CODE]="1",s)),[2,t.createQueryString()]}})})},t.prototype.createAuthCodeUrlQueryString=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t,n,a,i,r,o,s;return(0,E.Uh)(this,function(c){switch(c.label){case 0:if((t=new $e).addClientId(this.config.authOptions.clientId),n=(0,E._r)(e.scopes||[],e.extraScopesToConsent||[]),t.addScopes(n),t.addRedirectUri(e.redirectUri),a=e.correlationId||this.config.cryptoInterface.createNewGuid(),t.addCorrelationId(a),t.addResponseMode(e.responseMode),t.addResponseTypeCode(),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&t.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&t.addPrompt(e.prompt),e.domainHint&&t.addDomainHint(e.domainHint),e.prompt!==y.NJ.SELECT_ACCOUNT)if(e.sid&&e.prompt===y.NJ.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),t.addSid(e.sid);else if(e.account){if(i=this.extractAccountSid(e.account),r=this.extractLoginHint(e.account)){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),t.addLoginHint(r);try{o=oe(e.account.homeAccountId),t.addCcsOid(o)}catch(e){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(i&&e.prompt===y.NJ.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),t.addSid(i);try{o=oe(e.account.homeAccountId),t.addCcsOid(o)}catch(e){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),t.addLoginHint(e.account.username);try{o=oe(e.account.homeAccountId),t.addCcsOid(o)}catch(e){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return e.nonce&&t.addNonce(e.nonce),e.state&&t.addState(e.state),(!H.x.isEmpty(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),e.nativeBroker?(t.addNativeBroker(),e.authenticationScheme!==y.sO.POP?[3,2]:[4,new tt(this.cryptoUtils).generateCnf(e)]):[3,2];case 1:s=c.sent(),t.addPopToken(s.reqCnfHash),c.label=2;case 2:return[2,t.createQueryString()]}})})},t.prototype.createLogoutUrlQueryString=function(e){var t=new $e;return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),t.createQueryString()},t.prototype.extractAccountSid=function(e){var t;return(null===(t=e.idTokenClaims)||void 0===t?void 0:t.sid)||null},t.prototype.extractLoginHint=function(e){var t;return(null===(t=e.idTokenClaims)||void 0===t?void 0:t.login_hint)||null},t}(Xe);function rt(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}var ot,st={"https://login.microsoftonline.com/common/":{token_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/common/":{token_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/common/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/common/":{token_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/consumers/":{token_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/consumers/":{token_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/consumers/":{token_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/organizations/":{token_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/organizations/":{token_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/organizations/":{token_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"}},ct={"https://login.microsoftonline.com/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/common/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/consumers/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/organizations/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},dt=function(){function e(e){this.networkInterface=e}return e.prototype.detectRegion=function(t,n,a){return(0,E.fG)(this,void 0,void 0,function(){var i,r,o,s,c;return(0,E.Uh)(this,function(d){switch(d.label){case 0:if(i=t)return[3,8];r=e.IMDS_OPTIONS,a&&(r.proxyUrl=a),d.label=1;case 1:return d.trys.push([1,6,,7]),[4,this.getRegionFromIMDS(y.oT.IMDS_VERSION,r)];case 2:return(o=d.sent()).status===y.JY.httpSuccess&&(i=o.body,n.region_source=y.W.IMDS),o.status!==y.JY.httpBadRequest?[3,5]:[4,this.getCurrentVersion(r)];case 3:return(s=d.sent())?[4,this.getRegionFromIMDS(s,r)]:(n.region_source=y.W.FAILED_AUTO_DETECTION,[2,null]);case 4:(c=d.sent()).status===y.JY.httpSuccess&&(i=c.body,n.region_source=y.W.IMDS),d.label=5;case 5:return[3,7];case 6:return d.sent(),n.region_source=y.W.FAILED_AUTO_DETECTION,[2,null];case 7:return[3,9];case 8:n.region_source=y.W.ENVIRONMENT_VARIABLE,d.label=9;case 9:return i||(n.region_source=y.W.FAILED_AUTO_DETECTION),[2,i||null]}})})},e.prototype.getRegionFromIMDS=function(e,t){return(0,E.fG)(this,void 0,void 0,function(){return(0,E.Uh)(this,function(n){return[2,this.networkInterface.sendGetRequestAsync(y.oT.IMDS_ENDPOINT+"?api-version="+e+"&format=text",t,y.oT.IMDS_TIMEOUT)]})})},e.prototype.getCurrentVersion=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t;return(0,E.Uh)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.networkInterface.sendGetRequestAsync(y.oT.IMDS_ENDPOINT+"?format=json",e)];case 1:return(t=n.sent()).status===y.JY.httpBadRequest&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?[2,t.body["newest-versions"][0]]:[2,null];case 2:return n.sent(),[2,null];case 3:return[2]}})})},e.IMDS_OPTIONS={headers:{Metadata:"true"}},e}(),lt=function(){function e(e,t,n,a,i){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=a,this.regionDiscovery=new dt(t),this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.proxyUrl=i||y.oT.EMPTY_STRING}return Object.defineProperty(e.prototype,"authorityType",{get:function(){var e=this.canonicalAuthorityUrlComponents.PathSegments;if(e.length)switch(e[0].toLowerCase()){case y.oT.ADFS:return Y.Adfs;case y.oT.DSTS:return Y.Dsts}return Y.Default},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"protocolMode",{get:function(){return this.authorityOptions.protocolMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.authorityOptions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canonicalAuthority",{get:function(){return this._canonicalAuthority.urlString},set:function(e){this._canonicalAuthority=new Ee(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canonicalAuthorityUrlComponents",{get:function(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hostnameAndPort",{get:function(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tenant",{get:function(){return this.canonicalAuthorityUrlComponents.PathSegments[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"authorizationEndpoint",{get:function(){if(this.discoveryComplete()){var e=this.replacePath(this.metadata.authorization_endpoint);return this.replaceTenant(e)}throw ie.e.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenEndpoint",{get:function(){if(this.discoveryComplete()){var e=this.replacePath(this.metadata.token_endpoint);return this.replaceTenant(e)}throw ie.e.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceCodeEndpoint",{get:function(){if(this.discoveryComplete()){var e=this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));return this.replaceTenant(e)}throw ie.e.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endSessionEndpoint",{get:function(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw ie.e.createLogoutNotSupportedError();var e=this.replacePath(this.metadata.end_session_endpoint);return this.replaceTenant(e)}throw ie.e.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selfSignedJwtAudience",{get:function(){if(this.discoveryComplete()){var e=this.replacePath(this.metadata.issuer);return this.replaceTenant(e)}throw ie.e.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"jwksUri",{get:function(){if(this.discoveryComplete()){var e=this.replacePath(this.metadata.jwks_uri);return this.replaceTenant(e)}throw ie.e.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),e.prototype.replaceTenant=function(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)},e.prototype.replacePath=function(e){var t=e,n=new Ee(this.metadata.canonical_authority).getUrlComponents().PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach(function(e,a){var i=n[a];e!==i&&(t=t.replace("/"+i+"/","/"+e+"/"))}),t},Object.defineProperty(e.prototype,"defaultOpenIdConfigurationEndpoint",{get:function(){return this.authorityType===Y.Adfs||this.authorityType===Y.Dsts||this.protocolMode===xe.OIDC?this.canonicalAuthority+".well-known/openid-configuration":this.canonicalAuthority+"v2.0/.well-known/openid-configuration"},enumerable:!1,configurable:!0}),e.prototype.discoveryComplete=function(){return!!this.metadata},e.prototype.resolveEndpointsAsync=function(){return(0,E.fG)(this,void 0,void 0,function(){var e,t,n,a;return(0,E.Uh)(this,function(i){switch(i.label){case 0:return(e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort))||(e=new Se).updateCanonicalAuthority(this.canonicalAuthority),[4,this.updateCloudDiscoveryMetadata(e)];case 1:return t=i.sent(),this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network),[4,this.updateEndpointMetadata(e)];case 2:return n=i.sent(),t!==y._Q.CACHE&&n!==y._Q.CACHE&&(e.resetExpiresAt(),e.updateCanonicalAuthority(this.canonicalAuthority)),a=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache),this.cacheManager.setAuthorityMetadata(a,e),this.metadata=e,[2]}})})},e.prototype.updateEndpointMetadata=function(e){var t,n;return(0,E.fG)(this,void 0,void 0,function(){var a,i;return(0,E.Uh)(this,function(r){switch(r.label){case 0:return(a=this.getEndpointMetadataFromConfig())?(e.updateEndpointMetadata(a,!1),[2,y._Q.CONFIG]):this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!e.isExpired()?[2,y._Q.CACHE]:(i=this.getEndpointMetadataFromHardcodedValues(),[4,this.getEndpointMetadataFromNetwork()]);case 1:return(a=r.sent())?(null===(t=this.authorityOptions.azureRegionConfiguration)||void 0===t?void 0:t.azureRegion)?[4,this.updateMetadataWithRegionalInformation(a)]:[3,3]:[3,4];case 2:a=r.sent(),r.label=3;case 3:return e.updateEndpointMetadata(a,!0),[2,y._Q.NETWORK];case 4:return!i||this.authorityOptions.skipAuthorityMetadataCache?[3,7]:(null===(n=this.authorityOptions.azureRegionConfiguration)||void 0===n?void 0:n.azureRegion)?[4,this.updateMetadataWithRegionalInformation(i)]:[3,6];case 5:i=r.sent(),r.label=6;case 6:return e.updateEndpointMetadata(i,!1),[2,y._Q.HARDCODED_VALUES];case 7:throw ie.e.createUnableToGetOpenidConfigError(this.defaultOpenIdConfigurationEndpoint)}})})},e.prototype.isAuthoritySameType=function(e){return new Ee(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length},e.prototype.getEndpointMetadataFromConfig=function(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw le.createInvalidAuthorityMetadataError()}return null},e.prototype.getEndpointMetadataFromNetwork=function(){return(0,E.fG)(this,void 0,void 0,function(){var e,t;return(0,E.Uh)(this,function(n){switch(n.label){case 0:e={},this.proxyUrl&&(e.proxyUrl=this.proxyUrl),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(this.defaultOpenIdConfigurationEndpoint,e)];case 2:return[2,rt((t=n.sent()).body)?t.body:null];case 3:return n.sent(),[2,null];case 4:return[2]}})})},e.prototype.getEndpointMetadataFromHardcodedValues=function(){return this.canonicalAuthority in st?st[this.canonicalAuthority]:null},e.prototype.updateMetadataWithRegionalInformation=function(t){var n,a,i,r,o;return(0,E.fG)(this,void 0,void 0,function(){var s,c;return(0,E.Uh)(this,function(d){switch(d.label){case 0:return[4,this.regionDiscovery.detectRegion(null===(n=this.authorityOptions.azureRegionConfiguration)||void 0===n?void 0:n.environmentRegion,this.regionDiscoveryMetadata,this.proxyUrl)];case 1:return s=d.sent(),c=(null===(a=this.authorityOptions.azureRegionConfiguration)||void 0===a?void 0:a.azureRegion)===y.oT.AZURE_REGION_AUTO_DISCOVER_FLAG?s:null===(i=this.authorityOptions.azureRegionConfiguration)||void 0===i?void 0:i.azureRegion,(null===(r=this.authorityOptions.azureRegionConfiguration)||void 0===r?void 0:r.azureRegion)===y.oT.AZURE_REGION_AUTO_DISCOVER_FLAG?this.regionDiscoveryMetadata.region_outcome=s?y.li.AUTO_DETECTION_REQUESTED_SUCCESSFUL:y.li.AUTO_DETECTION_REQUESTED_FAILED:this.regionDiscoveryMetadata.region_outcome=s?(null===(o=this.authorityOptions.azureRegionConfiguration)||void 0===o?void 0:o.azureRegion)===s?y.li.CONFIGURED_MATCHES_DETECTED:y.li.CONFIGURED_NOT_DETECTED:y.li.CONFIGURED_NO_AUTO_DETECTION,c?(this.regionDiscoveryMetadata.region_used=c,[2,e.replaceWithRegionalInformation(t,c)]):[2,t]}})})},e.prototype.updateCloudDiscoveryMetadata=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t,n;return(0,E.Uh)(this,function(a){switch(a.label){case 0:return(t=this.getCloudDiscoveryMetadataFromConfig())?(e.updateCloudDiscoveryMetadata(t,!1),[2,y._Q.CONFIG]):this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!e.isExpired()?[2,y._Q.CACHE]:(n=this.getCloudDiscoveryMetadataFromHarcodedValues(),[4,this.getCloudDiscoveryMetadataFromNetwork()]);case 1:if(t=a.sent())return e.updateCloudDiscoveryMetadata(t,!0),[2,y._Q.NETWORK];if(n&&!this.options.skipAuthorityMetadataCache)return e.updateCloudDiscoveryMetadata(n,!1),[2,y._Q.HARDCODED_VALUES];throw le.createUntrustedAuthorityError()}})})},e.prototype.getCloudDiscoveryMetadataFromConfig=function(){if(this.authorityOptions.cloudDiscoveryMetadata)try{var t=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),n=e.getCloudDiscoveryMetadataFromNetworkResponse(t.metadata,this.hostnameAndPort);if(n)return n}catch(e){throw le.createInvalidCloudDiscoveryMetadataError()}return this.isInKnownAuthorities()?e.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort):null},e.prototype.getCloudDiscoveryMetadataFromNetwork=function(){return(0,E.fG)(this,void 0,void 0,function(){var t,n,a,i,r;return(0,E.Uh)(this,function(o){switch(o.label){case 0:t=""+y.oT.AAD_INSTANCE_DISCOVERY_ENDPT+this.canonicalAuthority+"oauth2/v2.0/authorize",n={},this.proxyUrl&&(n.proxyUrl=this.proxyUrl),a=null,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(t,n)];case 2:return i=o.sent(),r=function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(i.body)?i.body.metadata:[],0===r.length?[2,null]:(a=e.getCloudDiscoveryMetadataFromNetworkResponse(r,this.hostnameAndPort),[3,4]);case 3:return o.sent(),[2,null];case 4:return a||(a=e.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),[2,a]}})})},e.prototype.getCloudDiscoveryMetadataFromHarcodedValues=function(){return this.canonicalAuthority in ct?ct[this.canonicalAuthority]:null},e.prototype.isInKnownAuthorities=function(){var e=this;return this.authorityOptions.knownAuthorities.filter(function(t){return Ee.getDomainFromUrl(t).toLowerCase()===e.hostnameAndPort}).length>0},e.generateAuthority=function(e,t){var n;if(t&&t.azureCloudInstance!==Ce.None){var a=t.tenant?t.tenant:y.oT.DEFAULT_COMMON_TENANT;n=t.azureCloudInstance+"/"+a+"/"}return n||e},e.createCloudDiscoveryMetadataFromHost=function(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}},e.getCloudDiscoveryMetadataFromNetworkResponse=function(e,t){for(var n=0;n<e.length;n++){var a=e[n];if(a.aliases.indexOf(t)>-1)return a}return null},e.prototype.getPreferredCache=function(){if(this.discoveryComplete())return this.metadata.preferred_cache;throw ie.e.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},e.prototype.isAlias=function(e){return this.metadata.aliases.indexOf(e)>-1},e.isPublicCloudAuthority=function(e){return y.oT.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0},e.buildRegionalAuthorityString=function(e,t,n){var a=new Ee(e);a.validateAsUri();var i=a.getUrlComponents(),r=t+"."+i.HostNameAndPort;this.isPublicCloudAuthority(i.HostNameAndPort)&&(r=t+"."+y.oT.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX);var o=Ee.constructAuthorityUriFromObject((0,E._i)((0,E._i)({},a.getUrlComponents()),{HostNameAndPort:r})).urlString;return n?o+"?"+n:o},e.replaceWithRegionalInformation=function(t,n){return t.authorization_endpoint=e.buildRegionalAuthorityString(t.authorization_endpoint,n),t.token_endpoint=e.buildRegionalAuthorityString(t.token_endpoint,n,y.oT.REGIONAL_AUTH_NON_MSI_QUERY_STRING),t.end_session_endpoint&&(t.end_session_endpoint=e.buildRegionalAuthorityString(t.end_session_endpoint,n)),t},e}(),ut=function(){function e(){}return e.createDiscoveredInstance=function(t,n,a,i,r){return(0,E.fG)(this,void 0,void 0,function(){var o,s;return(0,E.Uh)(this,function(c){switch(c.label){case 0:o=e.createInstance(t,n,a,i,r),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,o.resolveEndpointsAsync()];case 2:return c.sent(),[2,o];case 3:throw s=c.sent(),ie.e.createEndpointDiscoveryIncompleteError(s);case 4:return[2]}})})},e.createInstance=function(e,t,n,a,i){if(H.x.isEmpty(e))throw le.createUrlEmptyError();return new lt(e,t,n,a,i)},e}(),ft=function(){function e(e,t){this.cacheOutcome=y.Ko.NO_CACHE_HIT,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||y.oT.EMPTY_STRING,this.wrapperVer=e.wrapperVer||y.oT.EMPTY_STRING,this.telemetryCacheKey=y.PN.CACHE_KEY+y.wv.CACHE_KEY_SEPARATOR+e.clientId}return e.prototype.generateCurrentRequestHeaderValue=function(){var e=""+this.apiId+y.PN.VALUE_SEPARATOR+this.cacheOutcome,t=[this.wrapperSKU,this.wrapperVer].join(y.PN.VALUE_SEPARATOR),n=[e,this.getRegionDiscoveryFields()].join(y.PN.VALUE_SEPARATOR);return[y.PN.SCHEMA_VERSION,n,t].join(y.PN.CATEGORY_SEPARATOR)},e.prototype.generateLastRequestHeaderValue=function(){var t=this.getLastRequests(),n=e.maxErrorsToSend(t),a=t.failedRequests.slice(0,2*n).join(y.PN.VALUE_SEPARATOR),i=t.errors.slice(0,n).join(y.PN.VALUE_SEPARATOR),r=t.errors.length,o=[r,n<r?y.PN.OVERFLOW_TRUE:y.PN.OVERFLOW_FALSE].join(y.PN.VALUE_SEPARATOR);return[y.PN.SCHEMA_VERSION,t.cacheHits,a,i,o].join(y.PN.CATEGORY_SEPARATOR)},e.prototype.cacheFailedRequest=function(e){var t=this.getLastRequests();t.errors.length>=y.PN.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),H.x.isEmpty(e.subError)?H.x.isEmpty(e.errorCode)?e&&e.toString()?t.errors.push(e.toString()):t.errors.push(y.PN.UNKNOWN_ERROR):t.errors.push(e.errorCode):t.errors.push(e.subError),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)},e.prototype.incrementCacheHits=function(){var e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits},e.prototype.getLastRequests=function(){var e=new ye;return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e},e.prototype.clearTelemetryCache=function(){var t=this.getLastRequests(),n=e.maxErrorsToSend(t);if(n===t.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey);else{var a=new ye;a.failedRequests=t.failedRequests.slice(2*n),a.errors=t.errors.slice(n),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,a)}},e.maxErrorsToSend=function(e){var t,n=0,a=0,i=e.errors.length;for(t=0;t<i;t++){var r=e.failedRequests[2*t]||y.oT.EMPTY_STRING,o=e.failedRequests[2*t+1]||y.oT.EMPTY_STRING,s=e.errors[t]||y.oT.EMPTY_STRING;if(!((a+=r.toString().length+o.toString().length+s.length+3)<y.PN.MAX_LAST_HEADER_BYTES))break;n+=1}return n},e.prototype.getRegionDiscoveryFields=function(){var e=[];return e.push(this.regionUsed||y.oT.EMPTY_STRING),e.push(this.regionSource||y.oT.EMPTY_STRING),e.push(this.regionOutcome||y.oT.EMPTY_STRING),e.join(",")},e.prototype.updateRegionDiscoveryMetadata=function(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome},e.prototype.setCacheOutcome=function(e){this.cacheOutcome=e},e}(),pt=function(){function e(e,t,n,a,i,r,o,s,c){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=i,this.navigationClient=r,this.nativeMessageHandler=s,this.correlationId=c||this.browserCrypto.createNewGuid(),this.logger=a.clone(S,We,this.correlationId),this.performanceClient=o}return e.prototype.clearCacheOnLogout=function(e){return c(this,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:if(!e)return[3,5];ce.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null)),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.browserStorage.removeAccount(ce.generateAccountCacheKey(e))];case 2:return t.sent(),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request."),[3,4];case 3:return t.sent(),this.logger.error("Account provided in logout request was not found. Local cache unchanged."),[3,4];case 4:return[3,9];case 5:return t.trys.push([5,8,,9]),this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),[4,this.browserStorage.clear()];case 6:return t.sent(),[4,this.browserCrypto.clearKeystore()];case 7:return t.sent(),[3,9];case 8:return t.sent(),this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged."),[3,9];case 9:return[2]}})})},e.prototype.initializeBaseRequest=function(e){return c(this,void 0,void 0,function(){var t,n,a,i;return d(this,function(r){switch(r.label){case 0:if(this.logger.verbose("Initializing BaseAuthRequest"),t=e.authority||this.config.auth.authority,n=u(e&&e.scopes||[]),(a=s(s({},e),{correlationId:this.correlationId,authority:t,scopes:n})).authenticationScheme){if(a.authenticationScheme===y.sO.SSH){if(!e.sshJwk)throw le.createMissingSshJwkError();if(!e.sshKid)throw le.createMissingSshKidError()}this.logger.verbose('Authentication Scheme set to "'+a.authenticationScheme+'" as configured in Auth request')}else a.authenticationScheme=y.sO.BEARER,this.logger.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return!e.claims||H.x.isEmpty(e.claims)?[3,2]:(i=a,[4,this.browserCrypto.hashString(e.claims)]);case 1:i.requestedClaimsHash=r.sent(),r.label=2;case 2:return[2,a]}})})},e.prototype.getRedirectUri=function(e){this.logger.verbose("getRedirectUri called");var t=e||this.config.auth.redirectUri||ze.getCurrentUri();return Ee.getAbsoluteUrl(t,ze.getCurrentUri())},e.prototype.initializeServerTelemetryManager=function(e,t){this.logger.verbose("initializeServerTelemetryManager called");var n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new ft(n,this.browserStorage)},e.prototype.getDiscoveredAuthority=function(e){return c(this,void 0,void 0,function(){var t;return d(this,function(n){switch(n.label){case 0:return this.logger.verbose("getDiscoveredAuthority called"),t={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata},e?(this.logger.verbose("Creating discovered authority with request authority"),[4,ut.createDiscoveredInstance(e,this.config.system.networkClient,this.browserStorage,t)]):[3,2];case 1:case 3:return[2,n.sent()];case 2:return this.logger.verbose("Creating discovered authority with configured authority"),[4,ut.createDiscoveredInstance(this.config.auth.authority,this.config.system.networkClient,this.browserStorage,t)]}})})},e}(),mt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initializeAuthorizationCodeRequest=function(e){return c(this,void 0,void 0,function(){var t,n;return d(this,function(a){switch(a.label){case 0:return this.logger.verbose("initializeAuthorizationRequest called",e.correlationId),[4,this.browserCrypto.generatePkceCodes()];case 1:return t=a.sent(),n=s(s({},e),{redirectUri:e.redirectUri,code:y.oT.EMPTY_STRING,codeVerifier:t.verifier}),e.codeChallenge=t.challenge,e.codeChallengeMethod=y.oT.S256_CODE_CHALLENGE_METHOD,[2,n]}})})},t.prototype.initializeLogoutRequest=function(e){this.logger.verbose("initializeLogoutRequest called",null==e?void 0:e.correlationId);var t=s({correlationId:this.correlationId||this.browserCrypto.createNewGuid()},e);if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){var n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=Ee.getAbsoluteUrl(e.postLogoutRedirectUri,ze.getCurrentUri())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=Ee.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,ze.getCurrentUri())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=Ee.getAbsoluteUrl(ze.getCurrentUri(),ze.getCurrentUri())),t},t.prototype.getLogoutHintFromIdTokenClaims=function(e){var t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null},t.prototype.createAuthCodeClient=function(e,t,n){return c(this,void 0,void 0,function(){var a;return d(this,function(i){switch(i.label){case 0:return[4,this.getClientConfiguration(e,t,n)];case 1:return a=i.sent(),[2,new it(a)]}})})},t.prototype.getClientConfiguration=function(e,t,n){return c(this,void 0,void 0,function(){var a;return d(this,function(i){switch(i.label){case 0:return this.logger.verbose("getClientConfiguration called",this.correlationId),[4,this.getDiscoveredAuthority(t,n)];case 1:return a=i.sent(),[2,{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:this.config.system.loggerOptions.loggerCallback,piiLoggingEnabled:this.config.system.loggerOptions.piiLoggingEnabled,logLevel:this.config.system.loggerOptions.logLevel,correlationId:this.correlationId},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:e,libraryInfo:{sku:S,version:We,cpu:y.oT.EMPTY_STRING,os:y.oT.EMPTY_STRING},telemetry:this.config.telemetry}]}})})},t.prototype.validateAndExtractStateFromHash=function(e,t,n){if(this.logger.verbose("validateAndExtractStateFromHash called",n),!e.state)throw j.createHashDoesNotContainStateError();var a=Ae.extractBrowserRequestState(this.browserCrypto,e.state);if(!a)throw j.createUnableToParseStateError();if(a.interactionType!==t)throw j.createStateInteractionTypeMismatchError();return this.logger.verbose("Returning state from hash",n),e.state},t.prototype.getDiscoveredAuthority=function(e,t){return c(this,void 0,void 0,function(){var n,a,i,o;return d(this,function(s){switch(s.label){case 0:return this.logger.verbose("getDiscoveredAuthority called",this.correlationId),n=this.performanceClient.startMeasurement(r.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},i=e||this.config.auth.authority,o=lt.generateAuthority(i,t||this.config.auth.azureCloudOptions),this.logger.verbose("Creating discovered authority with configured authority",this.correlationId),[4,ut.createDiscoveredInstance(o,this.config.system.networkClient,this.browserStorage,a).then(function(e){return n.endMeasurement({success:!0}),e}).catch(function(e){throw n.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})];case 1:return[2,s.sent()]}})})},t.prototype.initializeAuthorizationRequest=function(e,t){return c(this,void 0,void 0,function(){var n,a,i,r,o,c,l;return d(this,function(d){switch(d.label){case 0:return this.logger.verbose("initializeAuthorizationRequest called",this.correlationId),n=this.getRedirectUri(e.redirectUri),a={interactionType:t},i=Ie.setRequestState(this.browserCrypto,e&&e.state||y.oT.EMPTY_STRING,a),o=[{}],[4,this.initializeBaseRequest(e)];case 1:return r=s.apply(void 0,[s.apply(void 0,o.concat([d.sent()])),{redirectUri:n,state:i,nonce:e.nonce||this.browserCrypto.createNewGuid(),responseMode:y.Sw.FRAGMENT}]),(c=e.account||this.browserStorage.getActiveAccount())&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii("Setting validated request account: "+c.homeAccountId,this.correlationId),r.account=c),H.x.isEmpty(r.loginHint)&&!c&&(l=this.browserStorage.getLegacyLoginHint())&&(r.loginHint=l),[2,r]}})})},t}(pt);!function(e){e.USER_INTERACTION_REQUIRED="USER_INTERACTION_REQUIRED",e.USER_CANCEL="USER_CANCEL",e.NO_NETWORK="NO_NETWORK",e.TRANSIENT_ERROR="TRANSIENT_ERROR",e.PERSISTENT_ERROR="PERSISTENT_ERROR",e.DISABLED="DISABLED",e.ACCOUNT_UNAVAILABLE="ACCOUNT_UNAVAILABLE"}(ot||(ot={}));var _t=function(e){function t(n,a,i){var r=e.call(this,n,a)||this;return Object.setPrototypeOf(r,t.prototype),r.name="NativeAuthError",r.ext=i,r}return i(t,e),t.prototype.isFatal=function(){return!(!this.ext||!this.ext.status||this.ext.status!==ot.PERSISTENT_ERROR&&this.ext.status!==ot.DISABLED)||"ContentError"===this.errorCode},t.createError=function(e,n,a){if(a&&a.status)switch(a.status){case ot.ACCOUNT_UNAVAILABLE:return ne.Jo.createNativeAccountUnavailableError();case ot.USER_INTERACTION_REQUIRED:return new ne.Jo(e,n);case ot.USER_CANCEL:return j.createUserCancelledError();case ot.NO_NETWORK:return j.createNoNetworkConnectivityError()}return new t(e,n,a)},t.createUserSwitchError=function(){return new t("user_switch","User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again.")},t.createTokensNotFoundInCacheError=function(){return new t("tokens_not_found_in_internal_memory_cache","Tokens not cached in MSAL JS internal memory, please make the WAM request")},t}(A.l),ht=function(e){function t(t,n){return e.call(this,t,n)||this}return(0,E.XT)(t,e),t.prototype.acquireToken=function(e){var t,n;return(0,E.fG)(this,void 0,void 0,function(){var a,i,o,s,c,d=this;return(0,E.Uh)(this,function(l){switch(l.label){case 0:return a=null===(t=this.performanceClient)||void 0===t?void 0:t.startMeasurement(r.RefreshTokenClientAcquireToken,e.correlationId),this.logger.verbose("RefreshTokenClientAcquireToken called",e.correlationId),i=he.nowSeconds(),[4,this.executeTokenRequest(e,this.authority)];case 1:return o=l.sent(),s=null===(n=o.headers)||void 0===n?void 0:n[y.GZ.X_MS_REQUEST_ID],(c=new at(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin)).validateTokenResponse(o.body),[2,c.handleServerTokenResponse(o.body,this.authority,i,e,void 0,void 0,!0,e.forceCache,s).then(function(e){var t;return null==a||a.endMeasurement({success:!0,refreshTokenSize:(null===(t=o.body.refresh_token)||void 0===t?void 0:t.length)||0}),e}).catch(function(t){throw d.logger.verbose("Error in fetching refresh token",e.correlationId),null==a||a.endMeasurement({errorCode:t.errorCode,subErrorCode:t.subError,success:!1,refreshTokenSize:void 0}),t})]}})})},t.prototype.acquireTokenByRefreshToken=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t,n;return(0,E.Uh)(this,function(a){if(!e)throw le.createEmptyTokenRequestError();if(!e.account)throw ie.e.createNoAccountInSilentRequestError();if(this.cacheManager.isAppMetadataFOCI(e.account.environment,this.config.authOptions.clientId))try{return[2,this.acquireTokenWithCachedRefreshToken(e,!0)]}catch(a){if(t=a instanceof ne.Jo&&a.errorCode===ne.Xy.noTokensFoundError.code,n=a instanceof ae&&a.errorCode===y.A1.INVALID_GRANT_ERROR&&a.subError===y.A1.CLIENT_MISMATCH_ERROR,t||n)return[2,this.acquireTokenWithCachedRefreshToken(e,!1)];throw a}return[2,this.acquireTokenWithCachedRefreshToken(e,!1)]})})},t.prototype.acquireTokenWithCachedRefreshToken=function(e,t){var n;return(0,E.fG)(this,void 0,void 0,function(){var a,i,o;return(0,E.Uh)(this,function(s){if(a=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement(r.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),this.logger.verbose("RefreshTokenClientAcquireTokenWithCachedRefreshToken called",e.correlationId),!(i=this.cacheManager.readRefreshTokenFromCache(this.config.authOptions.clientId,e.account,t)))throw null==a||a.discardMeasurement(),ne.Jo.createNoTokensFoundError();return null==a||a.endMeasurement({success:!0}),o=(0,E._i)((0,E._i)({},e),{refreshToken:i.secret,authenticationScheme:e.authenticationScheme||y.sO.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:se.HOME_ACCOUNT_ID}}),[2,this.acquireToken(o)]})})},t.prototype.executeTokenRequest=function(e,t){var n;return(0,E.fG)(this,void 0,void 0,function(){var a,i,o,s,c,d;return(0,E.Uh)(this,function(l){switch(l.label){case 0:return a=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement(r.RefreshTokenClientExecuteTokenRequest,e.correlationId),[4,this.createTokenRequestBody(e)];case 1:return i=l.sent(),o=this.createTokenQueryParameters(e),s=this.createTokenRequestHeaders(e.ccsCredential),c={clientId:this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid},d=Ee.appendQueryString(t.tokenEndpoint,o),[2,this.executePostToTokenEndpoint(d,i,s,c).then(function(e){return null==a||a.endMeasurement({success:!0}),e}).catch(function(e){throw null==a||a.endMeasurement({success:!1}),e})]}})})},t.prototype.createTokenQueryParameters=function(e){var t=new $e;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()},t.prototype.createTokenRequestBody=function(e){var t;return(0,E.fG)(this,void 0,void 0,function(){var n,a,i,o,s,c;return(0,E.Uh)(this,function(d){switch(d.label){case 0:return n=e.correlationId,a=null===(t=this.performanceClient)||void 0===t?void 0:t.startMeasurement(r.BaseClientCreateTokenRequestHeaders,n),(i=new $e).addClientId(this.config.authOptions.clientId),i.addScopes(e.scopes),i.addGrantType(y.hJ.REFRESH_TOKEN_GRANT),i.addClientInfo(),i.addLibraryInfo(this.config.libraryInfo),i.addApplicationTelemetry(this.config.telemetry.application),i.addThrottling(),this.serverTelemetryManager&&i.addServerTelemetry(this.serverTelemetryManager),i.addCorrelationId(n),i.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&i.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion&&(o=this.config.clientCredentials.clientAssertion,i.addClientAssertion(o.assertion),i.addClientAssertionType(o.assertionType)),e.authenticationScheme!==y.sO.POP?[3,2]:[4,new tt(this.cryptoUtils).generateCnf(e)];case 1:return s=d.sent(),i.addPopToken(s.reqCnfString),[3,3];case 2:if(e.authenticationScheme===y.sO.SSH){if(!e.sshJwk)throw null==a||a.endMeasurement({success:!1}),le.createMissingSshJwkError();i.addSshJwk(e.sshJwk)}d.label=3;case 3:if((!H.x.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&i.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case se.HOME_ACCOUNT_ID:try{c=oe(e.ccsCredential.credential),i.addCcsOid(c)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case se.UPN:i.addCcsUpn(e.ccsCredential.credential)}return null==a||a.endMeasurement({success:!0}),[2,i.createQueryString()]}})})},t}(Xe),bt=function(e){function t(t,n){return e.call(this,t,n)||this}return(0,E.XT)(t,e),t.prototype.acquireToken=function(e){return(0,E.fG)(this,void 0,void 0,function(){var t;return(0,E.Uh)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.acquireCachedToken(e)];case 1:return[2,n.sent()];case 2:if((t=n.sent())instanceof ie.e&&t.errorCode===ie.A.tokenRefreshRequired.code)return[2,new ht(this.config,this.performanceClient).acquireTokenByRefreshToken(e)];throw t;case 3:return[2]}})})},t.prototype.acquireCachedToken=function(e){var t,n,a,i;return(0,E.fG)(this,void 0,void 0,function(){var r,o;return(0,E.Uh)(this,function(s){switch(s.label){case 0:if(!e)throw le.createEmptyTokenRequestError();if(e.forceRefresh)throw null===(t=this.serverTelemetryManager)||void 0===t||t.setCacheOutcome(y.Ko.FORCE_REFRESH),this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because forceRefresh is true."),ie.e.createRefreshRequiredError();if(!e.account)throw ie.e.createNoAccountInSilentRequestError();if(r=e.authority||this.authority.getPreferredCache(),!(o=this.cacheManager.readCacheRecord(e.account,this.config.authOptions.clientId,e,r)).accessToken)throw null===(n=this.serverTelemetryManager)||void 0===n||n.setCacheOutcome(y.Ko.NO_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - No access token found in cache for the given properties."),ie.e.createRefreshRequiredError();if(he.wasClockTurnedBack(o.accessToken.cachedAt)||he.isTokenExpired(o.accessToken.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw null===(a=this.serverTelemetryManager)||void 0===a||a.setCacheOutcome(y.Ko.CACHED_ACCESS_TOKEN_EXPIRED),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token is expired or will expire within "+this.config.systemOptions.tokenRenewalOffsetSeconds+" seconds."),ie.e.createRefreshRequiredError();if(o.accessToken.refreshOn&&he.isTokenExpired(o.accessToken.refreshOn,0))throw null===(i=this.serverTelemetryManager)||void 0===i||i.setCacheOutcome(y.Ko.REFRESH_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'."),ie.e.createRefreshRequiredError();return this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[4,this.generateResultFromCacheRecord(o,e)];case 1:return[2,s.sent()]}})})},t.prototype.generateResultFromCacheRecord=function(e,t){return(0,E.fG)(this,void 0,void 0,function(){var n,a;return(0,E.Uh)(this,function(i){switch(i.label){case 0:if(e.idToken&&(n=new fe(e.idToken.secret,this.config.cryptoInterface)),t.maxAge||0===t.maxAge){if(!(a=null==n?void 0:n.claims.auth_time))throw ie.e.createAuthTimeNotFoundError();fe.checkMaxAge(a,t.maxAge)}return[4,at.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,n)];case 1:return[2,i.sent()]}})})},t}(Xe),gt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.acquireToken=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,o;return d(this,function(s){switch(s.label){case 0:return t=this.performanceClient.startMeasurement(r.SilentCacheClientAcquireToken,e.correlationId),n=this.initializeServerTelemetryManager(b.acquireTokenSilent_silentFlow),[4,this.createSilentFlowClient(n,e.authority,e.azureCloudOptions)];case 1:a=s.sent(),this.logger.verbose("Silent auth client created"),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,a.acquireCachedToken(e)];case 3:return i=s.sent(),t.endMeasurement({success:!0,fromCache:!0}),[2,i];case 4:throw(o=s.sent())instanceof j&&o.errorCode===N&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),t.endMeasurement({errorCode:o instanceof A.l&&o.errorCode||void 0,subErrorCode:o instanceof A.l&&o.subError||void 0,success:!1}),o;case 5:return[2]}})})},t.prototype.logout=function(){return Promise.reject(j.createSilentLogoutUnsupportedError())},t.prototype.createSilentFlowClient=function(e,t,n){return c(this,void 0,void 0,function(){var a;return d(this,function(i){switch(i.label){case 0:return[4,this.getClientConfiguration(e,t,n)];case 1:return a=i.sent(),[2,new bt(a,this.performanceClient)]}})})},t.prototype.initializeSilentRequest=function(e,t){return c(this,void 0,void 0,function(){var n;return d(this,function(a){switch(a.label){case 0:return n=[s({},e)],[4,this.initializeBaseRequest(e)];case 1:return[2,s.apply(void 0,[s.apply(void 0,n.concat([a.sent()])),{account:t,forceRefresh:e.forceRefresh||!1}])]}})})},t}(mt),vt=function(e){function t(t,n,a,i,r,o,s,c,d,l,u,f){var p=e.call(this,t,n,a,i,r,o,c,d,f)||this;return p.apiId=s,p.accountId=l,p.nativeMessageHandler=d,p.nativeStorageManager=u,p.silentCacheClient=new gt(t,p.nativeStorageManager,a,i,r,o,c,d,f),p}return i(t,e),t.prototype.acquireToken=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,o,s,c;return d(this,function(d){switch(d.label){case 0:return this.logger.trace("NativeInteractionClient - acquireToken called."),t=this.performanceClient.startMeasurement(r.NativeInteractionClientAcquireToken,e.correlationId),n=he.nowSeconds(),[4,this.initializeNativeRequest(e)];case 1:a=d.sent(),d.label=2;case 2:return d.trys.push([2,4,,5]),[4,this.acquireTokensFromCache(this.accountId,a)];case 3:return i=d.sent(),t.endMeasurement({success:!0,isNativeBroker:!0,fromCache:!0}),[2,i];case 4:return d.sent(),this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call"),[3,5];case 5:return o={method:f.GetToken,request:a},[4,this.nativeMessageHandler.sendMessage(o)];case 6:return s=d.sent(),c=this.validateNativeResponse(s),[2,this.handleNativeResponse(c,a,n).then(function(e){return t.endMeasurement({success:!0,isNativeBroker:!0}),e}).catch(function(e){throw t.endMeasurement({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e})]}})})},t.prototype.createSilentCacheRequest=function(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:ue.fromString(e.scope).asArray(),account:t,forceRefresh:!1}},t.prototype.acquireTokensFromCache=function(e,t){return c(this,void 0,void 0,function(){var n,a,i;return d(this,function(r){switch(r.label){case 0:if(!(n=this.browserStorage.readAccountFromCacheWithNativeAccountId(e)))throw ie.e.createNoAccountFoundError();a=n.getAccountInfo(),r.label=1;case 1:return r.trys.push([1,3,,4]),i=this.createSilentCacheRequest(t,a),[4,this.silentCacheClient.acquireToken(i)];case 2:return[2,r.sent()];case 3:throw r.sent();case 4:return[2]}})})},t.prototype.acquireTokenRedirect=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,r,o;return d(this,function(s){switch(s.label){case 0:return this.logger.trace("NativeInteractionClient - acquireTokenRedirect called."),[4,this.initializeNativeRequest(e)];case 1:t=s.sent(),n={method:f.GetToken,request:t},s.label=2;case 2:return s.trys.push([2,4,,5]),[4,this.nativeMessageHandler.sendMessage(n)];case 3:return a=s.sent(),this.validateNativeResponse(a),[3,5];case 4:if((i=s.sent())instanceof _t&&i.isFatal())throw i;return[3,5];case 5:return this.browserStorage.setTemporaryCache(_.NATIVE_REQUEST,JSON.stringify(t),!0),r={apiId:b.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},o=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri),[4,this.navigationClient.navigateExternal(o,r)];case 6:return s.sent(),[2]}})})},t.prototype.handleRedirectPromise=function(){return c(this,void 0,void 0,function(){var e,t,n,a,i,r;return d(this,function(o){switch(o.label){case 0:if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),[2,null];if(!(e=this.browserStorage.getCachedNativeRequest()))return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),[2,null];this.browserStorage.removeItem(this.browserStorage.generateCacheKey(_.NATIVE_REQUEST)),t={method:f.GetToken,request:e},n=he.nowSeconds(),o.label=1;case 1:return o.trys.push([1,3,,4]),this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker."),[4,this.nativeMessageHandler.sendMessage(t)];case 2:return a=o.sent(),this.validateNativeResponse(a),i=this.handleNativeResponse(a,e,n),this.browserStorage.setInteractionInProgress(!1),[2,i];case 3:throw r=o.sent(),this.browserStorage.setInteractionInProgress(!1),r;case 4:return[2]}})})},t.prototype.logout=function(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")},t.prototype.handleNativeResponse=function(e,t,n){return c(this,void 0,void 0,function(){var a,i,r,o,s,c,l,u,f,p,m,_,h,b,g,v,S,D,I,x=this;return d(this,function(d){switch(d.label){case 0:if(this.logger.trace("NativeInteractionClient - handleNativeResponse called."),e.account.id!==t.accountId)throw _t.createUserSwitchError();return a=new fe(e.id_token||y.oT.EMPTY_STRING,this.browserCrypto),[4,this.getDiscoveredAuthority(t.authority)];case 1:return i=d.sent(),r=i.getPreferredCache(),o=ce.generateHomeAccountId(e.client_info||y.oT.EMPTY_STRING,Y.Default,this.logger,this.browserCrypto,a),s=ce.createAccount(e.client_info,o,a,void 0,void 0,void 0,r,e.account.id),this.browserStorage.setAccount(s),c=e.scope?ue.fromString(e.scope):ue.fromString(t.scope),l=e.account.properties||{},u=l.UID||a.claims.oid||a.claims.sub||y.oT.EMPTY_STRING,f=l.TenantId||a.claims.tid||y.oT.EMPTY_STRING,m=y.sO.BEARER,t.tokenType===y.sO.POP?[3,2]:[3,4];case 2:if(m=y.sO.POP,e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),p=e.shr,[3,5];if(_=new tt(this.browserCrypto),h={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce},!t.keyId)throw ie.e.createKeyIdMissingError();return[4,_.signPopToken(e.access_token,t.keyId,h)];case 3:return p=d.sent(),[3,5];case 4:p=e.access_token,d.label=5;case 5:return b=this.getMATSFromResponse(e),g={authority:i.canonicalAuthority,uniqueId:u,tenantId:f,scopes:c.asArray(),account:s.getAccountInfo(),idToken:e.id_token,idTokenClaims:a.claims,accessToken:p,fromCache:!!b&&this.isResponseFromCache(b),expiresOn:new Date(1e3*Number(n+e.expires_in)),tokenType:m,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0},v=_e.createIdTokenEntity(o,t.authority,e.id_token||y.oT.EMPTY_STRING,t.clientId,a.claims.tid||y.oT.EMPTY_STRING),this.nativeStorageManager.setIdTokenCredential(v),S=m===y.sO.POP?y.oT.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,D=n+S,I=be.createAccessTokenEntity(o,t.authority,p,t.clientId,f,c.printScopes(),D,0,this.browserCrypto),this.nativeStorageManager.setAccessTokenCredential(I),this.browserStorage.removeAccountContext(s).catch(function(e){x.logger.error("Error occurred while removing account context from browser storage. "+e)}),[2,g]}})})},t.prototype.validateNativeResponse=function(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw _t.createUnexpectedError("Response missing expected properties.")},t.prototype.getMATSFromResponse=function(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch(e){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null},t.prototype.isResponseFromCache=function(e){return void 0===e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached},t.prototype.initializeNativeRequest=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,r,o,c,l,u,f=this;return d(this,function(d){switch(d.label){case 0:return this.logger.trace("NativeInteractionClient - initializeNativeRequest called"),t=e.authority||this.config.auth.authority,(n=new Ee(t)).validateAsUri(),a=e.scopes,i=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(n[a[i]]=e[a[i]])}return n}(e,["scopes"]),(r=new ue(a||[])).appendScopes(y.r_),o=function(){switch(f.apiId){case b.ssoSilent:case b.acquireTokenSilent_silentFlow:return f.logger.trace("initializeNativeRequest: silent request sets prompt to none"),y.NJ.NONE}if(e.prompt)switch(e.prompt){case y.NJ.NONE:case y.NJ.CONSENT:case y.NJ.LOGIN:return f.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw f.logger.trace("initializeNativeRequest: prompt = "+e.prompt+" is not compatible with native flow"),j.createNativePromptParameterNotSupportedError()}else f.logger.trace("initializeNativeRequest: prompt was not provided")},c=s(s({},i),{accountId:this.accountId,clientId:this.config.auth.clientId,authority:n.urlString,scope:r.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:o(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:s(s(s({},e.extraQueryParameters),e.tokenQueryParameters),{telemetry:"MATS"}),extendedExpiryToken:!1}),e.authenticationScheme!==y.sO.POP?[3,2]:(l={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},[4,new tt(this.browserCrypto).generateCnf(l)]);case 1:u=d.sent(),c.reqCnf=u.reqCnfHash,c.keyId=u.kid,d.label=2;case 2:return[2,c]}})})},t}(pt),yt=function(){function e(e,t,n){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=n,this.resolvers=new Map,this.handshakeResolvers=new Map,this.responseId=0,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this)}return e.prototype.sendMessage=function(e){return c(this,void 0,void 0,function(){var t,n=this;return d(this,function(a){return this.logger.trace("NativeMessageHandler - sendMessage called."),t={channel:D,extensionId:this.extensionId,responseId:this.responseId++,body:e},this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii("NativeMessageHandler - Sending request to browser extension: "+JSON.stringify(t)),this.messageChannel.port1.postMessage(t),[2,new Promise(function(e,a){n.resolvers.set(t.responseId,{resolve:e,reject:a})})]})})},e.createProvider=function(t,n){return c(this,void 0,void 0,function(){var a,i;return d(this,function(r){switch(r.label){case 0:t.trace("NativeMessageHandler - createProvider called."),r.label=1;case 1:return r.trys.push([1,3,,5]),[4,(a=new e(t,n,"ppnbnpeolgkicgegkbkbjmhlideopiji")).sendHandshakeRequest()];case 2:return r.sent(),[2,a];case 3:return r.sent(),[4,(i=new e(t,n)).sendHandshakeRequest()];case 4:return r.sent(),[2,i];case 5:return[2]}})})},e.prototype.sendHandshakeRequest=function(){return c(this,void 0,void 0,function(){var e,t=this;return d(this,function(n){return this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1),e={channel:D,extensionId:this.extensionId,responseId:this.responseId++,body:{method:f.HandshakeRequest}},this.messageChannel.port1.onmessage=function(e){t.onChannelMessage(e)},window.postMessage(e,window.origin,[this.messageChannel.port2]),[2,new Promise(function(n,a){t.handshakeResolvers.set(e.responseId,{resolve:n,reject:a}),t.timeoutId=window.setTimeout(function(){window.removeEventListener("message",t.windowListener,!1),t.messageChannel.port1.close(),t.messageChannel.port2.close(),a(j.createNativeHandshakeTimeoutError()),t.handshakeResolvers.delete(e.responseId)},t.handshakeTimeoutMs)})]})})},e.prototype.onWindowMessage=function(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source===window){var t=e.data;if(t.channel&&t.channel===D&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===f.HandshakeRequest){this.logger.verbose(t.extensionId?"Extension with id: "+t.extensionId+" not installed":"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1);var n=this.handshakeResolvers.get(t.responseId);n&&n.reject(j.createNativeExtensionNotInstalledError())}}},e.prototype.onChannelMessage=function(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");var t=e.data,n=this.resolvers.get(t.responseId),a=this.handshakeResolvers.get(t.responseId);try{var i=t.body.method;if(i===f.Response){if(!n)return;var r=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii("NativeMessageHandler - Received response from browser extension: "+JSON.stringify(r)),"Success"!==r.status)n.reject(_t.createError(r.code,r.description,r.ext));else{if(!r.result)throw A.l.createUnexpectedError("Event does not contain result.");r.result.code&&r.result.description?n.reject(_t.createError(r.result.code,r.result.description,r.result.ext)):n.resolve(r.result)}this.resolvers.delete(t.responseId)}else if(i===f.HandshakeResponse){if(!a)return;clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.logger.verbose("NativeMessageHandler - Received HandshakeResponse from extension: "+this.extensionId),a.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(t){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii("Error parsing response from WAM Extension: "+t.toString()),this.logger.errorPii("Unable to parse "+e),n?n.reject(t):a&&a.reject(t)}},e.isNativeAvailable=function(e,t,n,a){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!n)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(a)switch(a){case y.sO.BEARER:case y.sO.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0},e}(),St=function(){function e(e,t,n,a){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=a}return e.prototype.handleCodeResponseFromHash=function(e,t,n,a){return c(this,void 0,void 0,function(){var i,r,o;return d(this,function(s){if(this.logger.verbose("InteractionHandler.handleCodeResponse called"),H.x.isEmpty(e))throw j.createEmptyHashError(e);if(i=this.browserStorage.generateStateKey(t),!(r=this.browserStorage.getTemporaryCache(i)))throw ie.e.createStateNotFoundError("Cached State");try{o=this.authModule.handleFragmentResponse(e,r)}catch(e){throw e instanceof ae&&e.subError===R?j.createUserCancelledError():e}return[2,this.handleCodeResponseFromServer(o,t,n,a)]})})},e.prototype.handleCodeResponseFromServer=function(e,t,n,a,i){return void 0===i&&(i=!0),c(this,void 0,void 0,function(){var r,o,s,c,l,u;return d(this,function(d){switch(d.label){case 0:if(this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),r=this.browserStorage.generateStateKey(t),!(o=this.browserStorage.getTemporaryCache(r)))throw ie.e.createStateNotFoundError("Cached State");return s=this.browserStorage.generateNonceKey(o),c=this.browserStorage.getTemporaryCache(s),this.authCodeRequest.code=e.code,e.cloud_instance_host_name?[4,this.updateTokenEndpointAuthority(e.cloud_instance_host_name,n,a)]:[3,2];case 1:d.sent(),d.label=2;case 2:return i&&(e.nonce=c||void 0),e.state=o,e.client_info?this.authCodeRequest.clientInfo=e.client_info:(l=this.checkCcsCredentials())&&(this.authCodeRequest.ccsCredential=l),[4,this.authModule.acquireToken(this.authCodeRequest,e)];case 3:return u=d.sent(),this.browserStorage.cleanRequestByState(t),[2,u]}})})},e.prototype.updateTokenEndpointAuthority=function(e,t,n){return c(this,void 0,void 0,function(){var a,i;return d(this,function(r){switch(r.label){case 0:return a="https://"+e+"/"+t.tenant+"/",[4,ut.createDiscoveredInstance(a,n,this.browserStorage,t.options)];case 1:return i=r.sent(),this.authModule.updateAuthority(i),[2]}})})},e.prototype.checkCcsCredentials=function(){var e=this.browserStorage.getTemporaryCache(_.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch(t){this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii("Cache credential could not be parsed: "+e)}return null},e}(),Dt=function(e){function t(t,n,a,i,r,o,s,c,d,l){var u=e.call(this,t,n,a,i,r,o,s,d,l)||this;return u.unloadWindow=u.unloadWindow.bind(u),u.nativeStorage=c,u}return i(t,e),t.prototype.acquireToken=function(e){try{var t=this.generatePopupName(e.scopes||y.r_,e.authority||this.config.auth.authority),n=e.popupWindowAttributes||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,t,n);this.logger.verbose("asyncPopup set to false, opening popup before acquiring token");var a=this.openSizedPopup("about:blank",t,n);return this.acquireTokenPopupAsync(e,t,n,a)}catch(e){return Promise.reject(e)}},t.prototype.logout=function(e){try{this.logger.verbose("logoutPopup called");var t=this.initializeLogoutRequest(e),n=this.generateLogoutPopupName(t),a=e&&e.authority,i=e&&e.mainWindowRedirectUri,r=(null==e?void 0:e.popupWindowAttributes)||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,r,a,void 0,i);this.logger.verbose("asyncPopup set to false, opening popup");var o=this.openSizedPopup("about:blank",n,r);return this.logoutPopupAsync(t,n,r,a,o,i)}catch(e){return Promise.reject(e)}},t.prototype.acquireTokenPopupAsync=function(e,t,n,a){return c(this,void 0,void 0,function(){var i,o,c,l,u,f,p,m,_,h,v,S,D,I,x,C,O=this;return d(this,function(d){switch(d.label){case 0:return this.logger.verbose("acquireTokenPopupAsync called"),i=this.initializeServerTelemetryManager(b.acquireTokenPopup),[4,this.initializeAuthorizationRequest(e,g.Popup)];case 1:o=d.sent(),this.browserStorage.updateCacheEntries(o.state,o.nonce,o.authority,o.loginHint||y.oT.EMPTY_STRING,o.account||null),d.label=2;case 2:return d.trys.push([2,8,,9]),[4,this.initializeAuthorizationCodeRequest(o)];case 3:return c=d.sent(),[4,this.createAuthCodeClient(i,o.authority,o.azureCloudOptions)];case 4:return l=d.sent(),this.logger.verbose("Auth code client created"),u=yt.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme),f=void 0,u&&(f=this.performanceClient.startMeasurement(r.FetchAccountIdWithNativeBroker,e.correlationId)),[4,l.getAuthCodeUrl(s(s({},o),{nativeBroker:u}))];case 5:return p=d.sent(),m=new St(l,this.browserStorage,c,this.logger),_={popup:a,popupName:t,popupWindowAttributes:n},h=this.initiateAuthRequest(p,_),this.eventHandler.emitEvent(ke.POPUP_OPENED,g.Popup,{popupWindow:h},null),[4,this.monitorPopupForHash(h)];case 6:if(v=d.sent(),S=Ee.getDeserializedHash(v),D=this.validateAndExtractStateFromHash(S,g.Popup,o.correlationId),Ye.removeThrottle(this.browserStorage,this.config.auth.clientId,c),S.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),f&&f.endMeasurement({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw j.createNativeConnectionNotEstablishedError();return I=new vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,b.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,S.accountId,this.nativeStorage,o.correlationId),x=Ie.parseRequestState(this.browserCrypto,D).userRequestState,[2,I.acquireToken(s(s({},o),{state:x,prompt:void 0})).finally(function(){O.browserStorage.cleanRequestByState(D)})]}return[4,m.handleCodeResponseFromHash(v,D,l.authority,this.networkClient)];case 7:return[2,d.sent()];case 8:throw C=d.sent(),a&&a.close(),C instanceof A.l&&C.setCorrelationId(this.correlationId),i.cacheFailedRequest(C),this.browserStorage.cleanRequestByState(o.state),C;case 9:return[2]}})})},t.prototype.logoutPopupAsync=function(e,t,n,a,i,r){return c(this,void 0,void 0,function(){var o,s,c,l,u,f,p;return d(this,function(d){switch(d.label){case 0:this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(ke.LOGOUT_START,g.Popup,e),o=this.initializeServerTelemetryManager(b.logoutPopup),d.label=1;case 1:return d.trys.push([1,5,,6]),[4,this.clearCacheOnLogout(e.account)];case 2:return d.sent(),[4,this.createAuthCodeClient(o,a)];case 3:return s=d.sent(),this.logger.verbose("Auth code client created"),c=s.getLogoutUri(e),this.eventHandler.emitEvent(ke.LOGOUT_SUCCESS,g.Popup,e),l=this.openPopup(c,{popupName:t,popupWindowAttributes:n,popup:i}),this.eventHandler.emitEvent(ke.POPUP_OPENED,g.Popup,{popupWindow:l},null),[4,this.waitForLogoutPopup(l)];case 4:return d.sent(),r?(u={apiId:b.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},f=Ee.getAbsoluteUrl(r,ze.getCurrentUri()),this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii("Redirecting main window to: "+f),this.navigationClient.navigateInternal(f,u)):this.logger.verbose("No main window navigation requested"),[3,6];case 5:throw p=d.sent(),i&&i.close(),p instanceof A.l&&p.setCorrelationId(this.correlationId),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(ke.LOGOUT_FAILURE,g.Popup,null,p),this.eventHandler.emitEvent(ke.LOGOUT_END,g.Popup),o.cacheFailedRequest(p),p;case 6:return this.eventHandler.emitEvent(ke.LOGOUT_END,g.Popup),[2]}})})},t.prototype.initiateAuthRequest=function(e,t){if(H.x.isEmpty(e))throw this.logger.error("Navigate url is empty"),j.createEmptyNavigationUriError();return this.logger.infoPii("Navigate to: "+e),this.openPopup(e,t)},t.prototype.monitorPopupForHash=function(e){var t=this;return new Promise(function(n,a){var i=t.config.system.windowHashTimeout/50,r=0;t.logger.verbose("PopupHandler.monitorPopupForHash - polling started");var o=setInterval(function(){if(e.closed)return t.logger.error("PopupHandler.monitorPopupForHash - window closed"),t.cleanPopup(),clearInterval(o),void a(j.createUserCancelledError());var s=y.oT.EMPTY_STRING,c=y.oT.EMPTY_STRING;try{s=e.location.href,c=e.location.hash}catch(e){}H.x.isEmpty(s)||"about:blank"===s||(t.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),r++,c?(t.logger.verbose("PopupHandler.monitorPopupForHash - found hash in url"),clearInterval(o),t.cleanPopup(e),Ee.hashContainsKnownProperties(c)?(t.logger.verbose("PopupHandler.monitorPopupForHash - hash contains known properties, returning."),n(c)):(t.logger.error("PopupHandler.monitorPopupForHash - found hash in url but it does not contain known properties. Check that your router is not changing the hash prematurely."),t.logger.errorPii("PopupHandler.monitorPopupForHash - hash found: "+c),a(j.createHashDoesNotContainKnownPropertiesError()))):r>i&&(t.logger.error("PopupHandler.monitorPopupForHash - unable to find hash in url, timing out"),clearInterval(o),a(j.createMonitorPopupTimeoutError())))},50)})},t.prototype.waitForLogoutPopup=function(e){var t=this;return new Promise(function(n){t.logger.verbose("PopupHandler.waitForLogoutPopup - polling started");var a=setInterval(function(){e.closed&&(t.logger.error("PopupHandler.waitForLogoutPopup - window closed"),t.cleanPopup(),clearInterval(a),n());var i=y.oT.EMPTY_STRING;try{i=e.location.href}catch(e){}H.x.isEmpty(i)||"about:blank"===i||(t.logger.verbose("PopupHandler.waitForLogoutPopup - popup window is on same origin as caller, closing."),clearInterval(a),t.cleanPopup(e),n())},50)})},t.prototype.openPopup=function(e,t){try{var n=void 0;if(t.popup?(n=t.popup,this.logger.verbosePii("Navigating popup window to: "+e),n.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii("Opening popup window to: "+e),n=this.openSizedPopup(e,t.popupName,t.popupWindowAttributes)),!n)throw j.createEmptyWindowCreatedError();return n.focus&&n.focus(),this.currentWindow=n,window.addEventListener("beforeunload",this.unloadWindow),n}catch(e){throw this.logger.error("error opening popup "+e.message),this.browserStorage.setInteractionInProgress(!1),j.createPopupWindowError(e.toString())}},t.prototype.openSizedPopup=function(e,t,n){var a,i,r,o,s=window.screenLeft?window.screenLeft:window.screenX,c=window.screenTop?window.screenTop:window.screenY,d=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,u=null===(a=n.popupSize)||void 0===a?void 0:a.width,f=null===(i=n.popupSize)||void 0===i?void 0:i.height,p=null===(r=n.popupPosition)||void 0===r?void 0:r.top,m=null===(o=n.popupPosition)||void 0===o?void 0:o.left;return(!u||u<0||u>d)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),u=483),(!f||f<0||f>l)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),f=600),(!p||p<0||p>l)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),p=Math.max(0,l/2-300+c)),(!m||m<0||m>d)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),m=Math.max(0,d/2-241.5+s)),window.open(e,t,"width="+u+", height="+f+", top="+p+", left="+m+", scrollbars=yes")},t.prototype.unloadWindow=function(e){this.browserStorage.cleanRequestByInteractionType(g.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()},t.prototype.cleanPopup=function(e){e&&e.close(),window.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)},t.prototype.generatePopupName=function(e,t){return"msal."+this.config.auth.clientId+"."+e.join("-")+"."+t+"."+this.correlationId},t.prototype.generateLogoutPopupName=function(e){var t=e.account&&e.account.homeAccountId;return"msal."+this.config.auth.clientId+"."+t+"."+this.correlationId},t}(mt),It=function(e){function t(t,n,a,i,r){var o=e.call(this,t,n,a,i)||this;return o.browserCrypto=r,o}return i(t,e),t.prototype.initiateAuthRequest=function(e,t){return c(this,void 0,void 0,function(){var n;return d(this,function(a){switch(a.label){case 0:return this.logger.verbose("RedirectHandler.initiateAuthRequest called"),H.x.isEmpty(e)?[3,7]:(t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(_.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(_.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest,this.browserCrypto),this.logger.infoPii("RedirectHandler.initiateAuthRequest: Navigate to: "+e),n={apiId:b.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1},"function"!=typeof t.onRedirectNavigate?[3,4]:(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1===t.onRedirectNavigate(e)?[3,2]:(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),[4,t.navigationClient.navigateExternal(e,n)])));case 1:case 5:return a.sent(),[2];case 2:return this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation"),[2];case 3:return[3,6];case 4:return this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),[4,t.navigationClient.navigateExternal(e,n)];case 6:return[3,8];case 7:throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),j.createEmptyNavigationUriError();case 8:return[2]}})})},t.prototype.handleCodeResponseFromHash=function(e,t,n,a){return c(this,void 0,void 0,function(){var i,r,o,s,c,l,u;return d(this,function(d){switch(d.label){case 0:if(this.logger.verbose("RedirectHandler.handleCodeResponse called"),H.x.isEmpty(e))throw j.createEmptyHashError(e);if(this.browserStorage.setInteractionInProgress(!1),i=this.browserStorage.generateStateKey(t),!(r=this.browserStorage.getTemporaryCache(i)))throw ie.e.createStateNotFoundError("Cached State");try{o=this.authModule.handleFragmentResponse(e,r)}catch(e){throw e instanceof ae&&e.subError===R?j.createUserCancelledError():e}return s=this.browserStorage.generateNonceKey(r),c=this.browserStorage.getTemporaryCache(s),this.authCodeRequest.code=o.code,o.cloud_instance_host_name?[4,this.updateTokenEndpointAuthority(o.cloud_instance_host_name,n,a)]:[3,2];case 1:d.sent(),d.label=2;case 2:return o.nonce=c||void 0,o.state=r,o.client_info?this.authCodeRequest.clientInfo=o.client_info:(l=this.checkCcsCredentials())&&(this.authCodeRequest.ccsCredential=l),[4,this.authModule.acquireToken(this.authCodeRequest,o)];case 3:return u=d.sent(),this.browserStorage.cleanRequestByState(t),[2,u]}})})},t}(St),xt=function(e){function t(t,n,a,i,r,o,s,c,d,l){var u=e.call(this,t,n,a,i,r,o,s,d,l)||this;return u.nativeStorage=c,u}return i(t,e),t.prototype.acquireToken=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,r,o,c,l,u,f=this;return d(this,function(d){switch(d.label){case 0:return[4,this.initializeAuthorizationRequest(e,g.Redirect)];case 1:t=d.sent(),this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||y.oT.EMPTY_STRING,t.account||null),n=this.initializeServerTelemetryManager(b.acquireTokenRedirect),a=function(e){e.persisted&&(f.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),f.browserStorage.cleanRequestByState(t.state))},d.label=2;case 2:return d.trys.push([2,7,,8]),[4,this.initializeAuthorizationCodeRequest(t)];case 3:return i=d.sent(),[4,this.createAuthCodeClient(n,t.authority,t.azureCloudOptions)];case 4:return r=d.sent(),this.logger.verbose("Auth code client created"),o=new It(r,this.browserStorage,i,this.logger,this.browserCrypto),[4,r.getAuthCodeUrl(s(s({},t),{nativeBroker:yt.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}))];case 5:return c=d.sent(),l=this.getRedirectStartPage(e.redirectStartPage),this.logger.verbosePii("Redirect start page: "+l),window.addEventListener("pageshow",a),[4,o.initiateAuthRequest(c,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:l,onRedirectNavigate:e.onRedirectNavigate})];case 6:return[2,d.sent()];case 7:throw(u=d.sent())instanceof A.l&&u.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",a),n.cacheFailedRequest(u),this.browserStorage.cleanRequestByState(t.state),u;case 8:return[2]}})})},t.prototype.handleRedirectPromise=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,r,o,s,c,l,u,f,p;return d(this,function(d){switch(d.label){case 0:t=this.initializeServerTelemetryManager(b.handleRedirectPromise),d.label=1;case 1:if(d.trys.push([1,10,,11]),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),[2,null];if(!(n=this.getRedirectResponseHash(e||window.location.hash)))return this.logger.info("handleRedirectPromise did not detect a response hash as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(g.Redirect),[2,null];a=void 0;try{i=Ee.getDeserializedHash(n),a=this.validateAndExtractStateFromHash(i,g.Redirect),this.logger.verbose("State extracted from hash")}catch(e){return this.logger.info("handleRedirectPromise was unable to extract state due to: "+e),this.browserStorage.cleanRequestByInteractionType(g.Redirect),[2,null]}return r=this.browserStorage.getTemporaryCache(_.ORIGIN_URI,!0)||y.oT.EMPTY_STRING,o=Ee.removeHashFromUrl(r),s=Ee.removeHashFromUrl(window.location.href),o===s&&this.config.auth.navigateToLoginRequestUrl?(this.logger.verbose("Current page is loginRequestUrl, handling hash"),[4,this.handleHash(n,a,t)]):[3,3];case 2:return c=d.sent(),r.indexOf("#")>-1&&ze.replaceHash(r),[2,c];case 3:return this.config.auth.navigateToLoginRequestUrl?[3,4]:(this.logger.verbose("NavigateToLoginRequestUrl set to false, handling hash"),[2,this.handleHash(n,a,t)]);case 4:return ze.isInIframe()&&!this.config.system.allowRedirectInIframe?[3,9]:(this.browserStorage.setTemporaryCache(_.URL_HASH,n,!0),l={apiId:b.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0},u=!0,r&&"null"!==r?[3,6]:(f=ze.getHomepage(),this.browserStorage.setTemporaryCache(_.ORIGIN_URI,f,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),[4,this.navigationClient.navigateInternal(f,l)]));case 5:return u=d.sent(),[3,8];case 6:return this.logger.verbose("Navigating to loginRequestUrl: "+r),[4,this.navigationClient.navigateInternal(r,l)];case 7:u=d.sent(),d.label=8;case 8:if(!u)return[2,this.handleHash(n,a,t)];d.label=9;case 9:return[2,null];case 10:throw(p=d.sent())instanceof A.l&&p.setCorrelationId(this.correlationId),t.cacheFailedRequest(p),this.browserStorage.cleanRequestByInteractionType(g.Redirect),p;case 11:return[2]}})})},t.prototype.getRedirectResponseHash=function(e){if(this.logger.verbose("getRedirectResponseHash called"),Ee.hashContainsKnownProperties(e))return ze.clearHash(window),this.logger.verbose("Hash contains known properties, returning response hash"),e;var t=this.browserStorage.getTemporaryCache(_.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(_.URL_HASH)),this.logger.verbose("Hash does not contain known properties, returning cached hash"),t},t.prototype.handleHash=function(e,t,n){return c(this,void 0,void 0,function(){var a,i,r,o,c,l,u=this;return d(this,function(d){switch(d.label){case 0:if(a=this.browserStorage.getCachedRequest(t,this.browserCrypto),this.logger.verbose("handleHash called, retrieved cached request"),(i=Ee.getDeserializedHash(e)).accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw j.createNativeConnectionNotEstablishedError();return r=new vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,b.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,i.accountId,this.browserStorage,a.correlationId),o=Ie.parseRequestState(this.browserCrypto,t).userRequestState,[2,r.acquireToken(s(s({},a),{state:o,prompt:void 0})).finally(function(){u.browserStorage.cleanRequestByState(t)})]}if(!(c=this.browserStorage.getCachedAuthority(t)))throw j.createNoCachedAuthorityError();return[4,this.createAuthCodeClient(n,c)];case 1:return l=d.sent(),this.logger.verbose("Auth code client created"),Ye.removeThrottle(this.browserStorage,this.config.auth.clientId,a),[4,new It(l,this.browserStorage,a,this.logger,this.browserCrypto).handleCodeResponseFromHash(e,t,l.authority,this.networkClient)];case 2:return[2,d.sent()]}})})},t.prototype.logout=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,r,o;return d(this,function(s){switch(s.label){case 0:this.logger.verbose("logoutRedirect called"),t=this.initializeLogoutRequest(e),n=this.initializeServerTelemetryManager(b.logout),s.label=1;case 1:return s.trys.push([1,10,,11]),this.eventHandler.emitEvent(ke.LOGOUT_START,g.Redirect,e),[4,this.clearCacheOnLogout(t.account)];case 2:return s.sent(),a={apiId:b.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},[4,this.createAuthCodeClient(n,e&&e.authority)];case 3:return i=s.sent(),this.logger.verbose("Auth code client created"),r=i.getLogoutUri(t),this.eventHandler.emitEvent(ke.LOGOUT_SUCCESS,g.Redirect,t),e&&"function"==typeof e.onRedirectNavigate?!1===e.onRedirectNavigate(r)?[3,5]:(this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),[4,this.navigationClient.navigateExternal(r,a)]):[3,7];case 4:return s.sent(),[2];case 5:this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation"),s.label=6;case 6:return[3,9];case 7:return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),[4,this.navigationClient.navigateExternal(r,a)];case 8:return s.sent(),[2];case 9:return[3,11];case 10:throw(o=s.sent())instanceof A.l&&o.setCorrelationId(this.correlationId),n.cacheFailedRequest(o),this.eventHandler.emitEvent(ke.LOGOUT_FAILURE,g.Redirect,null,o),this.eventHandler.emitEvent(ke.LOGOUT_END,g.Redirect),o;case 11:return this.eventHandler.emitEvent(ke.LOGOUT_END,g.Redirect),[2]}})})},t.prototype.getRedirectStartPage=function(e){var t=e||window.location.href;return Ee.getAbsoluteUrl(t,ze.getCurrentUri())},t}(mt),Ct=function(e){function t(t,n,a,i,r){var o=e.call(this,t,n,a,i)||this;return o.navigateFrameWait=r,o}return i(t,e),t.prototype.initiateAuthRequest=function(e){return c(this,void 0,void 0,function(){var t;return d(this,function(n){switch(n.label){case 0:if(H.x.isEmpty(e))throw this.logger.info("Navigate url is empty"),j.createEmptyNavigationUriError();return this.navigateFrameWait?[4,this.loadFrame(e)]:[3,2];case 1:return t=n.sent(),[3,3];case 2:t=this.loadFrameSync(e),n.label=3;case 3:return[2,t]}})})},t.prototype.monitorIframeForHash=function(e,t){var n=this;return new Promise(function(a,i){t<6e3&&n.logger.warning("system.loadFrameTimeout or system.iframeHashTimeout set to lower ("+t+"ms) than the default (6000ms). This may result in timeouts.");var r=window.performance.now()+t,o=setInterval(function(){if(window.performance.now()>r)return n.removeHiddenIframe(e),clearInterval(o),void i(j.createMonitorIframeTimeoutError());var t=y.oT.EMPTY_STRING,s=e.contentWindow;try{t=s?s.location.href:y.oT.EMPTY_STRING}catch(e){}if(!H.x.isEmpty(t)){var c=s?s.location.hash:y.oT.EMPTY_STRING;return Ee.hashContainsKnownProperties(c)?(n.removeHiddenIframe(e),clearInterval(o),void a(c)):void 0}},50)})},t.prototype.loadFrame=function(e){var t=this;return new Promise(function(n,a){var i=t.createHiddenIframe();setTimeout(function(){i?(i.src=e,n(i)):a("Unable to load iframe")},t.navigateFrameWait)})},t.prototype.loadFrameSync=function(e){var t=this.createHiddenIframe();return t.src=e,t},t.prototype.createHiddenIframe=function(){var e=document.createElement("iframe");return e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.getElementsByTagName("body")[0].appendChild(e),e},t.prototype.removeHiddenIframe=function(e){document.body===e.parentNode&&document.body.removeChild(e)},t}(St),Ot=function(e){function t(t,n,a,i,r,o,s,c,d,l,u){var f=e.call(this,t,n,a,i,r,o,c,l,u)||this;return f.apiId=s,f.nativeStorage=d,f}return i(t,e),t.prototype.acquireToken=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,o;return d(this,function(c){switch(c.label){case 0:if(this.logger.verbose("acquireTokenByIframe called"),t=this.performanceClient.startMeasurement(r.SilentIframeClientAcquireToken,e.correlationId),H.x.isEmpty(e.loginHint)&&H.x.isEmpty(e.sid)&&(!e.account||H.x.isEmpty(e.account.username))&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request."),e.prompt&&e.prompt!==y.NJ.NONE)throw t.endMeasurement({success:!1}),j.createSilentPromptValueError(e.prompt);return[4,this.initializeAuthorizationRequest(s(s({},e),{prompt:y.NJ.NONE}),g.Silent)];case 1:n=c.sent(),this.browserStorage.updateCacheEntries(n.state,n.nonce,n.authority,n.loginHint||y.oT.EMPTY_STRING,n.account||null),a=this.initializeServerTelemetryManager(this.apiId),c.label=2;case 2:return c.trys.push([2,5,,6]),[4,this.createAuthCodeClient(a,n.authority,n.azureCloudOptions)];case 3:return i=c.sent(),this.logger.verbose("Auth code client created"),[4,this.silentTokenHelper(i,n).then(function(e){return t.endMeasurement({success:!0,fromCache:!1}),e})];case 4:return[2,c.sent()];case 5:throw(o=c.sent())instanceof A.l&&o.setCorrelationId(this.correlationId),a.cacheFailedRequest(o),this.browserStorage.cleanRequestByState(n.state),t.endMeasurement({errorCode:o instanceof A.l&&o.errorCode||void 0,subErrorCode:o instanceof A.l&&o.subError||void 0,success:!1}),o;case 6:return[2]}})})},t.prototype.logout=function(){return Promise.reject(j.createSilentLogoutUnsupportedError())},t.prototype.silentTokenHelper=function(e,t){return c(this,void 0,void 0,function(){var n,a,i,r,o,c,l,u,f,p=this;return d(this,function(d){switch(d.label){case 0:return[4,this.initializeAuthorizationCodeRequest(t)];case 1:return n=d.sent(),[4,e.getAuthCodeUrl(s(s({},t),{nativeBroker:yt.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}))];case 2:return a=d.sent(),[4,(i=new Ct(e,this.browserStorage,n,this.logger,this.config.system.navigateFrameWait)).initiateAuthRequest(a)];case 3:return r=d.sent(),[4,i.monitorIframeForHash(r,this.config.system.iframeHashTimeout)];case 4:if(o=d.sent(),c=Ee.getDeserializedHash(o),l=this.validateAndExtractStateFromHash(c,g.Silent,n.correlationId),c.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw j.createNativeConnectionNotEstablishedError();return u=new vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,c.accountId,this.browserStorage,this.correlationId),f=Ie.parseRequestState(this.browserCrypto,l).userRequestState,[2,u.acquireToken(s(s({},t),{state:f,prompt:y.NJ.NONE})).finally(function(){p.browserStorage.cleanRequestByState(l)})]}return[2,i.handleCodeResponseFromHash(o,l,e.authority,this.networkClient)]}})})},t}(mt),wt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.acquireToken=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,o,c=this;return d(this,function(d){switch(d.label){case 0:return n=[s({},e)],[4,this.initializeBaseRequest(e)];case 1:return t=s.apply(void 0,n.concat([d.sent()])),a=this.performanceClient.startMeasurement(r.SilentRefreshClientAcquireToken,t.correlationId),i=this.initializeServerTelemetryManager(b.acquireTokenSilent_silentFlow),[4,this.createRefreshTokenClient(i,t.authority,t.azureCloudOptions)];case 2:return o=d.sent(),this.logger.verbose("Refresh token client created"),[2,o.acquireTokenByRefreshToken(t).then(function(e){return a.endMeasurement({success:!0,fromCache:e.fromCache}),e}).catch(function(e){throw e instanceof A.l&&e.setCorrelationId(c.correlationId),i.cacheFailedRequest(e),a.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})]}})})},t.prototype.logout=function(){return Promise.reject(j.createSilentLogoutUnsupportedError())},t.prototype.createRefreshTokenClient=function(e,t,n){return c(this,void 0,void 0,function(){var a;return d(this,function(i){switch(i.label){case 0:return[4,this.getClientConfiguration(e,t,n)];case 1:return a=i.sent(),[2,new ht(a,this.performanceClient)]}})})},t}(mt),Et=function(){function e(e,t,n,a){this.isBrowserEnvironment="undefined"!=typeof window,this.config=e,this.storage=t,this.logger=n,this.cryptoObj=a}return e.prototype.loadExternalTokens=function(e,t,n){if(this.logger.info("TokenCache - loadExternalTokens called"),!t.id_token)throw j.createUnableToLoadTokenError("Please ensure server response includes id token.");if(e.account)this.loadIdToken(t.id_token,e.account.homeAccountId,e.account.environment,e.account.tenantId,n),this.loadAccessToken(e,t,e.account.homeAccountId,e.account.environment,e.account.tenantId,n);else{if(!e.authority)throw j.createUnableToLoadTokenError("Please provide a request with an account or a request with authority.");var a=lt.generateAuthority(e.authority,e.azureCloudOptions),i={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},r=new lt(a,this.config.system.networkClient,this.storage,i);if(n.clientInfo)this.logger.trace("TokenCache - homeAccountId from options"),this.loadIdToken(t.id_token,n.clientInfo,r.hostnameAndPort,r.tenant,n),this.loadAccessToken(e,t,n.clientInfo,r.hostnameAndPort,r.tenant,n);else{if(!t.client_info)throw j.createUnableToLoadTokenError("Please provide clientInfo in the response or options.");this.logger.trace("TokenCache - homeAccountId from response"),this.loadIdToken(t.id_token,t.client_info,r.hostnameAndPort,r.tenant,n),this.loadAccessToken(e,t,t.client_info,r.hostnameAndPort,r.tenant,n)}}},e.prototype.loadIdToken=function(e,t,n,a,i){var r=_e.createIdTokenEntity(t,n,e,this.config.auth.clientId,a),o=new fe(e,this.cryptoObj),s=i.clientInfo?ce.createAccount(i.clientInfo,t,o,void 0,void 0,void 0,n):ce.createGenericAccount(t,o,void 0,void 0,void 0,n);if(!this.isBrowserEnvironment)throw j.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.");this.logger.verbose("TokenCache - loading id token"),this.storage.setAccount(s),this.storage.setIdTokenCredential(r)},e.prototype.loadAccessToken=function(e,t,n,a,i,r){if(t.access_token){if(!t.expires_in)throw j.createUnableToLoadTokenError("Please ensure server response includes expires_in value.");if(!r.extendedExpiresOn)throw j.createUnableToLoadTokenError("Please provide an extendedExpiresOn value in the options.");var o=new ue(e.scopes).printScopes(),s=r.expiresOn||t.expires_in+(new Date).getTime()/1e3,c=r.extendedExpiresOn,d=be.createAccessTokenEntity(n,a,t.access_token,this.config.auth.clientId,i,o,s,c,this.cryptoObj);if(!this.isBrowserEnvironment)throw j.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.");this.logger.verbose("TokenCache - loading access token"),this.storage.setAccessTokenCredential(d)}else this.logger.verbose("TokenCache - No access token provided for caching")},e}(),At=function(e){function t(t){var n=e.call(this,t)||this;return n.includeRedirectUri=!1,n}return i(t,e),t}(it),Lt=function(e){function t(t,n,a,i,r,o,s,c,d,l){var u=e.call(this,t,n,a,i,r,o,c,d,l)||this;return u.apiId=s,u}return i(t,e),t.prototype.acquireToken=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,r,o;return d(this,function(c){switch(c.label){case 0:if(this.logger.trace("SilentAuthCodeClient.acquireToken called"),!e.code)throw j.createAuthCodeRequiredError();return[4,this.initializeAuthorizationRequest(e,g.Silent)];case 1:t=c.sent(),this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||y.oT.EMPTY_STRING,t.account||null),n=this.initializeServerTelemetryManager(this.apiId),c.label=2;case 2:return c.trys.push([2,4,,5]),a=s(s({},t),{code:e.code}),[4,this.getClientConfiguration(n,t.authority)];case 3:return i=c.sent(),r=new At(i),this.logger.verbose("Auth code client created"),[2,new Ct(r,this.browserStorage,a,this.logger,this.config.system.navigateFrameWait).handleCodeResponseFromServer({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t.state,r.authority,this.networkClient,!1)];case 4:throw(o=c.sent())instanceof A.l&&o.setCorrelationId(this.correlationId),n.cacheFailedRequest(o),this.browserStorage.cleanRequestByState(t.state),o;case 5:return[2]}})})},t.prototype.logout=function(){return Promise.reject(j.createSilentLogoutUnsupportedError())},t}(mt),kt=function(){function e(e,t){this.correlationId=t,this.measureName="msal.measure."+e+"."+this.correlationId,this.startMark="msal.start."+e+"."+this.correlationId,this.endMark="msal.end."+e+"."+this.correlationId}return e.supportsBrowserPerformance=function(){return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.mark&&"function"==typeof window.performance.measure&&"function"==typeof window.performance.clearMarks&&"function"==typeof window.performance.clearMeasures&&"function"==typeof window.performance.getEntriesByName},e.prototype.startMeasurement=function(){if(e.supportsBrowserPerformance())try{window.performance.mark(this.startMark)}catch(e){}},e.prototype.endMeasurement=function(){if(e.supportsBrowserPerformance())try{window.performance.mark(this.endMark),window.performance.measure(this.measureName,this.startMark,this.endMark)}catch(e){}},e.prototype.flushMeasurement=function(){if(e.supportsBrowserPerformance())try{var t=window.performance.getEntriesByName(this.measureName,"measure");if(t.length>0){var n=t[0].duration;return window.performance.clearMeasures(this.measureName),window.performance.clearMarks(this.startMark),window.performance.clearMarks(this.endMark),n}}catch(e){}return null},e}(),Mt=function(e){function t(t,n,a,i,r,o){var s=e.call(this,t,n,a,i,r,o)||this;return s.browserCrypto=new K(s.logger),s.guidGenerator=new P(s.browserCrypto),s}return i(t,e),t.prototype.startPerformanceMeasuremeant=function(e,t){return new kt(e,t)},t.prototype.generateId=function(){return this.guidGenerator.generateGuid()},t.prototype.getPageVisibility=function(){var e;return(null===(e=document.visibilityState)||void 0===e?void 0:e.toString())||null},t.prototype.startMeasurement=function(t,n){var a=this,i=this.getPageVisibility(),r=e.prototype.startMeasurement.call(this,t,n);return s(s({},r),{endMeasurement:function(e){return r.endMeasurement(s({startPageVisibility:i,endPageVisibility:a.getPageVisibility()},e))}})},t}(Z),Pt=function(){function e(e){var t,n,a;this.isBrowserEnvironment="undefined"!=typeof window,this.config=function(e,t){var n=e.auth,a=e.cache,i=e.system,r=e.telemetry,o={clientId:y.oT.EMPTY_STRING,authority:""+y.oT.DEFAULT_AUTHORITY,knownAuthorities:[],cloudDiscoveryMetadata:y.oT.EMPTY_STRING,authorityMetadata:y.oT.EMPTY_STRING,redirectUri:y.oT.EMPTY_STRING,postLogoutRedirectUri:y.oT.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:xe.AAD,azureCloudOptions:{azureCloudInstance:Ce.None,tenant:y.oT.EMPTY_STRING},skipAuthorityMetadataCache:!1},c={cacheLocation:p.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1},d={loggerCallback:function(){},logLevel:X.i.Info,piiLoggingEnabled:!1},l=s(s({},Pe),{loggerOptions:d,networkClient:t?ze.getBrowserNetworkClient():Be,navigationClient:new Ge,loadFrameTimeout:0,windowHashTimeout:(null==i?void 0:i.loadFrameTimeout)||6e4,iframeHashTimeout:(null==i?void 0:i.loadFrameTimeout)||6e3,navigateFrameWait:t&&ze.detectIEOrEdge()?500:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(null==i?void 0:i.nativeBrokerHandshakeTimeout)||2e3}),u={application:{appName:y.oT.EMPTY_STRING,appVersion:y.oT.EMPTY_STRING}};return{auth:s(s({},o),n),cache:s(s({},c),a),system:s(s({},l),i),telemetry:s(s({},u),r)}}(e,this.isBrowserEnvironment),this.initialized=!1,this.logger=new X.Y(this.config.system.loggerOptions,Ke,We),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.isBrowserEnvironment?new Mt(this.config.auth.clientId,this.config.auth.authority,this.logger,Ke,We,this.config.telemetry.application):new ee(this.config.auth.clientId,this.config.auth.authority,this.logger,Ke,We,this.config.telemetry.application),this.browserCrypto=this.isBrowserEnvironment?new J(this.logger,this.performanceClient):te,this.eventHandler=new Qe(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new Le(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger):(t=this.config.auth.clientId,n=this.logger,a={cacheLocation:p.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1},new Le(t,a,te,n));var i={cacheLocation:p.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1};this.nativeInternalStorage=new Le(this.config.auth.clientId,i,this.browserCrypto,this.logger),this.tokenCache=new Et(this.config,this.browserStorage,this.logger,this.browserCrypto)}return e.prototype.initialize=function(){return c(this,void 0,void 0,function(){var e,t;return d(this,function(n){switch(n.label){case 0:if(this.logger.trace("initialize called"),this.initialized)return this.logger.info("initialize has already been called, exiting early."),[2];if(this.eventHandler.emitEvent(ke.INITIALIZE_START),!this.config.system.allowNativeBroker)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),e=this,[4,yt.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout)];case 2:return e.nativeExtensionProvider=n.sent(),[3,4];case 3:return t=n.sent(),this.logger.verbose(t),[3,4];case 4:return this.initialized=!0,this.eventHandler.emitEvent(ke.INITIALIZE_END),[2]}})})},e.prototype.handleRedirectPromise=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,r,o,s,c,l=this;return d(this,function(d){return this.logger.verbose("handleRedirectPromise called"),ze.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),t=this.getAllAccounts(),this.isBrowserEnvironment?(n=e||y.oT.EMPTY_STRING,void 0===(a=this.redirectResponse.get(n))?(this.eventHandler.emitEvent(ke.HANDLE_REDIRECT_START,g.Redirect),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise"),i=this.browserStorage.getCachedNativeRequest(),r=void 0,i&&yt.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e?(this.logger.trace("handleRedirectPromise - acquiring token from native platform"),o=new vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,b.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,i.accountId,this.nativeInternalStorage,i.correlationId),r=o.handleRedirectPromise()):(this.logger.trace("handleRedirectPromise - acquiring token from web flow"),s=this.browserStorage.getTemporaryCache(_.CORRELATION_ID,!0)||y.oT.EMPTY_STRING,c=this.createRedirectClient(s),r=c.handleRedirectPromise(e)),a=r.then(function(e){return e&&(t.length<l.getAllAccounts().length?(l.eventHandler.emitEvent(ke.LOGIN_SUCCESS,g.Redirect,e),l.logger.verbose("handleRedirectResponse returned result, login success")):(l.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_SUCCESS,g.Redirect,e),l.logger.verbose("handleRedirectResponse returned result, acquire token success"))),l.eventHandler.emitEvent(ke.HANDLE_REDIRECT_END,g.Redirect),e}).catch(function(e){throw t.length>0?l.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_FAILURE,g.Redirect,null,e):l.eventHandler.emitEvent(ke.LOGIN_FAILURE,g.Redirect,null,e),l.eventHandler.emitEvent(ke.HANDLE_REDIRECT_END,g.Redirect),e}),this.redirectResponse.set(n,a)):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),[2,a]):(this.logger.verbose("handleRedirectPromise returns null, not browser environment"),[2,null])})})},e.prototype.acquireTokenRedirect=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,r,o=this;return d(this,function(s){return t=this.getRequestCorrelationId(e),this.logger.verbose("acquireTokenRedirect called",t),this.preflightBrowserEnvironmentCheck(g.Redirect),(n=this.getAllAccounts().length>0)?this.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_START,g.Redirect,e):this.eventHandler.emitEvent(ke.LOGIN_START,g.Redirect,e),this.nativeExtensionProvider&&this.canUseNative(e)?(i=new vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,b.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId),a=i.acquireTokenRedirect(e).catch(function(t){if(t instanceof _t&&t.isFatal())return o.nativeExtensionProvider=void 0,o.createRedirectClient(e.correlationId).acquireToken(e);if(t instanceof ne.Jo)return o.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),o.createRedirectClient(e.correlationId).acquireToken(e);throw o.browserStorage.setInteractionInProgress(!1),t})):(r=this.createRedirectClient(e.correlationId),a=r.acquireToken(e)),[2,a.catch(function(e){throw n?o.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_FAILURE,g.Redirect,null,e):o.eventHandler.emitEvent(ke.LOGIN_FAILURE,g.Redirect,null,e),e})]})})},e.prototype.acquireTokenPopup=function(e){var t=this,n=this.getRequestCorrelationId(e),a=this.performanceClient.startMeasurement(r.AcquireTokenPopup,n);try{this.logger.verbose("acquireTokenPopup called",n),this.preflightBrowserEnvironmentCheck(g.Popup)}catch(e){return Promise.reject(e)}var i=this.getAllAccounts();return i.length>0?this.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_START,g.Popup,e):this.eventHandler.emitEvent(ke.LOGIN_START,g.Popup,e),(this.canUseNative(e)?this.acquireTokenNative(e,b.acquireTokenPopup).then(function(e){return t.browserStorage.setInteractionInProgress(!1),a.endMeasurement({success:!0,isNativeBroker:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),a.flushMeasurement(),e}).catch(function(n){if(n instanceof _t&&n.isFatal())return t.nativeExtensionProvider=void 0,t.createPopupClient(e.correlationId).acquireToken(e);if(n instanceof ne.Jo)return t.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createPopupClient(e.correlationId).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),n}):this.createPopupClient(e.correlationId).acquireToken(e)).then(function(e){return i.length<t.getAllAccounts().length?t.eventHandler.emitEvent(ke.LOGIN_SUCCESS,g.Popup,e):t.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_SUCCESS,g.Popup,e),a.endMeasurement({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),a.flushMeasurement(),e}).catch(function(e){return i.length>0?t.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_FAILURE,g.Popup,null,e):t.eventHandler.emitEvent(ke.LOGIN_FAILURE,g.Popup,null,e),a.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),a.flushMeasurement(),Promise.reject(e)})},e.prototype.ssoSilent=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,o,c=this;return d(this,function(d){return t=this.getRequestCorrelationId(e),n=s(s({},e),{prompt:y.NJ.NONE,correlationId:t}),this.preflightBrowserEnvironmentCheck(g.Silent),a=this.performanceClient.startMeasurement(r.SsoSilent,t),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(ke.SSO_SILENT_START,g.Silent,n),this.canUseNative(n)?i=this.acquireTokenNative(n,b.ssoSilent).catch(function(e){if(e instanceof _t&&e.isFatal())return c.nativeExtensionProvider=void 0,c.createSilentIframeClient(n.correlationId).acquireToken(n);throw e}):(o=this.createSilentIframeClient(n.correlationId),i=o.acquireToken(n)),[2,i.then(function(e){return c.eventHandler.emitEvent(ke.SSO_SILENT_SUCCESS,g.Silent,e),a.endMeasurement({success:!0,isNativeBroker:e.fromNativeBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),a.flushMeasurement(),e}).catch(function(e){throw c.eventHandler.emitEvent(ke.SSO_SILENT_FAILURE,g.Silent,null,e),a.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),a.flushMeasurement(),e})]})})},e.prototype.acquireTokenByCode=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,o=this;return d(this,function(c){t=this.getRequestCorrelationId(e),this.preflightBrowserEnvironmentCheck(g.Silent),this.logger.trace("acquireTokenByCode called",t),this.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_BY_CODE_START,g.Silent,e),n=this.performanceClient.startMeasurement(r.AcquireTokenByCode,e.correlationId);try{if(e.code)return a=e.code,(i=this.hybridAuthCodeResponses.get(a))?(this.logger.verbose("Existing acquireTokenByCode request found",e.correlationId),n.endMeasurement({success:!0}),n.discardMeasurement()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),i=this.acquireTokenByCodeAsync(s(s({},e),{correlationId:t})).then(function(e){return o.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_BY_CODE_SUCCESS,g.Silent,e),o.hybridAuthCodeResponses.delete(a),n.endMeasurement({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,isNativeBroker:e.fromNativeBroker}),n.flushMeasurement(),e}).catch(function(e){throw o.hybridAuthCodeResponses.delete(a),o.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_BY_CODE_FAILURE,g.Silent,null,e),n.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),n.flushMeasurement(),e}),this.hybridAuthCodeResponses.set(a,i)),[2,i];if(e.nativeAccountId){if(this.canUseNative(e,e.nativeAccountId))return[2,this.acquireTokenNative(e,b.acquireTokenByCode,e.nativeAccountId).catch(function(e){throw e instanceof _t&&e.isFatal()&&(o.nativeExtensionProvider=void 0),e})];throw j.createUnableToAcquireTokenFromNativePlatformError()}throw j.createAuthCodeOrNativeAccountIdRequiredError()}catch(e){throw this.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_BY_CODE_FAILURE,g.Silent,null,e),n.endMeasurement({errorCode:e instanceof A.l&&e.errorCode||void 0,subErrorCode:e instanceof A.l&&e.subError||void 0,success:!1}),e}return[2]})})},e.prototype.acquireTokenByCodeAsync=function(e){return c(this,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),[4,this.createSilentAuthCodeClient(e.correlationId).acquireToken(e)];case 1:return[2,t.sent()]}})})},e.prototype.acquireTokenByRefreshToken=function(e){return c(this,void 0,void 0,function(){var t,n=this;return d(this,function(a){return ze.blockReloadInHiddenIframes(),t=this.performanceClient.startMeasurement(r.AcquireTokenByRefreshToken,e.correlationId),this.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_NETWORK_START,g.Silent,e),[2,this.createSilentRefreshClient(e.correlationId).acquireToken(e).then(function(e){return t.endMeasurement({success:!0,fromCache:e.fromCache,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),e}).catch(function(a){var i=a instanceof ae,r=a instanceof ne.Jo,o="invalid_grant"===a.errorCode;if(i&&o&&!r)return n.logger.verbose("Refresh token expired or invalid, attempting acquire token by iframe",e.correlationId),n.createSilentIframeClient(e.correlationId).acquireToken(e).then(function(e){return t.endMeasurement({success:!0,fromCache:e.fromCache,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),e}).catch(function(e){throw t.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e});throw t.endMeasurement({success:!1}),a})]})})},e.prototype.logout=function(e){return c(this,void 0,void 0,function(){var t;return d(this,function(n){return t=this.getRequestCorrelationId(e),this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),[2,this.logoutRedirect(s({correlationId:t},e))]})})},e.prototype.logoutRedirect=function(e){return c(this,void 0,void 0,function(){var t;return d(this,function(n){return t=this.getRequestCorrelationId(e),this.preflightBrowserEnvironmentCheck(g.Redirect),[2,this.createRedirectClient(t).logout(e)]})})},e.prototype.logoutPopup=function(e){try{var t=this.getRequestCorrelationId(e);return this.preflightBrowserEnvironmentCheck(g.Popup),this.createPopupClient(t).logout(e)}catch(e){return Promise.reject(e)}},e.prototype.getAllAccounts=function(){return this.logger.verbose("getAllAccounts called"),this.isBrowserEnvironment?this.browserStorage.getAllAccounts():[]},e.prototype.getAccountByUsername=function(e){var t=this.getAllAccounts();return!H.x.isEmpty(e)&&t&&t.length?(this.logger.verbose("Account matching username found, returning"),this.logger.verbosePii("Returning signed-in accounts matching username: "+e),t.filter(function(t){return t.username.toLowerCase()===e.toLowerCase()})[0]||null):(this.logger.verbose("getAccountByUsername: No matching account found, returning null"),null)},e.prototype.getAccountByHomeId=function(e){var t=this.getAllAccounts();return!H.x.isEmpty(e)&&t&&t.length?(this.logger.verbose("Account matching homeAccountId found, returning"),this.logger.verbosePii("Returning signed-in accounts matching homeAccountId: "+e),t.filter(function(t){return t.homeAccountId===e})[0]||null):(this.logger.verbose("getAccountByHomeId: No matching account found, returning null"),null)},e.prototype.getAccountByLocalId=function(e){var t=this.getAllAccounts();return!H.x.isEmpty(e)&&t&&t.length?(this.logger.verbose("Account matching localAccountId found, returning"),this.logger.verbosePii("Returning signed-in accounts matching localAccountId: "+e),t.filter(function(t){return t.localAccountId===e})[0]||null):(this.logger.verbose("getAccountByLocalId: No matching account found, returning null"),null)},e.prototype.setActiveAccount=function(e){this.browserStorage.setActiveAccount(e)},e.prototype.getActiveAccount=function(){return this.browserStorage.getActiveAccount()},e.prototype.preflightBrowserEnvironmentCheck=function(e,t){if(void 0===t&&(t=!0),this.logger.verbose("preflightBrowserEnvironmentCheck started"),ze.blockNonBrowserEnvironment(this.isBrowserEnvironment),ze.blockRedirectInIframe(e,this.config.system.allowRedirectInIframe),ze.blockReloadInHiddenIframes(),ze.blockAcquireTokenInPopups(),ze.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),e===g.Redirect&&this.config.cache.cacheLocation===p.MemoryStorage&&!this.config.cache.storeAuthStateInCookie)throw Oe.createInMemoryRedirectUnavailableError();e!==g.Redirect&&e!==g.Popup||this.preflightInteractiveRequest(t)},e.prototype.preflightInteractiveRequest=function(e){this.logger.verbose("preflightInteractiveRequest called, validating app environment"),ze.blockReloadInHiddenIframes(),e&&this.browserStorage.setInteractionInProgress(!0)},e.prototype.acquireTokenNative=function(e,t,n){return c(this,void 0,void 0,function(){return d(this,function(a){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw j.createNativeConnectionNotEstablishedError();return[2,new vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)]})})},e.prototype.canUseNative=function(e,t){if(this.logger.trace("canUseNative called"),!yt.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case y.NJ.NONE:case y.NJ.CONSENT:case y.NJ.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace("canUseNative: prompt = "+e.prompt+" is not compatible with native flow, returning false"),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))},e.prototype.getNativeAccountId=function(e){var t=e.account||this.browserStorage.getAccountInfoByHints(e.loginHint,e.sid)||this.getActiveAccount();return t&&t.nativeAccountId||""},e.prototype.createPopupClient=function(e){return new Dt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},e.prototype.createRedirectClient=function(e){return new xt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},e.prototype.createSilentIframeClient=function(e){return new Ot(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,b.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},e.prototype.createSilentCacheClient=function(e){return new gt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)},e.prototype.createSilentRefreshClient=function(e){return new wt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)},e.prototype.createSilentAuthCodeClient=function(e){return new Lt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,b.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)},e.prototype.addEventCallback=function(e){return this.eventHandler.addEventCallback(e)},e.prototype.removeEventCallback=function(e){this.eventHandler.removeEventCallback(e)},e.prototype.addPerformanceCallback=function(e){return this.performanceClient.addPerformanceCallback(e)},e.prototype.removePerformanceCallback=function(e){return this.performanceClient.removePerformanceCallback(e)},e.prototype.enableAccountStorageEvents=function(){this.eventHandler.enableAccountStorageEvents()},e.prototype.disableAccountStorageEvents=function(){this.eventHandler.disableAccountStorageEvents()},e.prototype.getTokenCache=function(){return this.tokenCache},e.prototype.getLogger=function(){return this.logger},e.prototype.setLogger=function(e){this.logger=e},e.prototype.initializeWrapperLibrary=function(e,t){this.browserStorage.setWrapperMetadata(e,t)},e.prototype.setNavigationClient=function(e){this.navigationClient=e},e.prototype.getConfiguration=function(){return this.config},e.prototype.getRequestCorrelationId=function(e){return(null==e?void 0:e.correlationId)?e.correlationId:this.isBrowserEnvironment?this.browserCrypto.createNewGuid():y.oT.EMPTY_STRING},e}(),Tt=function(e){function t(t){var n=e.call(this,t)||this;return n.activeSilentTokenRequests=new Map,n}return i(t,e),t.prototype.loginRedirect=function(e){return c(this,void 0,void 0,function(){var t;return d(this,function(n){return t=this.getRequestCorrelationId(e),this.logger.verbose("loginRedirect called",t),[2,this.acquireTokenRedirect(s({correlationId:t},e||x))]})})},t.prototype.loginPopup=function(e){var t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup(s({correlationId:t},e||x))},t.prototype.acquireTokenSilent=function(e){return c(this,void 0,void 0,function(){var t,n,a,i,o,c,l,u=this;return d(this,function(d){if(t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(r.AcquireTokenSilent,t),this.preflightBrowserEnvironmentCheck(g.Silent),this.logger.verbose("acquireTokenSilent called",t),!(a=e.account||this.getActiveAccount()))throw j.createNoAccountError();return i={clientId:this.config.auth.clientId,authority:e.authority||y.oT.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:a.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid},o=JSON.stringify(i),void 0===(c=this.activeSilentTokenRequests.get(o))?(this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t),l=this.acquireTokenSilentAsync(s(s({},e),{correlationId:t}),a).then(function(e){return u.activeSilentTokenRequests.delete(o),n.endMeasurement({success:!0,fromCache:e.fromCache,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,isNativeBroker:e.fromNativeBroker}),n.flushMeasurement(),e}).catch(function(e){throw u.activeSilentTokenRequests.delete(o),n.endMeasurement({success:!1}),n.flushMeasurement(),e}),this.activeSilentTokenRequests.set(o,l),[2,l]):(this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),n.endMeasurement({success:!0}),n.discardMeasurement(),[2,c])})})},t.prototype.acquireTokenSilentAsync=function(e,t){return c(this,void 0,void 0,function(){var n,a,i,o,l,u=this;return d(this,function(f){switch(f.label){case 0:return this.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_START,g.Silent,e),n=this.performanceClient.startMeasurement(r.AcquireTokenSilentAsync,e.correlationId),yt.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&t.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),i=s(s({},e),{account:t}),a=this.acquireTokenNative(i,b.acquireTokenSilent_silentFlow).catch(function(t){return c(u,void 0,void 0,function(){return d(this,function(n){if(t instanceof _t&&t.isFatal())return this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,[2,this.createSilentIframeClient(e.correlationId).acquireToken(e)];throw t})})}),[3,3]):[3,1];case 1:return this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),[4,(o=this.createSilentCacheClient(e.correlationId)).initializeSilentRequest(e,t)];case 2:l=f.sent(),a=o.acquireToken(l).catch(function(){return c(u,void 0,void 0,function(){return d(this,function(e){return[2,this.acquireTokenByRefreshToken(l)]})})}),f.label=3;case 3:return[2,a.then(function(e){return u.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_SUCCESS,g.Silent,e),n.endMeasurement({success:!0,fromCache:e.fromCache,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,isNativeBroker:e.fromNativeBroker}),e}).catch(function(e){throw u.eventHandler.emitEvent(ke.ACQUIRE_TOKEN_FAILURE,g.Silent,null,e),n.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})]}})})},t}(Pt)}
,300:(e,t,n)=>{n.d(t,{k:()=>a});class a{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}}
,5243:(e,t,n)=>{n.d(t,{Ts:()=>v,Z7:()=>y});var a=n(3905),i=n(7812),r=n(8222),o=n(5529),s=n(957),c=n(773),d=n(711);const l={sendGetRequestAsync:()=>Promise.reject((0,c.CP)(d.R2)),sendPostRequestAsync:()=>Promise.reject((0,c.CP)(d.R2))};var u=n(3700),f=n(3097),p=n(5405),m=n(586);class _{navigateInternal(e,t){return _.defaultNavigateWindow(e,t)}navigateExternal(e,t){return _.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(e=>{setTimeout(()=>{e(!0)},t.timeout)})}}var h=n(1235),b=n(2051);class g{async sendGetRequestAsync(e,t){let n;try{n=await fetch(e,{method:m.LC.GET,headers:this.getFetchHeaders(t)})}catch(e){throw window.navigator.onLine?(0,h.X_)(b.E8):(0,h.X_)(b.Rq)}try{return{headers:this.getHeaderDict(n.headers),body:await n.json(),status:n.status}}catch(e){throw(0,h.X_)(b.D6)}}async sendPostRequestAsync(e,t){const n=t&&t.body||a.oT.EMPTY_STRING;let i;try{i=await fetch(e,{method:m.LC.POST,headers:this.getFetchHeaders(t),body:n})}catch(e){throw window.navigator.onLine?(0,h.X_)(b.Ac):(0,h.X_)(b.Rq)}try{return{headers:this.getHeaderDict(i.headers),body:await i.json(),status:i.status}}catch(e){throw(0,h.X_)(b.D6)}}getFetchHeaders(e){const t=new Headers;if(!e||!e.headers)return t;const n=e.headers;return Object.keys(n).forEach(e=>{t.append(e,n[e])}),t}getHeaderDict(e){const t={};return e.forEach((e,n)=>{t[n]=e}),t}}const v=1e4;function y({auth:e,cache:t,system:n,telemetry:c},d){const h={clientId:a.oT.EMPTY_STRING,authority:`${a.oT.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:a.oT.EMPTY_STRING,authorityMetadata:a.oT.EMPTY_STRING,redirectUri:a.oT.EMPTY_STRING,postLogoutRedirectUri:a.oT.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:i.A.AAD,OIDCOptions:{serverResponseType:a.bg.FRAGMENT,defaultScopes:[a.oT.OPENID_SCOPE,a.oT.PROFILE_SCOPE,a.oT.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:r.z.None,tenant:a.oT.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1},b={cacheLocation:m.Tx.SessionStorage,temporaryCacheLocation:m.Tx.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!t||t.cacheLocation!==m.Tx.LocalStorage),claimsBasedCachingEnabled:!1},y={loggerCallback:()=>{},logLevel:o.i.Info,piiLoggingEnabled:!1},S={...{...s.z,loggerOptions:y,networkClient:d?new g:l,navigationClient:new _,loadFrameTimeout:0,windowHashTimeout:n?.loadFrameTimeout||6e4,iframeHashTimeout:n?.loadFrameTimeout||v,navigateFrameWait:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:n?.nativeBrokerHandshakeTimeout||2e3,pollIntervalMilliseconds:m.hx.DEFAULT_POLL_INTERVAL_MS},...n,loggerOptions:n?.loggerOptions||y},D={application:{appName:a.oT.EMPTY_STRING,appVersion:a.oT.EMPTY_STRING},client:new u.n};if(e?.protocolMode!==i.A.OIDC&&e?.OIDCOptions&&new o.Y(S.loggerOptions).warning(JSON.stringify((0,f.ii)(p.hz))),e?.protocolMode&&e.protocolMode!==i.A.AAD&&S?.allowNativeBroker)throw(0,f.ii)(p.Bl);return{auth:{...h,...e,OIDCOptions:{...h.OIDCOptions,...e?.OIDCOptions}},cache:{...b,...t},system:S,telemetry:{...D,...c}}}}
,605:(e,t,n)=>{n.r(t),n.d(t,{StandardController:()=>rt});var a={};n.r(a),n.d(a,{createDiscoveredInstance:()=>de});var i=n(3356),r=n(2190),o=n(5387),s=n(7157),c=n(773),d=n(3905),l=n(8843),u=n(3097),f=n(7812),p=n(8222),m=n(2520);const _=(e,t,n,a,i)=>(...r)=>{n.trace(`Executing function ${t}`);const o=a?.startMeasurement(t,i);try{const a=e(...r);return o?.end({success:!0}),n.trace(`Returning result from ${t}`),a}catch(e){n.trace(`Error occurred in ${t}`);try{n.trace(JSON.stringify(e))}catch(e){n.trace("Unable to print error message.")}throw o?.end({success:!1}),e}},h=(e,t,n,a,i)=>(...r)=>{n.trace(`Executing function ${t}`);const o=a?.startMeasurement(t,i);return a?.setPreQueueTime(t,i),e(...r).then(e=>(n.trace(`Returning result from ${t}`),o?.end({success:!0}),e)).catch(e=>{n.trace(`Error occurred in ${t}`);try{n.trace(JSON.stringify(e))}catch(e){n.trace("Unable to print error message.")}throw o?.end({success:!1}),e})};class b{constructor(e,t,n,a){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=a}async detectRegion(e,t){this.performanceClient?.addQueueMeasurement(m.Ok.RegionDiscoveryDetectRegion,this.correlationId);let n=e;if(n)t.region_source=d.W.ENVIRONMENT_VARIABLE;else{const e=b.IMDS_OPTIONS;try{const a=await h(this.getRegionFromIMDS.bind(this),m.Ok.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(d.oT.IMDS_VERSION,e);if(a.status===d.JY.httpSuccess&&(n=a.body,t.region_source=d.W.IMDS),a.status===d.JY.httpBadRequest){const a=await h(this.getCurrentVersion.bind(this),m.Ok.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(e);if(!a)return t.region_source=d.W.FAILED_AUTO_DETECTION,null;const i=await h(this.getRegionFromIMDS.bind(this),m.Ok.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(a,e);i.status===d.JY.httpSuccess&&(n=i.body,t.region_source=d.W.IMDS)}}catch(e){return t.region_source=d.W.FAILED_AUTO_DETECTION,null}}return n||(t.region_source=d.W.FAILED_AUTO_DETECTION),n||null}async getRegionFromIMDS(e,t){return this.performanceClient?.addQueueMeasurement(m.Ok.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${d.oT.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,d.oT.IMDS_TIMEOUT)}async getCurrentVersion(e){this.performanceClient?.addQueueMeasurement(m.Ok.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const t=await this.networkInterface.sendGetRequestAsync(`${d.oT.IMDS_ENDPOINT}?format=json`,e);return t.status===d.JY.httpBadRequest&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?t.body["newest-versions"][0]:null}catch(e){return null}}}b.IMDS_OPTIONS={headers:{Metadata:"true"}};var g=n(6925),v=n(6279),y=n(711),S=n(5405);class D{constructor(e,t,n,a,i,r,o){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=a,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=i,this.performanceClient=o,this.correlationId=r,this.regionDiscovery=new b(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(d.oT.CIAM_AUTH_URL))return o.a.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case d.oT.ADFS:return o.a.Adfs;case d.oT.DSTS:return o.a.Dsts}return o.a.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new s.G(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw(0,c.CP)(y.PO)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw(0,c.CP)(y.PO)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw(0,c.CP)(y.PO)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw(0,c.CP)(y.cg);return this.replacePath(this.metadata.end_session_endpoint)}throw(0,c.CP)(y.PO)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw(0,c.CP)(y.PO)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw(0,c.CP)(y.PO)}canReplaceTenant(e){return 1===e.PathSegments.length&&!D.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===o.a.Default&&this.protocolMode===f.A.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const n=new s.G(this.metadata.canonical_authority).getUrlComponents(),a=n.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((e,i)=>{let r=a[i];if(0===i&&this.canReplaceTenant(n)){const e=new s.G(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];r!==e&&(this.logger.verbose(`Replacing tenant domain name ${r} with id ${e}`),r=e)}e!==r&&(t=t.replace(`/${r}/`,`/${e}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===o.a.Adfs||this.protocolMode!==f.A.AAD&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){this.performanceClient?.addQueueMeasurement(m.Ok.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await h(this.updateCloudDiscoveryMetadata.bind(this),m.Ok.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const n=await h(this.updateEndpointMetadata.bind(this),m.Ok.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:n}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:n},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:(0,v.zw)(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==d._Q.CACHE&&n?.source!==d._Q.CACHE&&(e.expiresAt=(0,v.zw)(),e.canonical_authority=this.canonicalAuthority);const a=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(a,e),this.metadata=e}async updateEndpointMetadata(e){this.performanceClient?.addQueueMeasurement(m.Ok.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===d._Q.HARDCODED_VALUES&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata){const n=await h(this.updateMetadataWithRegionalInformation.bind(this),m.Ok.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);(0,v.Ic)(e,n,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let n=await h(this.getEndpointMetadataFromNetwork.bind(this),m.Ok.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(n=await h(this.updateMetadataWithRegionalInformation.bind(this),m.Ok.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(n)),(0,v.Ic)(e,n,!0),d._Q.NETWORK;throw(0,c.CP)(y.Ee,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),(0,v.Ic)(e,t,!1),{source:d._Q.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const t=this.getEndpointMetadataFromHardcodedValues();if(t)return(0,v.Ic)(e,t,!1),{source:d._Q.HARDCODED_VALUES,metadata:t};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const n=(0,v.l5)(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:d._Q.CACHE}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new s.G(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw(0,u.ii)(S.Cx)}return null}async getEndpointMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(m.Ok.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const n=await this.networkInterface.sendGetRequestAsync(t,e),a=function(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}(n.body);return a?n.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(e){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${e}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in l.Vh?l.Vh[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){this.performanceClient?.addQueueMeasurement(m.Ok.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==d.oT.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=d.li.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,D.replaceWithRegionalInformation(e,t);const n=await h(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),m.Ok.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(n)return this.regionDiscoveryMetadata.region_outcome=d.li.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=n,D.replaceWithRegionalInformation(e,n);this.regionDiscoveryMetadata.region_outcome=d.li.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){this.performanceClient?.addQueueMeasurement(m.Ok.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const n=await h(this.getCloudDiscoveryMetadataFromNetwork.bind(this),m.Ok.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return(0,v.Ed)(e,n,!0),d._Q.NETWORK;throw(0,u.ii)(S.m_)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||d.oT.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||d.oT.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||d.oT.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),(0,v.Ed)(e,t,!1),d._Q.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const t=(0,l.cx)(this.hostnameAndPort);if(t)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),(0,v.Ed)(e,t,!1),d._Q.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const n=(0,v.l5)(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),d._Q.CACHE):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===o.a.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),D.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=(0,l.iM)(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch(e){throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),(0,u.ii)(S.E)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),D.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(m.Ok.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${d.oT.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let n=null;try{const a=await this.networkInterface.sendGetRequestAsync(e,t);let i,r;if(function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(a.body))i=a.body,r=i.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${i.tenant_discovery_endpoint}`);else{if(!function(e){return e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")}(a.body))return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${a.status}`),i=a.body,i.error===d.oT.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${i.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${i.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),r=[]}this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),n=(0,l.iM)(r,this.hostnameAndPort)}catch(e){if(e instanceof g.u4)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.\nError: ${e.errorCode}\nError Description: ${e.errorMessage}`);else{const t=e;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: ${t.name}\nError Description: ${t.message}`)}return null}return n||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),n=D.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),n}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(e=>e&&s.G.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;if(t&&t.azureCloudInstance!==p.z.None){const e=t.tenant?t.tenant:d.oT.DEFAULT_COMMON_TENANT;n=`${t.azureCloudInstance}/${e}/`}return n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.discoveryComplete())return this.metadata.preferred_cache;throw(0,c.CP)(y.PO)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return l.Dn.has(e)}static isPublicCloudAuthority(e){return d.oT.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){const a=new s.G(e);a.validateAsUri();const i=a.getUrlComponents();let r=`${t}.${i.HostNameAndPort}`;this.isPublicCloudAuthority(i.HostNameAndPort)&&(r=`${t}.${d.oT.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const o=s.G.constructAuthorityUriFromObject({...a.getUrlComponents(),HostNameAndPort:r}).urlString;return n?`${o}?${n}`:o}static replaceWithRegionalInformation(e,t){const n={...e};return n.authorization_endpoint=D.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=D.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=D.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const n=new s.G(e).getUrlComponents();return 0===n.PathSegments.length&&n.HostNameAndPort.endsWith(d.oT.CIAM_AUTH_URL)&&(t=`${t}${n.HostNameAndPort.split(".")[0]}${d.oT.AAD_TENANT_DOMAIN_SUFFIX}`),t}}function I(e){return e.endsWith(d.oT.FORWARD_SLASH)?e:`${e}${d.oT.FORWARD_SLASH}`}D.reservedTenantDomains=new Set(["{tenant}","{tenantid}",d.Nb.COMMON,d.Nb.CONSUMERS,d.Nb.ORGANIZATIONS]);var x=n(6937),C=n(2122),O=n(5361),w=n(5908),E=n(543);class A{static setRequestState(e,t,n){const a=A.generateLibraryState(e,n);return t?`${a}${d.oT.RESOURCE_DELIM}${t}`:a}static generateLibraryState(e,t){if(!e)throw(0,c.CP)(y.VL);const n={id:e.createNewGuid()};t&&(n.meta=t);const a=JSON.stringify(n);return e.base64Encode(a)}static parseRequestState(e,t){if(!e)throw(0,c.CP)(y.VL);if(!t)throw(0,c.CP)(y.b8);try{const n=t.split(d.oT.RESOURCE_DELIM),a=n[0],i=n.length>1?n.slice(1).join(d.oT.RESOURCE_DELIM):d.oT.EMPTY_STRING,r=e.base64Decode(a),o=JSON.parse(r);return{userRequestState:i||d.oT.EMPTY_STRING,libraryState:o}}catch(e){throw(0,c.CP)(y.b8)}}}const L="home_account_id",k="UPN";var M=n(5500);class P{constructor(e,t,n,a,i){this.account=e||null,this.idToken=t||null,this.accessToken=n||null,this.refreshToken=a||null,this.appMetadata=i||null}}var T=n(1235),U=n(586);const F="storage_not_supported",H="in_mem_redirect_unavailable",R={[F]:"Given storage configuration option was not supported.",stubbed_public_client_application_called:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[H]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class N extends g.u4{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,N.prototype)}}function B(e){return new N(e,R[e])}class j{constructor(e){this.validateWindowStorage(e),this.windowStorage=window[e]}validateWindowStorage(e){if(e!==U.Tx.LocalStorage&&e!==U.Tx.SessionStorage||!window[e])throw B(F)}getItem(e){return this.windowStorage.getItem(e)}setItem(e,t){this.windowStorage.setItem(e,t)}removeItem(e){this.windowStorage.removeItem(e)}getKeys(){return Object.keys(this.windowStorage)}containsKey(e){return this.windowStorage.hasOwnProperty(e)}}var V=n(300);function z(e,t){if(!t)return null;try{return A.parseRequestState(e,t).libraryState.meta}catch(e){throw(0,c.CP)(y.b8)}}var G=n(6952),K=n(6093),W=n(2051);class q extends w.L{constructor(e,t,n,a,i){super(e,n,a,i),this.COOKIE_LIFE_MULTIPLIER=864e5,this.cacheConfig=t,this.logger=a,this.internalStorage=new V.k,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupTemporaryCacheStorage(this.cacheConfig.temporaryCacheLocation,this.cacheConfig.cacheLocation),t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps())}setupBrowserStorage(e){switch(e){case U.Tx.LocalStorage:case U.Tx.SessionStorage:try{return new j(e)}catch(e){this.logger.verbose(e);break}}return this.cacheConfig.cacheLocation=U.Tx.MemoryStorage,new V.k}setupTemporaryCacheStorage(e,t){switch(t){case U.Tx.LocalStorage:case U.Tx.SessionStorage:try{return new j(e||U.Tx.SessionStorage)}catch(e){return this.logger.verbose(e),this.internalStorage}case U.Tx.MemoryStorage:default:return this.internalStorage}}migrateCacheEntries(){const e=`${d.oT.CACHE_PREFIX}.${d.qi.ID_TOKEN}`,t=`${d.oT.CACHE_PREFIX}.${d.qi.CLIENT_INFO}`,n=`${d.oT.CACHE_PREFIX}.${d.qi.ERROR}`,a=`${d.oT.CACHE_PREFIX}.${d.qi.ERROR_DESC}`,i=[this.browserStorage.getItem(e),this.browserStorage.getItem(t),this.browserStorage.getItem(n),this.browserStorage.getItem(a)];[d.qi.ID_TOKEN,d.qi.CLIENT_INFO,d.qi.ERROR,d.qi.ERROR_DESC].forEach((e,t)=>this.migrateCacheEntry(e,i[t]))}migrateCacheEntry(e,t){t&&this.setTemporaryCache(e,t,!0)}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");const e=this.getItem(U.Bq.ACCOUNT_KEYS),t=this.getItem(`${U.Bq.TOKEN_KEYS}.${this.clientId}`);e&&t?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach(e=>{if(this.isCredentialKey(e)){const t=this.getItem(e);if(t){const n=this.validateAndParseJson(t);if(n&&n.hasOwnProperty("credentialType"))switch(n.credentialType){case d.a3.ID_TOKEN:if(v.wq(n)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${e} found, saving key to token key map`);const t=n,a=this.updateCredentialCacheKey(e,t);return void this.addTokenKey(a,d.a3.ID_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${e}`);break;case d.a3.ACCESS_TOKEN:case d.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(v.Bm(n)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${e} found, saving key to token key map`);const t=n,a=this.updateCredentialCacheKey(e,t);return void this.addTokenKey(a,d.a3.ACCESS_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${e}`);break;case d.a3.REFRESH_TOKEN:if(v.I4(n)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${e} found, saving key to token key map`);const t=n,a=this.updateCredentialCacheKey(e,t);return void this.addTokenKey(a,d.a3.REFRESH_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${e}`)}}}if(this.isAccountKey(e)){const t=this.getItem(e);if(t){const n=this.validateAndParseJson(t);n&&C.r.isAccountEntity(n)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${e} found, saving key to account key map`),this.addAccountKeyToMap(e))}}})}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t){this.browserStorage.setItem(e,t)}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const n=this.getCachedAccountEntity(e);return this.updateOutdatedCachedAccount(e,n,t)}getCachedAccountEntity(e){const t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;const n=this.validateAndParseJson(t);return n&&C.r.isAccountEntity(n)?w.L.toObject(new C.r,n):(this.removeAccountKeyFromMap(e),null)}setAccount(e){this.logger.trace("BrowserCacheManager.setAccount called");const t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");const e=this.getItem(U.Bq.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const t=this.getAccountKeys();-1===t.indexOf(e)?(t.push(e),this.setItem(U.Bq.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const t=this.getAccountKeys(),n=t.indexOf(e);n>-1?(t.splice(n,1),this.setItem(U.Bq.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e){super.removeAccount(e),this.removeAccountKeyFromMap(e)}removeOutdatedAccount(e){this.removeItem(e),this.removeAccountKeyFromMap(e)}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,d.a3.ID_TOKEN)}async removeAccessToken(e){super.removeAccessToken(e),this.removeTokenKey(e,d.a3.ACCESS_TOKEN)}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,d.a3.REFRESH_TOKEN)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");const e=this.getItem(`${U.Bq.TOKEN_KEYS}.${this.clientId}`);if(e){const t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");const n=this.getTokenKeys();switch(t){case d.a3.ID_TOKEN:-1===n.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),n.idToken.push(e));break;case d.a3.ACCESS_TOKEN:-1===n.accessToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),n.accessToken.push(e));break;case d.a3.REFRESH_TOKEN:-1===n.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),n.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),(0,c.CP)(y.ny)}this.setItem(`${U.Bq.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");const n=this.getTokenKeys();switch(t){case d.a3.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const a=n.idToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),n.idToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case d.a3.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const i=n.accessToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),n.accessToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case d.a3.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const r=n.refreshToken.indexOf(e);r>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),n.refreshToken.splice(r,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),(0,c.CP)(y.ny)}this.setItem(`${U.Bq.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}getIdTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,d.a3.ID_TOKEN),null;const n=this.validateAndParseJson(t);return n&&v.wq(n)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,d.a3.ID_TOKEN),null)}setIdTokenCredential(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const t=v.Rk(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,d.a3.ID_TOKEN)}getAccessTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,d.a3.ACCESS_TOKEN),null;const n=this.validateAndParseJson(t);return n&&v.Bm(n)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,d.a3.ACCESS_TOKEN),null)}setAccessTokenCredential(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const t=v.Rk(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,d.a3.ACCESS_TOKEN)}getRefreshTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,d.a3.REFRESH_TOKEN),null;const n=this.validateAndParseJson(t);return n&&v.I4(n)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,d.a3.REFRESH_TOKEN),null)}setRefreshTokenCredential(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const t=v.Rk(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,d.a3.REFRESH_TOKEN)}getAppMetadata(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&v.XL(e,n)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");const t=v.Bx(e);this.setItem(t,JSON.stringify(e))}getServerTelemetry(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&v.Us(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),n):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&v.kK(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(e=>this.isAuthorityMetadata(e))}setWrapperMetadata(e,t){this.internalStorage.setItem(U.ws.WRAPPER_SKU,e),this.internalStorage.setItem(U.ws.WRAPPER_VER,t)}getWrapperMetadata(){return[this.internalStorage.getItem(U.ws.WRAPPER_SKU)||d.oT.EMPTY_STRING,this.internalStorage.getItem(U.ws.WRAPPER_VER)||d.oT.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){const e=this.generateCacheKey(d.qi.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");const e=this.generateCacheKey(d.qi.ACTIVE_ACCOUNT),t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;const n=this.getAccountInfoFilteredBy({localAccountId:t});return n?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(n),n):null}const n=this.validateAndParseJson(t);return n?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,tenantId:n.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){const t=this.generateCacheKey(d.qi.ACTIVE_ACCOUNT_FILTERS),n=this.generateCacheKey(d.qi.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");const a={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.browserStorage.setItem(t,JSON.stringify(a)),this.browserStorage.setItem(n,e.localAccountId)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(n)}getThrottlingCache(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&v.qQ(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){const n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const e=this.getItemCookie(n);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),e}const a=this.temporaryCacheStorage.getItem(n);if(!a){if(this.cacheConfig.cacheLocation===U.Tx.LocalStorage){const e=this.browserStorage.getItem(n);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),e}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),a}setTemporaryCache(e,t,n){const a=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(a,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(a,t))}removeItem(e){this.browserStorage.removeItem(e),this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(e))}containsKey(e){return this.browserStorage.containsKey(e)||this.temporaryCacheStorage.containsKey(e)}getKeys(){return[...this.browserStorage.getKeys(),...this.temporaryCacheStorage.getKeys()]}async clear(){await this.removeAllAccounts(),this.removeAppMetadata(),this.getKeys().forEach(e=>{!this.browserStorage.containsKey(e)&&!this.temporaryCacheStorage.containsKey(e)||-1===e.indexOf(d.oT.CACHE_PREFIX)&&-1===e.indexOf(this.clientId)||this.removeItem(e)}),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e){e.addQueueMeasurement(m.Ok.ClearTokensAndKeysWithClaims);const t=this.getTokenKeys(),n=[];t.accessToken.forEach(e=>{const t=this.getAccessTokenCredential(e);t?.requestedClaimsHash&&e.includes(t.requestedClaimsHash.toLowerCase())&&n.push(this.removeAccessToken(e))}),await Promise.all(n),n.length>0&&this.logger.warning(`${n.length} access tokens with claims in the cache keys have been removed from the cache.`)}setItemCookie(e,t,n){let a=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;n&&(a+=`expires=${this.getCookieExpirationTime(n)};`),this.cacheConfig.secureCookies&&(a+="Secure;"),document.cookie=a}getItemCookie(e){const t=`${encodeURIComponent(e)}=`,n=document.cookie.split(";");for(let e=0;e<n.length;e++){let a=n[e];for(;" "===a.charAt(0);)a=a.substring(1);if(0===a.indexOf(t))return decodeURIComponent(a.substring(t.length,a.length))}return d.oT.EMPTY_STRING}clearMsalCookies(){const e=`${d.oT.CACHE_PREFIX}.${this.clientId}`;document.cookie.split(";").forEach(t=>{for(;" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(e)){const e=t.split("=")[0];this.clearItemCookie(e)}})}clearItemCookie(e){this.setItemCookie(e,d.oT.EMPTY_STRING,-1)}getCookieExpirationTime(e){const t=new Date;return new Date(t.getTime()+e*this.COOKIE_LIFE_MULTIPLIER).toUTCString()}getCache(){return this.browserStorage}setCache(){}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):E.x.startsWith(e,d.oT.CACHE_PREFIX)||E.x.startsWith(e,d.qi.ADAL_ID_TOKEN)?e:`${d.oT.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=A.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${U.n4.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=A.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${U.n4.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=A.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${U.n4.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),n=this.getTemporaryCache(t);if(!n)return null;const a=this.generateAuthorityKey(n);return this.getTemporaryCache(a)}updateCacheEntries(e,t,n,a,i){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const r=this.generateStateKey(e);this.setTemporaryCache(r,e,!1);const o=this.generateNonceKey(e);this.setTemporaryCache(o,t,!1);const s=this.generateAuthorityKey(e);if(this.setTemporaryCache(s,n,!1),i){const e={credential:i.homeAccountId,type:L};this.setTemporaryCache(U.n4.CCS_CREDENTIAL,JSON.stringify(e),!0)}else if(a){const e={credential:a,type:k};this.setTemporaryCache(U.n4.CCS_CREDENTIAL,JSON.stringify(e),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.getKeys().forEach(t=>{-1!==t.indexOf(e)&&this.removeItem(t)}),this.removeItem(this.generateStateKey(e)),this.removeItem(this.generateNonceKey(e)),this.removeItem(this.generateAuthorityKey(e))),this.removeItem(this.generateCacheKey(U.n4.REQUEST_PARAMS)),this.removeItem(this.generateCacheKey(U.n4.ORIGIN_URI)),this.removeItem(this.generateCacheKey(U.n4.URL_HASH)),this.removeItem(this.generateCacheKey(U.n4.CORRELATION_ID)),this.removeItem(this.generateCacheKey(U.n4.CCS_CREDENTIAL)),this.removeItem(this.generateCacheKey(U.n4.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),n=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n||d.oT.EMPTY_STRING)}this.clearMsalCookies()}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.getKeys().forEach(t=>{if(-1===t.indexOf(U.n4.REQUEST_STATE))return;const n=this.temporaryCacheStorage.getItem(t);if(!n)return;const a=z(this.cryptoImpl,n);a&&a.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n))}),this.clearMsalCookies(),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=(0,K.s$)(JSON.stringify(e));this.setTemporaryCache(U.n4.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(U.n4.REQUEST_PARAMS,!0);if(!t)throw(0,T.X_)(W.VO);let n;try{n=JSON.parse((0,G.t)(t))}catch(e){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${e}`),(0,T.X_)(W.i$)}if(this.removeItem(this.generateCacheKey(U.n4.REQUEST_PARAMS)),!n.authority){const t=this.generateAuthorityKey(e),a=this.getTemporaryCache(t);if(!a)throw(0,T.X_)(W.aT);n.authority=a}return n}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(U.n4.NATIVE_REQUEST,!0);return e?this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${d.oT.CACHE_PREFIX}.${U.n4.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${d.oT.CACHE_PREFIX}.${U.n4.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw(0,T.X_)(W.Ek);this.setTemporaryCache(t,this.clientId,!1)}else e||this.getInteractionInProgress()!==this.clientId||this.removeItem(t)}getLegacyLoginHint(){const e=this.getTemporaryCache(d.qi.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(d.qi.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));const t=this.getTemporaryCache(d.qi.ID_TOKEN,!0);t&&(this.removeItem(this.generateCacheKey(d.qi.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));const n=t||e;if(n){const e=M.X_(n,G.t);if(e.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),e.preferred_username;if(e.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),e.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t){const n=v.Rk(t);if(e!==n){const a=this.getItem(e);if(a)return this.removeItem(e),this.setItem(n,a),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),n;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}getRedirectRequestContext(){return this.getTemporaryCache(U.n4.REDIRECT_CONTEXT,!0)}setRedirectRequestContext(e){this.setTemporaryCache(U.n4.REDIRECT_CONTEXT,e,!0)}async hydrateCache(e,t){const n=v.Rd(e.account?.homeAccountId,e.account?.environment,e.idToken,this.clientId,e.tenantId);let a;t.claims&&(a=await this.cryptoImpl.hashString(t.claims));const i=v.As(e.account?.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?.getTime()||0,e.extExpiresOn?.getTime()||0,G.t,void 0,e.tokenType,void 0,t.sshKid,t.claims,a),r=new P(void 0,n,i);return this.saveCacheRecord(r)}}function Q(){return window.parent!==window}function Y(){return window.location.href.split("?")[0].split("#")[0]}function J(){if(s.G.hashContainsKnownProperties(window.location.hash)&&Q())throw(0,T.X_)(W.IO)}function X(e){if(!e)throw(0,T.X_)(W.el)}function Z(e){const t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout(()=>{try{document.head.removeChild(t)}catch{}},1e4)}var $=n(3938),ee=n(9079),te=n(2586);class ne{static generateThrottlingStorageKey(e){return`${d.tb.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){const n=ne.generateThrottlingStorageKey(t),a=e.getThrottlingCache(n);if(a){if(a.throttleTime<Date.now())return void e.removeItem(n);throw new te.n(a.errorCodes?.join(" ")||d.oT.EMPTY_STRING,a.errorMessage,a.subError)}}static postProcess(e,t,n){if(ne.checkResponseStatus(n)||ne.checkResponseForRetryAfter(n)){const a={throttleTime:ne.calculateThrottleTime(parseInt(n.headers[d.GZ.RETRY_AFTER])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(ne.generateThrottlingStorageKey(t),a)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(d.GZ.RETRY_AFTER)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(1e3*Math.min(n+(t||d.tb.DEFAULT_THROTTLE_TIME_SECONDS),n+d.tb.DEFAULT_MAX_THROTTLE_TIME_SECONDS))}static removeThrottle(e,t,n,a){const i={clientId:t,authority:n.authority,scopes:n.scopes,homeAccountIdentifier:a,claims:n.claims,authenticationScheme:n.authenticationScheme,resourceRequestMethod:n.resourceRequestMethod,resourceRequestUri:n.resourceRequestUri,shrClaims:n.shrClaims,sshKid:n.sshKid},r=this.generateThrottlingStorageKey(i);e.removeItem(r)}}var ae=n(957);class ie{constructor(e,t){this.networkClient=e,this.cacheManager=t}async sendPostRequest(e,t,n){let a;ne.preProcess(this.cacheManager,e);try{a=await this.networkClient.sendPostRequestAsync(t,n)}catch(e){throw e instanceof g.u4?e:(0,c.CP)(y.LF)}return ne.postProcess(this.cacheManager,e,a),a}}var re=n(5529),oe=n(2129),se=n(5865),ce=n(4358);async function de(e,t,n,a,i,r,o){o?.addQueueMeasurement(m.Ok.AuthorityFactoryCreateDiscoveredInstance,r);const s=D.transformCIAMAuthority(I(e)),d=new D(s,t,n,a,i,r,o);try{return await h(d.resolveEndpointsAsync.bind(d),m.Ok.AuthorityResolveEndpointsAsync,i,o,r)(),d}catch(e){throw(0,c.CP)(y.PO)}}class le{constructor(e,t){this.config=(0,ae.d6)(e),this.logger=new re.Y(this.config.loggerOptions,oe.u,oe.i),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new ie(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[d.GZ.CONTENT_TYPE]=d.oT.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case L:try{const n=(0,se.j)(e.credential);t[d.GZ.CCS_HEADER]=`Oid:${n.uid}@${n.utid}`}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case k:t[d.GZ.CCS_HEADER]=`UPN: ${e.credential}`}return t}async executePostToTokenEndpoint(e,t,n,a,i,r){r&&this.performanceClient?.addQueueMeasurement(r,i);const o=await this.networkManager.sendPostRequest(a,e,{body:t,headers:n});return this.performanceClient?.addFields({refreshTokenSize:o.body.refresh_token?.length||0,httpVerToken:o.headers?.[d.GZ.X_MS_HTTP_VERSION]||""},i),this.config.serverTelemetryManager&&o.status<500&&429!==o.status&&this.config.serverTelemetryManager.clearTelemetryCache(),o}async updateAuthority(e,t){this.performanceClient?.addQueueMeasurement(m.Ok.UpdateTokenEndpointAuthority,t);const n=`https://${e}/${this.authority.tenant}/`,a=await de(n,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=a}createTokenQueryParameters(e){const t=new ce.H;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()}}var ue=n(6238),fe=n(8211),pe=n(6124);class me{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){this.performanceClient?.addQueueMeasurement(m.Ok.PopTokenGenerateCnf,e.correlationId);const n=await h(this.generateKid.bind(this),m.Ok.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),a=this.cryptoUtils.base64Encode(JSON.stringify(n));return{kid:n.kid,reqCnfString:a,reqCnfHash:await this.cryptoUtils.hashString(a)}}async generateKid(e){return this.performanceClient?.addQueueMeasurement(m.Ok.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}}async signPopToken(e,t,n){return this.signPayload(e,t,n)}async signPayload(e,t,n,a){const{resourceRequestMethod:i,resourceRequestUri:r,shrClaims:o,shrNonce:c,shrOptions:d}=n,l=(r?new s.G(r):void 0)?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:pe.I.nowSeconds(),m:i?.toUpperCase(),u:l?.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:l?.AbsolutePath,q:l?.QueryString?[[],l.QueryString]:void 0,client_claims:o||void 0,...a},t,d,n.correlationId)}}class _e{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}var he=n(265),be=n(8036);class ge{constructor(e,t,n,a,i,r,o){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=a,this.serializableCache=i,this.persistencePlugin=r,this.performanceClient=o}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?(0,c.CP)(y.HV,"Cached State"):(0,c.CP)(y.HV,"Server State");let n,a;try{n=decodeURIComponent(e.state)}catch(t){throw(0,c.CP)(y.b8,e.state)}try{a=decodeURIComponent(t)}catch(t){throw(0,c.CP)(y.b8,e.state)}if(n!==a)throw(0,c.CP)(y.Ku);if(e.error||e.error_description||e.suberror){if((0,x.Ef)(e.error,e.error_description,e.suberror))throw new x.Jo(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"");throw new te.n(e.error||"",e.error_description,e.suberror)}}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){const n=`${e.error_codes} - [${e.timestamp}]: ${e.error_description} - Correlation ID: ${e.correlation_id} - Trace ID: ${e.trace_id}`,a=new te.n(e.error,n,e.suberror);if(t&&e.status&&e.status>=d.mj.SERVER_ERROR_RANGE_START&&e.status<=d.mj.SERVER_ERROR_RANGE_END)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.\n${a}`);if(t&&e.status&&e.status>=d.mj.CLIENT_ERROR_RANGE_START&&e.status<=d.mj.CLIENT_ERROR_RANGE_END)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.\n${a}`);if((0,x.Ef)(e.error,e.error_description,e.suberror))throw new x.Jo(e.error,e.error_description,e.suberror,e.timestamp||d.oT.EMPTY_STRING,e.trace_id||d.oT.EMPTY_STRING,e.correlation_id||d.oT.EMPTY_STRING,e.claims||d.oT.EMPTY_STRING);throw a}}async handleServerTokenResponse(e,t,n,a,i,r,o,s,l){let u,f;if(this.performanceClient?.addQueueMeasurement(m.Ok.HandleServerTokenResponse,e.correlation_id),e.id_token){if(u=(0,M.X_)(e.id_token||d.oT.EMPTY_STRING,this.cryptoObj.base64Decode),i&&i.nonce&&u.nonce!==i.nonce)throw(0,c.CP)(y.SR);if(a.maxAge||0===a.maxAge){const e=u.auth_time;if(!e)throw(0,c.CP)(y.D7);(0,M.ly)(e,a.maxAge)}}this.homeAccountIdentifier=C.r.generateHomeAccountId(e.client_info||d.oT.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,u),i&&i.state&&(f=A.parseRequestState(this.cryptoObj,i.state)),e.key_id=e.key_id||a.sshKid||void 0;const p=this.generateCacheRecord(e,t,n,a,u,r,i);let _;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),_=new _e(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(_)),o&&!s&&p.account){const e=p.account.generateAccountKey();if(!this.cacheStorage.getAccount(e,this.logger))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await ge.generateAuthenticationResult(this.cryptoObj,t,p,!1,a,u,f,void 0,l)}await this.cacheStorage.saveCacheRecord(p,a.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&_&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(_))}return ge.generateAuthenticationResult(this.cryptoObj,t,p,!1,a,u,f,e,l)}generateCacheRecord(e,t,n,a,i,r,o){const s=t.getPreferredCache();if(!s)throw(0,c.CP)(y.V9);const d=(0,he.M)(i);let l,u;e.id_token&&i&&(l=(0,v.Rd)(this.homeAccountIdentifier,s,e.id_token,this.clientId,d||""),u=ve(this.cacheStorage,t,this.homeAccountIdentifier,i,this.cryptoObj.base64Decode,e.client_info,s,d,o,void 0,this.logger));let f=null;if(e.access_token){const i=e.scope?fe.i.fromString(e.scope):new fe.i(a.scopes||[]),o=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,c=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,l=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,u=n+o,p=u+c,m=l&&l>0?n+l:void 0;f=(0,v.As)(this.homeAccountIdentifier,s,e.access_token,this.clientId,d||t.tenant,i.printScopes(),u,p,this.cryptoObj.base64Decode,m,e.token_type,r,e.key_id,a.claims,a.requestedClaimsHash)}let p=null;if(e.refresh_token){let t;e.refresh_token_expires_in&&(t=n+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)),p=(0,v.BJ)(this.homeAccountIdentifier,s,e.refresh_token,this.clientId,e.foci,r,t)}let m=null;return e.foci&&(m={clientId:this.clientId,environment:s,familyId:e.foci}),new P(u,l,f,p,m)}static async generateAuthenticationResult(e,t,n,a,i,r,o,s,l){let u,f,p=d.oT.EMPTY_STRING,m=[],_=null,h=d.oT.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType===d.sO.POP){const t=new me(e),{secret:a,keyId:r}=n.accessToken;if(!r)throw(0,c.CP)(y.Bf);p=await t.signPopToken(a,r,i)}else p=n.accessToken.secret;m=fe.i.fromString(n.accessToken.target).asArray(),_=new Date(1e3*Number(n.accessToken.expiresOn)),u=new Date(1e3*Number(n.accessToken.extendedExpiresOn)),n.accessToken.refreshOn&&(f=new Date(1e3*Number(n.accessToken.refreshOn)))}n.appMetadata&&(h=n.appMetadata.familyId===d.nh?d.nh:"");const b=r?.oid||r?.sub||"",g=r?.tid||"";s?.spa_accountid&&n.account&&(n.account.nativeAccountId=s?.spa_accountid);const v=n.account?(0,be.$f)(n.account.getAccountInfo(),void 0,r):null;return{authority:t.canonicalAuthority,uniqueId:b,tenantId:g,scopes:m,account:v,idToken:n?.idToken?.secret||"",idTokenClaims:r||{},accessToken:p,fromCache:a,expiresOn:_,extExpiresOn:u,refreshOn:f,correlationId:i.correlationId,requestId:l||d.oT.EMPTY_STRING,familyId:h,tokenType:n.accessToken?.tokenType||d.oT.EMPTY_STRING,state:o?o.userRequestState:d.oT.EMPTY_STRING,cloudGraphHostName:n.account?.cloudGraphHostName||d.oT.EMPTY_STRING,msGraphHost:n.account?.msGraphHost||d.oT.EMPTY_STRING,code:s?.spa_code,fromNativeBroker:!1}}}function ve(e,t,n,a,i,r,o,s,c,d,l){l?.verbose("setCachedAccount called");const u=e.getAccountKeys().find(e=>e.startsWith(n));let f=null;u&&(f=e.getAccount(u,l));const p=f||C.r.createAccount({homeAccountId:n,idTokenClaims:a,clientInfo:r,environment:o,cloudGraphHostName:c?.cloud_graph_host_name,msGraphHost:c?.msgraph_host,nativeAccountId:d},t,i),m=p.tenantProfiles||[];if(s&&!m.find(e=>e.tenantId===s)){const e=(0,be.GI)(n,a);m.push(e)}return p.tenantProfiles=m,p}var ye=n(1190);class Se extends le{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async getAuthCodeUrl(e){this.performanceClient?.addQueueMeasurement(m.Ok.GetAuthCodeUrl,e.correlationId);const t=await h(this.createAuthCodeUrlQueryString.bind(this),m.Ok.AuthClientCreateQueryString,this.logger,this.performanceClient,e.correlationId)(e);return s.G.appendQueryString(this.authority.authorizationEndpoint,t)}async acquireToken(e,t){if(this.performanceClient?.addQueueMeasurement(m.Ok.AuthClientAcquireToken,e.correlationId),!e.code)throw(0,c.CP)(y.kU);const n=pe.I.nowSeconds(),a=await h(this.executeTokenRequest.bind(this),m.Ok.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),i=a.headers?.[d.GZ.X_MS_REQUEST_ID],r=new ge(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return r.validateTokenResponse(a.body),h(r.handleServerTokenResponse.bind(r),m.Ok.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(a.body,this.authority,n,e,t,void 0,void 0,void 0,i)}handleFragmentResponse(e,t){if(new ge(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw(0,c.CP)(y.Xv);return e}getLogoutUri(e){if(!e)throw(0,u.ii)(S.$h);const t=this.createLogoutUrlQueryString(e);return s.G.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(m.Ok.AuthClientExecuteTokenRequest,t.correlationId);const n=this.createTokenQueryParameters(t),a=s.G.appendQueryString(e.tokenEndpoint,n),i=await h(this.createTokenRequestBody.bind(this),m.Ok.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let r;if(t.clientInfo)try{const e=(0,se.B)(t.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${e.uid}${d.wv.CLIENT_INFO_SEPARATOR}${e.utid}`,type:L}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}const o=this.createTokenRequestHeaders(r||t.ccsCredential),c={clientId:t.tokenBodyParameters?.clientId||this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return h(this.executePostToTokenEndpoint.bind(this),m.Ok.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(a,i,o,c,t.correlationId,m.Ok.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(m.Ok.AuthClientCreateTokenRequestBody,e.correlationId);const t=new ce.H;if(t.addClientId(e.tokenBodyParameters?.[ue.Ex]||this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):ye.D.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes,!0,this.oidcDefaultScopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&!(0,ae.uh)(this.config)&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const e=this.config.clientCredentials.clientAssertion;t.addClientAssertion(e.assertion),t.addClientAssertionType(e.assertionType)}if(t.addGrantType(d.hJ.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme===d.sO.POP){const n=new me(this.cryptoUtils,this.performanceClient),a=await h(n.generateCnf.bind(n),m.Ok.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger);t.addPopToken(a.reqCnfString)}else if(e.authenticationScheme===d.sO.SSH){if(!e.sshJwk)throw(0,u.ii)(S.aK);t.addSshJwk(e.sshJwk)}const n=e.correlationId||this.config.cryptoInterface.createNewGuid();let a;if(t.addCorrelationId(n),(!E.x.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.clientInfo)try{const t=(0,se.B)(e.clientInfo,this.cryptoUtils.base64Decode);a={credential:`${t.uid}${d.wv.CLIENT_INFO_SEPARATOR}${t.utid}`,type:L}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}else a=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&a)switch(a.type){case L:try{const e=(0,se.j)(a.credential);t.addCcsOid(e)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case k:t.addCcsUpn(a.credential)}return e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[ue.Xb]||t.addExtraQueryParameters({[ue.Xb]:"1"}),t.createQueryString()}async createAuthCodeUrlQueryString(e){this.performanceClient?.addQueueMeasurement(m.Ok.AuthClientCreateQueryString,e.correlationId);const t=new ce.H;t.addClientId(e.extraQueryParameters?.[ue.Ex]||this.config.authOptions.clientId);const n=[...e.scopes||[],...e.extraScopesToConsent||[]];t.addScopes(n,!0,this.oidcDefaultScopes),t.addRedirectUri(e.redirectUri);const a=e.correlationId||this.config.cryptoInterface.createNewGuid();if(t.addCorrelationId(a),t.addResponseMode(e.responseMode),t.addResponseTypeCode(),t.addLibraryInfo(this.config.libraryInfo),(0,ae.uh)(this.config)||t.addApplicationTelemetry(this.config.telemetry.application),t.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&t.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&t.addPrompt(e.prompt),e.domainHint&&t.addDomainHint(e.domainHint),e.prompt!==d.NJ.SELECT_ACCOUNT)if(e.sid&&e.prompt===d.NJ.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),t.addSid(e.sid);else if(e.account){const n=this.extractAccountSid(e.account),a=this.extractLoginHint(e.account);if(a){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),t.addLoginHint(a);try{const n=(0,se.j)(e.account.homeAccountId);t.addCcsOid(n)}catch(e){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(n&&e.prompt===d.NJ.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),t.addSid(n);try{const n=(0,se.j)(e.account.homeAccountId);t.addCcsOid(n)}catch(e){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),t.addLoginHint(e.account.username);try{const n=(0,se.j)(e.account.homeAccountId);t.addCcsOid(n)}catch(e){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&t.addNonce(e.nonce),e.state&&t.addState(e.state),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),e.nativeBroker&&(t.addNativeBroker(),e.authenticationScheme===d.sO.POP)){const n=new me(this.cryptoUtils),a=await h(n.generateCnf.bind(n),m.Ok.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger);t.addPopToken(a.reqCnfHash)}return t.createQueryString()}createLogoutUrlQueryString(e){const t=new ce.H;return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),t.createQueryString()}extractAccountSid(e){return e.idTokenClaims?.sid||null}extractLoginHint(e){return e.idTokenClaims?.login_hint||null}}class De{constructor(e,t){this.cacheOutcome=d.Ko.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||d.oT.EMPTY_STRING,this.wrapperVer=e.wrapperVer||d.oT.EMPTY_STRING,this.telemetryCacheKey=d.PN.CACHE_KEY+d.wv.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${d.PN.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer].join(d.PN.VALUE_SEPARATOR),n=[e,this.getRegionDiscoveryFields()].join(d.PN.VALUE_SEPARATOR);return[d.PN.SCHEMA_VERSION,n,t].join(d.PN.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=De.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(d.PN.VALUE_SEPARATOR),a=e.errors.slice(0,t).join(d.PN.VALUE_SEPARATOR),i=e.errors.length,r=[i,t<i?d.PN.OVERFLOW_TRUE:d.PN.OVERFLOW_FALSE].join(d.PN.VALUE_SEPARATOR);return[d.PN.SCHEMA_VERSION,e.cacheHits,n,a,r].join(d.PN.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=d.PN.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof g.u4?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(d.PN.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){const e=this.getLastRequests(),t=De.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey);else{const n={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,n)}}static maxErrorsToSend(e){let t,n=0,a=0;const i=e.errors.length;for(t=0;t<i;t++){const i=e.failedRequests[2*t]||d.oT.EMPTY_STRING,r=e.failedRequests[2*t+1]||d.oT.EMPTY_STRING,o=e.errors[t]||d.oT.EMPTY_STRING;if(a+=i.toString().length+r.toString().length+o.length+3,!(a<d.PN.MAX_LAST_HEADER_BYTES))break;n+=1}return n}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||d.oT.EMPTY_STRING),e.push(this.regionSource||d.oT.EMPTY_STRING),e.push(this.regionOutcome||d.oT.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}}var Ie=n(1540),xe=n(8208);class Ce{constructor(e,t,n,a,i,r,o,s,c){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=i,this.navigationClient=r,this.nativeMessageHandler=s,this.correlationId=c||(0,xe.pn)(),this.logger=a.clone(U.hx.MSAL_SKU,Ie.i,this.correlationId),this.performanceClient=o}async clearCacheOnLogout(e){if(e){C.r.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{await this.browserStorage.removeAccount(C.r.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch(e){this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(),await this.browserCrypto.clearKeystore()}catch(e){this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}async initializeBaseRequest(e,t){this.performanceClient.addQueueMeasurement(m.Ok.InitializeBaseRequest,this.correlationId);const n=e.authority||this.config.auth.authority;t&&await this.validateRequestAuthority(n,t);const a=[...e&&e.scopes||[]],i={...e,correlationId:this.correlationId,authority:n,scopes:a};if(i.authenticationScheme){if(i.authenticationScheme===d.sO.SSH){if(!e.sshJwk)throw(0,u.ii)(S.aK);if(!e.sshKid)throw(0,u.ii)(S.sI)}this.logger.verbose(`Authentication Scheme set to "${i.authenticationScheme}" as configured in Auth request`)}else i.authenticationScheme=d.sO.BEARER,this.logger.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return this.config.cache.claimsBasedCachingEnabled&&e.claims&&!E.x.isEmptyObj(e.claims)&&(i.requestedClaimsHash=await this.browserCrypto.hashString(e.claims)),i}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri||Y();return s.G.getAbsoluteUrl(t,Y())}async validateRequestAuthority(e,t){if(!(await this.getDiscoveredAuthority(e)).isAlias(t.environment))throw(0,u.ii)(S.Pv)}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new De(n,this.browserStorage)}async getDiscoveredAuthority(e){this.logger.verbose("getDiscoveredAuthority called");const t={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata},n=e||this.config.auth.authority;return this.logger.verbose(`Creating discovered authority with ${n}`),de(n,this.config.system.networkClient,this.browserStorage,t,this.logger,this.correlationId,this.performanceClient)}}async function Oe(e,t,n){e.addQueueMeasurement(m.Ok.GeneratePkceCodes,n);const a=_(we,m.Ok.GenerateCodeVerifier,t,e,n)(e,t,n);return{verifier:a,challenge:await h(Ee,m.Ok.GenerateCodeChallengeFromVerifier,t,e,n)(a,e,t,n)}}function we(e,t,n){try{const a=new Uint8Array(32);return _(xe.jP,m.Ok.GetRandomValues,t,e,n)(a),(0,K.Qy)(a)}catch(e){throw(0,T.X_)(W.SD)}}async function Ee(e,t,n,a){t.addQueueMeasurement(m.Ok.GenerateCodeChallengeFromVerifier,a);try{const i=await h(xe.kv,m.Ok.Sha256Digest,n,t,a)(e,t,a);return(0,K.Qy)(new Uint8Array(i))}catch(e){throw(0,T.X_)(W.SD)}}class Ae extends Ce{async initializeAuthorizationCodeRequest(e){this.performanceClient.addQueueMeasurement(m.Ok.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const t=await h(Oe,m.Ok.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),n={...e,redirectUri:e.redirectUri,code:d.oT.EMPTY_STRING,codeVerifier:t.verifier};return e.codeChallenge=t.challenge,e.codeChallengeMethod=d.oT.S256_CODE_CHALLENGE_METHOD,n}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);const t={correlationId:this.correlationId||(0,xe.pn)(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=s.G.getAbsoluteUrl(e.postLogoutRedirectUri,Y())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=s.G.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Y())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=s.G.getAbsoluteUrl(Y(),Y())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e,t,n){this.performanceClient.addQueueMeasurement(m.Ok.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const a=await h(this.getClientConfiguration.bind(this),m.Ok.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e,t,n);return new Se(a,this.performanceClient)}async getClientConfiguration(e,t,n){this.performanceClient.addQueueMeasurement(m.Ok.StandardInteractionClientGetClientConfiguration,this.correlationId);const a=await h(this.getDiscoveredAuthority.bind(this),m.Ok.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)(t,n),i=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:i.loggerCallback,piiLoggingEnabled:i.piiLoggingEnabled,logLevel:i.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:e,libraryInfo:{sku:U.hx.MSAL_SKU,version:Ie.i,cpu:d.oT.EMPTY_STRING,os:d.oT.EMPTY_STRING},telemetry:this.config.telemetry}}async getDiscoveredAuthority(e,t){this.performanceClient.addQueueMeasurement(m.Ok.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const n={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},i=e||this.config.auth.authority,r=D.generateAuthority(i,t||this.config.auth.azureCloudOptions);return h(de.bind(a),m.Ok.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(r,this.config.system.networkClient,this.browserStorage,n,this.logger,this.correlationId,this.performanceClient)}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(m.Ok.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const n=this.getRedirectUri(e.redirectUri),a={interactionType:t},i=A.setRequestState(this.browserCrypto,e&&e.state||d.oT.EMPTY_STRING,a),r={...await h(this.initializeBaseRequest.bind(this),m.Ok.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)(e),redirectUri:n,state:i,nonce:e.nonce||(0,xe.pn)(),responseMode:this.config.auth.OIDCOptions.serverResponseType},o=e.account||this.browserStorage.getActiveAccount();if(o&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${o.homeAccountId}`,this.correlationId),r.account=o),!r.loginHint&&!o){const e=this.browserStorage.getLegacyLoginHint();e&&(r.loginHint=e)}return r}}var Le=n(6199);const ke="user_switch",Me={[ke]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Pe extends g.u4{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,Pe.prototype),this.name="NativeAuthError",this.ext=n}}function Te(e){return!(!e.ext||!e.ext.status||"PERSISTENT_ERROR"!==e.ext.status&&"DISABLED"!==e.ext.status)||!(!e.ext||!e.ext.error||-2147186943!==e.ext.error)||"ContentError"===e.errorCode}function Ue(e,t,n){if(n&&n.status)switch(n.status){case"ACCOUNT_UNAVAILABLE":return(0,x.cp)(O.VP);case"USER_INTERACTION_REQUIRED":return new x.Jo(e,t);case"USER_CANCEL":return(0,T.X_)(W.s7);case"NO_NETWORK":return(0,T.X_)(W.Rq)}return new Pe(e,Me[e]||t,n)}class Fe extends le{constructor(e,t){super(e,t)}async acquireToken(e){this.performanceClient?.addQueueMeasurement(m.Ok.RefreshTokenClientAcquireToken,e.correlationId);const t=pe.I.nowSeconds(),n=await h(this.executeTokenRequest.bind(this),m.Ok.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),a=n.headers?.[d.GZ.X_MS_REQUEST_ID],i=new ge(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(n.body),h(i.handleServerTokenResponse.bind(i),m.Ok.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,a)}async acquireTokenByRefreshToken(e){if(!e)throw(0,u.ii)(S.aL);if(this.performanceClient?.addQueueMeasurement(m.Ok.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw(0,c.CP)(y.A7);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await h(this.acquireTokenWithCachedRefreshToken.bind(this),m.Ok.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(t){const n=t instanceof x.Jo&&t.errorCode===O.T2,a=t instanceof te.n&&t.errorCode===d.A1.INVALID_GRANT_ERROR&&t.subError===d.A1.CLIENT_MISMATCH_ERROR;if(n||a)return h(this.acquireTokenWithCachedRefreshToken.bind(this),m.Ok.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw t}return h(this.acquireTokenWithCachedRefreshToken.bind(this),m.Ok.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){this.performanceClient?.addQueueMeasurement(m.Ok.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const n=_(this.cacheManager.getRefreshToken.bind(this.cacheManager),m.Ok.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,void 0,this.performanceClient,e.correlationId);if(!n)throw(0,x.cp)(O.T2);if(n.expiresOn&&pe.I.isTokenExpired(n.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw(0,x.cp)(O.Kw);const a={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||d.sO.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:L}};try{return await h(this.acquireToken.bind(this),m.Ok.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(a)}catch(e){if(e instanceof x.Jo&&e.subError===O.pl){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const e=(0,v.Rk)(n);this.cacheManager.removeRefreshToken(e)}throw e}}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(m.Ok.RefreshTokenClientExecuteTokenRequest,e.correlationId);const n=this.createTokenQueryParameters(e),a=s.G.appendQueryString(t.tokenEndpoint,n),i=await h(this.createTokenRequestBody.bind(this),m.Ok.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),r=this.createTokenRequestHeaders(e.ccsCredential),o={clientId:e.tokenBodyParameters?.clientId||this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return h(this.executePostToTokenEndpoint.bind(this),m.Ok.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(a,i,r,o,e.correlationId,m.Ok.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(m.Ok.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=e.correlationId,n=new ce.H;if(n.addClientId(e.tokenBodyParameters?.[ue.Ex]||this.config.authOptions.clientId),e.redirectUri&&n.addRedirectUri(e.redirectUri),n.addScopes(e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),n.addGrantType(d.hJ.REFRESH_TOKEN_GRANT),n.addClientInfo(),n.addLibraryInfo(this.config.libraryInfo),n.addApplicationTelemetry(this.config.telemetry.application),n.addThrottling(),this.serverTelemetryManager&&!(0,ae.uh)(this.config)&&n.addServerTelemetry(this.serverTelemetryManager),n.addCorrelationId(t),n.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&n.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const e=this.config.clientCredentials.clientAssertion;n.addClientAssertion(e.assertion),n.addClientAssertionType(e.assertionType)}if(e.authenticationScheme===d.sO.POP){const t=new me(this.cryptoUtils,this.performanceClient),a=await h(t.generateCnf.bind(t),m.Ok.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger);n.addPopToken(a.reqCnfString)}else if(e.authenticationScheme===d.sO.SSH){if(!e.sshJwk)throw(0,u.ii)(S.aK);n.addSshJwk(e.sshJwk)}if((!E.x.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case L:try{const t=(0,se.j)(e.ccsCredential.credential);n.addCcsOid(t)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case k:n.addCcsUpn(e.ccsCredential.credential)}return e.tokenBodyParameters&&n.addExtraQueryParameters(e.tokenBodyParameters),n.createQueryString()}}class He extends le{constructor(e,t){super(e,t)}async acquireToken(e){try{const[t,n]=await this.acquireCachedToken(e);return n===d.Ko.PROACTIVELY_REFRESHED&&(this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new Fe(this.config,this.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),t}catch(t){if(t instanceof c.ir&&t.errorCode===y.g$)return new Fe(this.config,this.performanceClient).acquireTokenByRefreshToken(e);throw t}}async acquireCachedToken(e){this.performanceClient?.addQueueMeasurement(m.Ok.SilentFlowClientAcquireCachedToken,e.correlationId);let t=d.Ko.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!E.x.isEmptyObj(e.claims))throw this.setCacheOutcome(d.Ko.FORCE_REFRESH_OR_CLAIMS,e.correlationId),(0,c.CP)(y.g$);if(!e.account)throw(0,c.CP)(y.A7);const n=e.account.tenantId||function(e){const t=new s.G(e).getUrlComponents().PathSegments.slice(-1)[0].toLowerCase();switch(t){case d.Nb.COMMON:case d.Nb.ORGANIZATIONS:case d.Nb.CONSUMERS:return;default:return t}}(e.authority),a=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,a,n,this.performanceClient,e.correlationId);if(!i)throw this.setCacheOutcome(d.Ko.NO_CACHED_ACCESS_TOKEN,e.correlationId),(0,c.CP)(y.g$);if(pe.I.wasClockTurnedBack(i.cachedAt)||pe.I.isTokenExpired(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(d.Ko.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),(0,c.CP)(y.g$);i.refreshOn&&pe.I.isTokenExpired(i.refreshOn,0)&&(t=d.Ko.PROACTIVELY_REFRESHED);const r=e.authority||this.authority.getPreferredCache(),o={account:this.cacheManager.readAccountFromCache(e.account),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,a,n,this.performanceClient,e.correlationId),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(r)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await h(this.generateResultFromCacheRecord.bind(this),m.Ok.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(o,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==d.Ko.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){let n;if(this.performanceClient?.addQueueMeasurement(m.Ok.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId),e.idToken&&(n=(0,M.X_)(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){const e=n?.auth_time;if(!e)throw(0,c.CP)(y.D7);(0,M.ly)(e,t.maxAge)}return ge.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,n)}}class Re extends Ae{async acquireToken(e){this.performanceClient.addQueueMeasurement(m.Ok.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(U.QN.acquireTokenSilent_silentFlow),n=await this.createSilentFlowClient(t,e.authority,e.azureCloudOptions);this.logger.verbose("Silent auth client created");try{const t=(await h(n.acquireCachedToken.bind(n),m.Ok.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),t}catch(e){throw e instanceof T.Wt&&e.errorCode===W.YM&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),e}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t?.account)}async createSilentFlowClient(e,t,n){const a=await h(this.getClientConfiguration.bind(this),m.Ok.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e,t,n);return new He(a,this.performanceClient)}async initializeSilentRequest(e,t){this.performanceClient.addQueueMeasurement(m.Ok.InitializeSilentRequest,this.correlationId);const n=await h(this.initializeBaseRequest.bind(this),m.Ok.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)(e,t);return{...e,...n,account:t,forceRefresh:e.forceRefresh||!1}}}class Ne extends Ce{constructor(e,t,n,a,i,r,o,s,c,d,l,u){super(e,t,n,a,i,r,s,c,u),this.apiId=o,this.accountId=d,this.nativeMessageHandler=c,this.nativeStorageManager=l,this.silentCacheClient=new Re(e,this.nativeStorageManager,n,a,i,r,s,c,u)}async acquireToken(e){this.performanceClient.addQueueMeasurement(m.Ok.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(m.Ok.NativeInteractionClientAcquireToken,e.correlationId),n=pe.I.nowSeconds(),a=await this.initializeNativeRequest(e);try{const e=await this.acquireTokensFromCache(this.accountId,a);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),e}catch(e){this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const i={method:U.Fy.GetToken,request:a},r=await this.nativeMessageHandler.sendMessage(i),o=this.validateNativeResponse(r);return this.handleNativeResponse(o,a,n).then(e=>(t.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),e)).catch(e=>{throw t.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e})}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:fe.i.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),(0,c.CP)(y.nX);const n=this.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!n)throw(0,c.CP)(y.nX);try{const e=this.createSilentCacheRequest(t,n),a=await this.silentCacheClient.acquireToken(e),i={...n,idTokenClaims:a?.idTokenClaims};return{...a,account:i}}catch(e){throw e}}async acquireTokenRedirect(e){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const t=await this.initializeNativeRequest(e),n={method:U.Fy.GetToken,request:t};try{const e=await this.nativeMessageHandler.sendMessage(n);this.validateNativeResponse(e)}catch(e){if(e instanceof Pe&&Te(e))throw e}this.browserStorage.setTemporaryCache(U.n4.NATIVE_REQUEST,JSON.stringify(t),!0);const a={apiId:U.QN.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);await this.navigationClient.navigateExternal(i,a)}async handleRedirectPromise(){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const e=this.browserStorage.getCachedNativeRequest();if(!e)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),null;const{prompt:t,...n}=e;t&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(U.n4.NATIVE_REQUEST));const a={method:U.Fy.GetToken,request:n},i=pe.I.nowSeconds();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const e=await this.nativeMessageHandler.sendMessage(a);this.validateNativeResponse(e);const t=this.handleNativeResponse(e,n,i);return this.browserStorage.setInteractionInProgress(!1),await t}catch(e){throw this.browserStorage.setInteractionInProgress(!1),e}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,n){if(this.logger.trace("NativeInteractionClient - handleNativeResponse called."),e.account.id!==t.accountId)throw Ue(ke);const a=await this.getDiscoveredAuthority(t.authority),i=M.X_(e.id_token,G.t),r=this.createHomeAccountIdentifier(e,i),o=ve(this.browserStorage,a,r,i,G.t,e.client_info,void 0,i.tid,void 0,e.account.id,this.logger),s=await this.generateAuthenticationResult(e,t,i,o,a.canonicalAuthority,n);return this.cacheAccount(o),this.cacheNativeTokens(e,t,r,i,s.accessToken,s.tenantId,n),s}createHomeAccountIdentifier(e,t){return C.r.generateHomeAccountId(e.client_info||d.oT.EMPTY_STRING,o.a.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?fe.i.fromString(e.scope):fe.i.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===d.sO.POP){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const n=new me(this.browserCrypto),a={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw(0,c.CP)(y.Bf);return n.signPopToken(e.access_token,t.keyId,a)}return e.access_token}async generateAuthenticationResult(e,t,n,a,i,r){const o=this.addTelemetryFromNativeResponse(e),s=e.scope?fe.i.fromString(e.scope):fe.i.fromString(t.scope),c=e.account.properties||{},l=c.UID||n.oid||n.sub||d.oT.EMPTY_STRING,u=c.TenantId||n.tid||d.oT.EMPTY_STRING,f=(0,be.$f)(a.getAccountInfo(),void 0,n),p=await this.generatePopAccessToken(e,t),m=t.tokenType===d.sO.POP?d.sO.POP:d.sO.BEARER;return{authority:i,uniqueId:l,tenantId:u,scopes:s.asArray(),account:f,idToken:e.id_token,idTokenClaims:n,accessToken:p,fromCache:!!o&&this.isResponseFromCache(o),expiresOn:new Date(1e3*Number(r+e.expires_in)),tokenType:m,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}cacheAccount(e){this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch(e=>{this.logger.error(`Error occurred while removing account context from browser storage. ${e}`)})}cacheNativeTokens(e,t,n,a,i,r,o){const s=v.Rd(n,t.authority,e.id_token||"",t.clientId,a.tid||""),c=o+(t.tokenType===d.sO.POP?d.oT.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),l=this.generateScopes(e,t),u=v.As(n,t.authority,i,t.clientId,a.tid||r,l.printScopes(),c,0,G.t),f=new P(void 0,s,u);this.nativeStorageManager.saveCacheRecord(f,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw(0,g.RD)(Le.g,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch(e){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.validateRequestAuthority(t,e.account);const n=new s.G(t);n.validateAsUri();const{scopes:a,...i}=e,r=new fe.i(a||[]);r.appendScopes(d.r_);const o={...i,accountId:this.accountId,clientId:this.config.auth.clientId,authority:n.urlString,scope:r.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:(()=>{switch(this.apiId){case U.QN.ssoSilent:case U.QN.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),d.NJ.NONE}if(e.prompt)switch(e.prompt){case d.NJ.NONE:case d.NJ.CONSENT:case d.NJ.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),(0,T.X_)(W.m9)}else this.logger.trace("initializeNativeRequest: prompt was not provided")})(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1};if(this.handleExtraBrokerParams(o),o.extraParameters=o.extraParameters||{},o.extraParameters.telemetry=U.wD.MATS_TELEMETRY,e.authenticationScheme===d.sO.POP){const t={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},n=new me(this.browserCrypto),a=await h(n.generateCnf.bind(n),m.Ok.PopTokenGenerateCnf,this.logger,this.performanceClient,this.correlationId)(t,this.logger);o.reqCnf=a.reqCnfHash,o.keyId=a.kid}return o}handleExtraBrokerParams(e){if(e.extraParameters&&e.extraParameters.hasOwnProperty("brk_client_id")&&e.extraParameters.hasOwnProperty("brk_redirect_uri")&&e.extraParameters.hasOwnProperty(ue.Ex)){const t=e.extraParameters[ue.Ex],n=e.redirectUri,a=e.extraParameters.brk_redirect_uri;e.extraParameters={child_client_id:t,child_redirect_uri:n},e.redirectUri=a}}}class Be{constructor(e,t,n,a){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=a,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(m.Ok.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:U.wD.CHANNEL_ID,extensionId:this.extensionId,responseId:(0,xe.pn)(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((e,n)=>{this.resolvers.set(t.responseId,{resolve:e,reject:n})})}static async createProvider(e,t,n){e.trace("NativeMessageHandler - createProvider called.");try{const a=new Be(e,t,n,U.wD.PREFERRED_EXTENSION_ID);return await a.sendHandshakeRequest(),a}catch(a){const i=new Be(e,t,n);return await i.sendHandshakeRequest(),i}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:U.wD.CHANNEL_ID,extensionId:this.extensionId,responseId:(0,xe.pn)(),body:{method:U.Fy.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=e=>{this.onChannelMessage(e)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,n)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:n}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),n((0,T.X_)(W.sR)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(t.channel&&t.channel===U.wD.CHANNEL_ID&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===U.Fy.HandshakeRequest){const e=this.handshakeResolvers.get(t.responseId);if(!e)return void this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),e.reject((0,T.X_)(W.Qb))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,n=this.resolvers.get(t.responseId),a=this.handshakeResolvers.get(t.responseId);try{const e=t.body.method;if(e===U.Fy.Response){if(!n)return;const e=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(e)}`),"Success"!==e.status)n.reject(Ue(e.code,e.description,e.ext));else{if(!e.result)throw(0,g.RD)(Le.g,"Event does not contain result.");e.result.code&&e.result.description?n.reject(Ue(e.result.code,e.result.description,e.result.ext)):n.resolve(e.result)}this.resolvers.delete(t.responseId)}else if(e===U.Fy.HandshakeResponse){if(!a)return void this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),a.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(t){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${t}`),this.logger.errorPii(`Unable to parse ${e}`),n?n.reject(t):a&&a.reject(t)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,n,a){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!n)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(a)switch(a){case d.sO.BEARER:case d.sO.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}class je{constructor(e,t,n,a,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=a,this.performanceClient=i}async handleCodeResponse(e,t){let n;this.performanceClient.addQueueMeasurement(m.Ok.HandleCodeResponse,t.correlationId);try{n=this.authModule.handleFragmentResponse(e,t.state)}catch(e){throw e instanceof te.n&&e.subError===W.s7?(0,T.X_)(W.s7):e}return h(this.handleCodeResponseFromServer.bind(this),m.Ok.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(n,t)}async handleCodeResponseFromServer(e,t,n=!0){if(this.performanceClient.addQueueMeasurement(m.Ok.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await h(this.authModule.updateAuthority.bind(this.authModule),m.Ok.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const e=this.createCcsCredentials(t);e&&(this.authCodeRequest.ccsCredential=e)}return await h(this.authModule.acquireToken.bind(this.authModule),m.Ok.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:L}:e.loginHint?{credential:e.loginHint,type:k}:null}}var Ve=n(1062);function ze(e,t,n){const a=Ve.F(e);if(!a)throw Ve.q(e)?(n.error(`A ${t} is present in the iframe but it does not contain known properties. It's likely that the ${t} has been replaced by code running on the redirectUri page.`),n.errorPii(`The ${t} detected is: ${e}`),(0,T.X_)(W.G_)):(n.error(`The request has returned to the redirectUri but a ${t} is not present. It's likely that the ${t} has been removed or the page has been redirected by code running on the redirectUri page.`),(0,T.X_)(W.pF));return a}class Ge extends Ae{constructor(e,t,n,a,i,r,o,s,c,d){super(e,t,n,a,i,r,o,c,d),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=s}acquireToken(e){try{const t=this.generatePopupName(e.scopes||d.r_,e.authority||this.config.auth.authority),n=e.popupWindowAttributes||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,t,n);{this.logger.verbose("asyncPopup set to false, opening popup before acquiring token");const a=this.openSizedPopup("about:blank",t,n);return this.acquireTokenPopupAsync(e,t,n,a)}}catch(e){return Promise.reject(e)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),n=this.generateLogoutPopupName(t),a=e&&e.authority,i=e&&e.mainWindowRedirectUri,r=e?.popupWindowAttributes||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,r,a,void 0,i);{this.logger.verbose("asyncPopup set to false, opening popup");const e=this.openSizedPopup("about:blank",n,r);return this.logoutPopupAsync(t,n,r,a,e,i)}}catch(e){return Promise.reject(e)}}async acquireTokenPopupAsync(e,t,n,a){this.logger.verbose("acquireTokenPopupAsync called");const i=this.initializeServerTelemetryManager(U.QN.acquireTokenPopup),r=await h(this.initializeAuthorizationRequest.bind(this),m.Ok.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,U.g_.Popup);Z(r.authority);try{const o=await h(this.initializeAuthorizationCodeRequest.bind(this),m.Ok.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(r),s=await h(this.createAuthCodeClient.bind(this),m.Ok.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(i,r.authority,r.azureCloudOptions),c=Be.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let d;c&&(d=this.performanceClient.startMeasurement(m.Ok.FetchAccountIdWithNativeBroker,e.correlationId));const l=await s.getAuthCodeUrl({...r,nativeBroker:c}),u=new je(s,this.browserStorage,o,this.logger,this.performanceClient),f={popup:a,popupName:t,popupWindowAttributes:n},p=this.initiateAuthRequest(l,f);this.eventHandler.emitEvent($.t.POPUP_OPENED,U.g_.Popup,{popupWindow:p},null);const b=await this.monitorPopupForHash(p),g=_(ze,m.Ok.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(b,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(ne.removeThrottle(this.browserStorage,this.config.auth.clientId,o),g.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),d&&d.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw(0,T.X_)(W.q7);const e=new Ne(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,U.QN.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,g.accountId,this.nativeStorage,r.correlationId),{userRequestState:t}=A.parseRequestState(this.browserCrypto,r.state);return await e.acquireToken({...r,state:t,prompt:void 0})}return await u.handleCodeResponse(g,r)}catch(e){throw a&&a.close(),e instanceof g.u4&&(e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e)),e}}async logoutPopupAsync(e,t,n,a,i,r){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent($.t.LOGOUT_START,U.g_.Popup,e);const o=this.initializeServerTelemetryManager(U.QN.logoutPopup);try{await this.clearCacheOnLogout(e.account);const c=await h(this.createAuthCodeClient.bind(this),m.Ok.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(o,a);try{c.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&c.authority.protocolMode===f.A.OIDC){if(this.browserStorage.removeAccount(e.account?.homeAccountId),this.eventHandler.emitEvent($.t.LOGOUT_SUCCESS,U.g_.Popup,e),r){const e={apiId:U.QN.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=s.G.getAbsoluteUrl(r,Y());await this.navigationClient.navigateInternal(t,e)}return void(i&&i.close())}}const d=c.getLogoutUri(e);this.eventHandler.emitEvent($.t.LOGOUT_SUCCESS,U.g_.Popup,e);const l=this.openPopup(d,{popupName:t,popupWindowAttributes:n,popup:i});if(this.eventHandler.emitEvent($.t.POPUP_OPENED,U.g_.Popup,{popupWindow:l},null),await this.monitorPopupForHash(l).catch(()=>{}),r){const e={apiId:U.QN.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=s.G.getAbsoluteUrl(r,Y());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${t}`),await this.navigationClient.navigateInternal(t,e)}else this.logger.verbose("No main window navigation requested")}catch(e){throw i&&i.close(),e instanceof g.u4&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent($.t.LOGOUT_FAILURE,U.g_.Popup,null,e),this.eventHandler.emitEvent($.t.LOGOUT_END,U.g_.Popup),e}this.eventHandler.emitEvent($.t.LOGOUT_END,U.g_.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),(0,T.X_)(W.Zc)}monitorPopupForHash(e){return new Promise((t,n)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const a=setInterval(()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(a),void n((0,T.X_)(W.s7));let i="";try{i=e.location.href}catch(e){}if(!i||"about:blank"===i)return;clearInterval(a);let r="";const o=this.config.auth.OIDCOptions.serverResponseType;e&&(r=o===d.bg.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(r)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e)})}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),n.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii(`Opening popup window to: ${e}`),n=this.openSizedPopup(e,t.popupName,t.popupWindowAttributes)),!n)throw(0,T.X_)(W.H);return n.focus&&n.focus(),this.currentWindow=n,window.addEventListener("beforeunload",this.unloadWindow),n}catch(e){throw this.logger.error("error opening popup "+e.message),this.browserStorage.setInteractionInProgress(!1),(0,T.X_)(W.E)}}openSizedPopup(e,t,n){const a=window.screenLeft?window.screenLeft:window.screenX,i=window.screenTop?window.screenTop:window.screenY,r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let s=n.popupSize?.width,c=n.popupSize?.height,d=n.popupPosition?.top,l=n.popupPosition?.left;return(!s||s<0||s>r)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),s=U.hx.POPUP_WIDTH),(!c||c<0||c>o)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),c=U.hx.POPUP_HEIGHT),(!d||d<0||d>o)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),d=Math.max(0,o/2-U.hx.POPUP_HEIGHT/2+i)),(!l||l<0||l>r)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),l=Math.max(0,r/2-U.hx.POPUP_WIDTH/2+a)),window.open(e,t,`width=${s}, height=${c}, top=${d}, left=${l}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(U.g_.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e){e&&e.close(),window.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${U.hx.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${U.hx.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}class Ke{constructor(e,t,n,a,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=a,this.performanceClient=i}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(U.n4.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(U.n4.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const n={apiId:U.QN.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};return"function"==typeof t.onRedirectNavigate?(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1!==t.onRedirectNavigate(e)?(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void await t.navigationClient.navigateExternal(e,n)):void this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")):(this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void await t.navigationClient.navigateExternal(e,n))}throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),(0,T.X_)(W.Zc)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const n=this.browserStorage.generateStateKey(t),a=this.browserStorage.getTemporaryCache(n);if(!a)throw(0,c.CP)(y.HV,"Cached State");let i;try{i=this.authModule.handleFragmentResponse(e,a)}catch(e){throw e instanceof te.n&&e.subError===W.s7?(0,T.X_)(W.s7):e}const r=this.browserStorage.generateNonceKey(a),o=this.browserStorage.getTemporaryCache(r);if(this.authCodeRequest.code=i.code,i.cloud_instance_host_name&&await h(this.authModule.updateAuthority.bind(this.authModule),m.Ok.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(i.cloud_instance_host_name,this.authCodeRequest.correlationId),i.nonce=o||void 0,i.state=a,i.client_info)this.authCodeRequest.clientInfo=i.client_info;else{const e=this.checkCcsCredentials();e&&(this.authCodeRequest.ccsCredential=e)}const s=await this.authModule.acquireToken(this.authCodeRequest,i);return this.browserStorage.cleanRequestByState(t),s}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(U.n4.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch(t){this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}class We extends Ae{constructor(e,t,n,a,i,r,o,s,c,d){super(e,t,n,a,i,r,o,c,d),this.nativeStorage=s}async acquireToken(e){const t=await h(this.initializeAuthorizationRequest.bind(this),m.Ok.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,U.g_.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const n=this.initializeServerTelemetryManager(U.QN.acquireTokenRedirect),a=e=>{e.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent($.t.RESTORE_FROM_BFCACHE,U.g_.Redirect))};try{const i=await h(this.initializeAuthorizationCodeRequest.bind(this),m.Ok.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),r=await h(this.createAuthCodeClient.bind(this),m.Ok.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(n,t.authority,t.azureCloudOptions),o=new Ke(r,this.browserStorage,i,this.logger,this.performanceClient),s=await r.getAuthCodeUrl({...t,nativeBroker:Be.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),c=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${c}`),window.addEventListener("pageshow",a),await o.initiateAuthRequest(s,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:c,onRedirectNavigate:e.onRedirectNavigate})}catch(e){throw e instanceof g.u4&&(e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e)),window.removeEventListener("pageshow",a),this.browserStorage.cleanRequestByState(t.state),e}}async handleRedirectPromise(e){const t=this.initializeServerTelemetryManager(U.QN.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[n,a]=this.getRedirectResponse(e||"");if(!n)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(U.g_.Redirect),null;const i=this.browserStorage.getTemporaryCache(U.n4.ORIGIN_URI,!0)||d.oT.EMPTY_STRING;if(s.G.removeHashFromUrl(i)===s.G.removeHashFromUrl(window.location.href)&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),i.indexOf("#")>-1&&function(e){const t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}(i),await this.handleResponse(n,t);if(!this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(n,t);if(!Q()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(U.n4.URL_HASH,a,!0);const e={apiId:U.QN.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let r=!0;if(i&&"null"!==i)this.logger.verbose(`Navigating to loginRequestUrl: ${i}`),r=await this.navigationClient.navigateInternal(i,e);else{const t=function(){const e=new s.G(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}();this.browserStorage.setTemporaryCache(U.n4.ORIGIN_URI,t,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),r=await this.navigationClient.navigateInternal(t,e)}if(!r)return await this.handleResponse(n,t)}return null}catch(e){throw e instanceof g.u4&&(e.setCorrelationId(this.correlationId),t.cacheFailedRequest(e)),this.browserStorage.cleanRequestByInteractionType(U.g_.Redirect),e}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===d.bg.QUERY?window.location.search:window.location.hash);let n=Ve.F(t);if(n){try{!function(e,t,n){if(!e.state)throw(0,T.X_)(W.Yk);const a=z(t,e.state);if(!a)throw(0,T.X_)(W.$P);if(a.interactionType!==n)throw(0,T.X_)(W.xK)}(n,this.browserCrypto,U.g_.Redirect)}catch(e){return e instanceof g.u4&&this.logger.error(`Interaction type validation failed due to ${e.errorCode}: ${e.errorMessage}`),[null,""]}return(a=window).location.hash="","function"==typeof a.history.replaceState&&a.history.replaceState(null,"",`${a.location.origin}${a.location.pathname}${a.location.search}`),this.logger.verbose("Hash contains known properties, returning response hash"),[n,t]}var a;const i=this.browserStorage.getTemporaryCache(U.n4.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(U.n4.URL_HASH)),i&&(n=Ve.F(i),n)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[n,i]):[null,""]}async handleResponse(e,t){const n=e.state;if(!n)throw(0,T.X_)(W.Yk);const a=this.browserStorage.getCachedRequest(n);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw(0,T.X_)(W.q7);const t=new Ne(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,U.QN.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,a.correlationId),{userRequestState:i}=A.parseRequestState(this.browserCrypto,n);return t.acquireToken({...a,state:i,prompt:void 0}).finally(()=>{this.browserStorage.cleanRequestByState(n)})}const i=this.browserStorage.getCachedAuthority(n);if(!i)throw(0,T.X_)(W.aT);const r=await h(this.createAuthCodeClient.bind(this),m.Ok.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(t,i);return ne.removeThrottle(this.browserStorage,this.config.auth.clientId,a),new Ke(r,this.browserStorage,a,this.logger,this.performanceClient).handleCodeResponse(e,n)}async logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),n=this.initializeServerTelemetryManager(U.QN.logout);try{this.eventHandler.emitEvent($.t.LOGOUT_START,U.g_.Redirect,e),await this.clearCacheOnLogout(t.account);const a={apiId:U.QN.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=await h(this.createAuthCodeClient.bind(this),m.Ok.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(n,e&&e.authority);if(i.authority.protocolMode===f.A.OIDC)try{i.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId)return this.browserStorage.removeAccount(t.account?.homeAccountId),void this.eventHandler.emitEvent($.t.LOGOUT_SUCCESS,U.g_.Redirect,t)}const r=i.getLogoutUri(t);if(this.eventHandler.emitEvent($.t.LOGOUT_SUCCESS,U.g_.Redirect,t),!e||"function"!=typeof e.onRedirectNavigate)return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),void await this.navigationClient.navigateExternal(r,a);if(!1!==e.onRedirectNavigate(r))return this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),void await this.navigationClient.navigateExternal(r,a);this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(e){throw e instanceof g.u4&&(e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e)),this.eventHandler.emitEvent($.t.LOGOUT_FAILURE,U.g_.Redirect,null,e),this.eventHandler.emitEvent($.t.LOGOUT_END,U.g_.Redirect),e}this.eventHandler.emitEvent($.t.LOGOUT_END,U.g_.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return s.G.getAbsoluteUrl(t,Y())}}var qe=n(5243);async function Qe(e,t,n,a,i){if(t.addQueueMeasurement(m.Ok.SilentHandlerInitiateAuthRequest,a),!e)throw n.info("Navigate url is empty"),(0,T.X_)(W.Zc);return i?h(Je,m.Ok.SilentHandlerLoadFrame,n,t,a)(e,i,t,a):_(Xe,m.Ok.SilentHandlerLoadFrameSync,n,t,a)(e)}async function Ye(e,t,n,a,i,r,o){return a.addQueueMeasurement(m.Ok.SilentHandlerMonitorIframeForHash,r),new Promise((a,r)=>{t<qe.Ts&&i.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${t}ms) than the default (${qe.Ts}ms). This may result in timeouts.`);const s=window.setTimeout(()=>{window.clearInterval(c),r((0,T.X_)(W.UA))},t),c=window.setInterval(()=>{let t="";const n=e.contentWindow;try{t=n?n.location.href:""}catch(e){}if(!t||"about:blank"===t)return;let i="";n&&(i=o===d.bg.QUERY?n.location.search:n.location.hash),window.clearTimeout(s),window.clearInterval(c),a(i)},n)}).finally(()=>{_($e,m.Ok.RemoveHiddenIframe,i,a,r)(e)})}function Je(e,t,n,a){return n.addQueueMeasurement(m.Ok.SilentHandlerLoadFrame,a),new Promise((n,a)=>{const i=Ze();window.setTimeout(()=>{i?(i.src=e,n(i)):a("Unable to load iframe")},t)})}function Xe(e){const t=Ze();return t.src=e,t}function Ze(){const e=document.createElement("iframe");return e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(e),e}function $e(e){document.body===e.parentNode&&document.body.removeChild(e)}class et extends Ae{constructor(e,t,n,a,i,r,o,s,c,d,l){super(e,t,n,a,i,r,s,d,l),this.apiId=o,this.nativeStorage=c}async acquireToken(e){if(this.performanceClient.addQueueMeasurement(m.Ok.SilentIframeClientAcquireToken,e.correlationId),e.loginHint||e.sid||e.account&&e.account.username||this.logger.warning("No user hint provided. The authorization server may need more information to complete this request."),e.prompt&&e.prompt!==d.NJ.NONE&&e.prompt!==d.NJ.NO_SESSION)throw(0,T.X_)(W.QQ);const t=await h(this.initializeAuthorizationRequest.bind(this),m.Ok.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)({...e,prompt:e.prompt||d.NJ.NONE},U.g_.Silent);Z(t.authority);const n=this.initializeServerTelemetryManager(this.apiId);try{const a=await h(this.createAuthCodeClient.bind(this),m.Ok.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)(n,t.authority,t.azureCloudOptions);return await h(this.silentTokenHelper.bind(this),m.Ok.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(a,t)}catch(e){throw e instanceof g.u4&&(e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e)),e}}logout(){return Promise.reject((0,T.X_)(W.T9))}async silentTokenHelper(e,t){const n=t.correlationId;this.performanceClient.addQueueMeasurement(m.Ok.SilentIframeClientTokenHelper,n);const a=await h(this.initializeAuthorizationCodeRequest.bind(this),m.Ok.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,n)(t),i=await h(e.getAuthCodeUrl.bind(e),m.Ok.GetAuthCodeUrl,this.logger,this.performanceClient,n)({...t,nativeBroker:Be.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),r=new je(e,this.browserStorage,a,this.logger,this.performanceClient),o=await h(Qe,m.Ok.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(i,this.performanceClient,this.logger,n,this.config.system.navigateFrameWait),s=this.config.auth.OIDCOptions.serverResponseType,c=await h(Ye,m.Ok.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,n)(o,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,n,s),l=_(ze,m.Ok.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(c,s,this.logger);if(l.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw(0,T.X_)(W.q7);const e=new Ne(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,l.accountId,this.browserStorage,n),{userRequestState:a}=A.parseRequestState(this.browserCrypto,t.state);return h(e.acquireToken.bind(e),m.Ok.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,n)({...t,state:a,prompt:t.prompt||d.NJ.NONE})}return h(r.handleCodeResponse.bind(r),m.Ok.HandleCodeResponse,this.logger,this.performanceClient,n)(l,t)}}class tt extends Ae{async acquireToken(e){this.performanceClient.addQueueMeasurement(m.Ok.SilentRefreshClientAcquireToken,e.correlationId);const t=await h(this.initializeBaseRequest.bind(this),m.Ok.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,e.account),n={...e,...t};e.redirectUri&&(n.redirectUri=this.getRedirectUri(e.redirectUri));const a=this.initializeServerTelemetryManager(U.QN.acquireTokenSilent_silentFlow),i=await this.createRefreshTokenClient(a,n.authority,n.azureCloudOptions);return h(i.acquireTokenByRefreshToken.bind(i),m.Ok.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(n).catch(e=>{throw e.setCorrelationId(this.correlationId),a.cacheFailedRequest(e),e})}logout(){return Promise.reject((0,T.X_)(W.T9))}async createRefreshTokenClient(e,t,n){const a=await h(this.getClientConfiguration.bind(this),m.Ok.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e,t,n);return new Fe(a,this.performanceClient)}}class nt{constructor(e,t,n,a){this.isBrowserEnvironment="undefined"!=typeof window,this.config=e,this.storage=t,this.logger=n,this.cryptoObj=a}loadExternalTokens(e,t,n){if(this.logger.info("TokenCache - loadExternalTokens called"),!t.id_token)throw(0,T.X_)(W.Ud);const a=M.X_(t.id_token,G.t);let i,r,o;if(e.account)o=C.r.createFromAccountInfo(e.account),i=new P(o,this.loadIdToken(t.id_token,o.homeAccountId,e.account.environment,e.account.tenantId),this.loadAccessToken(e,t,o.homeAccountId,e.account.environment,e.account.tenantId,n),this.loadRefreshToken(e,t,o.homeAccountId,e.account.environment));else{if(!e.authority)throw(0,T.X_)(W.Ud);{const s=D.generateAuthority(e.authority,e.azureCloudOptions),c={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache};if(r=new D(s,this.config.system.networkClient,this.storage,c,this.logger,e.correlationId||(0,xe.pn)()),n.clientInfo)this.logger.trace("TokenCache - homeAccountId from options"),o=this.loadAccount(a,r,n.clientInfo),i=new P(o,this.loadIdToken(t.id_token,o.homeAccountId,r.hostnameAndPort,r.tenant),this.loadAccessToken(e,t,o.homeAccountId,r.hostnameAndPort,r.tenant,n),this.loadRefreshToken(e,t,o.homeAccountId,r.hostnameAndPort));else{if(!t.client_info)throw(0,T.X_)(W.Ud);this.logger.trace("TokenCache - homeAccountId from response"),o=this.loadAccount(a,r,t.client_info),i=new P(o,this.loadIdToken(t.id_token,o.homeAccountId,r.hostnameAndPort,r.tenant),this.loadAccessToken(e,t,o.homeAccountId,r.hostnameAndPort,r.tenant,n),this.loadRefreshToken(e,t,o.homeAccountId,r.hostnameAndPort))}}}return this.generateAuthenticationResult(e,a,i,o,r)}loadAccount(e,t,n,a){if(this.isBrowserEnvironment){let i;if(this.logger.verbose("TokenCache - loading account"),a?i=a:void 0!==t.authorityType&&n&&(i=C.r.generateHomeAccountId(n,t.authorityType,this.logger,this.cryptoObj,e)),!i)throw(0,T.X_)(W.Ud);const r=e.tid,o=ve(this.storage,t,i,e,G.t,n,t.hostnameAndPort,r,void 0,void 0,this.logger);return this.storage.setAccount(o),o}throw(0,T.X_)(W.Ud)}loadIdToken(e,t,n,a){const i=v.Rd(t,n,e,this.config.auth.clientId,a);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading id token"),this.storage.setIdTokenCredential(i),i;throw(0,T.X_)(W.Ud)}loadAccessToken(e,t,n,a,i,r){if(!t.access_token)return this.logger.verbose("TokenCache - No access token provided for caching"),null;if(!t.expires_in)throw(0,T.X_)(W.Ud);if(!r.extendedExpiresOn)throw(0,T.X_)(W.Ud);const o=new fe.i(e.scopes).printScopes(),s=r.expiresOn||t.expires_in+(new Date).getTime()/1e3,c=r.extendedExpiresOn,d=v.As(n,a,t.access_token,this.config.auth.clientId,i,o,s,c,G.t);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading access token"),this.storage.setAccessTokenCredential(d),d;throw(0,T.X_)(W.Ud)}loadRefreshToken(e,t,n,a){if(!t.refresh_token)return this.logger.verbose("TokenCache - No refresh token provided for caching"),null;const i=v.BJ(n,a,t.refresh_token,this.config.auth.clientId);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading refresh token"),this.storage.setRefreshTokenCredential(i),i;throw(0,T.X_)(W.Ud)}generateAuthenticationResult(e,t,n,a,i){let r,o=d.oT.EMPTY_STRING,s=[],c=null;n?.accessToken&&(o=n.accessToken.secret,s=fe.i.fromString(n.accessToken.target).asArray(),c=new Date(1e3*Number(n.accessToken.expiresOn)),r=new Date(1e3*Number(n.accessToken.extendedExpiresOn)));const l=t.oid||t.sub||d.oT.EMPTY_STRING,u=t.tid||d.oT.EMPTY_STRING;return{authority:i?i.canonicalAuthority:d.oT.EMPTY_STRING,uniqueId:l,tenantId:u,scopes:s,account:a.getAccountInfo(),idToken:n.idToken?.secret||"",idTokenClaims:t||{},accessToken:o,fromCache:!0,expiresOn:c,correlationId:e.correlationId||d.oT.EMPTY_STRING,requestId:d.oT.EMPTY_STRING,extExpiresOn:r,familyId:d.oT.EMPTY_STRING,tokenType:n?.accessToken?.tokenType||d.oT.EMPTY_STRING,state:d.oT.EMPTY_STRING,cloudGraphHostName:a.cloudGraphHostName||d.oT.EMPTY_STRING,msGraphHost:a.msGraphHost||d.oT.EMPTY_STRING,code:void 0,fromNativeBroker:!1}}}class at extends Se{constructor(e){super(e),this.includeRedirectUri=!1}}class it extends Ae{constructor(e,t,n,a,i,r,o,s,c,d){super(e,t,n,a,i,r,s,c,d),this.apiId=o}async acquireToken(e){if(!e.code)throw(0,T.X_)(W.Oj);const t=await h(this.initializeAuthorizationRequest.bind(this),m.Ok.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,U.g_.Silent),n=this.initializeServerTelemetryManager(this.apiId);try{const a={...t,code:e.code},i=await h(this.getClientConfiguration.bind(this),m.Ok.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)(n,t.authority),r=new at(i);this.logger.verbose("Auth code client created");const o=new je(r,this.browserStorage,a,this.logger,this.performanceClient);return await h(o.handleCodeResponseFromServer.bind(o),m.Ok.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(e){throw e instanceof g.u4&&(e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e)),e}}logout(){return Promise.reject((0,T.X_)(W.T9))}}class rt{constructor(e){this.atsAsyncMeasurement=void 0,this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new i.Q(this.logger,this.performanceClient):r.d,this.eventHandler=new ee.b(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new q(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,function(e){const t=e.cloudDiscoveryMetadata;let n;if(t)try{n=JSON.parse(t)}catch(e){throw(0,u.ii)(S.E)}return{canonicalAuthority:e.authority?I(e.authority):void 0,knownAuthorities:e.knownAuthorities,cloudDiscoveryMetadata:n}}(this.config.auth)):((e,t)=>{const n={cacheLocation:U.Tx.MemoryStorage,temporaryCacheLocation:U.Tx.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new q(e,n,r.d,t)})(this.config.auth.clientId,this.logger);const t={cacheLocation:U.Tx.MemoryStorage,temporaryCacheLocation:U.Tx.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new q(this.config.auth.clientId,t,this.browserCrypto,this.logger),this.tokenCache=new nt(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e){const t=new rt(e);return await t.initialize(),t}trackPageVisibility(){this.atsAsyncMeasurement&&(this.logger.info("Perf: Visibility change detected"),this.atsAsyncMeasurement.increment({visibilityChangeCount:1}))}async initialize(){if(this.logger.trace("initialize called"),this.initialized)return void this.logger.info("initialize has already been called, exiting early.");const e=this.config.system.allowNativeBroker,t=this.performanceClient.startMeasurement(m.Ok.InitializeClientApplication);if(this.eventHandler.emitEvent($.t.INITIALIZE_START),e)try{this.nativeExtensionProvider=await Be.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(e){this.logger.verbose(e)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await h(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),m.Ok.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient)(this.performanceClient)),this.initialized=!0,this.eventHandler.emitEvent($.t.INITIALIZE_END),t.end({allowNativeBroker:e,success:!0})}async handleRedirectPromise(e){this.logger.verbose("handleRedirectPromise called"),X(this.initialized);const t=this.getAllAccounts();if(this.isBrowserEnvironment){const n=e||"";let a=this.redirectResponse.get(n);if(void 0===a){this.eventHandler.emitEvent($.t.HANDLE_REDIRECT_START,U.g_.Redirect),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise");const i=this.browserStorage.getCachedNativeRequest();let r;if(i&&Be.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e)this.logger.trace("handleRedirectPromise - acquiring token from native platform"),r=new Ne(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,U.QN.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,i.accountId,this.nativeInternalStorage,i.correlationId).handleRedirectPromise();else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const t=this.browserStorage.getTemporaryCache(U.n4.CORRELATION_ID,!0)||d.oT.EMPTY_STRING;r=this.createRedirectClient(t).handleRedirectPromise(e)}a=r.then(e=>(e&&(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent($.t.LOGIN_SUCCESS,U.g_.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_SUCCESS,U.g_.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, acquire token success"))),this.eventHandler.emitEvent($.t.HANDLE_REDIRECT_END,U.g_.Redirect),e)).catch(e=>{throw t.length>0?this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_FAILURE,U.g_.Redirect,null,e):this.eventHandler.emitEvent($.t.LOGIN_FAILURE,U.g_.Redirect,null,e),this.eventHandler.emitEvent($.t.HANDLE_REDIRECT_END,U.g_.Redirect),e}),this.redirectResponse.set(n,a)}else this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call");return a}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t),this.preflightBrowserEnvironmentCheck(U.g_.Redirect);const n=this.getAllAccounts().length>0;let a;return n?this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_START,U.g_.Redirect,e):this.eventHandler.emitEvent($.t.LOGIN_START,U.g_.Redirect,e),a=this.nativeExtensionProvider&&this.canUseNative(e)?new Ne(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,U.QN.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e).catch(n=>{if(n instanceof Pe&&Te(n))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(n instanceof x.Jo)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw this.getBrowserStorage().setInteractionInProgress(!1),n}):this.createRedirectClient(t).acquireToken(e),a.catch(e=>{throw n?this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_FAILURE,U.g_.Redirect,null,e):this.eventHandler.emitEvent($.t.LOGIN_FAILURE,U.g_.Redirect,null,e),e})}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(m.Ok.AcquireTokenPopup,t);try{this.logger.verbose("acquireTokenPopup called",t),this.preflightBrowserEnvironmentCheck(U.g_.Popup)}catch(e){return Promise.reject(e)}const a=this.getAllAccounts();let i;return a.length>0?this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_START,U.g_.Popup,e):this.eventHandler.emitEvent($.t.LOGIN_START,U.g_.Popup,e),i=this.canUseNative(e)?this.acquireTokenNative({...e,correlationId:t},U.QN.acquireTokenPopup).then(e=>(this.getBrowserStorage().setInteractionInProgress(!1),n.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),e)).catch(n=>{if(n instanceof Pe&&Te(n))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(n instanceof x.Jo)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.getBrowserStorage().setInteractionInProgress(!1),n}):this.createPopupClient(t).acquireToken(e),i.then(e=>(a.length<this.getAllAccounts().length?this.eventHandler.emitEvent($.t.LOGIN_SUCCESS,U.g_.Popup,e):this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_SUCCESS,U.g_.Popup,e),n.add({accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),n.end({success:!0,requestId:e.requestId}),e)).catch(e=>(a.length>0?this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_FAILURE,U.g_.Popup,null,e):this.eventHandler.emitEvent($.t.LOGIN_FAILURE,U.g_.Popup,null,e),n.end({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),Promise.reject(e)))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){const t=this.getRequestCorrelationId(e),n={...e,prompt:e.prompt,correlationId:t};let a;return this.preflightBrowserEnvironmentCheck(U.g_.Silent),this.ssoSilentMeasurement=this.performanceClient.startMeasurement(m.Ok.SsoSilent,t),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent($.t.SSO_SILENT_START,U.g_.Silent,n),a=this.canUseNative(n)?this.acquireTokenNative(n,U.QN.ssoSilent).catch(e=>{if(e instanceof Pe&&Te(e))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(n.correlationId).acquireToken(n);throw e}):this.createSilentIframeClient(n.correlationId).acquireToken(n),a.then(e=>(this.eventHandler.emitEvent($.t.SSO_SILENT_SUCCESS,U.g_.Silent,e),this.ssoSilentMeasurement?.add({accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e)).catch(e=>{throw this.eventHandler.emitEvent($.t.SSO_SILENT_FAILURE,U.g_.Silent,null,e),this.ssoSilentMeasurement?.end({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.preflightBrowserEnvironmentCheck(U.g_.Silent),this.logger.trace("acquireTokenByCode called",t),this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_BY_CODE_START,U.g_.Silent,e);const n=this.performanceClient.startMeasurement(m.Ok.AcquireTokenByCode,t);try{if(e.code&&e.nativeAccountId)throw(0,T.X_)(W.HL);if(e.code){const a=e.code;let i=this.hybridAuthCodeResponses.get(a);return i?(this.logger.verbose("Existing acquireTokenByCode request found",t),n.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),i=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(e=>(this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_BY_CODE_SUCCESS,U.g_.Silent,e),this.hybridAuthCodeResponses.delete(a),n.add({accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),n.end({success:!0,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e)).catch(e=>{throw this.hybridAuthCodeResponses.delete(a),this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_BY_CODE_FAILURE,U.g_.Silent,null,e),n.end({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e}),this.hybridAuthCodeResponses.set(a,i)),await i}if(e.nativeAccountId){if(this.canUseNative(e,e.nativeAccountId))return await this.acquireTokenNative({...e,correlationId:t},U.QN.acquireTokenByCode,e.nativeAccountId).catch(e=>{throw e instanceof Pe&&Te(e)&&(this.nativeExtensionProvider=void 0),e});throw(0,T.X_)(W.FA)}throw(0,T.X_)(W.Ay)}catch(e){throw this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_BY_CODE_FAILURE,U.g_.Silent,null,e),n.end({errorCode:e instanceof g.u4&&e.errorCode||void 0,subErrorCode:e instanceof g.u4&&e.subError||void 0,success:!1}),e}}async acquireTokenByCodeAsync(e){this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(m.Ok.AcquireTokenByCodeAsync,e.correlationId),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const t=this.createSilentAuthCodeClient(e.correlationId);return await t.acquireToken(e).then(e=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e)).catch(e=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t,n){switch(this.performanceClient.addQueueMeasurement(m.Ok.AcquireTokenFromCache,t.correlationId),n){case U.uu.Default:case U.uu.AccessToken:case U.uu.AccessTokenAndRefreshToken:return h(e.acquireToken.bind(e),m.Ok.SilentCacheClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(t);default:throw(0,c.CP)(y.g$)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(m.Ok.AcquireTokenByRefreshToken,e.correlationId),t){case U.uu.Default:case U.uu.AccessTokenAndRefreshToken:case U.uu.RefreshToken:case U.uu.RefreshTokenAndNetwork:const t=this.createSilentRefreshClient(e.correlationId);return h(t.acquireToken.bind(t),m.Ok.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw(0,c.CP)(y.g$)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(m.Ok.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return h(t.acquireToken.bind(t),m.Ok.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return this.preflightBrowserEnvironmentCheck(U.g_.Redirect),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return this.preflightBrowserEnvironmentCheck(U.g_.Popup),this.createPopupClient(t).logout(e)}catch(e){return Promise.reject(e)}}async clearCache(e){const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return this.logger.verbose("getAllAccounts called"),this.isBrowserEnvironment?this.browserStorage.getAllAccounts(e):[]}getAccount(e){if(this.logger.trace("getAccount called"),0===Object.keys(e).length)return this.logger.warning("getAccount: No accountFilter provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy(e);return t?(this.logger.verbose("getAccount: Account matching provided filter found, returning"),t):(this.logger.verbose("getAccount: No matching account found, returning null"),null)}getAccountByUsername(e){if(this.logger.trace("getAccountByUsername called"),!e)return this.logger.warning("getAccountByUsername: No username provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy({username:e});return t?(this.logger.verbose("getAccountByUsername: Account matching username found, returning"),this.logger.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${e}`),t):(this.logger.verbose("getAccountByUsername: No matching account found, returning null"),null)}getAccountByHomeId(e){if(this.logger.trace("getAccountByHomeId called"),!e)return this.logger.warning("getAccountByHomeId: No homeAccountId provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy({homeAccountId:e});return t?(this.logger.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),this.logger.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${e}`),t):(this.logger.verbose("getAccountByHomeId: No matching account found, returning null"),null)}getAccountByLocalId(e){if(this.logger.trace("getAccountByLocalId called"),!e)return this.logger.warning("getAccountByLocalId: No localAccountId provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy({localAccountId:e});return t?(this.logger.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),this.logger.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${e}`),t):(this.logger.verbose("getAccountByLocalId: No matching account found, returning null"),null)}setActiveAccount(e){this.browserStorage.setActiveAccount(e)}getActiveAccount(){return this.browserStorage.getActiveAccount()}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const n=C.r.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return this.browserStorage.setAccount(n),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}preflightBrowserEnvironmentCheck(e,t=!1){if(this.logger.verbose("preflightBrowserEnvironmentCheck started"),function(e){if(!e)throw(0,T.X_)(W.Ax)}(this.isBrowserEnvironment),function(e,t){const n=Q();if(e===U.g_.Redirect&&n&&!t)throw(0,T.X_)(W.t_)}(e,this.config.system.allowRedirectInIframe),J(),function(){if("undefined"!=typeof window&&window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(`${U.hx.POPUP_NAME_PREFIX}.`))throw(0,T.X_)(W.tj)}(),X(this.initialized),e===U.g_.Redirect&&this.config.cache.cacheLocation===U.Tx.MemoryStorage&&!this.config.cache.storeAuthStateInCookie)throw B(H);e!==U.g_.Redirect&&e!==U.g_.Popup||this.preflightInteractiveRequest(!t)}preflightInteractiveRequest(e){this.logger.verbose("preflightInteractiveRequest called, validating app environment"),J(),e&&this.getBrowserStorage().setInteractionInProgress(!0)}async acquireTokenNative(e,t,n){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw(0,T.X_)(W.q7);return new Ne(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!Be.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case d.NJ.NONE:case d.NJ.CONSENT:case d.NJ.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Ge(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new We(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new et(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,U.QN.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new Re(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new tt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new it(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,U.QN.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e){return this.eventHandler.addEventCallback(e)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){this.eventHandler.enableAccountStorageEvents()}disableAccountStorageEvents(){this.eventHandler.disableAccountStorageEvents()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}getBrowserStorage(){return this.browserStorage}isBrowserEnv(){return this.isBrowserEnvironment}getEventHandler(){return this.eventHandler}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?(0,xe.pn)():d.oT.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||U.xo})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||U.xo})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(m.Ok.AcquireTokenSilent,t);n.add({cacheLookupPolicy:e.cacheLookupPolicy}),this.preflightBrowserEnvironmentCheck(U.g_.Silent),this.logger.verbose("acquireTokenSilent called",t);const a=e.account||this.getActiveAccount();if(!a)throw(0,T.X_)(W.DH);const i={clientId:this.config.auth.clientId,authority:e.authority||d.oT.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:a.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},r=JSON.stringify(i),o=this.activeSilentTokenRequests.get(r);if(void 0===o){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const i=h(this.acquireTokenSilentAsync.bind(this),m.Ok.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},a).then(t=>(this.activeSilentTokenRequests.delete(r),n.add({accessTokenSize:t.accessToken.length,idTokenSize:t.idToken.length}),n.end({success:!0,fromCache:t.fromCache,isNativeBroker:t.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,requestId:t.requestId}),t)).catch(e=>{throw this.activeSilentTokenRequests.delete(r),n.end({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e});return this.activeSilentTokenRequests.set(r,i),{...await i,state:e.state}}return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),n.discard(),{...await o,state:e.state}}async acquireTokenSilentAsync(e,t){let n;if(this.performanceClient.addQueueMeasurement(m.Ok.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_START,U.g_.Silent,e),this.atsAsyncMeasurement=this.performanceClient.startMeasurement(m.Ok.AcquireTokenSilentAsync,e.correlationId),this.atsAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibility),Be.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&t.nativeAccountId){this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform");const a={...e,account:t};n=this.acquireTokenNative(a,U.QN.acquireTokenSilent_silentFlow).catch(async t=>{if(t instanceof Pe&&Te(t))return this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,this.createSilentIframeClient(e.correlationId).acquireToken(e);throw t})}else{this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow");const a=this.createSilentCacheClient(e.correlationId),i=await h(a.initializeSilentRequest.bind(a),m.Ok.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t),r=e.cacheLookupPolicy||U.uu.Default;n=h(this.acquireTokenFromCache.bind(this),m.Ok.AcquireTokenFromCache,this.logger,this.performanceClient,i.correlationId)(a,i,r).catch(t=>{if(e.cacheLookupPolicy===U.uu.AccessToken)throw t;return J(),this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_NETWORK_START,U.g_.Silent,i),h(this.acquireTokenByRefreshToken.bind(this),m.Ok.AcquireTokenByRefreshToken,this.logger,this.performanceClient,i.correlationId)(i,r).catch(e=>{const t=function(e,t,n){const a=!(e instanceof x.Jo&&e.subError!==O.pl),i=e.errorCode===U.hx.INVALID_GRANT_ERROR||e.errorCode===y.g$,r=a&&i||e.errorCode===O.T2||e.errorCode===O.Kw,o=U.ge.includes(n);return r&&o}(e,0,r);if(t)return this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",i.correlationId),h(this.acquireTokenBySilentIframe.bind(this),m.Ok.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i);throw e})})}return n.then(e=>(this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_SUCCESS,U.g_.Silent,e),this.atsAsyncMeasurement?.end({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e)).catch(e=>{throw this.eventHandler.emitEvent($.t.ACQUIRE_TOKEN_FAILURE,U.g_.Silent,null,e),this.atsAsyncMeasurement?.end({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibility)})}}}
,8208:(e,t,n)=>{n.d(t,{$5:()=>h,Ou:()=>m,Rg:()=>_,Yx:()=>b,hz:()=>l,jP:()=>f,kv:()=>u,pn:()=>p});var a=n(1235),i=n(2520),r=n(586),o=n(2051);const s="SHA-256",c=new Uint8Array([1,0,1]),d={name:"RSASSA-PKCS1-v1_5",hash:s,modulusLength:2048,publicExponent:c};function l(e){if(!("crypto"in window))throw e.error("BrowserCrypto: crypto interface is unavailable"),(0,a.X_)(o.KR);e.verbose("BrowserCrypto: modern crypto interface available")}async function u(e,t,n){t?.addQueueMeasurement(i.Ok.Sha256Digest,n);const a=(new TextEncoder).encode(e);return window.crypto.subtle.digest(s,a)}function f(e){return window.crypto.getRandomValues(e)}function p(){return window.crypto.randomUUID()}async function m(e,t){return window.crypto.subtle.generateKey(d,e,t)}async function _(e){return window.crypto.subtle.exportKey(r.Rm,e)}async function h(e,t,n){return window.crypto.subtle.importKey(r.Rm,e,d,t,n)}async function b(e,t){return window.crypto.subtle.sign(d,e,t)}}
,3356:(e,t,n)=>{n.d(t,{Q:()=>D});var a=n(2520),i=n(6925);const r="missing_kid_error",o="missing_alg_error",s={[r]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[o]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class c extends i.u4{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,c.prototype)}}function d(e){return new c(e,s[e])}var l=n(3905);class u{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw d(r);if(!e.alg)throw d(o);const t=new u({typ:e.typ||l.Id.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}var f=n(6093),p=n(6952),m=n(8208),_=n(1235),h=n(586),b=n(2051);class g{constructor(){this.dbName=h.P4,this.version=h.ld,this.tableName=h.Mv,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const n=window.indexedDB.open(this.dbName,this.version);n.addEventListener("upgradeneeded",e=>{e.target.result.createObjectStore(this.tableName)}),n.addEventListener("success",t=>{const n=t;this.db=n.target.result,this.dbOpen=!0,e()}),n.addEventListener("error",()=>t((0,_.X_)(b.ji)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n((0,_.X_)(b.TL));const a=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);a.addEventListener("success",e=>{const n=e;this.closeConnection(),t(n.target.result)}),a.addEventListener("error",e=>{this.closeConnection(),n(e)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((n,a)=>{if(!this.db)return a((0,_.X_)(b.TL));const i=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);i.addEventListener("success",()=>{this.closeConnection(),n()}),i.addEventListener("error",e=>{this.closeConnection(),a(e)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n((0,_.X_)(b.TL));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);a.addEventListener("success",()=>{this.closeConnection(),t()}),a.addEventListener("error",e=>{this.closeConnection(),n(e)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t((0,_.X_)(b.TL));const n=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();n.addEventListener("success",t=>{const n=t;this.closeConnection(),e(n.target.result)}),n.addEventListener("error",e=>{this.closeConnection(),t(e)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n((0,_.X_)(b.TL));const a=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);a.addEventListener("success",e=>{const n=e;this.closeConnection(),t(1===n.target.result)}),a.addEventListener("error",e=>{this.closeConnection(),n(e)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const n=window.indexedDB.deleteDatabase(h.P4);n.addEventListener("success",()=>e(!0)),n.addEventListener("blocked",()=>e(!0)),n.addEventListener("error",()=>t(!1))})}}var v=n(300);class y{constructor(e,t){this.inMemoryCache=new v.k,this.indexedDBCache=new g,this.logger=e,this.storeName=t}handleDatabaseAccessError(e){if(!(e instanceof _.Wt&&e.errorCode===b.ji))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(e){this.handleDatabaseAccessError(e)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(e){this.handleDatabaseAccessError(e)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(e){this.handleDatabaseAccessError(e)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(0===e.length)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(e){this.handleDatabaseAccessError(e)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(e){this.handleDatabaseAccessError(e)}return t}clearInMemory(){this.logger.verbose(`Deleting in-memory keystore ${this.storeName}`),this.inMemoryCache.clear(),this.logger.verbose(`In-memory keystore ${this.storeName} deleted`)}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}class S{constructor(e){this.logger=e,this.asymmetricKeys=new y(this.logger,"asymmetricKeys"),this.symmetricKeys=new y(this.logger,"symmetricKeys")}async clear(){this.asymmetricKeys.clearInMemory(),this.symmetricKeys.clearInMemory();try{return await this.asymmetricKeys.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}}class D{constructor(e,t){this.logger=e,(0,m.hz)(e),this.cache=new S(this.logger),this.performanceClient=t}createNewGuid(){return(0,m.pn)()}base64Encode(e){return(0,f.s$)(e)}base64Decode(e){return(0,p.t)(e)}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement(a.Ok.CryptoOptsGetPublicKeyThumbprint,e.correlationId),n=await(0,m.Ou)(D.EXTRACTABLE,D.POP_KEY_USAGES),i=await(0,m.Rg)(n.publicKey),r=I({e:i.e,kty:i.kty,n:i.n}),o=await this.hashString(r),s=await(0,m.Rg)(n.privateKey),c=await(0,m.$5)(s,!1,["sign"]);return await this.cache.asymmetricKeys.setItem(o,{privateKey:c,publicKey:n.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),o}async removeTokenBindingKey(e){return await this.cache.asymmetricKeys.removeItem(e),!await this.cache.asymmetricKeys.containsKey(e)}async clearKeystore(){return this.cache.clear()}async signJwt(e,t,n,i){const r=this.performanceClient?.startMeasurement(a.Ok.CryptoOptsSignJwt,i),o=await this.cache.asymmetricKeys.getItem(t);if(!o)throw(0,_.X_)(b.YM);const s=await(0,m.Rg)(o.publicKey),c=I(s),d=(0,f.Zj)(JSON.stringify({kid:t})),l=u.getShrHeaderString({...n?.header,alg:s.alg,kid:d}),p=(0,f.Zj)(l);e.cnf={jwk:JSON.parse(c)};const h=`${p}.${(0,f.Zj)(JSON.stringify(e))}`,g=(new TextEncoder).encode(h),v=await(0,m.Yx)(o.privateKey,g),y=`${h}.${(0,f.Qy)(new Uint8Array(v))}`;return r&&r.end({success:!0}),y}async hashString(e){const t=await(0,m.kv)(e),n=new Uint8Array(t);return(0,f.Qy)(n)}}function I(e){return JSON.stringify(e,Object.keys(e).sort())}D.POP_KEY_USAGES=["sign","verify"],D.EXTRACTABLE=!0}
,6952:(e,t,n)=>{n.d(t,{t:()=>r});var a=n(1235),i=n(2051);function r(e){return(new TextDecoder).decode(function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw(0,a.X_)(i.uZ)}const n=atob(t);return Uint8Array.from(n,e=>e.codePointAt(0)||0)}(e))}}
,6093:(e,t,n)=>{function a(e){return encodeURIComponent(r(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function i(e){return o(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function r(e){return o((new TextEncoder).encode(e))}function o(e){const t=Array.from(e,e=>String.fromCodePoint(e)).join("");return btoa(t)}n.d(t,{Qy:()=>i,Zj:()=>a,s$:()=>r})}
,1235:(e,t,n)=>{n.d(t,{Wt:()=>s,X_:()=>c});var a=n(6925),i=n(2051);const r="For more visit: aka.ms/msaljs/browser-errors",o={[i.SD]:"The PKCE code challenge and verifier could not be generated.",[i.KR]:"The crypto object or function is not available.",[i.Zc]:"Navigation URI is empty. Please check stack trace for more info.",[i.pF]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${r}`,[i.Yk]:"Hash does not contain state. Please verify that the request originated from msal.",[i.G_]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${r}`,[i.$P]:"Unable to parse state. Please verify that the request originated from msal.",[i.xK]:"Hash contains state but the interaction type does not match the caller.",[i.Ek]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${r}`,[i.E]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[i.H]:"window.open returned null or undefined window object.",[i.s7]:"User cancelled the flow.",[i.XT]:`Token acquisition in popup failed due to timeout.  ${r}`,[i.UA]:`Token acquisition in iframe failed due to timeout.  ${r}`,[i.t_]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[i.IO]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${r}`,[i.tj]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[i.s8]:"The iframe being monitored was closed prematurely.",[i.T9]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[i.DH]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[i.QQ]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[i.VO]:"No token request found in cache.",[i.i$]:"The cached token request could not be parsed.",[i.aT]:"No cached authority found.",[i.wO]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[i.Wt]:"Invalid cache type",[i.Ax]:"Login and token requests are not supported in non-browser environments.",[i.TL]:"Database is not open!",[i.Rq]:"No network connectivity. Check your internet connection.",[i.Ac]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[i.E8]:"Network request failed. Please check the network trace to determine root cause.",[i.D6]:"Failed to parse network response. Check network trace.",[i.Ud]:"Error loading token to cache.",[i.YM]:"Cryptographic Key or Keypair not found in browser storage.",[i.Oj]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[i.Ay]:"An authorization code or nativeAccountId must be provided to this flow.",[i.HL]:"Request cannot contain both spa code and native account id.",[i.ji]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[i.FA]:`Unable to acquire token from native platform.  ${r}`,[i.sR]:"Timed out while attempting to establish connection to browser extension",[i.Qb]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[i.q7]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${r}`,[i.el]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${r}`,[i.m9]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[i.uZ]:"Invalid base64 encoded string."};i.SD,i.SD,i.KR,i.KR,i.Zc,i.Zc,i.pF,i.pF,i.Yk,i.Yk,i.G_,i.G_,i.$P,i.$P,i.xK,i.xK,i.Ek,i.Ek,i.E,i.E,i.H,i.H,i.s7,i.s7,i.XT,i.XT,i.UA,i.UA,i.t_,i.t_,i.IO,i.IO,i.tj,i.tj,i.s8,i.s8,i.T9,i.T9,i.DH,i.DH,i.QQ,i.QQ,i.VO,i.VO,i.i$,i.i$,i.aT,i.aT,i.wO,i.wO,i.Wt,i.Wt,i.Ax,i.Ax,i.TL,i.TL,i.Rq,i.Rq,i.Ac,i.Ac,i.E8,i.E8,i.D6,i.D6,i.Ud,i.Ud,i.YM,i.YM,i.Oj,i.Oj,i.Ay,i.Ay,i.HL,i.HL,i.ji,i.ji,i.FA,i.FA,i.sR,i.sR,i.Qb,i.Qb,i.q7,i.q7,i.el,i.el,i.m9,i.m9,i.uZ,i.uZ;class s extends a.u4{constructor(e){super(e,o[e]),Object.setPrototypeOf(this,s.prototype),this.name="BrowserAuthError"}}function c(e){return new s(e)}}
,2051:(e,t,n)=>{n.d(t,{$P:()=>d,Ac:()=>M,Ax:()=>A,Ay:()=>R,D6:()=>T,DH:()=>D,E:()=>f,E8:()=>P,Ek:()=>u,FA:()=>j,G_:()=>c,H:()=>p,HL:()=>N,IO:()=>g,KR:()=>i,Oj:()=>H,QQ:()=>I,Qb:()=>z,Rq:()=>k,SD:()=>a,T9:()=>S,TL:()=>L,UA:()=>h,Ud:()=>U,VO:()=>x,Wt:()=>E,XT:()=>_,YM:()=>F,Yk:()=>s,Zc:()=>r,aT:()=>O,el:()=>K,i$:()=>C,ji:()=>B,m9:()=>W,pF:()=>o,q7:()=>G,s7:()=>m,s8:()=>y,sR:()=>V,t_:()=>b,tj:()=>v,uZ:()=>q,wO:()=>w,xK:()=>l});const a="pkce_not_created",i="crypto_nonexistent",r="empty_navigate_uri",o="hash_empty_error",s="no_state_in_hash",c="hash_does_not_contain_known_properties",d="unable_to_parse_state",l="state_interaction_type_mismatch",u="interaction_in_progress",f="popup_window_error",p="empty_window_error",m="user_cancelled",_="monitor_popup_timeout",h="monitor_window_timeout",b="redirect_in_iframe",g="block_iframe_reload",v="block_nested_popups",y="iframe_closed_prematurely",S="silent_logout_unsupported",D="no_account_error",I="silent_prompt_value_error",x="no_token_request_cache_error",C="unable_to_parse_token_request_cache_error",O="no_cached_authority_error",w="auth_request_not_set_error",E="invalid_cache_type",A="non_browser_environment",L="database_not_open",k="no_network_connectivity",M="post_request_failed",P="get_request_failed",T="failed_to_parse_response",U="unable_to_load_token",F="crypto_key_not_found",H="auth_code_required",R="auth_code_or_nativeAccountId_required",N="spa_code_and_nativeAccountId_present",B="database_unavailable",j="unable_to_acquire_token_from_native_platform",V="native_handshake_timeout",z="native_extension_not_installed",G="native_connection_not_established",K="uninitialized_public_client_application",W="native_prompt_not_supported",q="invalid_base64_string"}
,9079:(e,t,n)=>{n.d(t,{b:()=>s});var a=n(2122),i=n(5908),r=n(3938),o=n(8208);class s{constructor(e,t){this.eventCallbacks=new Map,this.logger=e,this.browserCrypto=t,this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}addEventCallback(e){if("undefined"!=typeof window){const t=(0,o.pn)();return this.eventCallbacks.set(t,e),this.logger.verbose(`Event callback registered with id: ${t}`),t}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}enableAccountStorageEvents(){"undefined"!=typeof window&&(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){"undefined"!=typeof window&&(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}emitEvent(e,t,n,a){if("undefined"!=typeof window){const i={eventType:e,interactionType:t||null,payload:n||null,error:a||null,timestamp:Date.now()};this.logger.info(`Emitting event: ${e}`),this.eventCallbacks.forEach((t,n)=>{this.logger.verbose(`Emitting event to callback ${n}: ${e}`),t.apply(null,[i])})}}handleAccountCacheChange(e){try{const t=e.newValue||e.oldValue;if(!t)return;const n=JSON.parse(t);if("object"!=typeof n||!a.r.isAccountEntity(n))return;const o=i.L.toObject(new a.r,n).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(r.t.ACCOUNT_ADDED,void 0,o)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(r.t.ACCOUNT_REMOVED,void 0,o))}catch(e){return}}}}
,3938:(e,t,n)=>{n.d(t,{t:()=>a});const a={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"}}
,1540:(e,t,n)=>{n.d(t,{i:()=>i,u:()=>a});const a="@azure/msal-browser",i="3.7.1"}
,586:(e,t,n)=>{n.d(t,{Bq:()=>l,Fy:()=>o,LC:()=>c,Mv:()=>g,P4:()=>h,QN:()=>f,RG:()=>I,Rm:()=>_,Tx:()=>s,g_:()=>p,ge:()=>y,hx:()=>i,jK:()=>D,ld:()=>b,n4:()=>d,tg:()=>S,uu:()=>v,wD:()=>r,ws:()=>u,xo:()=>m});var a=n(3905);const i={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},r={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},o={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},s={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},c={GET:"GET",POST:"POST"},d={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},l={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},u={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},f={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var p;!function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(p||(p={}));const m={scopes:a.r_},_="jwk",h="msal.db",b=1,g=`${h}.keys`,v={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},y=[v.Default,v.Skip,v.RefreshTokenAndNetwork],S="msal.browser.log.level",D="msal.browser.log.pii",I="msal.browser.performance.enabled"}
,8036:(e,t,n)=>{function a(e,t){return!!e&&!!t&&e===t.split(".")[1]}function i(e,t){const{oid:n,sub:i,tid:r,name:o,tfp:s,acr:c}=t,d=r||s||c||"";return{tenantId:d,localAccountId:n||i||"",name:o,isHomeTenant:a(d,e)}}function r(e,t,n){let a=e;if(t){const{isHomeTenant:n,...i}=t;a={...e,...i}}if(n){const{isHomeTenant:t,...r}=i(e.homeAccountId,n);return a={...a,...r,idTokenClaims:n},a}return a}n.d(t,{$f:()=>r,GI:()=>i,Pc:()=>a})}
,5500:(e,t,n)=>{n.d(t,{X_:()=>r,ly:()=>o});var a=n(773),i=n(711);function r(e,t){const n=function(e){if(!e)throw(0,a.CP)(i.jM);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw(0,a.CP)(i.MH);return t[2]}(e);try{const e=t(n);return JSON.parse(e)}catch(e){throw(0,a.CP)(i.MH)}}function o(e,t){if(0===t||Date.now()-3e5>e+t)throw(0,a.CP)(i.Oo)}}
,5865:(e,t,n)=>{n.d(t,{B:()=>o,j:()=>s});var a=n(773),i=n(3905),r=n(711);function o(e,t){if(!e)throw(0,a.CP)(r.G7);try{const n=t(e);return JSON.parse(n)}catch(e){throw(0,a.CP)(r.XE)}}function s(e){if(!e)throw(0,a.CP)(r.XE);const t=e.split(i.wv.CLIENT_INFO_SEPARATOR,2);return{uid:t[0],utid:t.length<2?i.oT.EMPTY_STRING:t[1]}}}
,265:(e,t,n)=>{function a(e){return e&&(e.tid||e.tfp||e.acr)||null}n.d(t,{M:()=>a})}
,8843:(e,t,n)=>{n.d(t,{Dn:()=>s,Vh:()=>r,Zu:()=>c,cx:()=>l,iM:()=>u});var a=n(7157),i=n(3905);const r={"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},o={tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},s=new Set;function c(e,t){let n;const r=e.canonicalAuthority;if(r){const s=new a.G(r).getUrlComponents().HostNameAndPort;n=d(s,e.cloudDiscoveryMetadata?.metadata,i._Q.CONFIG,t)||d(s,o.metadata,i._Q.HARDCODED_VALUES,t)||e.knownAuthorities}return n||[]}function d(e,t,n,a){if(a?.trace(`getAliasesFromMetadata called with source: ${n}`),e&&t){const i=u(t,e);if(i)return a?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${n}, returning aliases`),i.aliases;a?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${n}`)}return null}function l(e){return u(o.metadata,e)}function u(e,t){for(let n=0;n<e.length;n++){const a=e[n];if(a.aliases.includes(t))return a}return null}o.metadata.forEach(e=>{e.aliases.forEach(e=>{s.add(e)})})}
,8222:(e,t,n)=>{n.d(t,{z:()=>a});const a={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"}}
,5387:(e,t,n)=>{n.d(t,{a:()=>a});const a={Default:0,Adfs:1,Dsts:2,Ciam:3}}
,7812:(e,t,n)=>{n.d(t,{A:()=>a});const a={AAD:"AAD",OIDC:"OIDC"}}
,5908:(e,t,n)=>{n.d(t,{L:()=>p,w:()=>m});var a=n(3905),i=n(6279),r=n(8211),o=n(2122),s=n(773),c=n(8036),d=n(5500),l=n(2129),u=n(8843),f=n(711);class p{constructor(e,t,n,a){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(l.u,l.i),this.staticAuthorityOptions=a}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){const t=this.getAllAccounts(e);return t.length>1?t.sort(e=>e.idTokenClaims?-1:1)[0]:1===t.length?t[0]:null}getBaseAccountInfo(e){const t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(e=>this.getAccountInfoForTenantProfiles(e,t))}getAccountInfoForTenantProfiles(e,t){return this.getTenantProfilesFromAccountEntity(e,t?.tenantId,t)}getTenantedAccountInfoByFilter(e,t,n,a){let i,r=null;if(a&&!this.tenantProfileMatchesFilter(n,a))return null;const o=this.getIdToken(e,t,n.tenantId);return o&&(i=(0,d.X_)(o.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(i,a))?null:(r=(0,c.$f)(e,n,i),r)}getTenantProfilesFromAccountEntity(e,t,n){const a=e.getAccountInfo();let i=a.tenantProfiles||new Map;const r=this.getTokenKeys();if(t){const e=i.get(t);if(!e)return[];i=new Map([[t,e]])}const o=[];return i.forEach(e=>{const t=this.getTenantedAccountInfoByFilter(a,r,e,n);t&&o.push(t)}),o}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||void 0!==t.isHomeTenant&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){if(t){if(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId))return!1;if(t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint))return!1;if(t.username&&!this.matchUsername(e.preferred_username,t.username))return!1;if(t.name&&!this.matchName(e,t.name))return!1;if(t.sid&&!this.matchSid(e,t.sid))return!1}return!0}async saveCacheRecord(e,t){if(!e)throw(0,s.CP)(f.fj);e.account&&this.setAccount(e.account),e.idToken&&!1!==t?.idToken&&this.setIdTokenCredential(e.idToken),e.accessToken&&!1!==t?.accessToken&&await this.saveAccessToken(e.accessToken),e.refreshToken&&!1!==t?.refreshToken&&this.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&this.setAppMetadata(e.appMetadata)}async saveAccessToken(e){const t={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},n=this.getTokenKeys(),a=r.i.fromString(e.target),i=[];n.accessToken.forEach(e=>{if(!this.accessTokenKeyMatchesFilter(e,t,!1))return;const n=this.getAccessTokenCredential(e);n&&this.credentialMatchesFilter(n,t)&&r.i.fromString(n.target).intersectingScopeSets(a)&&i.push(this.removeAccessToken(e))}),await Promise.all(i),this.setAccessTokenCredential(e)}getAccountsFilteredBy(e){const t=this.getAccountKeys(),n=[];return t.forEach(t=>{if(!this.isAccountKey(t,e.homeAccountId))return;const a=this.getAccount(t,this.commonLogger);if(!a)return;if(e.homeAccountId&&!this.matchHomeAccountId(a,e.homeAccountId))return;if(e.username&&!this.matchUsername(a.username,e.username))return;if(e.environment&&!this.matchEnvironment(a,e.environment))return;if(e.realm&&!this.matchRealm(a,e.realm))return;if(e.nativeAccountId&&!this.matchNativeAccountId(a,e.nativeAccountId))return;if(e.authorityType&&!this.matchAuthorityType(a,e.authorityType))return;const i={localAccountId:e?.localAccountId,name:e?.name},r=a.tenantProfiles?.filter(e=>this.tenantProfileMatchesFilter(e,i));r&&0===r.length||n.push(a)}),n}isAccountKey(e,t,n){return!(e.split(a.wv.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||n&&!e.toLowerCase().includes(n.toLowerCase()))}isCredentialKey(e){if(e.split(a.wv.CACHE_KEY_SEPARATOR).length<6)return!1;const t=e.toLowerCase();if(-1===t.indexOf(a.a3.ID_TOKEN.toLowerCase())&&-1===t.indexOf(a.a3.ACCESS_TOKEN.toLowerCase())&&-1===t.indexOf(a.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())&&-1===t.indexOf(a.a3.REFRESH_TOKEN.toLowerCase()))return!1;if(t.indexOf(a.a3.REFRESH_TOKEN.toLowerCase())>-1){const e=`${a.a3.REFRESH_TOKEN}${a.wv.CACHE_KEY_SEPARATOR}${this.clientId}${a.wv.CACHE_KEY_SEPARATOR}`,n=`${a.a3.REFRESH_TOKEN}${a.wv.CACHE_KEY_SEPARATOR}${a.nh}${a.wv.CACHE_KEY_SEPARATOR}`;if(-1===t.indexOf(e.toLowerCase())&&-1===t.indexOf(n.toLowerCase()))return!1}else if(-1===t.indexOf(this.clientId.toLowerCase()))return!1;return!0}credentialMatchesFilter(e,t){if(t.clientId&&!this.matchClientId(e,t.clientId))return!1;if(t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash))return!1;if("string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId))return!1;if(t.environment&&!this.matchEnvironment(e,t.environment))return!1;if(t.realm&&!this.matchRealm(e,t.realm))return!1;if(t.credentialType&&!this.matchCredentialType(e,t.credentialType))return!1;if(t.familyId&&!this.matchFamilyId(e,t.familyId))return!1;if(t.target&&!this.matchTarget(e,t.target))return!1;if((t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash)return!1;if(e.credentialType===a.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(t.tokenType&&!this.matchTokenType(e,t.tokenType))return!1;if(t.tokenType===a.sO.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId))return!1}return!0}getAppMetadataFilteredBy(e){return this.getAppMetadataFilteredByInternal(e.environment,e.clientId)}getAppMetadataFilteredByInternal(e,t){const n=this.getKeys(),a={};return n.forEach(n=>{if(!this.isAppMetadata(n))return;const i=this.getAppMetadata(n);i&&(e&&!this.matchEnvironment(i,e)||t&&!this.matchClientId(i,t)||(a[n]=i))}),a}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let n=null;return t.forEach(t=>{if(!this.isAuthorityMetadata(t)||-1===t.indexOf(this.clientId))return;const a=this.getAuthorityMetadata(t);a&&-1!==a.aliases.indexOf(e)&&(n=a)}),n}async removeAllAccounts(){const e=this.getAccountKeys(),t=[];e.forEach(e=>{t.push(this.removeAccount(e))}),await Promise.all(t)}async removeAccount(e){const t=this.getAccount(e,this.commonLogger);t&&(await this.removeAccountContext(t),this.removeItem(e))}async removeAccountContext(e){const t=this.getTokenKeys(),n=e.generateAccountId(),a=[];t.idToken.forEach(e=>{0===e.indexOf(n)&&this.removeIdToken(e)}),t.accessToken.forEach(e=>{0===e.indexOf(n)&&a.push(this.removeAccessToken(e))}),t.refreshToken.forEach(e=>{0===e.indexOf(n)&&this.removeRefreshToken(e)}),await Promise.all(a)}updateOutdatedCachedAccount(e,t,n){if(t&&t.isSingleTenant()){this.commonLogger?.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");const a=this.getAccountKeys().filter(e=>e.startsWith(t.homeAccountId)),i=[];a.forEach(e=>{const t=this.getCachedAccountEntity(e);t&&i.push(t)});const r=i.find(e=>(0,c.Pc)(e.realm,e.homeAccountId))||i[0];r.tenantProfiles=i.map(e=>({tenantId:e.realm,localAccountId:e.localAccountId,name:e.name,isHomeTenant:(0,c.Pc)(e.realm,e.homeAccountId)}));const s=p.toObject(new o.r,{...r}),d=s.generateAccountKey();return a.forEach(t=>{t!==d&&this.removeOutdatedAccount(e)}),this.setAccount(s),n?.verbose("Updated an outdated account entity in the cache"),s}return t}async removeAccessToken(e){const t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===a.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===a.sO.POP){const e=t.keyId;if(e)try{await this.cryptoImpl.removeTokenBindingKey(e)}catch(e){throw(0,s.CP)(f.ml)}}return this.removeItem(e)}}removeAppMetadata(){return this.getKeys().forEach(e=>{this.isAppMetadata(e)&&this.removeItem(e)}),!0}readAccountFromCache(e){const t=o.r.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,n,i,r){this.commonLogger.trace("CacheManager - getIdToken called");const o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:a.a3.ID_TOKEN,clientId:this.clientId,realm:n},s=this.getIdTokensByFilter(o,t),c=s.size;if(c<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(c>1){let t=s;if(!n){const n=new Map;s.forEach((t,a)=>{t.realm===e.tenantId&&n.set(a,t)});const a=n.size;if(a<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),s.values().next().value;if(1===a)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),n.values().next().value;t=n}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),t.forEach((e,t)=>{this.removeIdToken(t)}),i&&r&&i.addFields({multiMatchedID:s.size},r),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),s.values().next().value}getIdTokensByFilter(e,t){const n=t&&t.idToken||this.getTokenKeys().idToken,a=new Map;return n.forEach(t=>{if(!this.idTokenKeyMatchesFilter(t,{clientId:this.clientId,...e}))return;const n=this.getIdTokenCredential(t);n&&this.credentialMatchesFilter(n,e)&&a.set(t,n)}),a}idTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,n,o,s,c){this.commonLogger.trace("CacheManager - getAccessToken called");const d=r.i.createSearchScopes(t.scopes),l=t.authenticationScheme||a.sO.BEARER,u=l&&l.toLowerCase()!==a.sO.BEARER.toLowerCase()?a.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME:a.a3.ACCESS_TOKEN,f={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:u,clientId:this.clientId,realm:o||e.tenantId,target:d,tokenType:l,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},p=n&&n.accessToken||this.getTokenKeys().accessToken,m=[];p.forEach(e=>{if(this.accessTokenKeyMatchesFilter(e,f,!0)){const t=this.getAccessTokenCredential(e);t&&this.credentialMatchesFilter(t,f)&&m.push(t)}});const _=m.length;return _<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):_>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),m.forEach(e=>{this.removeAccessToken((0,i.Rk)(e))}),s&&c&&s.addFields({multiMatchedAT:m.length},c),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),m[0])}accessTokenKeyMatchesFilter(e,t,n){const a=e.toLowerCase();if(t.clientId&&-1===a.indexOf(t.clientId.toLowerCase()))return!1;if(t.homeAccountId&&-1===a.indexOf(t.homeAccountId.toLowerCase()))return!1;if(t.realm&&-1===a.indexOf(t.realm.toLowerCase()))return!1;if(t.requestedClaimsHash&&-1===a.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target){const e=t.target.asArray();for(let t=0;t<e.length;t++){if(n&&!a.includes(e[t].toLowerCase()))return!1;if(!n&&a.includes(e[t].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){const t=this.getTokenKeys(),n=[];return t.accessToken.forEach(t=>{if(!this.accessTokenKeyMatchesFilter(t,e,!0))return;const a=this.getAccessTokenCredential(t);a&&this.credentialMatchesFilter(a,e)&&n.push(a)}),n}getRefreshToken(e,t,n,i,r){this.commonLogger.trace("CacheManager - getRefreshToken called");const o=t?a.nh:void 0,s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:a.a3.REFRESH_TOKEN,clientId:this.clientId,familyId:o},c=n&&n.refreshToken||this.getTokenKeys().refreshToken,d=[];c.forEach(e=>{if(this.refreshTokenKeyMatchesFilter(e,s)){const t=this.getRefreshTokenCredential(e);t&&this.credentialMatchesFilter(t,s)&&d.push(t)}});const l=d.length;return l<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(l>1&&i&&r&&i.addFields({multiMatchedRT:l},r),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),d[0])}refreshTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.familyId&&-1===n.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),a=Object.keys(n).map(e=>n[e]),i=a.length;if(i<1)return null;if(i>1)throw(0,s.CP)(f.LC);return a[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!(!t||t.familyId!==a.nh)}matchHomeAccountId(e,t){return!("string"!=typeof e.homeAccountId||t!==e.homeAccountId)}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return!(t.toLowerCase()!==e.name?.toLowerCase())}matchUsername(e,t){return!(!e||"string"!=typeof e||t?.toLowerCase()!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const n=(0,u.Zu)(this.staticAuthorityOptions,this.commonLogger);if(n.includes(t)&&n.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){return!(e.realm?.toLowerCase()!==t.toLowerCase())}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){return!(e.credentialType!==a.a3.ACCESS_TOKEN&&e.credentialType!==a.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&r.i.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf(a.ag)}isAuthorityMetadata(e){return-1!==e.indexOf(a.VU.CACHE_KEY)}generateAuthorityMetadataCacheKey(e){return`${a.VU.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const n in t)e[n]=t[n];return e}}class m extends p{setAccount(){throw(0,s.CP)(f.R2)}getAccount(){throw(0,s.CP)(f.R2)}getCachedAccountEntity(){throw(0,s.CP)(f.R2)}setIdTokenCredential(){throw(0,s.CP)(f.R2)}getIdTokenCredential(){throw(0,s.CP)(f.R2)}setAccessTokenCredential(){throw(0,s.CP)(f.R2)}getAccessTokenCredential(){throw(0,s.CP)(f.R2)}setRefreshTokenCredential(){throw(0,s.CP)(f.R2)}getRefreshTokenCredential(){throw(0,s.CP)(f.R2)}setAppMetadata(){throw(0,s.CP)(f.R2)}getAppMetadata(){throw(0,s.CP)(f.R2)}setServerTelemetry(){throw(0,s.CP)(f.R2)}getServerTelemetry(){throw(0,s.CP)(f.R2)}setAuthorityMetadata(){throw(0,s.CP)(f.R2)}getAuthorityMetadata(){throw(0,s.CP)(f.R2)}getAuthorityMetadataKeys(){throw(0,s.CP)(f.R2)}setThrottlingCache(){throw(0,s.CP)(f.R2)}getThrottlingCache(){throw(0,s.CP)(f.R2)}removeItem(){throw(0,s.CP)(f.R2)}containsKey(){throw(0,s.CP)(f.R2)}getKeys(){throw(0,s.CP)(f.R2)}getAccountKeys(){throw(0,s.CP)(f.R2)}getTokenKeys(){throw(0,s.CP)(f.R2)}async clear(){throw(0,s.CP)(f.R2)}updateCredentialCacheKey(){throw(0,s.CP)(f.R2)}removeOutdatedAccount(){throw(0,s.CP)(f.R2)}}}
,2122:(e,t,n)=>{n.d(t,{r:()=>u});var a=n(3905),i=n(5865),r=n(8036),o=n(773),s=n(5387),c=n(265),d=n(7812),l=n(711);class u{generateAccountId(){return[this.homeAccountId,this.environment].join(a.wv.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return u.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){const t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(a.wv.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,n){const f=new u;let p;t.authorityType===s.a.Adfs?f.authorityType=a.cR.ADFS_ACCOUNT_TYPE:t.protocolMode===d.A.AAD?f.authorityType=a.cR.MSSTS_ACCOUNT_TYPE:f.authorityType=a.cR.GENERIC_ACCOUNT_TYPE,e.clientInfo&&n&&(p=(0,i.B)(e.clientInfo,n)),f.clientInfo=e.clientInfo,f.homeAccountId=e.homeAccountId,f.nativeAccountId=e.nativeAccountId;const m=e.environment||t&&t.getPreferredCache();if(!m)throw(0,o.CP)(l.V9);f.environment=m,f.realm=p?.utid||(0,c.M)(e.idTokenClaims)||"",f.localAccountId=p?.uid||e.idTokenClaims.oid||e.idTokenClaims.sub||"";const _=e.idTokenClaims.preferred_username||e.idTokenClaims.upn,h=e.idTokenClaims.emails?e.idTokenClaims.emails[0]:null;if(f.username=_||h||"",f.name=e.idTokenClaims.name,f.cloudGraphHostName=e.cloudGraphHostName,f.msGraphHost=e.msGraphHost,e.tenantProfiles)f.tenantProfiles=e.tenantProfiles;else{const t=[];if(e.idTokenClaims){const n=(0,r.GI)(e.homeAccountId,e.idTokenClaims);t.push(n)}f.tenantProfiles=t}return f}static createFromAccountInfo(e,t,n){const i=new u;return i.authorityType=e.authorityType||a.cR.GENERIC_ACCOUNT_TYPE,i.homeAccountId=e.homeAccountId,i.localAccountId=e.localAccountId,i.nativeAccountId=e.nativeAccountId,i.realm=e.tenantId,i.environment=e.environment,i.username=e.username,i.name=e.name,i.cloudGraphHostName=t,i.msGraphHost=n,i.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),i}static generateHomeAccountId(e,t,n,a,r){if(t!==s.a.Adfs&&t!==s.a.Dsts){if(e)try{const t=(0,i.B)(e,a.base64Decode);if(t.uid&&t.utid)return`${t.uid}.${t.utid}`}catch(e){}n.warning("No client info in response")}return r?.sub||""}static isAccountEntity(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;let a=!0;if(n){const n=e.idTokenClaims||{},i=t.idTokenClaims||{};a=n.iat===i.iat&&n.nonce===i.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&a}}}
,6279:(e,t,n)=>{n.d(t,{As:()=>l,BJ:()=>u,Bm:()=>p,Bx:()=>I,Ed:()=>E,I4:()=>_,Ic:()=>w,Rd:()=>d,Rk:()=>c,Us:()=>S,XL:()=>x,kK:()=>C,l5:()=>A,qQ:()=>D,wq:()=>m,zw:()=>O});var a=n(5500),i=n(773),r=n(3905),o=n(6124),s=n(711);function c(e){return[h(e),b(e),g(e),v(e),y(e)].join(r.wv.CACHE_KEY_SEPARATOR).toLowerCase()}function d(e,t,n,a,i){return{credentialType:r.a3.ID_TOKEN,homeAccountId:e,environment:t,clientId:a,secret:n,realm:i}}function l(e,t,n,c,d,l,u,f,p,m,_,h,b,g,v){const y={homeAccountId:e,credentialType:r.a3.ACCESS_TOKEN,secret:n,cachedAt:o.I.nowSeconds().toString(),expiresOn:u.toString(),extendedExpiresOn:f.toString(),environment:t,clientId:c,realm:d,target:l,tokenType:_||r.sO.BEARER};if(h&&(y.userAssertionHash=h),m&&(y.refreshOn=m.toString()),g&&(y.requestedClaims=g,y.requestedClaimsHash=v),y.tokenType?.toLowerCase()!==r.sO.BEARER.toLowerCase())switch(y.credentialType=r.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME,y.tokenType){case r.sO.POP:const e=(0,a.X_)(n,p);if(!e?.cnf?.kid)throw(0,i.CP)(s.j_);y.keyId=e.cnf.kid;break;case r.sO.SSH:y.keyId=b}return y}function u(e,t,n,a,i,o,s){const c={credentialType:r.a3.REFRESH_TOKEN,homeAccountId:e,environment:t,clientId:a,secret:n};return o&&(c.userAssertionHash=o),i&&(c.familyId=i),s&&(c.expiresOn=s.toString()),c}function f(e){return e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")}function p(e){return!!e&&f(e)&&e.hasOwnProperty("realm")&&e.hasOwnProperty("target")&&(e.credentialType===r.a3.ACCESS_TOKEN||e.credentialType===r.a3.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function m(e){return!!e&&f(e)&&e.hasOwnProperty("realm")&&e.credentialType===r.a3.ID_TOKEN}function _(e){return!!e&&f(e)&&e.credentialType===r.a3.REFRESH_TOKEN}function h(e){return[e.homeAccountId,e.environment].join(r.wv.CACHE_KEY_SEPARATOR).toLowerCase()}function b(e){const t=e.credentialType===r.a3.REFRESH_TOKEN&&e.familyId||e.clientId;return[e.credentialType,t,e.realm||""].join(r.wv.CACHE_KEY_SEPARATOR).toLowerCase()}function g(e){return(e.target||"").toLowerCase()}function v(e){return(e.requestedClaimsHash||"").toLowerCase()}function y(e){return e.tokenType&&e.tokenType.toLowerCase()!==r.sO.BEARER.toLowerCase()?e.tokenType.toLowerCase():""}function S(e,t){const n=0===e.indexOf(r.PN.CACHE_KEY);let a=!0;return t&&(a=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),n&&a}function D(e,t){let n=!1;e&&(n=0===e.indexOf(r.tb.THROTTLING_PREFIX));let a=!0;return t&&(a=t.hasOwnProperty("throttleTime")),n&&a}function I({environment:e,clientId:t}){return[r.ag,e,t].join(r.wv.CACHE_KEY_SEPARATOR).toLowerCase()}function x(e,t){return!!t&&0===e.indexOf(r.ag)&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("environment")}function C(e,t){return!!t&&0===e.indexOf(r.VU.CACHE_KEY)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")}function O(){return o.I.nowSeconds()+r.VU.REFRESH_TIME_SECONDS}function w(e,t,n){e.authorization_endpoint=t.authorization_endpoint,e.token_endpoint=t.token_endpoint,e.end_session_endpoint=t.end_session_endpoint,e.issuer=t.issuer,e.endpointsFromNetwork=n,e.jwks_uri=t.jwks_uri}function E(e,t,n){e.aliases=t.aliases,e.preferred_cache=t.preferred_cache,e.preferred_network=t.preferred_network,e.aliasesFromNetwork=n}function A(e){return e.expiresAt<=o.I.nowSeconds()}}
,957:(e,t,n)=>{n.d(t,{d6:()=>y,uh:()=>S,z:()=>f});var a=n(2190),i=n(5529),r=n(3905),o=n(2129),s=n(8222),c=n(5908),d=n(7812),l=n(773),u=n(711);const f={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},p={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:i.i.Info,correlationId:r.oT.EMPTY_STRING},m={claimsBasedCachingEnabled:!1},_={async sendGetRequestAsync(){throw(0,l.CP)(u.R2)},async sendPostRequestAsync(){throw(0,l.CP)(u.R2)}},h={sku:r.oT.SKU,version:o.i,cpu:r.oT.EMPTY_STRING,os:r.oT.EMPTY_STRING},b={clientSecret:r.oT.EMPTY_STRING,clientAssertion:void 0},g={azureCloudInstance:s.z.None,tenant:`${r.oT.DEFAULT_COMMON_TENANT}`},v={application:{appName:"",appVersion:""}};function y({authOptions:e,systemOptions:t,loggerOptions:n,cacheOptions:r,storageInterface:o,networkInterface:s,cryptoInterface:d,clientCredentials:l,libraryInfo:u,telemetry:y,serverTelemetryManager:S,persistencePlugin:D,serializableCache:I}){const x={...p,...n};return{authOptions:(C=e,{clientCapabilities:[],azureCloudOptions:g,skipAuthorityMetadataCache:!1,...C}),systemOptions:{...f,...t},loggerOptions:x,cacheOptions:{...m,...r},storageInterface:o||new c.w(e.clientId,a.d,new i.Y(x)),networkInterface:s||_,cryptoInterface:d||a.d,clientCredentials:l||b,libraryInfo:{...h,...u},telemetry:{...v,...y},serverTelemetryManager:S||null,persistencePlugin:D||null,serializableCache:I||null};var C}function S(e){return e.authOptions.authority.options.protocolMode===d.A.OIDC}}
,6238:(e,t,n)=>{n.d(t,{AN:()=>k,AW:()=>h,B4:()=>N,C6:()=>l,Cl:()=>H,Cm:()=>O,E2:()=>_,Ex:()=>a,FR:()=>T,Hm:()=>o,I5:()=>j,MQ:()=>E,Pe:()=>i,TC:()=>d,Tm:()=>f,WS:()=>V,Xb:()=>R,cb:()=>A,d5:()=>C,g4:()=>b,gI:()=>M,h0:()=>L,id:()=>u,jU:()=>B,jY:()=>U,je:()=>S,li:()=>w,lo:()=>s,nO:()=>m,nt:()=>c,pZ:()=>g,rC:()=>v,sR:()=>x,sf:()=>F,tJ:()=>y,tP:()=>I,ty:()=>p,xO:()=>r,zJ:()=>P,zO:()=>z,zl:()=>D});const a="client_id",i="redirect_uri",r="response_type",o="response_mode",s="grant_type",c="claims",d="scope",l="refresh_token",u="state",f="nonce",p="prompt",m="code",_="code_challenge",h="code_challenge_method",b="code_verifier",g="client-request-id",v="x-client-SKU",y="x-client-VER",S="x-client-OS",D="x-client-CPU",I="x-client-current-telemetry",x="x-client-last-telemetry",C="x-ms-lib-capability",O="x-app-name",w="x-app-ver",E="post_logout_redirect_uri",A="id_token_hint",L="device_code",k="client_secret",M="client_assertion",P="client_assertion_type",T="token_type",U="req_cnf",F="assertion",H="requested_token_use",R="return_spa_code",N="nativebroker",B="logout_hint",j="sid",V="login_hint",z="domain_hint"}
,2190:(e,t,n)=>{n.d(t,{d:()=>r});var a=n(773),i=n(711);const r={createNewGuid:()=>{throw(0,a.CP)(i.R2)},base64Decode:()=>{throw(0,a.CP)(i.R2)},base64Encode:()=>{throw(0,a.CP)(i.R2)},async getPublicKeyThumbprint(){throw(0,a.CP)(i.R2)},async removeTokenBindingKey(){throw(0,a.CP)(i.R2)},async clearKeystore(){throw(0,a.CP)(i.R2)},async signJwt(){throw(0,a.CP)(i.R2)},async hashString(){throw(0,a.CP)(i.R2)}}}
,6925:(e,t,n)=>{n.d(t,{RD:()=>s,u4:()=>o});var a=n(3905),i=n(6199);const r={[i.g]:"Unexpected error in authentication.",[i.D]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};i.g,i.g,i.D,i.D;class o extends Error{constructor(e,t,n){super(t?`${e}: ${t}`:e),Object.setPrototypeOf(this,o.prototype),this.errorCode=e||a.oT.EMPTY_STRING,this.errorMessage=t||a.oT.EMPTY_STRING,this.subError=n||a.oT.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function s(e,t){return new o(e,t?`${r[e]} ${t}`:r[e])}}
,6199:(e,t,n)=>{n.d(t,{D:()=>i,g:()=>a});const a="unexpected_error",i="post_request_failed"}
,773:(e,t,n)=>{n.d(t,{CP:()=>s,ir:()=>o});var a=n(6925),i=n(711);const r={[i.XE]:"The client info could not be parsed/decoded correctly",[i.G7]:"The client info was empty",[i.MH]:"Token cannot be parsed",[i.jM]:"The token is null or empty",[i.PO]:"Endpoints cannot be resolved",[i.LF]:"Network request failed",[i.Ee]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[i.t4]:"The hash parameters could not be deserialized",[i.b8]:"State was not the expected format",[i.Ku]:"State mismatch error",[i.HV]:"State not found",[i.SR]:"Nonce mismatch error",[i.D7]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[i.Oo]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[i.RU]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[i.zH]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[i.LC]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[i.kU]:"Token request cannot be made without authorization code or refresh token.",[i.S1]:"Cannot remove null or empty scope from ScopeSet",[i.r4]:"Cannot append ScopeSet",[i.S]:"Empty input ScopeSet cannot be processed",[i.Uk]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[i.vS]:"Device code is expired.",[i.XT]:"Device code stopped polling for unknown reasons.",[i.A7]:"Please pass an account object, silent flow is not supported without account information",[i.fj]:"Cache record object was null or undefined.",[i.V9]:"Invalid environment when attempting to create cache entry",[i.nX]:"No account found in cache for given key.",[i.VL]:"No crypto object detected.",[i.ny]:"Unexpected credential type.",[i.eE]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[i.GX]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[i.g$]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[i.pQ]:"User defined timeout for device code polling reached",[i.j_]:"Cannot generate a POP jwt if the token_claims are not populated",[i.Xv]:"Server response does not contain an authorization code to proceed",[i.ml]:"Could not remove the credential's binding key from storage.",[i.cg]:"The provided authority does not support logout",[i.Bf]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[i.Rq]:"No network connectivity. Check your internet connection.",[i.$R]:"User cancelled the flow.",[i.l7]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[i.R2]:"This method has not been implemented",[i.Hs]:"The nested app auth bridge is disabled"};i.XE,i.XE,i.G7,i.G7,i.MH,i.MH,i.jM,i.jM,i.PO,i.PO,i.LF,i.LF,i.Ee,i.Ee,i.t4,i.t4,i.b8,i.b8,i.Ku,i.Ku,i.HV,i.HV,i.SR,i.SR,i.D7,i.D7,i.Oo,i.Oo,i.RU,i.RU,i.zH,i.zH,i.LC,i.LC,i.kU,i.kU,i.S1,i.S1,i.r4,i.r4,i.S,i.S,i.Uk,i.Uk,i.vS,i.vS,i.XT,i.XT,i.A7,i.A7,i.fj,i.fj,i.V9,i.V9,i.nX,i.nX,i.VL,i.VL,i.ny,i.ny,i.eE,i.eE,i.GX,i.GX,i.g$,i.g$,i.pQ,i.pQ,i.j_,i.j_,i.Xv,i.Xv,i.ml,i.ml,i.cg,i.cg,i.Bf,i.Bf,i.Rq,i.Rq,i.$R,i.$R,i.l7,i.l7,i.Hs,i.Hs;class o extends a.u4{constructor(e,t){super(e,t?`${r[e]}: ${t}`:r[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,o.prototype)}}function s(e,t){return new o(e,t)}}
,711:(e,t,n)=>{n.d(t,{$R:()=>z,A7:()=>w,Bf:()=>j,D7:()=>_,Ee:()=>d,G7:()=>i,GX:()=>T,HV:()=>p,Hs:()=>W,Ku:()=>f,LC:()=>v,LF:()=>c,MH:()=>r,Oo:()=>h,PO:()=>s,R2:()=>K,RU:()=>b,Rq:()=>V,S:()=>I,S1:()=>S,SR:()=>m,Uk:()=>x,V9:()=>A,VL:()=>k,XE:()=>a,XT:()=>O,Xv:()=>R,b8:()=>u,cg:()=>B,eE:()=>P,fj:()=>E,g$:()=>U,jM:()=>o,j_:()=>H,kU:()=>y,l7:()=>G,ml:()=>N,nX:()=>L,ny:()=>M,pQ:()=>F,r4:()=>D,t4:()=>l,vS:()=>C,zH:()=>g});const a="client_info_decoding_error",i="client_info_empty_error",r="token_parsing_error",o="null_or_empty_token",s="endpoints_resolution_error",c="network_error",d="openid_config_error",l="hash_not_deserialized",u="invalid_state",f="state_mismatch",p="state_not_found",m="nonce_mismatch",_="auth_time_not_found",h="max_age_transpired",b="multiple_matching_tokens",g="multiple_matching_accounts",v="multiple_matching_appMetadata",y="request_cannot_be_made",S="cannot_remove_empty_scope",D="cannot_append_scopeset",I="empty_input_scopeset",x="device_code_polling_cancelled",C="device_code_expired",O="device_code_unknown_error",w="no_account_in_silent_request",E="invalid_cache_record",A="invalid_cache_environment",L="no_account_found",k="no_crypto_object",M="unexpected_credential_type",P="invalid_assertion",T="invalid_client_credential",U="token_refresh_required",F="user_timeout_reached",H="token_claims_cnf_required_for_signedjwt",R="authorization_code_missing_from_server_response",N="binding_key_not_removed",B="end_session_endpoint_not_supported",j="key_id_missing",V="no_network_connectivity",z="user_canceled",G="missing_tenant_id_error",K="method_not_implemented",W="nested_app_auth_bridge_disabled"}
,3097:(e,t,n)=>{n.d(t,{ii:()=>s});var a=n(6925),i=n(5405);const r={[i.zV]:"A redirect URI is required for all calls, and none has been set.",[i.HB]:"Could not parse the given claims request object.",[i.Bz]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[i.xH]:"URL could not be parsed into appropriate segments.",[i.Ko]:"URL was empty or null.",[i.SE]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[i.C_]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[i.pm]:"Given claims parameter must be a stringified JSON object.",[i.aL]:"Token request was empty and not found in cache.",[i.$h]:"The logout request was null or undefined.",[i.a6]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[i.KU]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[i.E]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[i.Cx]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[i.m_]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[i.aK]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[i.sI]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[i.W9]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[i.c1]:"Invalid authentication header provided",[i.hz]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[i.Bl]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[i.Pv]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};i.zV,i.zV,i.HB,i.HB,i.Bz,i.Bz,i.xH,i.xH,i.Ko,i.Ko,i.SE,i.SE,i.C_,i.C_,i.pm,i.pm,i.aL,i.aL,i.$h,i.$h,i.a6,i.a6,i.KU,i.KU,i.E,i.E,i.Cx,i.Cx,i.m_,i.m_,i.aK,i.aK,i.sI,i.sI,i.W9,i.W9,i.c1,i.c1,i.hz,i.hz,i.Bl,i.Bl,i.Pv,i.Pv;class o extends a.u4{constructor(e){super(e,r[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,o.prototype)}}function s(e){return new o(e)}}
,5405:(e,t,n)=>{n.d(t,{$h:()=>f,Bl:()=>I,Bz:()=>r,C_:()=>d,Cx:()=>h,E:()=>_,HB:()=>i,KU:()=>m,Ko:()=>s,Pv:()=>x,SE:()=>c,W9:()=>y,a6:()=>p,aK:()=>g,aL:()=>u,c1:()=>S,hz:()=>D,m_:()=>b,pm:()=>l,sI:()=>v,xH:()=>o,zV:()=>a});const a="redirect_uri_empty",i="claims_request_parsing_error",r="authority_uri_insecure",o="url_parse_error",s="empty_url_error",c="empty_input_scopes_error",d="invalid_prompt_value",l="invalid_claims",u="token_request_empty",f="logout_request_empty",p="invalid_code_challenge_method",m="pkce_params_missing",_="invalid_cloud_discovery_metadata",h="invalid_authority_metadata",b="untrusted_authority",g="missing_ssh_jwk",v="missing_ssh_kid",y="missing_nonce_authentication_header",S="invalid_authentication_header",D="cannot_set_OIDCOptions",I="cannot_allow_native_broker",x="authority_mismatch"}
,6937:(e,t,n)=>{n.d(t,{Ef:()=>l,Jo:()=>d,cp:()=>u});var a=n(3905),i=n(6925),r=n(5361);const o=[r.vZ,r.Ro,r.lk,r.pl],s=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],c={[r.T2]:"No refresh token found in the cache. Please sign-in.",[r.VP]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[r.Kw]:"Refresh token has expired.",[r.pl]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};r.T2,r.T2,r.VP,r.VP,r.pl,r.pl;class d extends i.u4{constructor(e,t,n,i,r,o,s){super(e,t,n),Object.setPrototypeOf(this,d.prototype),this.timestamp=i||a.oT.EMPTY_STRING,this.traceId=r||a.oT.EMPTY_STRING,this.correlationId=o||a.oT.EMPTY_STRING,this.claims=s||a.oT.EMPTY_STRING,this.name="InteractionRequiredAuthError"}}function l(e,t,n){const a=!!e&&o.indexOf(e)>-1,i=!!n&&s.indexOf(n)>-1,r=!!t&&o.some(e=>t.indexOf(e)>-1);return a||r||i}function u(e){return new d(e,c[e])}}
,5361:(e,t,n)=>{n.d(t,{Kw:()=>r,Ro:()=>s,T2:()=>a,VP:()=>i,lk:()=>c,pl:()=>d,vZ:()=>o});const a="no_tokens_found",i="native_account_unavailable",r="refresh_token_expired",o="interaction_required",s="consent_required",c="login_required",d="bad_token"}
,2586:(e,t,n)=>{n.d(t,{n:()=>i});var a=n(6925);class i extends a.u4{constructor(e,t,n){super(e,t,n),this.name="ServerError",Object.setPrototypeOf(this,i.prototype)}}}
,5529:(e,t,n)=>{n.d(t,{Y:()=>r,i:()=>a});var a,i=n(3905);!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Trace=4]="Trace"}(a||(a={}));class r{constructor(e,t,n){this.level=a.Info;const o=e||r.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||(()=>{}),this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level="number"==typeof o.logLevel?o.logLevel:a.Info,this.correlationId=o.correlationId||i.oT.EMPTY_STRING,this.packageName=t||i.oT.EMPTY_STRING,this.packageVersion=n||i.oT.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:a.Info}}clone(e,t,n){return new r({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:n||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const n=`[${(new Date).toUTCString()}] : [${t.correlationId||this.correlationId||""}] : ${this.packageName}@${this.packageVersion} : ${a[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,n,t.containsPii||!1)}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,t){this.logMessage(e,{logLevel:a.Error,containsPii:!1,correlationId:t||i.oT.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:a.Error,containsPii:!0,correlationId:t||i.oT.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:a.Warning,containsPii:!1,correlationId:t||i.oT.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:a.Warning,containsPii:!0,correlationId:t||i.oT.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:a.Info,containsPii:!1,correlationId:t||i.oT.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:a.Info,containsPii:!0,correlationId:t||i.oT.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:a.Verbose,containsPii:!1,correlationId:t||i.oT.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:a.Verbose,containsPii:!0,correlationId:t||i.oT.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:a.Trace,containsPii:!1,correlationId:t||i.oT.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:a.Trace,containsPii:!0,correlationId:t||i.oT.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}}
,2129:(e,t,n)=>{n.d(t,{i:()=>i,u:()=>a});const a="@azure/msal-common",i="14.6.1"}
,4358:(e,t,n)=>{n.d(t,{H:()=>d});var a=n(3905),i=n(6238),r=n(8211),o=n(3097),s=n(1190),c=n(5405);class d{constructor(){this.parameters=new Map}addResponseTypeCode(){this.parameters.set(i.xO,encodeURIComponent(a.oT.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(i.xO,encodeURIComponent(`${a.oT.TOKEN_RESPONSE_TYPE} ${a.oT.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set(i.Hm,encodeURIComponent(e||a.Sw.QUERY))}addNativeBroker(){this.parameters.set(i.B4,encodeURIComponent("1"))}addScopes(e,t=!0,n=a.r_){!t||n.includes("openid")||e.includes("openid")||n.push("openid");const o=t?[...e||[],...n]:e||[],s=new r.i(o);this.parameters.set(i.TC,encodeURIComponent(s.printScopes()))}addClientId(e){this.parameters.set(i.Ex,encodeURIComponent(e))}addRedirectUri(e){s.D.validateRedirectUri(e),this.parameters.set(i.Pe,encodeURIComponent(e))}addPostLogoutRedirectUri(e){s.D.validateRedirectUri(e),this.parameters.set(i.MQ,encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set(i.cb,encodeURIComponent(e))}addDomainHint(e){this.parameters.set(i.zO,encodeURIComponent(e))}addLoginHint(e){this.parameters.set(i.WS,encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(a.GZ.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(a.GZ.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set(i.I5,encodeURIComponent(e))}addClaims(e,t){const n=this.addClientCapabilitiesToClaims(e,t);s.D.validateClaims(n),this.parameters.set(i.nt,encodeURIComponent(n))}addCorrelationId(e){this.parameters.set(i.pZ,encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set(i.rC,e.sku),this.parameters.set(i.tJ,e.version),e.os&&this.parameters.set(i.je,e.os),e.cpu&&this.parameters.set(i.zl,e.cpu)}addApplicationTelemetry(e){e?.appName&&this.parameters.set(i.Cm,e.appName),e?.appVersion&&this.parameters.set(i.li,e.appVersion)}addPrompt(e){s.D.validatePrompt(e),this.parameters.set(`${i.ty}`,encodeURIComponent(e))}addState(e){e&&this.parameters.set(i.id,encodeURIComponent(e))}addNonce(e){this.parameters.set(i.Tm,encodeURIComponent(e))}addCodeChallengeParams(e,t){if(s.D.validateCodeChallengeParams(e,t),!e||!t)throw(0,o.ii)(c.KU);this.parameters.set(i.E2,encodeURIComponent(e)),this.parameters.set(i.AW,encodeURIComponent(t))}addAuthorizationCode(e){this.parameters.set(i.nO,encodeURIComponent(e))}addDeviceCode(e){this.parameters.set(i.h0,encodeURIComponent(e))}addRefreshToken(e){this.parameters.set(i.C6,encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set(i.g4,encodeURIComponent(e))}addClientSecret(e){this.parameters.set(i.AN,encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set(i.gI,encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set(i.zJ,encodeURIComponent(e))}addOboAssertion(e){this.parameters.set(i.sf,encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set(i.Cl,encodeURIComponent(e))}addGrantType(e){this.parameters.set(i.lo,encodeURIComponent(e))}addClientInfo(){this.parameters.set(a.gR,"1")}addExtraQueryParameters(e){const t=s.D.sanitizeEQParams(e,this.parameters);Object.keys(t).forEach(t=>{this.parameters.set(t,e[t])})}addClientCapabilitiesToClaims(e,t){let n;if(e)try{n=JSON.parse(e)}catch(e){throw(0,o.ii)(c.pm)}else n={};return t&&t.length>0&&(n.hasOwnProperty(a.Os.ACCESS_TOKEN)||(n[a.Os.ACCESS_TOKEN]={}),n[a.Os.ACCESS_TOKEN][a.Os.XMS_CC]={values:t}),JSON.stringify(n)}addUsername(e){this.parameters.set(a.Me.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(a.Me.password,encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(i.FR,a.sO.POP),this.parameters.set(i.jY,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(i.FR,a.sO.SSH),this.parameters.set(i.jY,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set(i.tP,e.generateCurrentRequestHeaderValue()),this.parameters.set(i.sR,e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(i.d5,a.tb.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set(i.jU,encodeURIComponent(e))}createQueryString(){const e=new Array;return this.parameters.forEach((t,n)=>{e.push(`${n}=${t}`)}),e.join("&")}}}
,1190:(e,t,n)=>{n.d(t,{D:()=>o});var a=n(3097),i=n(3905),r=n(5405);class o{static validateRedirectUri(e){if(!e)throw(0,a.ii)(r.zV)}static validatePrompt(e){const t=[];for(const e in i.NJ)t.push(i.NJ[e]);if(t.indexOf(e)<0)throw(0,a.ii)(r.C_)}static validateClaims(e){try{JSON.parse(e)}catch(e){throw(0,a.ii)(r.pm)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw(0,a.ii)(r.KU);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([i.qX.PLAIN,i.qX.S256].indexOf(e)<0)throw(0,a.ii)(r.a6)}static sanitizeEQParams(e,t){return e?(t.forEach((t,n)=>{e[n]&&delete e[n]}),Object.fromEntries(Object.entries(e).filter(e=>""!==e[1]))):{}}}}
,8211:(e,t,n)=>{n.d(t,{i:()=>d});var a=n(3097),i=n(543),r=n(773),o=n(3905),s=n(5405),c=n(711);class d{constructor(e){const t=e?i.x.trimArrayEntries([...e]):[],n=t?i.x.removeEmptyStringsFromArray(t):[];this.validateInputScopes(n),this.scopes=new Set,n.forEach(e=>this.scopes.add(e))}static fromString(e){const t=(e||o.oT.EMPTY_STRING).split(" ");return new d(t)}static createSearchScopes(e){const t=new d(e);return t.containsOnlyOIDCScopes()?t.removeScope(o.oT.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw(0,a.ii)(s.SE)}containsScope(e){const t=this.printScopesLowerCase().split(" "),n=new d(t);return!!e&&n.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(e=>this.containsScope(e))}containsOnlyOIDCScopes(){let e=0;return o.$f.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(e=>this.appendScope(e))}catch(e){throw(0,r.CP)(c.r4)}}removeScope(e){if(!e)throw(0,r.CP)(c.S1);this.scopes.delete(e.trim())}removeOIDCScopes(){o.$f.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw(0,r.CP)(c.S);const t=new Set;return e.scopes.forEach(e=>t.add(e.toLowerCase())),this.scopes.forEach(e=>t.add(e.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw(0,r.CP)(c.S);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),n=e.getScopeCount(),a=this.getScopeCount();return t.size<a+n}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):o.oT.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}}
,2520:(e,t,n)=>{n.d(t,{$L:()=>i,I0:()=>r,Ok:()=>a});const a={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromiseMeasurement",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues"},i={NotStarted:0,InProgress:1,Completed:2},r=new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status","multiMatchedAT","multiMatchedID","multiMatchedRT"])}
,3700:(e,t,n)=>{n.d(t,{g:()=>i,n:()=>r});var a=n(2520);class i{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class r{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:a.$L.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new i}}startPerformanceMeasurement(){return new i}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}}
,7157:(e,t,n)=>{n.d(t,{G:()=>c});var a=n(3097),i=n(543),r=n(3905),o=n(1062),s=n(5405);class c{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw(0,a.ii)(s.Ko);e.includes("#")||(this._urlString=c.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return i.x.endsWith(t,"?")?t=t.slice(0,-1):i.x.endsWith(t,"?/")&&(t=t.slice(0,-2)),i.x.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch(e){throw(0,a.ii)(s.xH)}if(!e.HostNameAndPort||!e.PathSegments)throw(0,a.ii)(s.xH);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw(0,a.ii)(s.Bz)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return c.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),n=t.PathSegments;return!e||0===n.length||n[0]!==r.Nb.COMMON&&n[0]!==r.Nb.ORGANIZATIONS||(n[0]=e),c.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw(0,a.ii)(s.xH);const n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let i=n.AbsolutePath.split("/");return i=i.filter(e=>e&&e.length>0),n.PathSegments=i,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw(0,a.ii)(s.xH);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===r.oT.FORWARD_SLASH){const n=new c(t).getUrlComponents();return n.Protocol+"//"+n.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new c(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!(0,o.F)(e)}}}
,3905:(e,t,n)=>{n.d(t,{$f:()=>o,A1:()=>w,GZ:()=>s,Id:()=>P,JY:()=>A,Ko:()=>M,Me:()=>E,NJ:()=>u,Nb:()=>d,Os:()=>l,PN:()=>x,Sw:()=>m,VU:()=>D,W:()=>L,_Q:()=>I,a3:()=>g,ag:()=>v,bg:()=>p,cR:()=>h,gR:()=>y,hJ:()=>_,li:()=>k,mj:()=>i,nh:()=>S,oT:()=>a,qX:()=>f,qi:()=>c,r_:()=>r,sO:()=>C,tb:()=>O,wv:()=>b});const a={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},i={SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR_RANGE_START:400,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR_RANGE_START:500,SERVER_ERROR_RANGE_END:599},r=[a.OPENID_SCOPE,a.PROFILE_SCOPE,a.OFFLINE_ACCESS_SCOPE],o=[...r,a.EMAIL_SCOPE],s={CONTENT_TYPE:"Content-Type",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},c={ID_TOKEN:"idtoken",CLIENT_INFO:"client.info",ADAL_ID_TOKEN:"adal.idtoken",ERROR:"error",ERROR_DESC:"error.description",ACTIVE_ACCOUNT:"active-account",ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},d={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},l={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},u={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},f={PLAIN:"plain",S256:"S256"},p={QUERY:"query",FRAGMENT:"fragment"},m={...p,FORM_POST:"form_post"},_={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},h={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},b={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},g={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},v="appmetadata",y="client_info",S="1",D={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:86400},I={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},x={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},C={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},O={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},w={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},E={username:"username",password:"password"},A={httpSuccess:200,httpBadRequest:400},L={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},k={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},M={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},P={Jwt:"JWT",Jwk:"JWK",Pop:"pop"}}
,543:(e,t,n)=>{n.d(t,{x:()=>a});class a{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return 0===Object.keys(t).length}catch(e){}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},n=e.split("&"),a=e=>decodeURIComponent(e.replace(/\+/g," "));return n.forEach(e=>{if(e.trim()){const[n,i]=e.split(/=(.+)/g,2);n&&i&&(t[a(n)]=a(i))}}),t}static trimArrayEntries(e){return e.map(e=>e.trim())}static removeEmptyStringsFromArray(e){return e.filter(e=>!!e)}static jsonParseHelper(e){try{return JSON.parse(e)}catch(e){return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}}
,6124:(e,t,n)=>{n.d(t,{I:()=>a});class a{static nowSeconds(){return Math.round((new Date).getTime()/1e3)}static isTokenExpired(e,t){const n=Number(e)||0;return a.nowSeconds()+t>n}static wasClockTurnedBack(e){return Number(e)>a.nowSeconds()}static delay(e,t){return new Promise(n=>setTimeout(()=>n(t),e))}}}
,1062:(e,t,n)=>{n.d(t,{F:()=>o,q:()=>r});var a=n(773),i=n(711);function r(e){return e.startsWith("#/")?e.substring(2):e.startsWith("#")||e.startsWith("?")?e.substring(1):e}function o(e){if(!e||e.indexOf("=")<0)return null;try{const t=r(e),n=Object.fromEntries(new URLSearchParams(t));if(n.code||n.error||n.error_description||n.state)return n}catch(e){throw(0,a.CP)(i.t4)}return null}}
,3891:(e,t,n)=>{n.d(t,{Uh:()=>s,XT:()=>i,_i:()=>r,_r:()=>c,fG:()=>o});var a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},a(e,t)};function i(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var r=function(){return r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function o(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}c((a=a.apply(e,t||[])).next())})}function s(e,t){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],a=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}function c(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),i=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,i++)a[i]=r[o];return a}}
,5278:(e,t,n)=>{n.d(t,{l:()=>r});var a=n(3891),i=n(9405),r=function(e){function t(n,a,r){var o=this,s=a?n+": "+a:n;return o=e.call(this,s)||this,Object.setPrototypeOf(o,t.prototype),o.errorCode=n||i.oT.EMPTY_STRING,o.errorMessage=a||i.oT.EMPTY_STRING,o.subError=r||i.oT.EMPTY_STRING,o.name="AuthError",o}return(0,a.XT)(t,e),t.prototype.setCorrelationId=function(e){this.correlationId=e},t.createUnexpectedError=function(e){return new t("unexpected_error","Unexpected error in authentication.: "+e)},t.createPostRequestFailed=function(e){return new t("post_request_failed","Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details.: "+e)},t}(Error)}
,8124:(e,t,n)=>{n.d(t,{A:()=>r,e:()=>o});var a=n(3891),i=n(5278),r={clientInfoDecodingError:{code:"client_info_decoding_error",desc:"The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause."},clientInfoEmptyError:{code:"client_info_empty_error",desc:"The client info was empty. Please review the trace to determine the root cause."},tokenParsingError:{code:"token_parsing_error",desc:"Token cannot be parsed. Please review stack trace to determine root cause."},nullOrEmptyToken:{code:"null_or_empty_token",desc:"The token is null or empty. Please review the trace to determine the root cause."},endpointResolutionError:{code:"endpoints_resolution_error",desc:"Error: could not resolve endpoints. Please check network and try again."},networkError:{code:"network_error",desc:"Network request failed. Please check network trace to determine root cause."},unableToGetOpenidConfigError:{code:"openid_config_error",desc:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints."},hashNotDeserialized:{code:"hash_not_deserialized",desc:"The hash parameters could not be deserialized. Please review the trace to determine the root cause."},blankGuidGenerated:{code:"blank_guid_generated",desc:"The guid generated was blank. Please review the trace to determine the root cause."},invalidStateError:{code:"invalid_state",desc:"State was not the expected format. Please check the logs to determine whether the request was sent using ProtocolUtils.setRequestState()."},stateMismatchError:{code:"state_mismatch",desc:"State mismatch error. Please check your network. Continued requests may cause cache overflow."},stateNotFoundError:{code:"state_not_found",desc:"State not found"},nonceMismatchError:{code:"nonce_mismatch",desc:"Nonce mismatch error. This may be caused by a race condition in concurrent requests."},nonceNotFoundError:{code:"nonce_not_found",desc:"nonce not found"},authTimeNotFoundError:{code:"auth_time_not_found",desc:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information."},maxAgeTranspiredError:{code:"max_age_transpired",desc:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication."},noTokensFoundError:{code:"no_tokens_found",desc:"No tokens were found for the given scopes, and no authorization code was passed to acquireToken. You must retrieve an authorization code before making a call to acquireToken()."},multipleMatchingTokens:{code:"multiple_matching_tokens",desc:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account."},multipleMatchingAccounts:{code:"multiple_matching_accounts",desc:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account"},multipleMatchingAppMetadata:{code:"multiple_matching_appMetadata",desc:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata"},tokenRequestCannotBeMade:{code:"request_cannot_be_made",desc:"Token request cannot be made without authorization code or refresh token."},appendEmptyScopeError:{code:"cannot_append_empty_scope",desc:"Cannot append null or empty scope to ScopeSet. Please check the stack trace for more info."},removeEmptyScopeError:{code:"cannot_remove_empty_scope",desc:"Cannot remove null or empty scope from ScopeSet. Please check the stack trace for more info."},appendScopeSetError:{code:"cannot_append_scopeset",desc:"Cannot append ScopeSet due to error."},emptyInputScopeSetError:{code:"empty_input_scopeset",desc:"Empty input ScopeSet cannot be processed."},DeviceCodePollingCancelled:{code:"device_code_polling_cancelled",desc:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true."},DeviceCodeExpired:{code:"device_code_expired",desc:"Device code is expired."},DeviceCodeUnknownError:{code:"device_code_unknown_error",desc:"Device code stopped polling for unknown reasons."},NoAccountInSilentRequest:{code:"no_account_in_silent_request",desc:"Please pass an account object, silent flow is not supported without account information"},invalidCacheRecord:{code:"invalid_cache_record",desc:"Cache record object was null or undefined."},invalidCacheEnvironment:{code:"invalid_cache_environment",desc:"Invalid environment when attempting to create cache entry"},noAccountFound:{code:"no_account_found",desc:"No account found in cache for given key."},CachePluginError:{code:"no cache plugin set on CacheManager",desc:"ICachePlugin needs to be set before using readFromStorage or writeFromStorage"},noCryptoObj:{code:"no_crypto_object",desc:"No crypto object detected. This is required for the following operation: "},invalidCacheType:{code:"invalid_cache_type",desc:"Invalid cache type"},unexpectedAccountType:{code:"unexpected_account_type",desc:"Unexpected account type."},unexpectedCredentialType:{code:"unexpected_credential_type",desc:"Unexpected credential type."},invalidAssertion:{code:"invalid_assertion",desc:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515"},invalidClientCredential:{code:"invalid_client_credential",desc:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential"},tokenRefreshRequired:{code:"token_refresh_required",desc:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired."},userTimeoutReached:{code:"user_timeout_reached",desc:"User defined timeout for device code polling reached"},tokenClaimsRequired:{code:"token_claims_cnf_required_for_signedjwt",desc:"Cannot generate a POP jwt if the token_claims are not populated"},noAuthorizationCodeFromServer:{code:"authorization_code_missing_from_server_response",desc:"Server response does not contain an authorization code to proceed"},noAzureRegionDetected:{code:"no_azure_region_detected",desc:"No azure region was detected and no fallback was made available"},accessTokenEntityNullError:{code:"access_token_entity_null",desc:"Access token entity is null, please check logs and cache to ensure a valid access token is present."},bindingKeyNotRemovedError:{code:"binding_key_not_removed",desc:"Could not remove the credential's binding key from storage."},logoutNotSupported:{code:"end_session_endpoint_not_supported",desc:"Provided authority does not support logout."},keyIdMissing:{code:"key_id_missing",desc:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key."}},o=function(e){function t(n,a){var i=e.call(this,n,a)||this;return i.name="ClientAuthError",Object.setPrototypeOf(i,t.prototype),i}return(0,a.XT)(t,e),t.createClientInfoDecodingError=function(e){return new t(r.clientInfoDecodingError.code,r.clientInfoDecodingError.desc+" Failed with error: "+e)},t.createClientInfoEmptyError=function(){return new t(r.clientInfoEmptyError.code,""+r.clientInfoEmptyError.desc)},t.createTokenParsingError=function(e){return new t(r.tokenParsingError.code,r.tokenParsingError.desc+" Failed with error: "+e)},t.createTokenNullOrEmptyError=function(e){return new t(r.nullOrEmptyToken.code,r.nullOrEmptyToken.desc+" Raw Token Value: "+e)},t.createEndpointDiscoveryIncompleteError=function(e){return new t(r.endpointResolutionError.code,r.endpointResolutionError.desc+" Detail: "+e)},t.createNetworkError=function(e,n){return new t(r.networkError.code,r.networkError.desc+" | Fetch client threw: "+n+" | Attempted to reach: "+e.split("?")[0])},t.createUnableToGetOpenidConfigError=function(e){return new t(r.unableToGetOpenidConfigError.code,r.unableToGetOpenidConfigError.desc+" Attempted to retrieve endpoints from: "+e)},t.createHashNotDeserializedError=function(e){return new t(r.hashNotDeserialized.code,r.hashNotDeserialized.desc+" Given Object: "+e)},t.createInvalidStateError=function(e,n){return new t(r.invalidStateError.code,r.invalidStateError.desc+" Invalid State: "+e+", Root Err: "+n)},t.createStateMismatchError=function(){return new t(r.stateMismatchError.code,r.stateMismatchError.desc)},t.createStateNotFoundError=function(e){return new t(r.stateNotFoundError.code,r.stateNotFoundError.desc+":  "+e)},t.createNonceMismatchError=function(){return new t(r.nonceMismatchError.code,r.nonceMismatchError.desc)},t.createAuthTimeNotFoundError=function(){return new t(r.authTimeNotFoundError.code,r.authTimeNotFoundError.desc)},t.createMaxAgeTranspiredError=function(){return new t(r.maxAgeTranspiredError.code,r.maxAgeTranspiredError.desc)},t.createNonceNotFoundError=function(e){return new t(r.nonceNotFoundError.code,r.nonceNotFoundError.desc+":  "+e)},t.createMultipleMatchingTokensInCacheError=function(){return new t(r.multipleMatchingTokens.code,r.multipleMatchingTokens.desc+".")},t.createMultipleMatchingAccountsInCacheError=function(){return new t(r.multipleMatchingAccounts.code,r.multipleMatchingAccounts.desc)},t.createMultipleMatchingAppMetadataInCacheError=function(){return new t(r.multipleMatchingAppMetadata.code,r.multipleMatchingAppMetadata.desc)},t.createTokenRequestCannotBeMadeError=function(){return new t(r.tokenRequestCannotBeMade.code,r.tokenRequestCannotBeMade.desc)},t.createAppendEmptyScopeToSetError=function(e){return new t(r.appendEmptyScopeError.code,r.appendEmptyScopeError.desc+" Given Scope: "+e)},t.createRemoveEmptyScopeFromSetError=function(e){return new t(r.removeEmptyScopeError.code,r.removeEmptyScopeError.desc+" Given Scope: "+e)},t.createAppendScopeSetError=function(e){return new t(r.appendScopeSetError.code,r.appendScopeSetError.desc+" Detail Error: "+e)},t.createEmptyInputScopeSetError=function(){return new t(r.emptyInputScopeSetError.code,""+r.emptyInputScopeSetError.desc)},t.createDeviceCodeCancelledError=function(){return new t(r.DeviceCodePollingCancelled.code,""+r.DeviceCodePollingCancelled.desc)},t.createDeviceCodeExpiredError=function(){return new t(r.DeviceCodeExpired.code,""+r.DeviceCodeExpired.desc)},t.createDeviceCodeUnknownError=function(){return new t(r.DeviceCodeUnknownError.code,""+r.DeviceCodeUnknownError.desc)},t.createNoAccountInSilentRequestError=function(){return new t(r.NoAccountInSilentRequest.code,""+r.NoAccountInSilentRequest.desc)},t.createNullOrUndefinedCacheRecord=function(){return new t(r.invalidCacheRecord.code,r.invalidCacheRecord.desc)},t.createInvalidCacheEnvironmentError=function(){return new t(r.invalidCacheEnvironment.code,r.invalidCacheEnvironment.desc)},t.createNoAccountFoundError=function(){return new t(r.noAccountFound.code,r.noAccountFound.desc)},t.createCachePluginError=function(){return new t(r.CachePluginError.code,""+r.CachePluginError.desc)},t.createNoCryptoObjectError=function(e){return new t(r.noCryptoObj.code,""+r.noCryptoObj.desc+e)},t.createInvalidCacheTypeError=function(){return new t(r.invalidCacheType.code,""+r.invalidCacheType.desc)},t.createUnexpectedAccountTypeError=function(){return new t(r.unexpectedAccountType.code,""+r.unexpectedAccountType.desc)},t.createUnexpectedCredentialTypeError=function(){return new t(r.unexpectedCredentialType.code,""+r.unexpectedCredentialType.desc)},t.createInvalidAssertionError=function(){return new t(r.invalidAssertion.code,""+r.invalidAssertion.desc)},t.createInvalidCredentialError=function(){return new t(r.invalidClientCredential.code,""+r.invalidClientCredential.desc)},t.createRefreshRequiredError=function(){return new t(r.tokenRefreshRequired.code,r.tokenRefreshRequired.desc)},t.createUserTimeoutReachedError=function(){return new t(r.userTimeoutReached.code,r.userTimeoutReached.desc)},t.createTokenClaimsRequiredError=function(){return new t(r.tokenClaimsRequired.code,r.tokenClaimsRequired.desc)},t.createNoAuthCodeInServerResponseError=function(){return new t(r.noAuthorizationCodeFromServer.code,r.noAuthorizationCodeFromServer.desc)},t.createBindingKeyNotRemovedError=function(){return new t(r.bindingKeyNotRemovedError.code,r.bindingKeyNotRemovedError.desc)},t.createLogoutNotSupportedError=function(){return new t(r.logoutNotSupported.code,r.logoutNotSupported.desc)},t.createKeyIdMissingError=function(){return new t(r.keyIdMissing.code,r.keyIdMissing.desc)},t}(i.l)}
,3863:(e,t,n)=>{n.d(t,{Jo:()=>c,Xy:()=>s});var a=n(3891),i=n(5278),r=["interaction_required","consent_required","login_required"],o=["message_only","additional_action","basic_action","user_password_expired","consent_required"],s={noTokensFoundError:{code:"no_tokens_found",desc:"No refresh token found in the cache. Please sign-in."},native_account_unavailable:{code:"native_account_unavailable",desc:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API."}},c=function(e){function t(n,a,i){var r=e.call(this,n,a,i)||this;return r.name="InteractionRequiredAuthError",Object.setPrototypeOf(r,t.prototype),r}return(0,a.XT)(t,e),t.isInteractionRequiredError=function(e,t,n){var a=!!e&&r.indexOf(e)>-1,i=!!n&&o.indexOf(n)>-1,s=!!t&&r.some(function(e){return t.indexOf(e)>-1});return a||s||i},t.createNoTokensFoundError=function(){return new t(s.noTokensFoundError.code,s.noTokensFoundError.desc)},t.createNativeAccountUnavailableError=function(){return new t(s.native_account_unavailable.code,s.native_account_unavailable.desc)},t}(i.l)}
,8064:(e,t,n)=>{n.d(t,{Y:()=>o,i:()=>a});var a,i=n(2169),r=n(9405);!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Trace=4]="Trace"}(a||(a={}));var o=function(){function e(e,t,n){this.level=a.Info,this.localCallback=e.loggerCallback||function(){},this.piiLoggingEnabled=e.piiLoggingEnabled||!1,this.level="number"==typeof e.logLevel?e.logLevel:a.Info,this.correlationId=e.correlationId||r.oT.EMPTY_STRING,this.packageName=t||r.oT.EMPTY_STRING,this.packageVersion=n||r.oT.EMPTY_STRING}return e.prototype.clone=function(t,n,a){return new e({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:a||this.correlationId},t,n)},e.prototype.logMessage=function(e,t){if(!(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)){var n=(new Date).toUTCString(),r=(i.x.isEmpty(t.correlationId)?i.x.isEmpty(this.correlationId)?"["+n+"]":"["+n+"] : ["+this.correlationId+"]":"["+n+"] : ["+t.correlationId+"]")+" : "+this.packageName+"@"+this.packageVersion+" : "+a[t.logLevel]+" - "+e;this.executeCallback(t.logLevel,r,t.containsPii||!1)}},e.prototype.executeCallback=function(e,t,n){this.localCallback&&this.localCallback(e,t,n)},e.prototype.error=function(e,t){this.logMessage(e,{logLevel:a.Error,containsPii:!1,correlationId:t||r.oT.EMPTY_STRING})},e.prototype.errorPii=function(e,t){this.logMessage(e,{logLevel:a.Error,containsPii:!0,correlationId:t||r.oT.EMPTY_STRING})},e.prototype.warning=function(e,t){this.logMessage(e,{logLevel:a.Warning,containsPii:!1,correlationId:t||r.oT.EMPTY_STRING})},e.prototype.warningPii=function(e,t){this.logMessage(e,{logLevel:a.Warning,containsPii:!0,correlationId:t||r.oT.EMPTY_STRING})},e.prototype.info=function(e,t){this.logMessage(e,{logLevel:a.Info,containsPii:!1,correlationId:t||r.oT.EMPTY_STRING})},e.prototype.infoPii=function(e,t){this.logMessage(e,{logLevel:a.Info,containsPii:!0,correlationId:t||r.oT.EMPTY_STRING})},e.prototype.verbose=function(e,t){this.logMessage(e,{logLevel:a.Verbose,containsPii:!1,correlationId:t||r.oT.EMPTY_STRING})},e.prototype.verbosePii=function(e,t){this.logMessage(e,{logLevel:a.Verbose,containsPii:!0,correlationId:t||r.oT.EMPTY_STRING})},e.prototype.trace=function(e,t){this.logMessage(e,{logLevel:a.Trace,containsPii:!1,correlationId:t||r.oT.EMPTY_STRING})},e.prototype.tracePii=function(e,t){this.logMessage(e,{logLevel:a.Trace,containsPii:!0,correlationId:t||r.oT.EMPTY_STRING})},e.prototype.isPiiLoggingEnabled=function(){return this.piiLoggingEnabled||!1},e}()}
,9405:(e,t,n)=>{n.d(t,{$f:()=>u,A1:()=>F,GZ:()=>a,HL:()=>y,JY:()=>L,Ko:()=>P,L:()=>T,Me:()=>A,NJ:()=>p,Nb:()=>r,Os:()=>s,PN:()=>E,Sw:()=>m,VU:()=>O,W:()=>k,Yj:()=>v,_Q:()=>D,a3:()=>g,ag:()=>I,cR:()=>h,gR:()=>x,hJ:()=>_,ko:()=>o,li:()=>M,nh:()=>C,oT:()=>d,qO:()=>f,qX:()=>S,qi:()=>i,r_:()=>l,sO:()=>w,tb:()=>U,wv:()=>b});var a,i,r,o,s,c=n(3891),d={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",REGIONAL_AUTH_NON_MSI_QUERY_STRING:"allowestsrnonmsi=true",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240},l=[d.OPENID_SCOPE,d.PROFILE_SCOPE,d.OFFLINE_ACCESS_SCOPE],u=(0,c._r)(l,[d.EMAIL_SCOPE]);!function(e){e.CONTENT_TYPE="Content-Type",e.RETRY_AFTER="Retry-After",e.CCS_HEADER="X-AnchorMailbox",e.WWWAuthenticate="WWW-Authenticate",e.AuthenticationInfo="Authentication-Info",e.X_MS_REQUEST_ID="x-ms-request-id"}(a||(a={})),function(e){e.ID_TOKEN="idtoken",e.CLIENT_INFO="client.info",e.ADAL_ID_TOKEN="adal.idtoken",e.ERROR="error",e.ERROR_DESC="error.description",e.ACTIVE_ACCOUNT="active-account",e.ACTIVE_ACCOUNT_FILTERS="active-account-filters"}(i||(i={})),function(e){e.COMMON="common",e.ORGANIZATIONS="organizations",e.CONSUMERS="consumers"}(r||(r={})),function(e){e.CLIENT_ID="client_id",e.REDIRECT_URI="redirect_uri",e.RESPONSE_TYPE="response_type",e.RESPONSE_MODE="response_mode",e.GRANT_TYPE="grant_type",e.CLAIMS="claims",e.SCOPE="scope",e.ERROR="error",e.ERROR_DESCRIPTION="error_description",e.ACCESS_TOKEN="access_token",e.ID_TOKEN="id_token",e.REFRESH_TOKEN="refresh_token",e.EXPIRES_IN="expires_in",e.STATE="state",e.NONCE="nonce",e.PROMPT="prompt",e.SESSION_STATE="session_state",e.CLIENT_INFO="client_info",e.CODE="code",e.CODE_CHALLENGE="code_challenge",e.CODE_CHALLENGE_METHOD="code_challenge_method",e.CODE_VERIFIER="code_verifier",e.CLIENT_REQUEST_ID="client-request-id",e.X_CLIENT_SKU="x-client-SKU",e.X_CLIENT_VER="x-client-VER",e.X_CLIENT_OS="x-client-OS",e.X_CLIENT_CPU="x-client-CPU",e.X_CLIENT_CURR_TELEM="x-client-current-telemetry",e.X_CLIENT_LAST_TELEM="x-client-last-telemetry",e.X_MS_LIB_CAPABILITY="x-ms-lib-capability",e.X_APP_NAME="x-app-name",e.X_APP_VER="x-app-ver",e.POST_LOGOUT_URI="post_logout_redirect_uri",e.ID_TOKEN_HINT="id_token_hint",e.DEVICE_CODE="device_code",e.CLIENT_SECRET="client_secret",e.CLIENT_ASSERTION="client_assertion",e.CLIENT_ASSERTION_TYPE="client_assertion_type",e.TOKEN_TYPE="token_type",e.REQ_CNF="req_cnf",e.OBO_ASSERTION="assertion",e.REQUESTED_TOKEN_USE="requested_token_use",e.ON_BEHALF_OF="on_behalf_of",e.FOCI="foci",e.CCS_HEADER="X-AnchorMailbox",e.RETURN_SPA_CODE="return_spa_code",e.NATIVE_BROKER="nativebroker",e.LOGOUT_HINT="logout_hint"}(o||(o={})),function(e){e.ACCESS_TOKEN="access_token",e.XMS_CC="xms_cc"}(s||(s={}));var f,p={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"};!function(e){e.ACCOUNT="account",e.SID="sid",e.LOGIN_HINT="login_hint",e.ID_TOKEN="id_token",e.DOMAIN_HINT="domain_hint",e.ORGANIZATIONS="organizations",e.CONSUMERS="consumers",e.ACCOUNT_ID="accountIdentifier",e.HOMEACCOUNT_ID="homeAccountIdentifier"}(f||(f={}));var m,_,h,b,g,v,y,S={PLAIN:"plain",S256:"S256"};!function(e){e.QUERY="query",e.FRAGMENT="fragment",e.FORM_POST="form_post"}(m||(m={})),function(e){e.IMPLICIT_GRANT="implicit",e.AUTHORIZATION_CODE_GRANT="authorization_code",e.CLIENT_CREDENTIALS_GRANT="client_credentials",e.RESOURCE_OWNER_PASSWORD_GRANT="password",e.REFRESH_TOKEN_GRANT="refresh_token",e.DEVICE_CODE_GRANT="device_code",e.JWT_BEARER="urn:ietf:params:oauth:grant-type:jwt-bearer"}(_||(_={})),function(e){e.MSSTS_ACCOUNT_TYPE="MSSTS",e.ADFS_ACCOUNT_TYPE="ADFS",e.MSAV1_ACCOUNT_TYPE="MSA",e.GENERIC_ACCOUNT_TYPE="Generic"}(h||(h={})),function(e){e.CACHE_KEY_SEPARATOR="-",e.CLIENT_INFO_SEPARATOR="."}(b||(b={})),function(e){e.ID_TOKEN="IdToken",e.ACCESS_TOKEN="AccessToken",e.ACCESS_TOKEN_WITH_AUTH_SCHEME="AccessToken_With_AuthScheme",e.REFRESH_TOKEN="RefreshToken"}(g||(g={})),function(e){e.ACCOUNT="Account",e.CREDENTIAL="Credential",e.ID_TOKEN="IdToken",e.ACCESS_TOKEN="AccessToken",e.REFRESH_TOKEN="RefreshToken",e.APP_METADATA="AppMetadata",e.TEMPORARY="TempCache",e.TELEMETRY="Telemetry",e.UNDEFINED="Undefined",e.THROTTLING="Throttling"}(v||(v={})),function(e){e[e.ADFS=1001]="ADFS",e[e.MSA=1002]="MSA",e[e.MSSTS=1003]="MSSTS",e[e.GENERIC=1004]="GENERIC",e[e.ACCESS_TOKEN=2001]="ACCESS_TOKEN",e[e.REFRESH_TOKEN=2002]="REFRESH_TOKEN",e[e.ID_TOKEN=2003]="ID_TOKEN",e[e.APP_METADATA=3001]="APP_METADATA",e[e.UNDEFINED=9999]="UNDEFINED"}(y||(y={}));var D,I="appmetadata",x="client_info",C="1",O={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:86400};!function(e){e.CONFIG="config",e.CACHE="cache",e.NETWORK="network",e.HARDCODED_VALUES="hardcoded_values"}(D||(D={}));var w,E={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"};!function(e){e.BEARER="Bearer",e.POP="pop",e.SSH="ssh-cert"}(w||(w={}));var A,L,k,M,P,T,U={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},F={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"};!function(e){e.username="username",e.password="password"}(A||(A={})),function(e){e[e.httpSuccess=200]="httpSuccess",e[e.httpBadRequest=400]="httpBadRequest"}(L||(L={})),function(e){e.FAILED_AUTO_DETECTION="1",e.INTERNAL_CACHE="2",e.ENVIRONMENT_VARIABLE="3",e.IMDS="4"}(k||(k={})),function(e){e.CONFIGURED_MATCHES_DETECTED="1",e.CONFIGURED_NO_AUTO_DETECTION="2",e.CONFIGURED_NOT_DETECTED="3",e.AUTO_DETECTION_REQUESTED_SUCCESSFUL="4",e.AUTO_DETECTION_REQUESTED_FAILED="5"}(M||(M={})),function(e){e.NO_CACHE_HIT="0",e.FORCE_REFRESH="1",e.NO_CACHED_ACCESS_TOKEN="2",e.CACHED_ACCESS_TOKEN_EXPIRED="3",e.REFRESH_CACHED_ACCESS_TOKEN="4"}(P||(P={})),function(e){e.Jwt="JWT",e.Jwk="JWK"}(T||(T={}))}
,2169:(e,t,n)=>{n.d(t,{x:()=>i});var a=n(8124),i=function(){function e(){}return e.decodeAuthToken=function(t){if(e.isEmpty(t))throw a.e.createTokenNullOrEmptyError(t);var n=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(t);if(!n||n.length<4)throw a.e.createTokenParsingError("Given token is malformed: "+JSON.stringify(t));return{header:n[1],JWSPayload:n[2],JWSSig:n[3]}},e.isEmpty=function(e){return void 0===e||!e||0===e.length},e.isEmptyObj=function(t){if(t&&!e.isEmpty(t))try{var n=JSON.parse(t);return 0===Object.keys(n).length}catch(e){}return!0},e.startsWith=function(e,t){return 0===e.indexOf(t)},e.endsWith=function(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length},e.queryStringToObject=function(e){var t={},n=e.split("&"),a=function(e){return decodeURIComponent(e.replace(/\+/g," "))};return n.forEach(function(e){if(e.trim()){var n=e.split(/=(.+)/g,2),i=n[0],r=n[1];i&&r&&(t[a(i)]=a(r))}}),t},e.trimArrayEntries=function(e){return e.map(function(e){return e.trim()})},e.removeEmptyStringsFromArray=function(t){return t.filter(function(t){return!e.isEmpty(t)})},e.jsonParseHelper=function(e){try{return JSON.parse(e)}catch(e){return null}},e.matchPattern=function(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)},e}()}
}]);