{"version":3,"file":"Mgt.js","sourceRoot":"","sources":["../../src/Mgt.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React, { ReactNode, ReactElement } from 'react';\nimport ReactDOM from 'react-dom';\nimport { Wc, WcProps, WcTypeProps } from 'wc-react';\nimport { customElementHelper, TemplateRenderedData } from '@microsoft/mgt-element';\n\nexport class Mgt extends Wc {\n  private _templates: Record<string, ReactElement>;\n\n  constructor(props: WcTypeProps) {\n    super(props);\n  }\n\n  protected getTag(): string {\n    let tag: string = super.getTag() as string;\n    const tagPrefix = `${customElementHelper.prefix}-`;\n    if (!tag.startsWith(tagPrefix)) {\n      tag = tagPrefix + tag;\n    }\n\n    return tag;\n  }\n\n  // type mismatch due to version drift\n  // @ts-expect-error - TS2416: Property 'render' in type 'Mgt' is not assignable to the same property in base type 'Wc'\n  public render(): React.DOMElement<React.DOMAttributes<HTMLElement>, HTMLElement> {\n    const tag = this.getTag();\n    if (!tag) {\n      throw new Error('\"wcType\" must be set!');\n    }\n\n    this.processTemplates(this.props.children);\n\n    const templateElements = [];\n\n    if (this._templates) {\n      for (const t in this._templates) {\n        if (Object.prototype.hasOwnProperty.call(this._templates, t)) {\n          const element = React.createElement('template', { key: t, 'data-type': t }, null);\n          templateElements.push(element);\n        }\n      }\n    }\n\n    return React.createElement(tag, { ref: (element: HTMLElement) => this.setRef(element) }, templateElements);\n  }\n\n  /**\n   * Sets the web component reference and syncs the props\n   *\n   * @protected\n   * @param {HTMLElement} element\n   * @memberof Wc\n   */\n  protected setRef(component: HTMLElement) {\n    if (component) {\n      component.addEventListener('templateRendered', this.handleTemplateRendered);\n    }\n    super.setRef(component);\n  }\n\n  /**\n   * Removes all event listeners from web component element\n   *\n   * @protected\n   * @returns\n   * @memberof Mgt\n   */\n  protected cleanUp() {\n    if (!this.element) {\n      return;\n    }\n\n    this.element.removeEventListener('templateRendered', this.handleTemplateRendered);\n\n    super.cleanUp();\n  }\n\n  /**\n   * Renders a template\n   *\n   * @protected\n   * @param {*} e\n   * @returns\n   * @memberof Mgt\n   */\n  protected handleTemplateRendered = (e: CustomEvent<TemplateRenderedData>) => {\n    if (!this._templates) {\n      return;\n    }\n\n    const templateType = e.detail.templateType;\n    const dataContext = e.detail.context;\n    const element = e.detail.element;\n\n    let template = this._templates[templateType];\n\n    if (template) {\n      template = React.cloneElement(template, { dataContext });\n      ReactDOM.render(template, element);\n    }\n  };\n\n  /**\n   * Prepares templates for rendering\n   *\n   * @protected\n   * @param {ReactNode} children\n   * @returns\n   * @memberof Mgt\n   */\n  protected processTemplates(children: ReactNode) {\n    if (!children) {\n      return;\n    }\n\n    const templates: Record<string, ReactElement> = {};\n\n    React.Children.forEach(children, child => {\n      const element = child as ReactElement<{ template: string }>;\n      const template = element?.props?.template;\n      if (template) {\n        templates[template] = element;\n      } else {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/dot-notation\n        templates['default'] = element;\n      }\n    });\n\n    this._templates = templates;\n  }\n}\n\n/**\n * Creates a new React Functional Component that wraps the\n * web component with the specified tag name\n *\n * @template T - optional props type for component\n * @param {(string | Function)} tag\n * @returns React component\n */\nexport const wrapMgt = <T = WcProps>(tag: string) => {\n  const WrapMgt = (props: T, ref: React.ForwardedRef<unknown>): React.CElement<WcTypeProps, Mgt> =>\n    React.createElement(Mgt, { wcType: tag, innerRef: ref, ...props });\n  const component: React.ForwardRefExoticComponent<\n    React.PropsWithoutRef<T & React.HTMLAttributes<unknown>> & React.RefAttributes<unknown>\n  > = React.forwardRef(WrapMgt);\n  return component;\n};\n"]}